<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員簽到 | 科技學會 ATS</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #00f0ff;
            --accent: #8338ec;
            --success: #00ff88;
            --warning: #ffbe0b;
            --danger: #ff006e;
            --late: #ff6b35;
            --early: #845ef7;
            --bg-dark: #0a0e17;
            --bg-card: #131a2b;
            --text-primary: #ffffff;
            --text-secondary: #8892a6;
            --border: #2a3550;
        }

        .light {
            --primary: #0066cc;
            --accent: #6622bb;
            --success: #00aa55;
            --warning: #cc9900;
            --danger: #cc0044;
            --late: #cc5500;
            --early: #6644bb;
            --bg-dark: #f0f4f8;
            --bg-card: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 80%, rgba(0, 240, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(131, 56, 236, 0.1) 0%, transparent 50%);
            animation: bgMove 20s ease-in-out infinite;
        }

        .light .bg-animation::before {
            background:
                radial-gradient(circle at 20% 80%, rgba(0, 102, 204, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(102, 34, 187, 0.15) 0%, transparent 50%);
        }

        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-2%, -2%); }
        }

        /* Grid Pattern */
        .grid-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: -1;
        }

        /* Main Container */
        .container {
            text-align: center;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
        }

        /* Logo */
        .logo {
            margin-bottom: 2rem;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 1rem;
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
        }

        .logo h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo p {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        /* Scan Area */
        .scan-container {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 24px;
            padding: 3rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .scan-icon {
            width: 180px;
            height: 180px;
            margin: 0 auto 2rem;
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(131, 56, 236, 0.1));
            border: 4px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: var(--primary);
            transition: all 0.5s ease;
        }

        .scan-icon.scanning {
            border-color: var(--primary);
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.3);
        }

        .scan-icon.success {
            border-color: var(--success);
            color: var(--success);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
            box-shadow: 0 0 60px rgba(0, 255, 136, 0.4);
            animation: successPop 0.5s ease;
        }

        .scan-icon.error {
            border-color: var(--danger);
            color: var(--danger);
            background: linear-gradient(135deg, rgba(255, 0, 110, 0.2), rgba(255, 0, 110, 0.1));
            box-shadow: 0 0 60px rgba(255, 0, 110, 0.4);
            animation: shake 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 240, 255, 0.4);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 0 30px rgba(0, 240, 255, 0);
            }
        }

        @keyframes successPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        .scan-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .scan-text.success {
            color: var(--success);
        }

        .scan-text.error {
            color: var(--danger);
        }

        .scan-hint {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .scan-hint.success {
            color: var(--success);
        }

        .scan-hint.error {
            color: var(--danger);
        }

        /* Status Display */
        .status-display {
            margin-top: 1.5rem;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .status-display.checkin {
            display: inline-flex;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .status-display.checkout {
            display: inline-flex;
            background: rgba(255, 190, 11, 0.1);
            border: 2px solid var(--warning);
            color: var(--warning);
        }

        /* Time Status Badge */
        .time-status-badge {
            display: none;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .time-status-badge.normal {
            display: inline-flex;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .time-status-badge.late {
            display: inline-flex;
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid var(--late);
            color: var(--late);
        }

        .time-status-badge.early {
            display: inline-flex;
            background: rgba(132, 94, 247, 0.1);
            border: 2px solid var(--early);
            color: var(--early);
        }

        /* Time Display */
        .time-display {
            position: fixed;
            top: 2rem;
            right: 2rem;
            text-align: right;
        }

        .current-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .current-date {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Stats Display */
        .stats-display {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 1rem 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Header Buttons */
        .header-buttons {
            position: fixed;
            top: 2rem;
            left: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-start;
        }

        .version-badge {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }


        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .logo-icon {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .logo h1 {
                font-size: 1.4rem;
            }

            .scan-container {
                padding: 2rem 1.5rem;
            }

            .scan-icon {
                width: 140px;
                height: 140px;
                font-size: 4rem;
            }

            .scan-text {
                font-size: 1.5rem;
            }

            .time-display {
                top: 1rem;
                right: 1rem;
            }

            .current-time {
                font-size: 1.5rem;
            }

            .header-buttons {
                top: 1rem;
                left: 1rem;
            }

            .version-badge, .btn-settings {
                font-size: 0.65rem;
                padding: 0.4rem 0.75rem;
            }

            .stats-display {
                bottom: 1rem;
                gap: 1.5rem;
                padding: 0.75rem 1.5rem;
            }

            .stat-value {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .time-display {
                position: static;
                margin-bottom: 1rem;
                text-align: center;
            }

            .header-buttons {
                position: static;
                flex-direction: row;
                justify-content: center;
                margin-bottom: 1rem;
            }

            .stats-display {
                position: static;
                transform: none;
                margin-top: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="grid-pattern"></div>

    <div class="header-buttons">
        <span class="version-badge">v1.2.0</span>
    </div>

    <div class="time-display">
        <div class="current-time" id="currentTime">--:--:--</div>
        <div class="current-date" id="currentDate">----年--月--日</div>
    </div>

    <div class="container">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-fingerprint"></i>
            </div>
            <h1>會員簽到</h1>
            <p>科技學會 ATS</p>
        </div>

        <div class="scan-container">
            <div class="scan-icon scanning" id="scanIcon">
                <i class="fas fa-credit-card" id="scanIconInner"></i>
            </div>
            <p class="scan-text" id="scanText">請刷會員卡</p>
            <p class="scan-hint" id="scanHint">將磁條卡在讀卡機上刷過</p>

            <div class="status-display" id="statusDisplay">
                <i class="fas fa-check-circle" id="statusIcon"></i>
                <span id="statusText">簽到成功</span>
            </div>

            <div class="time-status-badge" id="timeStatusBadge">
                <i class="fas fa-clock" id="timeStatusIcon"></i>
                <span id="timeStatusText">正常</span>
            </div>
        </div>
    </div>

    <div class="stats-display">
        <div class="stat-item">
            <div class="stat-value" id="statCheckin">0</div>
            <div class="stat-label">今日簽到</div>
        </div>
        <div class="stat-item">
            <div class="stat-value" id="statPresent">0</div>
            <div class="stat-label">目前在場</div>
        </div>
    </div>


    <script>
        // ==================== App State ====================
        let members = [];
        let records = [];
        let cardInputBuffer = '';
        let cardInputTimeout = null;
        let currentDate = new Date().toISOString().split('T')[0];

        // Time settings
        let settings = {
            startTime: '09:00',
            endTime: '17:00',
            enableTimeCheck: true
        };

        // ==================== Initialize ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Theme detection
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.remove('light');
            } else {
                document.body.classList.add('light');
            }

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                document.body.classList.toggle('light', !event.matches);
            });

            // Load settings
            loadSettings();

            // Load demo members
            loadMembers();

            // Update time display
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 1000);

            // Check for day change
            setInterval(checkDayChange, 60000);

            // Update stats
            updateStats();

            // Global keyboard listener
            document.addEventListener('keydown', handleGlobalKeydown);
        });

        // ==================== Settings ====================
        function loadSettings() {
            // Read settings from URL parameters (set by admin page)
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.has('start')) {
                settings.startTime = urlParams.get('start');
            }
            if (urlParams.has('end')) {
                settings.endTime = urlParams.get('end');
            }
            if (urlParams.has('enable')) {
                settings.enableTimeCheck = urlParams.get('enable') === '1';
            }
        }

        // ==================== Time Status Check ====================
        function getTimeStatus(type) {
            if (!settings.enableTimeCheck) return null;

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            const [startHour, startMin] = settings.startTime.split(':').map(Number);
            const startMinutes = startHour * 60 + startMin;

            const [endHour, endMin] = settings.endTime.split(':').map(Number);
            const endMinutes = endHour * 60 + endMin;

            if (type === 'checkin') {
                // Check if late
                if (currentMinutes > startMinutes) {
                    return 'late';
                }
                return 'normal';
            } else if (type === 'checkout') {
                // Check if early leave
                if (currentMinutes < endMinutes) {
                    return 'early';
                }
                return 'normal';
            }

            return 'normal';
        }

        function getTimeStatusText(status) {
            switch (status) {
                case 'late': return '遲到';
                case 'early': return '早退';
                case 'normal': return '正常';
                default: return '';
            }
        }

        function getTimeStatusIcon(status) {
            switch (status) {
                case 'late': return 'fa-clock';
                case 'early': return 'fa-running';
                case 'normal': return 'fa-check-circle';
                default: return 'fa-clock';
            }
        }

        // ==================== Time Display ====================
        function updateTimeDisplay() {
            const now = new Date();
            document.getElementById('currentTime').textContent =
                now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('currentDate').textContent =
                now.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        }

        // ==================== Day Change Check ====================
        function checkDayChange() {
            const today = new Date().toISOString().split('T')[0];
            if (today !== currentDate) {
                // Day has changed - reset incomplete records
                currentDate = today;

                // Mark all incomplete checkins as expired (no checkout needed)
                records.forEach(r => {
                    if (r.type === 'checkin' && !r.checkoutTime) {
                        r.type = 'expired';
                    }
                });

                updateStats();
            }
        }

        // ==================== Card Reader ====================
        function handleGlobalKeydown(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            if (e.key === '%' || e.key === ';' || cardInputBuffer.length > 0) {
                if (e.key === 'Enter') {
                    processCardData(cardInputBuffer);
                    cardInputBuffer = '';
                    clearTimeout(cardInputTimeout);
                    e.preventDefault();
                } else if (e.key.length === 1) {
                    cardInputBuffer += e.key;

                    clearTimeout(cardInputTimeout);
                    cardInputTimeout = setTimeout(() => {
                        if (cardInputBuffer.length > 5) {
                            processCardData(cardInputBuffer);
                        }
                        cardInputBuffer = '';
                    }, 150);

                    e.preventDefault();
                }
            }
        }

        function processCardData(data) {
            console.log('Card data:', data);

            let parsed = null;

            // Parse ATS format: %ATS|會員編號|姓名|班別|學號?
            const atsMatch = data.match(/%ATS\|([^|]+)\|([^|]+)\|([^|]+)\|([^?]+)\??/);
            if (atsMatch) {
                parsed = {
                    id: atsMatch[1],
                    name: atsMatch[2],
                    class: atsMatch[3],
                    number: atsMatch[4]
                };
            }

            // Try simple format
            if (!parsed) {
                const simpleMatch = data.match(/[%;]([^|]+)\|([^|]+)\|([^|]+)\|([^?]+)\??/);
                if (simpleMatch) {
                    parsed = {
                        id: simpleMatch[1],
                        name: simpleMatch[2],
                        class: simpleMatch[3],
                        number: simpleMatch[4]
                    };
                }
            }

            // Try member ID lookup
            if (!parsed) {
                let cleanData = data.replace(/^[%;]/, '').replace(/\?$/, '').trim();
                const member = members.find(m =>
                    m.id === cleanData ||
                    m.number === cleanData ||
                    m.id.toLowerCase() === cleanData.toLowerCase()
                );
                if (member) {
                    parsed = { ...member };
                }
            }

            if (parsed) {
                handleSwipe(parsed);
            } else {
                showError();
            }
        }

        function handleSwipe(member) {
            const now = new Date();
            const today = now.toISOString().split('T')[0];

            // Find today's active checkin for this member
            const todayCheckin = records.find(r => {
                const recordDate = new Date(r.time).toISOString().split('T')[0];
                return r.memberId === member.id && recordDate === today && r.type === 'checkin' && !r.checkoutTime;
            });

            if (todayCheckin) {
                // Checkout (離開)
                todayCheckin.checkoutTime = now.toISOString();
                todayCheckin.type = 'completed';
                const timeStatus = getTimeStatus('checkout');
                showSuccess('checkout', timeStatus);
                playCheckoutSound();
            } else {
                // Checkin (進入)
                records.unshift({
                    memberId: member.id,
                    name: member.name,
                    class: member.class,
                    number: member.number,
                    time: now.toISOString(),
                    type: 'checkin',
                    checkoutTime: null
                });
                const timeStatus = getTimeStatus('checkin');
                showSuccess('checkin', timeStatus);
                playCheckinSound();
            }

            updateStats();
        }

        function showSuccess(type, timeStatus) {
            const scanIcon = document.getElementById('scanIcon');
            const scanIconInner = document.getElementById('scanIconInner');
            const scanText = document.getElementById('scanText');
            const scanHint = document.getElementById('scanHint');
            const statusDisplay = document.getElementById('statusDisplay');
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            const timeStatusBadge = document.getElementById('timeStatusBadge');
            const timeStatusIcon = document.getElementById('timeStatusIcon');
            const timeStatusText = document.getElementById('timeStatusText');

            // Update icon
            scanIcon.classList.remove('scanning', 'error');
            scanIcon.classList.add('success');
            scanIconInner.className = 'fas fa-check';

            // Update text
            scanText.textContent = '刷卡成功';
            scanText.classList.remove('error');
            scanText.classList.add('success');

            if (type === 'checkin') {
                scanHint.textContent = '歡迎進入！';
                statusDisplay.className = 'status-display checkin';
                statusIcon.className = 'fas fa-sign-in-alt';
                statusText.textContent = '已進入';
            } else {
                scanHint.textContent = '再見！';
                statusDisplay.className = 'status-display checkout';
                statusIcon.className = 'fas fa-sign-out-alt';
                statusText.textContent = '已離開';
            }
            scanHint.classList.remove('error');
            scanHint.classList.add('success');

            // Show time status if enabled
            if (timeStatus && settings.enableTimeCheck) {
                timeStatusBadge.className = 'time-status-badge ' + timeStatus;
                timeStatusIcon.className = 'fas ' + getTimeStatusIcon(timeStatus);
                timeStatusText.textContent = getTimeStatusText(timeStatus);
            } else {
                timeStatusBadge.className = 'time-status-badge';
            }

            // Reset after delay
            setTimeout(resetDisplay, 3000);
        }

        function showError() {
            const scanIcon = document.getElementById('scanIcon');
            const scanIconInner = document.getElementById('scanIconInner');
            const scanText = document.getElementById('scanText');
            const scanHint = document.getElementById('scanHint');
            const statusDisplay = document.getElementById('statusDisplay');
            const timeStatusBadge = document.getElementById('timeStatusBadge');

            // Update icon
            scanIcon.classList.remove('scanning', 'success');
            scanIcon.classList.add('error');
            scanIconInner.className = 'fas fa-times';

            // Update text
            scanText.textContent = '刷卡失敗';
            scanText.classList.remove('success');
            scanText.classList.add('error');
            scanHint.textContent = '無法識別卡片';
            scanHint.classList.remove('success');
            scanHint.classList.add('error');

            // Hide status
            statusDisplay.className = 'status-display';
            timeStatusBadge.className = 'time-status-badge';

            playErrorSound();

            // Reset after delay
            setTimeout(resetDisplay, 2000);
        }

        function resetDisplay() {
            const scanIcon = document.getElementById('scanIcon');
            const scanIconInner = document.getElementById('scanIconInner');
            const scanText = document.getElementById('scanText');
            const scanHint = document.getElementById('scanHint');
            const statusDisplay = document.getElementById('statusDisplay');
            const timeStatusBadge = document.getElementById('timeStatusBadge');

            scanIcon.classList.remove('success', 'error');
            scanIcon.classList.add('scanning');
            scanIconInner.className = 'fas fa-credit-card';

            scanText.textContent = '請刷會員卡';
            scanText.classList.remove('success', 'error');
            scanHint.textContent = '將磁條卡在讀卡機上刷過';
            scanHint.classList.remove('success', 'error');

            statusDisplay.className = 'status-display';
            timeStatusBadge.className = 'time-status-badge';
        }

        // ==================== Stats ====================
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];

            const todayRecords = records.filter(r => {
                const recordDate = new Date(r.time).toISOString().split('T')[0];
                return recordDate === today;
            });

            // Unique members who checked in today
            const uniqueCheckins = [...new Set(todayRecords.map(r => r.memberId))].length;

            // Currently present (checked in but not checked out)
            const presentCount = todayRecords.filter(r => r.type === 'checkin' && !r.checkoutTime).length;

            document.getElementById('statCheckin').textContent = uniqueCheckins;
            document.getElementById('statPresent').textContent = presentCount;
        }

        // ==================== Audio ====================
        function playCheckinSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = 880;
                osc.type = 'sine';
                gain.gain.value = 0.3;
                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                osc.stop(ctx.currentTime + 0.15);
            } catch (e) {}
        }

        function playCheckoutSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();

                // First beep
                const osc1 = ctx.createOscillator();
                const gain1 = ctx.createGain();
                osc1.connect(gain1);
                gain1.connect(ctx.destination);
                osc1.frequency.value = 660;
                osc1.type = 'sine';
                gain1.gain.value = 0.3;
                osc1.start();
                gain1.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc1.stop(ctx.currentTime + 0.1);

                // Second beep
                setTimeout(() => {
                    const osc2 = ctx.createOscillator();
                    const gain2 = ctx.createGain();
                    osc2.connect(gain2);
                    gain2.connect(ctx.destination);
                    osc2.frequency.value = 880;
                    osc2.type = 'sine';
                    gain2.gain.value = 0.3;
                    osc2.start();
                    gain2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                    osc2.stop(ctx.currentTime + 0.15);
                }, 120);
            } catch (e) {}
        }

        function playErrorSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.frequency.value = 200;
                osc.type = 'square';
                gain.gain.value = 0.2;
                osc.start();
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.stop(ctx.currentTime + 0.3);
            } catch (e) {}
        }

        // ==================== Load Members ====================
        function loadMembers() {
            // Demo members - in production, this would load from a shared source
            members = [
                { id: 'M001', name: '陳大文', class: '5A', number: '12345' },
                { id: 'M002', name: '李小明', class: '5A', number: '12346' },
                { id: 'M003', name: '張三豐', class: '4B', number: '11234' },
                { id: 'M004', name: '王小虎', class: '4B', number: '11235' },
                { id: 'M005', name: '林志玲', class: '3C', number: '10123' }
            ];
        }
    </script>
</body>
</html>
