<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁßëÊäÄÂ≠∏ÊúÉÁÆ°ÁêÜÂæåÂè∞ | Admin Panel v5.2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4a49b8',
                    }
                }
            }
        }
    </script>
    <style>
        html {
            scroll-behavior: smooth;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-[#181818] text-gray-900 dark:text-gray-100">

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg max-w-md w-full">
            <div class="text-center mb-8">
                <svg class="w-16 h-16 mx-auto mb-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <h1 class="text-2xl font-bold">ÁßëÊäÄÂ≠∏ÊúÉÁÆ°ÁêÜÂæåÂè∞</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Ë´ãÁôªÂÖ•‰ª•ÁπºÁ∫å</p>
            </div>

            <form id="loginForm" onsubmit="return handleLogin(event)" class="space-y-4">
                <div>
                    <label for="loginEmail" class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç</label>
                    <input type="text" id="loginEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç" required>
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-semibold mb-2">ÂØÜÁ¢º</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="Ë´ãËº∏ÂÖ•ÂØÜÁ¢º" required>
                </div>
                <button type="submit" id="loginBtn" class="w-full px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                    ÁôªÂÖ•
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-40">
            <div class="px-6 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <div>
                        <h1 class="text-xl font-bold">ÁßëÊäÄÂ≠∏ÊúÉÁÆ°ÁêÜÂæåÂè∞</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Ê≠°ËøéÂõû‰æÜÔºå<span id="currentUser"></span></p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary transition-colors">ËøîÂõûÂâçÂè∞</a>
                    <button id="logoutBtn" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                        ÁôªÂá∫
                    </button>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- Sidebar -->
            <aside class="w-64 bg-white dark:bg-gray-800 min-h-screen shadow-sm">
                <nav class="p-4 space-y-2">
                    <button data-section="activities" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Ê¥ªÂãïÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="projects" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        <span>Â∞àÊ°àÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="team" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span>ÂúòÈöäÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="contacts" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3 relative">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span>ËÅØÁµ°Ë®äÊÅØ</span>
                        <span id="unreadContactsBadge" class="hidden absolute right-2 top-1/2 -translate-y-1/2 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full min-w-[20px] text-center">0</span>
                    </button>
                    <button data-section="users" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <span>Áî®Êà∂ÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="hero" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
                        </svg>
                        <span>È¶ñÈ†ÅÊ®ôË™û</span>
                    </button>
                    <button data-section="announcements" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                        </svg>
                        <span>ÊúÄÊñ∞Ë®äÊÅØ</span>
                    </button>
                    <button data-section="contactSettings" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>ËÅØÁµ°Ë®≠ÁΩÆ</span>
                    </button>
                    <button data-section="anthemSettings" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                        </svg>
                        <span>ÊúÉÊ≠åË®≠ÁΩÆ</span>
                    </button>
                    <button data-section="visitorStats" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>Ë®™ÂÆ¢Áµ±Ë®à</span>
                    </button>
                    <button data-section="profile" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>ÂÄã‰∫∫Ë≥áÊñô</span>
                    </button>

                    <!-- ÂàÜÈöîÁ∑ö -->
                    <div class="border-t border-gray-200 dark:border-gray-700 my-3"></div>
                    <p class="px-4 text-xs text-gray-500 dark:text-gray-400 font-semibold uppercase tracking-wider mb-2">ÈÄ≤ÈöéÂäüËÉΩ</p>

                    <button data-section="memberProfiles" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>ÊúÉÂì°Ê™îÊ°à</span>
                    </button>
                    <button data-section="pointsSystem" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Á©çÂàÜÁ≥ªÁµ±</span>
                    </button>
                    <button data-section="achievements" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                        <span>ÊàêÂ∞±ÂæΩÁ´†</span>
                    </button>
                    <button data-section="eventRegistration" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        <span>Ê¥ªÂãïÂ†±Âêç</span>
                    </button>
                    <button data-section="qrCheckin" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                        </svg>
                        <span>QRÁ∞ΩÂà∞</span>
                    </button>
                    <button data-section="calendarView" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Ë°å‰∫ãÊõÜ</span>
                    </button>
                    <button data-section="votingSystem" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                        <span>ÊäïÁ•®Á≥ªÁµ±</span>
                    </button>
                    <button data-section="surveys" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>ÂïèÂç∑Ë™øÊü•</span>
                    </button>
                    <button data-section="resourceBooking" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <span>Ë≥áÊ∫êÈ†êÁ¥Ñ</span>
                    </button>
                    <button data-section="notificationCenter" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span>ÈÄöÁü•‰∏≠ÂøÉ</span>
                    </button>
                    <button data-section="forum" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"></path>
                        </svg>
                        <span>Ë®éË´ñÂçÄ</span>
                    </button>
                    <button data-section="photoGallery" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Ê¥ªÂãïÁõ∏Á∞ø</span>
                    </button>
                    <button data-section="executives" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <span>ÂππÈÉ®ÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="finance" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span>Ë≤°ÂãôÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="guestbook" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                        </svg>
                        <span>Ë®™ÂÆ¢ÁïôË®Ä</span>
                    </button>
                    <button data-section="faq" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Â∏∏Ë¶ãÂïèÈ°å</span>
                    </button>
                    <button data-section="quickNotes" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        <span>Âø´ÈÄüÁ≠ÜË®ò</span>
                    </button>
                    <button data-section="todoList" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        <span>ÂæÖËæ¶‰∫ãÈ†Ö</span>
                    </button>
                    <button data-section="maintenance" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>Á∂≠Ë≠∑Ê®°Âºè</span>
                    </button>
                    <button data-section="themeSettings" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
                        </svg>
                        <span>‰∏ªÈ°åË®≠ÁΩÆ</span>
                    </button>

                    <!-- ÂàÜÈöîÁ∑ö - Êõ¥Â§öÂäüËÉΩ -->
                    <div class="border-t border-gray-200 dark:border-gray-700 my-3"></div>
                    <p class="px-4 text-xs text-gray-500 dark:text-gray-400 font-semibold uppercase tracking-wider mb-2">Êõ¥Â§öÂäüËÉΩ</p>

                    <button data-section="emailTemplates" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span>ÈÉµ‰ª∂Ê®°Êùø</span>
                    </button>
                    <button data-section="socialLinks" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                        </svg>
                        <span>Á§æÁæ§ÈÄ£Áµê</span>
                    </button>
                    <button data-section="meetingMinutes" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>ÊúÉË≠∞Ë®òÈåÑ</span>
                    </button>
                    <button data-section="documentLibrary" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>Êñá‰ª∂Â∫´</span>
                    </button>
                    <button data-section="learningResources" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <span>ÊïôÂ≠∏Ë≥áÊ∫ê</span>
                    </button>
                    <button data-section="projectTracker" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
                        </svg>
                        <span>Â∞àÊ°àËøΩËπ§</span>
                    </button>
                    <button data-section="teamGroups" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span>Â∞èÁµÑÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="attendanceRecords" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                        <span>ËÄÉÂã§Ë®òÈåÑ</span>
                    </button>
                    <button data-section="rewardsPenalties" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                        <span>ÁçéÊá≤Ë®òÈåÑ</span>
                    </button>
                    <button data-section="sponsors" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <span>Ë¥äÂä©ÂïÜ</span>
                    </button>
                    <button data-section="partners" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span>Âêà‰ΩúÂ§•‰º¥</span>
                    </button>
                    <button data-section="competitions" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                        <span>ÊØîË≥ΩË®òÈåÑ</span>
                    </button>
                    <button data-section="certificates" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                        <span>Ë≠âÊõ∏ÁîüÊàê</span>
                    </button>
                    <button data-section="bugReports" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <span>ÂïèÈ°åÂõûÂ†±</span>
                    </button>
                    <button data-section="suggestionBox" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <span>ÊÑèË¶ãÁÆ±</span>
                    </button>
                    <button data-section="knowledgeBase" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                        </svg>
                        <span>Áü•Ë≠òÂ∫´</span>
                    </button>
                    <button data-section="tagManagement" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        <span>Ê®ôÁ±§ÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="dataExport" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        <span>Êï∏ÊìöÂåØÂá∫</span>
                    </button>
                    <button data-section="systemLogs" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>Á≥ªÁµ±Êó•Ë™å</span>
                    </button>
                    <button data-section="backupRestore" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path>
                        </svg>
                        <span>ÂÇô‰ªΩÈÇÑÂéü</span>
                    </button>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-8">
                <!-- Activities Section -->
                <div id="activitiesSection" class="section">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Ê¥ªÂãïÁÆ°ÁêÜ</h2>
                            <button id="addActivityBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                + Êñ∞Â¢ûÊ¥ªÂãï
                            </button>
                        </div>

                        <!-- Activities List -->
                        <div id="activitiesLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="activitiesList" class="space-y-4 hidden"></div>
                        <div id="activitiesEmptyState" class="text-center py-12 hidden">
                            <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°Ê¥ªÂãïË≥áÊñô</p>
                        </div>
                    </div>
                </div>

                <!-- Projects Section -->
                <div id="projectsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Â∞àÊ°àÁÆ°ÁêÜ</h2>
                            <button id="addProjectBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                + Êñ∞Â¢ûÂ∞àÊ°à
                            </button>
                        </div>

                        <!-- Projects List -->
                        <div id="projectsLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="projectsList" class="space-y-4 hidden"></div>
                        <div id="projectsEmptyState" class="text-center py-12 hidden">
                            <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°Â∞àÊ°àË≥áÊñô</p>
                        </div>
                    </div>
                </div>

                <!-- Team Section -->
                <div id="teamSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ÂúòÈöäÁÆ°ÁêÜ</h2>
                            <button id="addTeamMemberBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                + Êñ∞Â¢ûÊàêÂì°
                            </button>
                        </div>

                        <!-- Team Members List -->
                        <div id="teamList" class="space-y-4">
                            <!-- Team members will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Contacts Section -->
                <div id="contactsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ËÅØÁµ°Ë®äÊÅØ</h2>
                            <div class="flex space-x-2 items-center">
                                <button onclick="filterContacts('all')" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold transition-colors">
                                    ÂÖ®ÈÉ®
                                </button>
                                <button onclick="filterContacts('unread')" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold transition-colors">
                                    Êú™ËÆÄ
                                </button>
                                <button onclick="filterContacts('replied')" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold transition-colors">
                                    Â∑≤ÂõûË¶Ü
                                </button>
                                <span class="border-l border-gray-300 dark:border-gray-600 h-6 mx-2"></span>
                                <button onclick="deleteAllContacts()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                    ÂÖ®ÈÉ®Âà™Èô§
                                </button>
                            </div>
                        </div>

                        <!-- Contacts List -->
                        <div id="contactsLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="contactsList" class="space-y-4 hidden"></div>
                        <div id="contactsEmptyState" class="text-center py-12 hidden">
                            <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°ËÅØÁµ°Ë®äÊÅØ</p>
                        </div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="usersSection" class="section hidden">
                    <!-- Áî®Êà∂Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Á∏ΩÁî®Êà∂</p>
                                    <p class="text-2xl font-bold" id="userStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üë•</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">ÁÆ°ÁêÜÂì°</p>
                                    <p class="text-2xl font-bold" id="userStatAdmin">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üëë</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Â∑≤ÊâπÂáÜ</p>
                                    <p class="text-2xl font-bold" id="userStatApproved">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100 text-sm">ÂæÖÂØ©Ê†∏</p>
                                    <p class="text-2xl font-bold" id="userStatPending">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚è≥</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Â∑≤ÊãíÁµï</p>
                                    <p class="text-2xl font-bold" id="userStatRejected">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚ùå</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üë•</span> Áî®Êà∂ÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportUsersToCSV()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">
                                    üì• ÂåØÂá∫CSV
                                </button>
                                <button id="addUserBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢ûÁî®Êà∂
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ËßíËâ≤:</label>
                                <select id="userFilterRole" onchange="filterUsersAdvanced()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="admin">üëë ÁÆ°ÁêÜÂì°</option>
                                    <option value="moderator">üõ°Ô∏è Áâà‰∏ª</option>
                                    <option value="user">üë§ ÊôÆÈÄöÁî®Êà∂</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÁãÄÊÖã:</label>
                                <select id="userFilterStatus" onchange="filterUsersAdvanced()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="approved">‚úÖ Â∑≤ÊâπÂáÜ</option>
                                    <option value="pending">‚è≥ ÂæÖÂØ©Ê†∏</option>
                                    <option value="rejected">‚ùå Â∑≤ÊãíÁµï</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[200px]">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÊêúÂ∞ã:</label>
                                <input type="text" id="userSearchInput" oninput="filterUsersAdvanced()" placeholder="ÂßìÂêç„ÄÅÈÉµÁÆ±..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                            </div>
                            <button onclick="clearUserFilters()" class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                ‚úï Ê∏ÖÈô§
                            </button>
                        </div>

                        <!-- Users List -->
                        <div id="usersLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="usersList" class="space-y-4 hidden"></div>
                        <div id="usersEmptyState" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">üë§</div>
                            <p class="text-gray-500 dark:text-gray-400 text-lg">Êö´ÁÑ°Áî®Êà∂Ë≥áÊñô</p>
                            <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">ÈªûÊìä„ÄåÊñ∞Â¢ûÁî®Êà∂„Äç‰æÜÂª∫Á´ãÁ¨¨‰∏Ä‰ΩçÁî®Êà∂</p>
                        </div>
                    </div>
                </div>

                <!-- Hero Section -->
                <div id="heroSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">È¶ñÈ†ÅÊ®ôË™ûË®≠ÁΩÆ</h2>
                        </div>

                        <form id="heroForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2">‰∏ªÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ê≠°Ëøé‰æÜÂà∞ÁßëÊäÄÂ≠∏ÊúÉ">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÂâØÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroSubtitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Êé¢Á¥¢ÁßëÊäÄÔºåÂâµÊñ∞Êú™‰æÜ">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">‰∏ªÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ê¨¢ËøéÊù•Âà∞ÁßëÊäÄÂ≠¶‰ºö">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÂâØÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroSubtitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Êé¢Á¥¢ÁßëÊäÄÔºåÂàõÊñ∞Êú™Êù•">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">‰∏ªÊ®ôÈ°åÔºàEnglishÔºâ</label>
                                <input type="text" id="heroTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Welcome to Tech Society">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÂâØÊ®ôÈ°åÔºàEnglishÔºâ</label>
                                <input type="text" id="heroSubtitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Explore Technology, Innovate the Future">
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                    ÂÑ≤Â≠òÊ®ôË™û
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Announcements Section -->
                <div id="announcementsSection" class="section hidden">
                    <!-- Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">ÂÖ®ÈÉ®ÂÖ¨Âëä</p>
                                    <p class="text-2xl font-bold" id="annStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üì¢</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">ÂïüÁî®‰∏≠</p>
                                    <p class="text-2xl font-bold" id="annStatActive">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">ÁΩÆÈ†Ç</p>
                                    <p class="text-2xl font-bold" id="annStatPinned">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üìå</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Á∑äÊÄ•</p>
                                    <p class="text-2xl font-bold" id="annStatUrgent">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üî¥</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üì£</span> ÊúÄÊñ∞Ë®äÊÅØÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="refreshAnnouncements()" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors" title="Âà∑Êñ∞">
                                    üîÑ Âà∑Êñ∞
                                </button>
                                <button id="addAnnouncementBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢ûË®äÊÅØ
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÂàÜÈ°û:</label>
                                <select id="annFilterCategory" onchange="filterAnnouncements()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="general">üü¢ ‰∏ÄËà¨</option>
                                    <option value="important">üü° ÈáçË¶Å</option>
                                    <option value="urgent">üî¥ Á∑äÊÄ•</option>
                                    <option value="event">üîµ Ê¥ªÂãï</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÁãÄÊÖã:</label>
                                <select id="annFilterStatus" onchange="filterAnnouncements()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="active">ÂïüÁî®‰∏≠</option>
                                    <option value="inactive">Â∑≤ÂÅúÁî®</option>
                                    <option value="pinned">ÁΩÆÈ†Ç</option>
                                    <option value="scheduled">È†êÂÆöÁôºÂ∏É</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[200px]">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÊêúÂ∞ã:</label>
                                <input type="text" id="annSearchInput" oninput="filterAnnouncements()" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                            </div>
                            <button onclick="clearAnnouncementFilters()" class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                ‚úï Ê∏ÖÈô§ÁØ©ÈÅ∏
                            </button>
                        </div>

                        <!-- Announcements List -->
                        <div id="announcementsLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="announcementsList" class="space-y-4 hidden"></div>
                        <div id="announcementsEmptyState" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">üì≠</div>
                            <p class="text-gray-500 dark:text-gray-400 text-lg">Êö´ÁÑ°Ë®äÊÅØË≥áÊñô</p>
                            <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">ÈªûÊìä„ÄåÊñ∞Â¢ûË®äÊÅØ„Äç‰æÜÂª∫Á´ãÁ¨¨‰∏ÄÂâáÂÖ¨Âëä</p>
                        </div>
                    </div>
                </div>

                <!-- Contact Settings Section -->
                <div id="contactSettingsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ËÅØÁµ°Ë≥áË®äË®≠ÁΩÆ</h2>
                        </div>

                        <form id="contactSettingsForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÁπÅÈ´î‰∏≠ÊñáÂú∞ÂùÄ</label>
                                <input type="text" id="contactAddressZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: È¶ôÊ∏Ø‰πùÈæç...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Á∞°È´î‰∏≠ÊñáÂú∞ÂùÄ</label>
                                <input type="text" id="contactAddressZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: È¶ôÊ∏Ø‰πùÈæô...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">English Address</label>
                                <input type="text" id="contactAddressEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="e.g., Kowloon, Hong Kong...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÈõªË©±</label>
                                <input type="tel" id="contactPhone" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="+852 1234 5678">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂</label>
                                <input type="email" id="contactEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="contact@techsociety.com">
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                    ÂÑ≤Â≠òËÅØÁµ°Ë≥áË®ä
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Anthem Settings Section -->
                <div id="anthemSettingsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ÊúÉÊ≠åË®≠ÁΩÆ</h2>
                        </div>

                        <form id="anthemSettingsForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÁπÅÈ´î‰∏≠ÊñáÊ®ôÈ°å</label>
                                    <input type="text" id="anthemTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: ÁßëÊäÄÂ≠∏ÊúÉÊúÉÊ≠å">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Á∞°È´î‰∏≠ÊñáÊ®ôÈ°å</label>
                                    <input type="text" id="anthemTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: ÁßëÊäÄÂ≠¶‰ºö‰ºöÊ≠å">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">English Title</label>
                                    <input type="text" id="anthemTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="e.g., Science and Technology Club Anthem">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÁπÅÈ´î‰∏≠ÊñáÊèèËø∞</label>
                                    <textarea id="anthemDescZhTW" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="‰æãÂ¶Ç: ËÅÜËÅΩÊàëÂÄëÁöÑÊúÉÊ≠åÔºåÊÑüÂèóÁßëÊäÄÂ≠∏ÊúÉÁöÑÁ≤æÁ•ûËàáÁÜ±ÊÉÖ"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Á∞°È´î‰∏≠ÊñáÊèèËø∞</label>
                                    <textarea id="anthemDescZhCN" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="‰æãÂ¶Ç: ËÅÜÂê¨Êàë‰ª¨ÁöÑ‰ºöÊ≠åÔºåÊÑüÂèóÁßëÊäÄÂ≠¶‰ºöÁöÑÁ≤æÁ•û‰∏éÁÉ≠ÊÉÖ"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">English Description</label>
                                    <textarea id="anthemDescEn" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="e.g., Listen to our anthem and feel the spirit and passion"></textarea>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                    ÂÑ≤Â≠òÊúÉÊ≠åË®≠ÁΩÆ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Visitor Stats Section -->
                <div id="visitorStatsSection" class="section hidden">
                    <div class="space-y-6">
                        <!-- Real-time Stats -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Âç≥ÊôÇË®™ÂÆ¢Êï∏Êìö</h2>
                                <button onclick="refreshVisitorStats()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg text-sm font-semibold transition-colors">
                                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Âà∑Êñ∞
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Online Visitors -->
                                <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm opacity-80">ÁõÆÂâçÂú®Á∑öË®™ÂÆ¢</p>
                                            <p class="text-4xl font-bold mt-2" id="statOnlineVisitors">-</p>
                                        </div>
                                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>

                                <!-- Today Visitors -->
                                <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm opacity-80">‰ªäÊó•Ë®™ÂïèÊï∏</p>
                                            <p class="text-4xl font-bold mt-2" id="statTodayVisitors">-</p>
                                        </div>
                                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                </div>

                                <!-- Total Visitors -->
                                <div class="bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm opacity-80">Á∏ΩË®™ÂïèÊï∏</p>
                                            <p class="text-4xl font-bold mt-2" id="statTotalVisitors">-</p>
                                        </div>
                                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Kick Out Actions -->
                            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">Ë®™ÂÆ¢ÁÆ°ÁêÜÊìç‰Ωú</h3>
                                <div class="flex flex-wrap gap-3">
                                    <button onclick="kickOutAllVisitors()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors flex items-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Ë∏¢Âá∫ÊâÄÊúâË®™ÂÆ¢
                                    </button>
                                    <button onclick="sendKickWarning()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-colors flex items-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                        </svg>
                                        ÁôºÈÄÅË∏¢Âá∫Ë≠¶ÂëäÔºà30ÁßíÔºâ
                                    </button>
                                    <button onclick="cancelKickWarning()" id="cancelKickWarningBtn" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors flex items-center hidden">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                        ÂèñÊ∂àË≠¶Âëä
                                    </button>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-3">
                                    <span class="text-red-600 dark:text-red-400">Ë∏¢Âá∫ÊâÄÊúâË®™ÂÆ¢</span>ÔºöÁ´ãÂç≥Ë∏¢Âá∫ÊâÄÊúâÂú®Á∑öË®™ÂÆ¢„ÄÇ
                                    <span class="text-orange-600 dark:text-orange-400 ml-3">ÁôºÈÄÅË∏¢Âá∫Ë≠¶Âëä</span>ÔºöË®™ÂÆ¢ÈúÄÂú®30ÁßíÂÖßÈªûÊìäÁ¢∫Ë™çÔºåÂê¶ÂâáË¢´Ë∏¢Âá∫„ÄÇ
                                </p>
                            </div>
                        </div>

                        <!-- Website Status Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Á∂≤Á´ôÁãÄÊÖã</h2>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                <div>
                                    <h3 class="font-semibold text-lg">ÂÅúÁî®Á∂≤Á´ô</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                        ÂÅúÁî®ÂæåÔºåË®™ÂÆ¢Â∞áÁúãÂà∞Á∂≠Ë≠∑È†ÅÈù¢„ÄÇÁÆ°ÁêÜÂì°‰ªçÂèØÁôªÂÖ•ÈÄ≤ÂÖ•„ÄÇ
                                    </p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="websiteDisabledToggle" class="sr-only peer">
                                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 dark:peer-focus:ring-red-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-red-600"></div>
                                </label>
                            </div>

                            <div id="websiteStatusMessage" class="mt-4 p-3 rounded-lg hidden">
                            </div>
                        </div>

                        <!-- Visitor Limit Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Ë®™ÂÆ¢ÈôêÂà∂Ë®≠ÁΩÆ</h2>
                            </div>

                            <form id="visitorSettingsForm" class="space-y-6">
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4">
                                    <div class="flex items-start">
                                        <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                        </svg>
                                        <div>
                                            <p class="text-sm font-semibold text-yellow-800 dark:text-yellow-300">Ê≥®ÊÑè</p>
                                            <p class="text-sm text-yellow-700 dark:text-yellow-400 mt-1">
                                                Áï∂Ë®≠ÁΩÆÁöÑÊúÄÂ§ßË®™ÂÆ¢Êï∏Ë∂ÖÈÅéÊôÇÔºåÊñ∞Ë®™ÂÆ¢Â∞áÁúãÂà∞ÊéíÈöäÁ≠âÂÄôÈ†ÅÈù¢„ÄÇË®≠ÁΩÆÁÇ∫ 0 Ë°®Á§∫ÁÑ°ÈôêÂà∂„ÄÇ
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÊúÄÂ§ßÂêåÊôÇË®™ÂÆ¢Êï∏</label>
                                    <input type="number" id="visitorMaxLimit" min="0" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: 100Ôºà0 Ë°®Á§∫ÁÑ°ÈôêÂà∂Ôºâ">
                                    <p class="text-xs text-gray-500 mt-2">Ëº∏ÂÖ• 0 Ë°®Á§∫‰∏çÈôêÂà∂Ë®™ÂÆ¢Êï∏Èáè</p>
                                </div>

                                <div class="flex justify-end">
                                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÂÑ≤Â≠òË®≠ÁΩÆ
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Ë®™ÂÆ¢Ë∂®Âã¢ÂúñË°® -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üìä Ë®™ÂÆ¢Ë∂®Âã¢ÂàÜÊûê</h2>
                                <div class="flex space-x-2">
                                    <button onclick="setChartPeriod('7d')" class="chart-period-btn px-3 py-1 bg-primary text-white rounded text-sm" data-period="7d">7Â§©</button>
                                    <button onclick="setChartPeriod('30d')" class="chart-period-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded text-sm" data-period="30d">30Â§©</button>
                                </div>
                            </div>
                            <div id="visitorTrendChart" class="h-64 flex items-end justify-between space-x-1 bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <!-- ÂúñË°®Â∞áÂãïÊÖãÁîüÊàê -->
                            </div>
                        </div>

                        <!-- Ë®™ÂïèÊôÇÊÆµÂàÜÊûê -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üïê Ë®™ÂïèÊôÇÊÆµÂàÜÊûê</h2>
                            </div>
                            <div id="hourlyChart" class="grid grid-cols-12 gap-1 h-32">
                                <!-- 24Â∞èÊôÇÂúñË°®Â∞áÂãïÊÖãÁîüÊàê -->
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                <span>0ÊôÇ</span>
                                <span>6ÊôÇ</span>
                                <span>12ÊôÇ</span>
                                <span>18ÊôÇ</span>
                                <span>24ÊôÇ</span>
                            </div>
                        </div>

                        <!-- Ë®≠ÂÇôÈ°ûÂûãÁµ±Ë®à -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üì± Ë®≠ÂÇôÈ°ûÂûãÁµ±Ë®à</h2>
                            </div>
                            <div class="grid grid-cols-3 gap-4" id="deviceStatsContainer">
                                <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üì±</div>
                                    <p class="text-2xl font-bold text-blue-600" id="mobileCount">0</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">ÊâãÊ©ü</p>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üìü</div>
                                    <p class="text-2xl font-bold text-green-600" id="tabletCount">0</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Âπ≥Êùø</p>
                                </div>
                                <div class="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üíª</div>
                                    <p class="text-2xl font-bold text-purple-600" id="desktopCount">0</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">ÈõªËÖ¶</p>
                                </div>
                            </div>
                        </div>

                        <!-- Êï∏ÊìöÁÆ°ÁêÜ -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üì• Êï∏ÊìöÁÆ°ÁêÜ</h2>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                    <h3 class="font-semibold mb-3">Â∞éÂá∫Êï∏Êìö</h3>
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="exportVisitorStats()" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                            üìä Â∞éÂá∫Ë®™ÂÆ¢Áµ±Ë®à CSV
                                        </button>
                                        <button onclick="exportContactMessages()" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                            ‚úâÔ∏è Â∞éÂá∫ËÅØÁµ°Ë®äÊÅØ CSV
                                        </button>
                                    </div>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                    <h3 class="font-semibold mb-3">Ëá™ÂãïÊ∏ÖÁêÜ</h3>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Ëá™ÂãïÊ∏ÖÁêÜË∂ÖÈÅé30Â§©ÁöÑË®™ÂÆ¢Ë®òÈåÑ</p>
                                        </div>
                                        <button onclick="cleanOldData()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                            üóëÔ∏è Á´ãÂç≥Ê∏ÖÁêÜ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÁÆ°ÁêÜÂì°Êìç‰ΩúÊó•Ë™å -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üìù ÁÆ°ÁêÜÂì°Êìç‰ΩúÊó•Ë™å</h2>
                                <button onclick="loadAdminLogs()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg text-sm font-semibold transition-colors">
                                    Âà∑Êñ∞
                                </button>
                            </div>
                            <div id="adminLogsContainer" class="max-h-64 overflow-y-auto space-y-2">
                                <p class="text-gray-500 dark:text-gray-400 text-center py-4">ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>

                        <!-- Historical Data -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Ê≠∑Âè≤Ë®™ÂïèÊï∏Êìö</h2>
                            </div>

                            <div id="visitorHistoryLoading" class="flex justify-center py-12">
                                <div class="loading-spinner"></div>
                            </div>

                            <div id="visitorHistoryList" class="hidden">
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <th class="px-4 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Êó•Êúü</th>
                                                <th class="px-4 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Ë®™ÂïèÊ¨°Êï∏</th>
                                            </tr>
                                        </thead>
                                        <tbody id="visitorHistoryTableBody">
                                            <!-- Êï∏ÊìöÂ∞áÂãïÊÖãÂä†Ëºâ -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div id="visitorHistoryEmpty" class="hidden text-center py-12">
                                <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°Ê≠∑Âè≤Êï∏Êìö</p>
                            </div>
                        </div>

                        <!-- ÊéíÈöäÈ†ÅÈù¢Ëá™ÂÆöÁæ© -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üé´ ÊéíÈöäÈ†ÅÈù¢Ë®≠ÁΩÆ</h2>
                            </div>
                            <form id="queueSettingsForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Ëá™ÂÆöÁæ©ÊéíÈöäË®äÊÅØ</label>
                                    <textarea id="queueCustomMessage" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶ÇÔºöÊÑüË¨ùÊÇ®ÁöÑËÄêÂøÉÁ≠âÂæÖÔºåÊàëÂÄëÊúÉÁõ°Âø´ÁÇ∫ÊÇ®ÊúçÂãô..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÊéíÈöäÈ†ÅÈù¢ÂúñÁâá URL</label>
                                    <input type="url" id="queueImageUrl" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="https://example.com/image.jpg">
                                    <p class="text-xs text-gray-500 mt-1">ÁïôÁ©∫Ââá‰ΩøÁî®È†êË®≠Ê®£Âºè</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">È†êË®àÊØè‰ΩçË®™ÂÆ¢Á≠âÂæÖÊôÇÈñìÔºàÂàÜÈêòÔºâ</label>
                                    <input type="number" id="queueWaitTimePerPerson" min="1" max="60" value="2" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="2">
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÂÑ≤Â≠òÊéíÈöäË®≠ÁΩÆ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div id="profileSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ÂÄã‰∫∫Ë≥áÊñô</h2>
                        </div>

                        <!-- Current User Info Display -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Áï∂ÂâçË≥áÊñô</h3>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Áî®Êà∂Âêç</p>
                                        <p class="font-semibold" id="profileCurrentUsername">ËºâÂÖ•‰∏≠...</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">ÈõªÂ≠êÈÉµ‰ª∂</p>
                                        <p class="font-semibold" id="profileCurrentEmail">ËºâÂÖ•‰∏≠...</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">ÂßìÂêç</p>
                                        <p class="font-semibold" id="profileCurrentName">ËºâÂÖ•‰∏≠...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Update Name Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">‰øÆÊîπÂßìÂêç</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">‰øÆÊîπÂßìÂêçÈúÄË¶ÅÈ©óË≠âÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êñ∞ÂßìÂêç</label>
                                    <input type="text" id="profileNewName" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•Êñ∞ÂßìÂêç">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="startUpdateName()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÁôºÈÄÅÈ©óË≠âÁ¢º
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Update Username Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">‰øÆÊîπÁî®Êà∂Âêç</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">‰øÆÊîπÁî®Êà∂ÂêçÈúÄË¶ÅÈ©óË≠âÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êñ∞Áî®Êà∂Âêç</label>
                                    <input type="text" id="profileNewUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•Êñ∞Áî®Êà∂Âêç">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="startUpdateUsername()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÁôºÈÄÅÈ©óË≠âÁ¢º
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Update Email Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <h3 class="text-lg font-semibold mb-4">‰øÆÊîπÈõªÂ≠êÈÉµ‰ª∂</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">‰øÆÊîπÈõªÂ≠êÈÉµ‰ª∂ÈúÄË¶ÅÈ©óË≠âËàäÈõªÈÉµÂíåÊñ∞ÈõªÈÉµ</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êñ∞ÈõªÂ≠êÈÉµ‰ª∂</label>
                                    <input type="email" id="profileNewEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•Êñ∞ÈõªÂ≠êÈÉµ‰ª∂">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="startUpdateEmail()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÈñãÂßãÈ©óË≠âÊµÅÁ®ã
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== Êñ∞ÂäüËÉΩÂçÄÂ°äÈñãÂßã ========== -->

                <!-- ÊúÉÂì°Ê™îÊ°à Section -->
                <div id="memberProfilesSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üë§ ÊúÉÂì°Ê™îÊ°àÁÆ°ÁêÜ</h2>
                            <div class="flex space-x-2">
                                <input type="text" id="memberSearchInput" placeholder="ÊêúÂ∞ãÊúÉÂì°..." class="px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                <button onclick="searchMembers()" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÊêúÂ∞ã</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="memberProfilesList">
                            <p class="text-gray-500 col-span-full text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Á©çÂàÜÁ≥ªÁµ± Section -->
                <div id="pointsSystemSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ü™ô Á©çÂàÜÁçéÂãµÁ≥ªÁµ±</h2>
                            <button onclick="showAddPointsRuleDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÁ©çÂàÜË¶èÂâá</button>
                        </div>
                        <!-- Á©çÂàÜÁµ±Ë®à -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl p-4 text-white">
                                <p class="text-sm opacity-80">Á∏ΩÁôºÊîæÁ©çÂàÜ</p>
                                <p class="text-3xl font-bold" id="totalPointsIssued">0</p>
                            </div>
                            <div class="bg-gradient-to-br from-green-400 to-emerald-500 rounded-xl p-4 text-white">
                                <p class="text-sm opacity-80">Êú¨ÊúàÁôºÊîæ</p>
                                <p class="text-3xl font-bold" id="monthlyPointsIssued">0</p>
                            </div>
                            <div class="bg-gradient-to-br from-blue-400 to-indigo-500 rounded-xl p-4 text-white">
                                <p class="text-sm opacity-80">Ê¥ªË∫çÊúÉÂì°</p>
                                <p class="text-3xl font-bold" id="activePointsMembers">0</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-400 to-pink-500 rounded-xl p-4 text-white">
                                <p class="text-sm opacity-80">Á©çÂàÜË¶èÂâáÊï∏</p>
                                <p class="text-3xl font-bold" id="pointsRulesCount">0</p>
                            </div>
                        </div>
                        <!-- Á©çÂàÜË¶èÂâáÂàóË°® -->
                        <h3 class="text-lg font-semibold mb-4">Á©çÂàÜË¶èÂâá</h3>
                        <div class="space-y-3" id="pointsRulesList">
                            <p class="text-gray-500 text-center py-4">ËºâÂÖ•‰∏≠...</p>
                        </div>
                        <!-- Á©çÂàÜÊéíË°åÊ¶ú -->
                        <h3 class="text-lg font-semibold mb-4 mt-6">üèÜ Á©çÂàÜÊéíË°åÊ¶ú</h3>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4" id="pointsLeaderboard">
                            <p class="text-gray-500 text-center py-4">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- ÊàêÂ∞±ÂæΩÁ´† Section -->
                <div id="achievementsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üèÖ ÊàêÂ∞±ÂæΩÁ´†Á≥ªÁµ±</h2>
                            <button onclick="showAddBadgeDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÂæΩÁ´†</button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="badgesList">
                            <p class="text-gray-500 col-span-full text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Ê¥ªÂãïÂ†±Âêç Section -->
                <div id="eventRegistrationSection" class="section hidden">
                    <!-- Â†±ÂêçÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">ÈÄ≤Ë°å‰∏≠Ê¥ªÂãï</p>
                                    <p class="text-2xl font-bold" id="regStatActive">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üéØ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Á∏ΩÂ†±Âêç‰∫∫Ê¨°</p>
                                    <p class="text-2xl font-bold" id="regStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üë•</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">Êú¨ÈÄ±Â†±Âêç</p>
                                    <p class="text-2xl font-bold" id="regStatWeek">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üìà</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">ÂæÖÂØ©Ê†∏</p>
                                    <p class="text-2xl font-bold" id="regStatPending">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚è≥</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üìù</span> Ê¥ªÂãïÂ†±ÂêçÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportAllRegistrations()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">
                                    üì• ÂåØÂá∫ÂÖ®ÈÉ®
                                </button>
                                <button onclick="showCreateRegistrationDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢ûÂ†±ÂêçÊ¥ªÂãï
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÁãÄÊÖã:</label>
                                <select id="regFilterStatus" onchange="filterRegistrationEvents()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="open">üü¢ ÈñãÊîæ‰∏≠</option>
                                    <option value="closed">üî¥ Â∑≤Êà™Ê≠¢</option>
                                    <option value="upcoming">üîµ Âç≥Â∞áÈñãÂßã</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[200px]">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÊêúÂ∞ã:</label>
                                <input type="text" id="regSearchInput" oninput="filterRegistrationEvents()" placeholder="Ê¥ªÂãïÂêçÁ®±..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                            </div>
                        </div>

                        <div class="space-y-4" id="registrationEventsList">
                            <div class="text-center py-8">
                                <div class="loading-spinner mx-auto mb-4"></div>
                                <p class="text-gray-500">ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- QRÁ∞ΩÂà∞ Section -->
                <div id="qrCheckinSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üì± QR Code Á∞ΩÂà∞</h2>
                            <div class="flex space-x-2">
                                <button onclick="refreshQREvents()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition-colors">üîÑ ÈáçÊï¥</button>
                                <button onclick="printQRCode()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">üñ®Ô∏è ÂàóÂç∞</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Ê¥ªÂãïÈÅ∏Êìá -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                                <h3 class="text-lg font-semibold mb-4">üìÖ ÈÅ∏ÊìáÊ¥ªÂãï</h3>
                                <select id="qrEventSelect" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 mb-4" onchange="generateQRCodeForEvent()">
                                    <option value="">-- Ë´ãÈÅ∏ÊìáÊ¥ªÂãï --</option>
                                </select>
                                <div id="selectedEventInfo" class="text-sm text-gray-600 dark:text-gray-400 space-y-2 hidden">
                                    <p><strong>Ê¥ªÂãïÂêçÁ®±Ôºö</strong><span id="qrEventName">-</span></p>
                                    <p><strong>Ê¥ªÂãïÊó•ÊúüÔºö</strong><span id="qrEventDate">-</span></p>
                                    <p><strong>Â∑≤Á∞ΩÂà∞‰∫∫Êï∏Ôºö</strong><span id="qrCheckinCount" class="text-green-600 font-bold">0</span></p>
                                </div>
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
                                    <h4 class="font-semibold mb-2">‚öôÔ∏è Á∞ΩÂà∞Ë®≠ÂÆö</h4>
                                    <label class="flex items-center space-x-2 mb-2">
                                        <input type="checkbox" id="qrAutoRefresh" class="rounded" checked>
                                        <span class="text-sm">Ëá™ÂãïÂà∑Êñ∞Ë®òÈåÑ (30Áßí)</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="qrPlaySound" class="rounded">
                                        <span class="text-sm">Á∞ΩÂà∞ÊàêÂäüÈü≥Êïà</span>
                                    </label>
                                </div>
                            </div>
                            <!-- QR Code È°ØÁ§∫ -->
                            <div class="bg-gradient-to-br from-primary/5 to-blue-50 dark:from-gray-700 dark:to-gray-600 rounded-xl p-6 text-center">
                                <h3 class="text-lg font-semibold mb-4">üì≤ Á∞ΩÂà∞ QR Code</h3>
                                <div id="qrCodeDisplay" class="bg-white dark:bg-gray-800 p-6 rounded-xl inline-block mb-4 shadow-lg">
                                    <div class="w-48 h-48 flex items-center justify-center text-gray-400">
                                        <div class="text-center">
                                            <svg class="w-16 h-16 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                                            </svg>
                                            <p class="text-sm">Ë´ãÈÅ∏ÊìáÊ¥ªÂãï</p>
                                        </div>
                                    </div>
                                </div>
                                <p id="qrCodeHint" class="text-sm text-gray-500">ÈÅ∏ÊìáÊ¥ªÂãïÂæåËá™ÂãïÁîüÊàêÁ∞ΩÂà∞Á¢º</p>
                                <div id="qrCodeActions" class="mt-4 hidden">
                                    <button onclick="downloadQRCode()" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg text-sm mr-2">üì• ‰∏ãËºâ</button>
                                    <button onclick="copyCheckinLink()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm">üìã Ë§áË£ΩÈÄ£Áµê</button>
                                </div>
                            </div>
                            <!-- Á∞ΩÂà∞Ë®òÈåÑ -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">üìã Á∞ΩÂà∞Ë®òÈåÑ</h3>
                                    <button onclick="exportCheckinRecords()" class="text-sm text-primary hover:text-primary-dark">ÂåØÂá∫</button>
                                </div>
                                <div id="checkinRecordsList" class="space-y-2 max-h-80 overflow-y-auto">
                                    <p class="text-gray-500 text-center py-8">ÈÅ∏ÊìáÊ¥ªÂãïÂæåÈ°ØÁ§∫Ë®òÈåÑ</p>
                                </div>
                            </div>
                        </div>
                        <!-- Áµ±Ë®àÂçÄÂ°ä -->
                        <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-green-50 dark:bg-green-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-green-600" id="qrStatPresent">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Â∑≤Á∞ΩÂà∞</p>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-yellow-600" id="qrStatLate">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈÅ≤Âà∞</p>
                            </div>
                            <div class="bg-red-50 dark:bg-red-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-red-600" id="qrStatAbsent">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Êú™Âà∞</p>
                            </div>
                            <div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-blue-600" id="qrStatTotal">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Á∏ΩÂ†±Âêç</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ë°å‰∫ãÊõÜ Section -->
                <div id="calendarViewSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìÖ Ë°å‰∫ãÊõÜ</h2>
                            <div class="flex space-x-2">
                                <button onclick="prevMonth()" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">‚óÄ</button>
                                <span id="currentMonthDisplay" class="px-4 py-2 font-semibold">2025Âπ¥1Êúà</span>
                                <button onclick="nextMonth()" class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">‚ñ∂</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-7 gap-1 mb-2">
                            <div class="text-center font-semibold py-2 text-red-500">Êó•</div>
                            <div class="text-center font-semibold py-2">‰∏Ä</div>
                            <div class="text-center font-semibold py-2">‰∫å</div>
                            <div class="text-center font-semibold py-2">‰∏â</div>
                            <div class="text-center font-semibold py-2">Âõõ</div>
                            <div class="text-center font-semibold py-2">‰∫î</div>
                            <div class="text-center font-semibold py-2 text-blue-500">ÂÖ≠</div>
                        </div>
                        <div id="calendarGrid" class="grid grid-cols-7 gap-1">
                            <!-- ÂãïÊÖãÁîüÊàêÊó•ÊõÜ -->
                        </div>
                    </div>
                </div>

                <!-- ÊäïÁ•®Á≥ªÁµ± Section -->
                <div id="votingSystemSection" class="section hidden">
                    <!-- ÊäïÁ•®Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-indigo-100 text-sm">ÈÄ≤Ë°å‰∏≠ÊäïÁ•®</p>
                                    <p class="text-2xl font-bold" id="voteStatActive">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üó≥Ô∏è</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Á∏ΩÊäïÁ•®Êï∏</p>
                                    <p class="text-2xl font-bold" id="voteStatTotalVotes">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">ÂèÉËàá‰∫∫Êï∏</p>
                                    <p class="text-2xl font-bold" id="voteStatParticipants">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üë•</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-100 text-sm">Â∑≤ÁµêÊùü</p>
                                    <p class="text-2xl font-bold" id="voteStatClosed">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üèÅ</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üó≥Ô∏è</span> ÊäïÁ•®Á≥ªÁµ±
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportPollResults()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">
                                    üìä ÂåØÂá∫ÁµêÊûú
                                </button>
                                <button onclick="showCreatePollDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢ûÊäïÁ•®
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÁãÄÊÖã:</label>
                                <select id="pollFilterStatus" onchange="filterPolls()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="active">üü¢ ÈÄ≤Ë°å‰∏≠</option>
                                    <option value="closed">üî¥ Â∑≤ÁµêÊùü</option>
                                    <option value="scheduled">üîµ È†êÂÆöÈñãÂßã</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">È°ûÂûã:</label>
                                <select id="pollFilterType" onchange="filterPolls()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="single">ÂñÆÈÅ∏</option>
                                    <option value="multiple">Â§öÈÅ∏</option>
                                    <option value="ranked">ÊéíÂ∫è</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[200px]">
                                <input type="text" id="pollSearchInput" oninput="filterPolls()" placeholder="ÊêúÂ∞ãÊäïÁ•®..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                            </div>
                        </div>

                        <div class="space-y-4" id="pollsList">
                            <div class="text-center py-8">
                                <div class="loading-spinner mx-auto mb-4"></div>
                                <p class="text-gray-500">ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂïèÂç∑Ë™øÊü• Section -->
                <div id="surveysSection" class="section hidden">
                    <!-- ÂïèÂç∑Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-teal-100 text-sm">ÈÄ≤Ë°å‰∏≠</p>
                                    <p class="text-2xl font-bold" id="surveyStatActive">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üìä</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Á∏ΩÂõûË¶Ü</p>
                                    <p class="text-2xl font-bold" id="surveyStatResponses">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úçÔ∏è</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">ÂÆåÊàêÁéá</p>
                                    <p class="text-2xl font-bold" id="surveyStatRate">0%</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-100 text-sm">Â∑≤ÁµêÊùü</p>
                                    <p class="text-2xl font-bold" id="surveyStatClosed">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üèÅ</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üìä</span> ÂïèÂç∑Ë™øÊü•
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportSurveyResults()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">üì• ÂåØÂá∫ÁµêÊûú</button>
                                <button onclick="showCreateSurveyDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">‚ûï Êñ∞Â¢ûÂïèÂç∑</button>
                            </div>
                        </div>
                        <div class="space-y-4" id="surveysList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Ë≥áÊ∫êÈ†êÁ¥Ñ Section -->
                <div id="resourceBookingSection" class="section hidden">
                    <!-- Ë≥áÊ∫êÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-cyan-100 text-sm">ÂèØÁî®Ë≥áÊ∫ê</p>
                                    <p class="text-2xl font-bold" id="resStatAvailable">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üè¢</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">‰ªäÊó•È†êÁ¥Ñ</p>
                                    <p class="text-2xl font-bold" id="resStatToday">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üìÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100 text-sm">ÂæÖÂØ©Ê†∏</p>
                                    <p class="text-2xl font-bold" id="resStatPending">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚è≥</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">‰ΩøÁî®‰∏≠</p>
                                    <p class="text-2xl font-bold" id="resStatInUse">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üîí</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üè¢</span> Ë≥áÊ∫êÈ†êÁ¥Ñ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="viewBookingCalendar()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition-colors">üìÖ È†êÁ¥ÑÊó•ÊõÜ</button>
                                <button onclick="showAddResourceDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">‚ûï Êñ∞Â¢ûË≥áÊ∫ê</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="resourcesList">
                            <div class="col-span-full text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- ÈÄöÁü•‰∏≠ÂøÉ Section -->
                <div id="notificationCenterSection" class="section hidden">
                    <!-- ÈÄöÁü•Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Á∏ΩÈÄöÁü•</p>
                                    <p class="text-2xl font-bold" id="notifStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üîî</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Êú™ËÆÄ</p>
                                    <p class="text-2xl font-bold" id="notifStatUnread">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üî¥</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">‰ªäÊó•ÁôºÈÄÅ</p>
                                    <p class="text-2xl font-bold" id="notifStatToday">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üì§</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">È†êÂÆöÁôºÈÄÅ</p>
                                    <p class="text-2xl font-bold" id="notifStatScheduled">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚è∞</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üîî</span> ÈÄöÁü•‰∏≠ÂøÉ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="markAllNotificationsRead()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-semibold transition-colors">‚úì ÂÖ®ÈÉ®Â∑≤ËÆÄ</button>
                                <button onclick="showSendNotificationDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">‚ûï ÁôºÈÄÅÈÄöÁü•</button>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <button onclick="filterNotifications('all')" class="notif-filter-btn px-4 py-2 bg-primary text-white rounded-lg text-sm transition-colors">ÂÖ®ÈÉ®</button>
                            <button onclick="filterNotifications('unread')" class="notif-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm transition-colors">üî¥ Êú™ËÆÄ</button>
                            <button onclick="filterNotifications('read')" class="notif-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm transition-colors">‚úì Â∑≤ËÆÄ</button>
                            <button onclick="filterNotifications('system')" class="notif-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm transition-colors">‚öôÔ∏è Á≥ªÁµ±</button>
                        </div>
                        <div class="space-y-3" id="notificationsList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Ë®éË´ñÂçÄ Section -->
                <div id="forumSection" class="section hidden">
                    <!-- Ë®éË´ñÂçÄÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-indigo-100 text-sm">‰∏ªÈ°åÊï∏</p>
                                    <p class="text-2xl font-bold" id="forumStatTopics">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üí¨</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Á∏ΩÂõûË¶Ü</p>
                                    <p class="text-2xl font-bold" id="forumStatReplies">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üí≠</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Ê¥ªË∫çÁî®Êà∂</p>
                                    <p class="text-2xl font-bold" id="forumStatUsers">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üë•</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">‰ªäÊó•Ë≤ºÊñá</p>
                                    <p class="text-2xl font-bold" id="forumStatToday">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üî•</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üí¨</span> Ë®éË´ñÂçÄÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="manageForumCategories()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-semibold transition-colors">üìÅ ÂàÜÈ°ûÁÆ°ÁêÜ</button>
                                <button onclick="showCreateTopicDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">‚ûï Êñ∞Â¢û‰∏ªÈ°å</button>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <select id="forumFilterCategory" onchange="filterForumTopics()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                <option value="">ÂÖ®ÈÉ®ÂàÜÈ°û</option>
                                <option value="general">üí¨ ‰∏ÄËà¨Ë®éË´ñ</option>
                                <option value="announcement">üì¢ ÂÖ¨Âëä</option>
                                <option value="question">‚ùì ÂïèÁ≠î</option>
                                <option value="sharing">üìö ÂàÜ‰∫´</option>
                            </select>
                            <input type="text" id="forumSearchInput" oninput="filterForumTopics()" placeholder="ÊêúÂ∞ã‰∏ªÈ°å..." class="flex-1 min-w-[200px] px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                        </div>
                        <div class="space-y-4" id="forumTopicsList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Ê¥ªÂãïÁõ∏Á∞ø Section -->
                <div id="photoGallerySection" class="section hidden">
                    <!-- Áõ∏Á∞øÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-pink-500 to-pink-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-pink-100 text-sm">Áõ∏Á∞øÊï∏</p>
                                    <p class="text-2xl font-bold" id="galleryStatAlbums">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üì∑</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">Á∏ΩÁõ∏Áâá</p>
                                    <p class="text-2xl font-bold" id="galleryStatPhotos">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üñºÔ∏è</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Á∏ΩÁÄèË¶Ω</p>
                                    <p class="text-2xl font-bold" id="galleryStatViews">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üëÅÔ∏è</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Êú¨ÊúàÊñ∞Â¢û</p>
                                    <p class="text-2xl font-bold" id="galleryStatNew">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚ú®</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üì∑</span> Ê¥ªÂãïÁõ∏Á∞ø
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="batchUploadPhotos()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">üì§ ÊâπÈáè‰∏äÂÇ≥</button>
                                <button onclick="showCreateAlbumDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">‚ûï Êñ∞Â¢ûÁõ∏Á∞ø</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="albumsList">
                            <div class="col-span-full text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- ÂππÈÉ®ÁÆ°ÁêÜ Section -->
                <div id="executivesSection" class="section hidden">
                    <!-- ÂππÈÉ®Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-slate-600 to-slate-700 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-slate-200 text-sm">Á∏ΩÂππÈÉ®</p>
                                    <p class="text-2xl font-bold" id="execStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üëî</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100 text-sm">ÊúÉÈï∑Âúò</p>
                                    <p class="text-2xl font-bold" id="execStatLeaders">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üëë</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">ÈÉ®ÈñÄÊï∏</p>
                                    <p class="text-2xl font-bold" id="execStatDepts">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üèõÔ∏è</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Âú®‰ªª‰∏≠</p>
                                    <p class="text-2xl font-bold" id="execStatActive">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üëî</span> ÂππÈÉ®ÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="showOrgChart()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition-colors">üìä ÁµÑÁπîÊû∂ÊßãÂúñ</button>
                                <button onclick="showAddExecutiveDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">‚ûï Êñ∞Â¢ûÂππÈÉ®</button>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <select id="execFilterDept" onchange="filterExecutives()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                <option value="">ÂÖ®ÈÉ®ÈÉ®ÈñÄ</option>
                                <option value="president">üëë ÊúÉÈï∑Âúò</option>
                                <option value="secretary">üìù ÁßòÊõ∏ÈÉ®</option>
                                <option value="finance">üí∞ Ë≤°ÂãôÈÉ®</option>
                                <option value="activity">üéâ Ê¥ªÂãïÈÉ®</option>
                                <option value="publicity">üì£ ÂÆ£ÂÇ≥ÈÉ®</option>
                                <option value="tech">üíª ÊäÄË°ìÈÉ®</option>
                            </select>
                            <select id="execFilterStatus" onchange="filterExecutives()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                <option value="">ÂÖ®ÈÉ®ÁãÄÊÖã</option>
                                <option value="active">‚úÖ Âú®‰ªª‰∏≠</option>
                                <option value="former">üìú Â∑≤Âç∏‰ªª</option>
                            </select>
                            <input type="text" id="execSearchInput" oninput="filterExecutives()" placeholder="ÊêúÂ∞ãÂππÈÉ®..." class="flex-1 min-w-[150px] px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                        </div>
                        <div class="space-y-4" id="executivesList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Ë≤°ÂãôÁÆ°ÁêÜ Section -->
                <div id="financeSection" class="section hidden">
                    <!-- Ë≤°ÂãôÊ¶ÇË¶ΩÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Á∏ΩÊî∂ÂÖ•</p>
                                    <p class="text-2xl font-bold" id="totalIncome">$0</p>
                                </div>
                                <span class="text-3xl opacity-80">üíµ</span>
                            </div>
                            <p class="text-xs text-green-200 mt-2" id="incomeChange">‚Üë Êú¨Êúà +$0</p>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-rose-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Á∏ΩÊîØÂá∫</p>
                                    <p class="text-2xl font-bold" id="totalExpense">$0</p>
                                </div>
                                <span class="text-3xl opacity-80">üí∏</span>
                            </div>
                            <p class="text-xs text-red-200 mt-2" id="expenseChange">‚Üì Êú¨Êúà -$0</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">È§òÈ°ç</p>
                                    <p class="text-2xl font-bold" id="totalBalance">$0</p>
                                </div>
                                <span class="text-3xl opacity-80">üí∞</span>
                            </div>
                            <p class="text-xs text-blue-200 mt-2" id="balanceStatus">Ë≤°ÂãôÁãÄÊÖãÊ≠£Â∏∏</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">ÂæÖÂØ©Êâπ</p>
                                    <p class="text-2xl font-bold" id="pendingTransactions">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚è≥</span>
                            </div>
                            <p class="text-xs text-purple-200 mt-2">Á≠Ü‰∫§ÊòìÂæÖËôïÁêÜ</p>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üí∞</span> Ë≤°ÂãôÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportFinanceReport()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">
                                    üìä ÂåØÂá∫Â†±Ë°®
                                </button>
                                <button onclick="showFinanceCharts()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition-colors">
                                    üìà ÂúñË°®ÂàÜÊûê
                                </button>
                                <button onclick="showAddTransactionDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢û‰∫§Êòì
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">È°ûÂûã:</label>
                                <select id="financeFilterType" onchange="filterTransactions()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="income">üíµ Êî∂ÂÖ•</option>
                                    <option value="expense">üí∏ ÊîØÂá∫</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÂàÜÈ°û:</label>
                                <select id="financeFilterCategory" onchange="filterTransactions()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="membership">ÊúÉË≤ª</option>
                                    <option value="event">Ê¥ªÂãï</option>
                                    <option value="equipment">Ë®≠ÂÇô</option>
                                    <option value="supplies">Áâ©Ë≥á</option>
                                    <option value="sponsorship">Ë¥äÂä©</option>
                                    <option value="other">ÂÖ∂‰ªñ</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÊúüÈñì:</label>
                                <input type="month" id="financeFilterMonth" onchange="filterTransactions()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[150px]">
                                <input type="text" id="financeSearchInput" oninput="filterTransactions()" placeholder="ÊêúÂ∞ã..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                            </div>
                        </div>

                        <!-- ‰∫§ÊòìË®òÈåÑ -->
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-semibold">Êó•Êúü</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold">Ë™™Êòé</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold">ÂàÜÈ°û</th>
                                        <th class="px-4 py-3 text-left text-sm font-semibold">È°ûÂûã</th>
                                        <th class="px-4 py-3 text-right text-sm font-semibold">ÈáëÈ°ç</th>
                                        <th class="px-4 py-3 text-center text-sm font-semibold">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsList">
                                    <tr><td colspan="6" class="text-center py-8 text-gray-500">
                                        <div class="loading-spinner mx-auto mb-2"></div>
                                        ËºâÂÖ•‰∏≠...
                                    </td></tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- ÂàÜÈ†Å -->
                        <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <p class="text-sm text-gray-500" id="financePageInfo">È°ØÁ§∫ 0 Á≠ÜË®òÈåÑ</p>
                            <div class="flex gap-2">
                                <button onclick="prevFinancePage()" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50" id="financePrevBtn" disabled>‰∏ä‰∏ÄÈ†Å</button>
                                <button onclick="nextFinancePage()" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50" id="financeNextBtn" disabled>‰∏ã‰∏ÄÈ†Å</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ë®™ÂÆ¢ÁïôË®Ä Section -->
                <div id="guestbookSection" class="section hidden">
                    <!-- ÁïôË®ÄÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-blue-100 text-sm">Á∏ΩÁïôË®Ä</p><p class="text-2xl font-bold" id="gbStatTotal">0</p></div>
                                <span class="text-3xl opacity-80">üìù</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-yellow-100 text-sm">ÂæÖÂØ©Ê†∏</p><p class="text-2xl font-bold" id="gbStatPending">0</p></div>
                                <span class="text-3xl opacity-80">‚è≥</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-green-100 text-sm">Â∑≤ÈÄöÈÅé</p><p class="text-2xl font-bold" id="gbStatApproved">0</p></div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-red-100 text-sm">Â∑≤ÊãíÁµï</p><p class="text-2xl font-bold" id="gbStatRejected">0</p></div>
                                <span class="text-3xl opacity-80">‚ùå</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><span class="text-3xl">üìù</span> Ë®™ÂÆ¢ÁïôË®ÄÊùø</h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportGuestbook()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold">üì• ÂåØÂá∫</button>
                                <button onclick="batchApproveGuestbook()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold">‚úì ÊâπÈáèÈÄöÈÅé</button>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <button onclick="filterGuestbook('all')" class="gb-filter-btn px-4 py-2 bg-primary text-white rounded-lg text-sm">ÂÖ®ÈÉ®</button>
                            <button onclick="filterGuestbook('pending')" class="gb-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">‚è≥ ÂæÖÂØ©Ê†∏</button>
                            <button onclick="filterGuestbook('approved')" class="gb-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">‚úÖ Â∑≤ÈÄöÈÅé</button>
                            <button onclick="filterGuestbook('rejected')" class="gb-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">‚ùå Â∑≤ÊãíÁµï</button>
                            <input type="text" id="gbSearchInput" oninput="searchGuestbook()" placeholder="ÊêúÂ∞ãÁïôË®Ä..." class="flex-1 min-w-[150px] px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                        </div>
                        <div class="space-y-4" id="guestbookList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Â∏∏Ë¶ãÂïèÈ°å Section -->
                <div id="faqSection" class="section hidden">
                    <!-- FAQÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-indigo-100 text-sm">Á∏ΩÂïèÈ°åÊï∏</p><p class="text-2xl font-bold" id="faqStatTotal">0</p></div>
                                <span class="text-3xl opacity-80">‚ùì</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-green-100 text-sm">Â∑≤ÁôºÂ∏É</p><p class="text-2xl font-bold" id="faqStatPublished">0</p></div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-blue-100 text-sm">ÂàÜÈ°ûÊï∏</p><p class="text-2xl font-bold" id="faqStatCategories">0</p></div>
                                <span class="text-3xl opacity-80">üìÅ</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><span class="text-3xl">‚ùì</span> Â∏∏Ë¶ãÂïèÈ°å FAQ</h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="reorderFaq()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-semibold">‚ÜïÔ∏è ÊéíÂ∫è</button>
                                <button onclick="showAddFaqDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold shadow-md">‚ûï Êñ∞Â¢ûÂïèÈ°å</button>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <select id="faqFilterCategory" onchange="filterFaq()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                <option value="">ÂÖ®ÈÉ®ÂàÜÈ°û</option>
                                <option value="general">üìå ‰∏ÄËà¨ÂïèÈ°å</option>
                                <option value="membership">üë• ÊúÉÂì°Áõ∏Èóú</option>
                                <option value="activity">üéâ Ê¥ªÂãïÁõ∏Èóú</option>
                                <option value="technical">üíª ÊäÄË°ìÂïèÈ°å</option>
                            </select>
                            <input type="text" id="faqSearchInput" oninput="filterFaq()" placeholder="ÊêúÂ∞ãÂïèÈ°å..." class="flex-1 min-w-[200px] px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                        </div>
                        <div class="space-y-4" id="faqList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Âø´ÈÄüÁ≠ÜË®ò Section -->
                <div id="quickNotesSection" class="section hidden">
                    <!-- Á≠ÜË®òÁµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-amber-100 text-sm">Á∏ΩÁ≠ÜË®ò</p><p class="text-2xl font-bold" id="noteStatTotal">0</p></div>
                                <span class="text-3xl opacity-80">üìã</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-pink-500 to-pink-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-pink-100 text-sm">ÈáçË¶Å</p><p class="text-2xl font-bold" id="noteStatImportant">0</p></div>
                                <span class="text-3xl opacity-80">‚≠ê</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-green-100 text-sm">Êú¨ÈÄ±Êñ∞Â¢û</p><p class="text-2xl font-bold" id="noteStatWeek">0</p></div>
                                <span class="text-3xl opacity-80">üìù</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-purple-100 text-sm">Ê®ôÁ±§Êï∏</p><p class="text-2xl font-bold" id="noteStatTags">0</p></div>
                                <span class="text-3xl opacity-80">üè∑Ô∏è</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><span class="text-3xl">üìã</span> Âø´ÈÄüÁ≠ÜË®ò</h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportNotes()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold">üì• ÂåØÂá∫</button>
                                <button onclick="showAddNoteDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold shadow-md">‚ûï Êñ∞Â¢ûÁ≠ÜË®ò</button>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <select id="noteFilterColor" onchange="filterNotes()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                                <option value="">ÂÖ®ÈÉ®È°èËâ≤</option>
                                <option value="yellow">üü° ÈªÉËâ≤</option>
                                <option value="green">üü¢ Á∂†Ëâ≤</option>
                                <option value="blue">üîµ ËóçËâ≤</option>
                                <option value="pink">üî¥ Á≤âËâ≤</option>
                            </select>
                            <button onclick="filterNotes('important')" class="px-3 py-2 text-sm bg-gray-200 dark:bg-gray-600 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500">‚≠ê ÈáçË¶Å</button>
                            <input type="text" id="noteSearchInput" oninput="filterNotes()" placeholder="ÊêúÂ∞ãÁ≠ÜË®ò..." class="flex-1 min-w-[200px] px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="notesList">
                            <div class="col-span-full text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- ÂæÖËæ¶‰∫ãÈ†Ö Section -->
                <div id="todoListSection" class="section hidden">
                    <!-- ÂæÖËæ¶Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-blue-100 text-sm">Á∏Ω‰ªªÂãô</p><p class="text-2xl font-bold" id="todoStatTotal">0</p></div>
                                <span class="text-3xl opacity-80">üìã</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-green-100 text-sm">Â∑≤ÂÆåÊàê</p><p class="text-2xl font-bold" id="todoStatCompleted">0</p></div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-orange-100 text-sm">ÈÄ≤Ë°å‰∏≠</p><p class="text-2xl font-bold" id="todoStatInProgress">0</p></div>
                                <span class="text-3xl opacity-80">üîÑ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div><p class="text-red-100 text-sm">Â∑≤ÈÅéÊúü</p><p class="text-2xl font-bold" id="todoStatOverdue">0</p></div>
                                <span class="text-3xl opacity-80">‚ö†Ô∏è</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><span class="text-3xl">‚úÖ</span> ÂæÖËæ¶‰∫ãÈ†Ö</h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="clearCompletedTodos()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-semibold">üóëÔ∏è Ê∏ÖÈô§Â∑≤ÂÆåÊàê</button>
                                <button onclick="showAddTodoDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold shadow-md">‚ûï Êñ∞Â¢ûÂæÖËæ¶</button>
                            </div>
                        </div>
                        <!-- ÈÄ≤Â∫¶Ê¢ù -->
                        <div class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex justify-between text-sm mb-2">
                                <span class="font-medium">ÂÆåÊàêÈÄ≤Â∫¶</span>
                                <span id="todoProgress" class="font-bold text-primary">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-4">
                                <div id="todoProgressBar" class="bg-gradient-to-r from-green-400 to-emerald-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button onclick="filterTodos('all')" class="todo-filter-btn px-4 py-2 bg-primary text-white rounded-lg text-sm">ÂÖ®ÈÉ®</button>
                            <button onclick="filterTodos('pending')" class="todo-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">‚è≥ ÂæÖËôïÁêÜ</button>
                            <button onclick="filterTodos('in_progress')" class="todo-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">üîÑ ÈÄ≤Ë°å‰∏≠</button>
                            <button onclick="filterTodos('completed')" class="todo-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">‚úÖ Â∑≤ÂÆåÊàê</button>
                            <button onclick="filterTodos('overdue')" class="todo-filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-600 rounded-lg text-sm">‚ö†Ô∏è Â∑≤ÈÅéÊúü</button>
                        </div>
                        <div class="space-y-3" id="todoItemsList">
                            <div class="text-center py-8"><div class="loading-spinner mx-auto mb-4"></div><p class="text-gray-500">ËºâÂÖ•‰∏≠...</p></div>
                        </div>
                    </div>
                </div>

                <!-- Á∂≠Ë≠∑Ê®°Âºè Section -->
                <div id="maintenanceSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üîß Á∂≠Ë≠∑Ê®°Âºè</h2>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6 mb-6">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <svg class="w-12 h-12 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200">Á∂≠Ë≠∑Ê®°ÂºèË®≠ÁΩÆ</h3>
                                    <p class="text-yellow-600 dark:text-yellow-400">ÂïüÁî®Á∂≠Ë≠∑Ê®°ÂºèÂæåÔºåË®™ÂÆ¢Â∞áÁúãÂà∞Á∂≠Ë≠∑È†ÅÈù¢ÔºåÁÑ°Ê≥ïË®™ÂïèÁ∂≤Á´ôÂÖßÂÆπ„ÄÇ</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="maintenanceModeToggle" class="sr-only peer" onchange="toggleMaintenanceMode()">
                                    <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                                </label>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Á∂≠Ë≠∑Ë®äÊÅØ</label>
                                <textarea id="maintenanceMessage" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="Á∂≤Á´ôÊ≠£Âú®Á∂≠Ë≠∑‰∏≠ÔºåË´ãÁ®çÂæåÂÜçË©¶...">Á∂≤Á´ôÊ≠£Âú®Á∂≠Ë≠∑‰∏≠ÔºåË´ãÁ®çÂæåÂÜçË©¶...</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">È†êË®àÂÆåÊàêÊôÇÈñì</label>
                                <input type="datetime-local" id="maintenanceEndTime" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                            </div>
                            <button onclick="saveMaintenanceSettings()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠òË®≠ÁΩÆ</button>
                        </div>
                    </div>
                </div>

                <!-- ‰∏ªÈ°åË®≠ÁΩÆ Section -->
                <div id="themeSettingsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üé® ‰∏ªÈ°åË®≠ÁΩÆ</h2>
                        </div>
                        <!-- ‰∏ªËâ≤Ë™øÈÅ∏Êìá -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4">‰∏ªËâ≤Ë™ø</h3>
                            <div class="grid grid-cols-6 gap-3" id="colorPalette">
                                <button onclick="setThemeColor('#8B5CF6')" class="w-12 h-12 rounded-full bg-[#8B5CF6] border-4 border-transparent hover:border-gray-400 transition-all" title="Á¥´Ëâ≤"></button>
                                <button onclick="setThemeColor('#3B82F6')" class="w-12 h-12 rounded-full bg-[#3B82F6] border-4 border-transparent hover:border-gray-400 transition-all" title="ËóçËâ≤"></button>
                                <button onclick="setThemeColor('#10B981')" class="w-12 h-12 rounded-full bg-[#10B981] border-4 border-transparent hover:border-gray-400 transition-all" title="Á∂†Ëâ≤"></button>
                                <button onclick="setThemeColor('#F59E0B')" class="w-12 h-12 rounded-full bg-[#F59E0B] border-4 border-transparent hover:border-gray-400 transition-all" title="Ê©ôËâ≤"></button>
                                <button onclick="setThemeColor('#EF4444')" class="w-12 h-12 rounded-full bg-[#EF4444] border-4 border-transparent hover:border-gray-400 transition-all" title="Á¥ÖËâ≤"></button>
                                <button onclick="setThemeColor('#EC4899')" class="w-12 h-12 rounded-full bg-[#EC4899] border-4 border-transparent hover:border-gray-400 transition-all" title="Á≤âËâ≤"></button>
                            </div>
                        </div>
                        <!-- Ëá™Ë®ÇÈ°èËâ≤ -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4">Ëá™Ë®ÇÈ°èËâ≤</h3>
                            <div class="flex space-x-4">
                                <input type="color" id="customThemeColor" value="#8B5CF6" class="w-16 h-16 rounded-lg cursor-pointer">
                                <button onclick="applyCustomColor()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Â•óÁî®</button>
                            </div>
                        </div>
                        <!-- Á∂≤Á´ôÂêçÁ®± -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-4">Á∂≤Á´ôÂêçÁ®±</h3>
                            <input type="text" id="siteNameInput" value="ÁßëÊäÄÂ≠∏ÊúÉ" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ëº∏ÂÖ•Á∂≤Á´ôÂêçÁ®±">
                        </div>
                        <button onclick="saveThemeSettings()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò‰∏ªÈ°åË®≠ÁΩÆ</button>
                    </div>
                </div>

                <!-- ========== Êõ¥Â§öÂäüËÉΩÂçÄÂ°ä ========== -->

                <!-- ÈÉµ‰ª∂Ê®°Êùø Section -->
                <div id="emailTemplatesSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìß ÈÉµ‰ª∂Ê®°Êùø</h2>
                            <button onclick="showCreateEmailTemplateDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÊ®°Êùø</button>
                        </div>
                        <div id="emailTemplatesList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Á§æÁæ§ÈÄ£Áµê Section -->
                <div id="socialLinksSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üîó Á§æÁæ§ÈÄ£Áµê</h2>
                            <button onclick="showAddSocialLinkDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÈÄ£Áµê</button>
                        </div>
                        <div id="socialLinksList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-2">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- ÊúÉË≠∞Ë®òÈåÑ Section -->
                <div id="meetingMinutesSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìù ÊúÉË≠∞Ë®òÈåÑ</h2>
                            <button onclick="showCreateMeetingDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûË®òÈåÑ</button>
                        </div>
                        <div id="meetingMinutesList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Êñá‰ª∂Â∫´ Section -->
                <div id="documentLibrarySection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìÅ Êñá‰ª∂Â∫´</h2>
                            <button onclick="showUploadDocumentDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ ‰∏äÂÇ≥Êñá‰ª∂</button>
                        </div>
                        <div class="mb-4 flex space-x-2">
                            <input type="text" id="documentSearch" placeholder="ÊêúÂ∞ãÊñá‰ª∂..." class="flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                            <select id="documentCategory" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700">
                                <option value="">ÂÖ®ÈÉ®È°ûÂà•</option>
                                <option value="manual">ÊâãÂÜä</option>
                                <option value="form">Ë°®ÂñÆ</option>
                                <option value="report">Â†±Âëä</option>
                                <option value="other">ÂÖ∂‰ªñ</option>
                            </select>
                        </div>
                        <div id="documentLibraryList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- ÊïôÂ≠∏Ë≥áÊ∫ê Section -->
                <div id="learningResourcesSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìö ÊïôÂ≠∏Ë≥áÊ∫ê</h2>
                            <button onclick="showAddResourceDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûË≥áÊ∫ê</button>
                        </div>
                        <div class="mb-4 flex flex-wrap gap-2" id="resourceTags">
                            <button onclick="filterResources('all')" class="px-4 py-2 bg-primary text-white rounded-lg text-sm">ÂÖ®ÈÉ®</button>
                            <button onclick="filterResources('video')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm">ÂΩ±Áâá</button>
                            <button onclick="filterResources('article')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm">ÊñáÁ´†</button>
                            <button onclick="filterResources('tutorial')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm">ÊïôÁ®ã</button>
                            <button onclick="filterResources('tool')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm">Â∑•ÂÖ∑</button>
                        </div>
                        <div id="learningResourcesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Â∞àÊ°àËøΩËπ§ Section -->
                <div id="projectTrackerSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìä Â∞àÊ°àËøΩËπ§</h2>
                            <button onclick="showCreateProjectDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Âª∫Â∞àÊ°à</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-gray-100 dark:bg-gray-700 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-primary" id="projectsTotal">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Á∏ΩÂ∞àÊ°àÊï∏</p>
                            </div>
                            <div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-blue-600" id="projectsInProgress">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈÄ≤Ë°å‰∏≠</p>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-green-600" id="projectsCompleted">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Â∑≤ÂÆåÊàê</p>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-yellow-600" id="projectsPending">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÂæÖËôïÁêÜ</p>
                            </div>
                        </div>
                        <div id="projectTrackerList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Â∞èÁµÑÁÆ°ÁêÜ Section -->
                <div id="teamGroupsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üë• Â∞èÁµÑÁÆ°ÁêÜ</h2>
                            <button onclick="showCreateGroupDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Âª∫Á´ãÂ∞èÁµÑ</button>
                        </div>
                        <div id="teamGroupsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- ËÄÉÂã§Ë®òÈåÑ Section -->
                <div id="attendanceRecordsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìã ËÄÉÂã§Ë®òÈåÑ</h2>
                            <button onclick="showAddAttendanceDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûË®òÈåÑ</button>
                        </div>
                        <div class="mb-4 flex space-x-4">
                            <input type="date" id="attendanceDateFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700">
                            <select id="attendanceEventFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700">
                                <option value="">ÂÖ®ÈÉ®Ê¥ªÂãï</option>
                            </select>
                            <button onclick="exportAttendance()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">ÂåØÂá∫</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <th class="py-3 px-4">ÊúÉÂì°</th>
                                        <th class="py-3 px-4">Ê¥ªÂãï</th>
                                        <th class="py-3 px-4">Á∞ΩÂà∞ÊôÇÈñì</th>
                                        <th class="py-3 px-4">ÁãÄÊÖã</th>
                                        <th class="py-3 px-4">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTableBody">
                                    <tr><td colspan="5" class="text-center py-8 text-gray-500">ËºâÂÖ•‰∏≠...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ÁçéÊá≤Ë®òÈåÑ Section -->
                <div id="rewardsPenaltiesSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">‚≠ê ÁçéÊá≤Ë®òÈåÑ</h2>
                            <button onclick="showAddRewardPenaltyDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûË®òÈåÑ</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-green-50 dark:bg-green-900/30 rounded-xl p-4">
                                <h3 class="text-lg font-semibold text-green-600 mb-2">üèÜ ÂòâÁçé</h3>
                                <p class="text-3xl font-bold" id="rewardsCount">0</p>
                            </div>
                            <div class="bg-red-50 dark:bg-red-900/30 rounded-xl p-4">
                                <h3 class="text-lg font-semibold text-red-600 mb-2">‚ö†Ô∏è Êá≤Ëôï</h3>
                                <p class="text-3xl font-bold" id="penaltiesCount">0</p>
                            </div>
                        </div>
                        <div id="rewardsPenaltiesList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Ë¥äÂä©ÂïÜ Section -->
                <div id="sponsorsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üè¢ Ë¥äÂä©ÂïÜÁÆ°ÁêÜ</h2>
                            <button onclick="showAddSponsorDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûË¥äÂä©ÂïÜ</button>
                        </div>
                        <div id="sponsorsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Âêà‰ΩúÂ§•‰º¥ Section -->
                <div id="partnersSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ü§ù Âêà‰ΩúÂ§•‰º¥</h2>
                            <button onclick="showAddPartnerDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÂ§•‰º¥</button>
                        </div>
                        <div id="partnersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- ÊØîË≥ΩË®òÈåÑ Section -->
                <div id="competitionsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üèÜ ÊØîË≥ΩË®òÈåÑ</h2>
                            <button onclick="showAddCompetitionDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÊØîË≥Ω</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-xl p-4 text-center">
                                <p class="text-3xl font-bold text-yellow-600" id="goldMedals">ü•á 0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈáëÁâå</p>
                            </div>
                            <div class="bg-gray-100 dark:bg-gray-700 rounded-xl p-4 text-center">
                                <p class="text-3xl font-bold text-gray-500" id="silverMedals">ü•à 0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈäÄÁâå</p>
                            </div>
                            <div class="bg-orange-50 dark:bg-orange-900/30 rounded-xl p-4 text-center">
                                <p class="text-3xl font-bold text-orange-600" id="bronzeMedals">ü•â 0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈäÖÁâå</p>
                            </div>
                        </div>
                        <div id="competitionsList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Ë≠âÊõ∏ÁîüÊàê Section -->
                <div id="certificatesSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìú Ë≠âÊõ∏ÁîüÊàê</h2>
                            <div class="flex space-x-2">
                                <button onclick="downloadCertificate()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">üì• ‰∏ãËºâË≠âÊõ∏</button>
                                <button onclick="printCertificate()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">üñ®Ô∏è ÂàóÂç∞</button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Ë≠âÊõ∏Ë®≠ÂÆö -->
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold">üìã Ë≠âÊõ∏Ë®≠ÂÆö</h3>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Ë≠âÊõ∏È°ûÂûã</label>
                                    <select id="certType" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="updateCertificatePreview()">
                                        <option value="participation">üé´ ÂèÉËàáË≠âÊõ∏</option>
                                        <option value="completion">‚úÖ ÂÆåÊàêË≠âÊõ∏</option>
                                        <option value="excellence">‚≠ê ÂÑ™ÁßÄË≠âÊõ∏</option>
                                        <option value="award">üèÜ Áç≤ÁçéË≠âÊõ∏</option>
                                        <option value="appreciation">üíñ ÊÑüË¨ùÁãÄ</option>
                                        <option value="volunteer">ü§ù ÂøóÂ∑•Ë≠âÊõ∏</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Áç≤ÁçéËÄÖÂßìÂêç *</label>
                                    <input type="text" id="certRecipient" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="Ë´ãËº∏ÂÖ•ÂßìÂêç" oninput="updateCertificatePreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Ê¥ªÂãï/ÊØîË≥ΩÂêçÁ®± *</label>
                                    <input type="text" id="certEvent" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="Ë´ãËº∏ÂÖ•Ê¥ªÂãïÂêçÁ®±" oninput="updateCertificatePreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êó•Êúü</label>
                                    <input type="date" id="certDate" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="updateCertificatePreview()">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Áç≤ÁçéÂêçÊ¨° (ÈÅ∏Â°´)</label>
                                    <select id="certRank" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="updateCertificatePreview()">
                                        <option value="">ÁÑ°</option>
                                        <option value="first">ü•á Á¨¨‰∏ÄÂêç</option>
                                        <option value="second">ü•à Á¨¨‰∫åÂêç</option>
                                        <option value="third">ü•â Á¨¨‰∏âÂêç</option>
                                        <option value="special">üåü ÁâπÂà•Áçé</option>
                                        <option value="honorable">üìã ‰Ω≥‰Ωú</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Á∞ΩÁôº‰∫∫</label>
                                    <input type="text" id="certIssuer" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="‰æãÔºöÊúÉÈï∑ xxx" oninput="updateCertificatePreview()">
                                </div>
                            </div>
                            <!-- Ê®£ÂºèÈÅ∏Êìá -->
                            <div class="space-y-4">
                                <h3 class="text-lg font-semibold">üé® Ê®£ÂºèË®≠ÂÆö</h3>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Ë≠âÊõ∏Ê®£Âºè</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="setCertStyle('classic')" class="cert-style-btn p-3 border-2 border-primary bg-primary/10 rounded-lg text-sm" data-style="classic">üèõÔ∏è Á∂ìÂÖ∏</button>
                                        <button onclick="setCertStyle('modern')" class="cert-style-btn p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-sm" data-style="modern">‚ú® Áèæ‰ª£</button>
                                        <button onclick="setCertStyle('elegant')" class="cert-style-btn p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-sm" data-style="elegant">üëë ÂÖ∏ÈõÖ</button>
                                        <button onclick="setCertStyle('minimal')" class="cert-style-btn p-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg text-sm" data-style="minimal">üìÑ Ê•µÁ∞°</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">‰∏ªÈ°åËâ≤</label>
                                    <div class="flex space-x-2">
                                        <button onclick="setCertColor('#5D5CDE')" class="w-8 h-8 rounded-full bg-[#5D5CDE] border-2 border-white shadow cert-color-btn" data-color="#5D5CDE"></button>
                                        <button onclick="setCertColor('#059669')" class="w-8 h-8 rounded-full bg-[#059669] border-2 border-transparent cert-color-btn" data-color="#059669"></button>
                                        <button onclick="setCertColor('#DC2626')" class="w-8 h-8 rounded-full bg-[#DC2626] border-2 border-transparent cert-color-btn" data-color="#DC2626"></button>
                                        <button onclick="setCertColor('#D97706')" class="w-8 h-8 rounded-full bg-[#D97706] border-2 border-transparent cert-color-btn" data-color="#D97706"></button>
                                        <button onclick="setCertColor('#7C3AED')" class="w-8 h-8 rounded-full bg-[#7C3AED] border-2 border-transparent cert-color-btn" data-color="#7C3AED"></button>
                                        <button onclick="setCertColor('#0891B2')" class="w-8 h-8 rounded-full bg-[#0891B2] border-2 border-transparent cert-color-btn" data-color="#0891B2"></button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">È°çÂ§ñË™™Êòé (ÈÅ∏Â°´)</label>
                                    <textarea id="certDescription" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 resize-none" placeholder="‰æãÔºöË°®ÁèæÂÑ™Áï∞ÔºåÁâπÊ≠§Ë°®Êèö" oninput="updateCertificatePreview()"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Ë≠âÊõ∏Á∑®Ëôü (ÈÅ∏Â°´)</label>
                                    <div class="flex space-x-2">
                                        <input type="text" id="certNumber" class="flex-1 px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="Ëá™ÂãïÁîüÊàê" oninput="updateCertificatePreview()">
                                        <button onclick="generateCertNumber()" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-lg text-sm">Ëá™Âãï</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Ë≠âÊõ∏È†êË¶Ω -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4">üëÅÔ∏è Ë≠âÊõ∏È†êË¶Ω</h3>
                                <div id="certificatePreview" class="bg-white rounded-xl shadow-lg overflow-hidden" style="aspect-ratio: 1.414/1;">
                                    <div class="w-full h-full flex items-center justify-center text-gray-400 p-4">
                                        <p>Â°´ÂØ´Ë≥áÊñôÂæåËá™ÂãïÈ†êË¶Ω</p>
                                    </div>
                                </div>
                                <div class="mt-4 flex space-x-2">
                                    <button onclick="generateCertificate()" class="flex-1 px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">üé® ÁîüÊàêË≠âÊõ∏</button>
                                    <button onclick="saveCertificateRecord()" class="px-4 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors" title="ÂÑ≤Â≠òË®òÈåÑ">üíæ</button>
                                </div>
                            </div>
                        </div>
                        <!-- Â∑≤ÁôºÊîæË≠âÊõ∏Ë®òÈåÑ -->
                        <div class="mt-8">
                            <h3 class="text-lg font-semibold mb-4">üìã Â∑≤ÁôºÊîæË≠âÊõ∏Ë®òÈåÑ</h3>
                            <div id="certificateHistory" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <p class="text-gray-500 dark:text-gray-400 text-center py-4 col-span-3">Â∞öÁÑ°Ë≠âÊõ∏Ë®òÈåÑ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂïèÈ°åÂõûÂ†± Section -->
                <div id="bugReportsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üêõ ÂïèÈ°åÂõûÂ†±</h2>
                        </div>
                        <div class="mb-4 flex space-x-2">
                            <select id="bugStatusFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="filterBugReports()">
                                <option value="">ÂÖ®ÈÉ®ÁãÄÊÖã</option>
                                <option value="open">ÂæÖËôïÁêÜ</option>
                                <option value="in_progress">ËôïÁêÜ‰∏≠</option>
                                <option value="resolved">Â∑≤Ëß£Ê±∫</option>
                                <option value="closed">Â∑≤ÈóúÈñâ</option>
                            </select>
                            <select id="bugPriorityFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="filterBugReports()">
                                <option value="">ÂÖ®ÈÉ®ÂÑ™ÂÖàÁ¥ö</option>
                                <option value="high">È´ò</option>
                                <option value="medium">‰∏≠</option>
                                <option value="low">‰Ωé</option>
                            </select>
                        </div>
                        <div id="bugReportsList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- ÊÑèË¶ãÁÆ± Section -->
                <div id="suggestionBoxSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üí° ÊÑèË¶ãÁÆ±</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-blue-600" id="suggestionsTotal">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Á∏ΩÂª∫Ë≠∞Êï∏</p>
                            </div>
                            <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-yellow-600" id="suggestionsPending">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÂæÖÂØ©Ê†∏</p>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/30 rounded-xl p-4 text-center">
                                <p class="text-2xl font-bold text-green-600" id="suggestionsImplemented">0</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Â∑≤Êé°Á¥ç</p>
                            </div>
                        </div>
                        <div id="suggestionsList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Áü•Ë≠òÂ∫´ Section -->
                <div id="knowledgeBaseSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìñ Áü•Ë≠òÂ∫´</h2>
                            <button onclick="showCreateArticleDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÊñáÁ´†</button>
                        </div>
                        <div class="mb-4">
                            <input type="text" id="knowledgeSearch" placeholder="ÊêúÂ∞ãÁü•Ë≠òÂ∫´..." class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" oninput="searchKnowledge()">
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4" id="knowledgeTags"></div>
                        <div id="knowledgeBaseList" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Ê®ôÁ±§ÁÆ°ÁêÜ Section -->
                <div id="tagManagementSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üè∑Ô∏è Ê®ôÁ±§ÁÆ°ÁêÜ</h2>
                            <button onclick="showAddTagDialog()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">+ Êñ∞Â¢ûÊ®ôÁ±§</button>
                        </div>
                        <div id="tagsList" class="flex flex-wrap gap-3">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8 w-full">ËºâÂÖ•‰∏≠...</p>
                        </div>
                    </div>
                </div>

                <!-- Êï∏ÊìöÂåØÂá∫ Section -->
                <div id="dataExportSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üì• Êï∏ÊìöÂåØÂá∫</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h3 class="font-semibold mb-2">üìÖ Ê¥ªÂãïË≥áÊñô</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂåØÂá∫ÊâÄÊúâÊ¥ªÂãïË≥áÊñô</p>
                                <button onclick="exportData('activities')" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">ÂåØÂá∫ CSV</button>
                            </div>
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h3 class="font-semibold mb-2">üë• ÊúÉÂì°Ë≥áÊñô</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂåØÂá∫ÊúÉÂì°ÂêçÂñÆ</p>
                                <button onclick="exportData('members')" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">ÂåØÂá∫ CSV</button>
                            </div>
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h3 class="font-semibold mb-2">üìã ËÄÉÂã§Ë®òÈåÑ</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂåØÂá∫ËÄÉÂã§Ë≥áÊñô</p>
                                <button onclick="exportData('attendance')" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">ÂåØÂá∫ CSV</button>
                            </div>
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h3 class="font-semibold mb-2">üí∞ Ë≤°ÂãôË≥áÊñô</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂåØÂá∫Êî∂ÊîØË®òÈåÑ</p>
                                <button onclick="exportData('finance')" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">ÂåØÂá∫ CSV</button>
                            </div>
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h3 class="font-semibold mb-2">üìä Â†±ÂêçË≥áÊñô</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂåØÂá∫Ê¥ªÂãïÂ†±Âêç</p>
                                <button onclick="exportData('registrations')" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm">ÂåØÂá∫ CSV</button>
                            </div>
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                                <h3 class="font-semibold mb-2">üìÅ ÂÆåÊï¥ÂÇô‰ªΩ</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂåØÂá∫ÂÖ®ÈÉ®Ë≥áÊñô</p>
                                <button onclick="exportData('all')" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm">ÂåØÂá∫ JSON</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Á≥ªÁµ±Êó•Ë™å Section -->
                <div id="systemLogsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üìã Á≥ªÁµ±Êó•Ë™å</h2>
                            <button onclick="clearOldLogs()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm">Ê∏ÖÈô§ËàäÊó•Ë™å</button>
                        </div>
                        <div class="mb-4 flex space-x-2">
                            <select id="logTypeFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="filterLogs()">
                                <option value="">ÂÖ®ÈÉ®È°ûÂûã</option>
                                <option value="login">ÁôªÂÖ•</option>
                                <option value="create">Âª∫Á´ã</option>
                                <option value="update">Êõ¥Êñ∞</option>
                                <option value="delete">Âà™Èô§</option>
                                <option value="error">ÈåØË™§</option>
                            </select>
                            <input type="date" id="logDateFilter" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" onchange="filterLogs()">
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <th class="py-3 px-4">ÊôÇÈñì</th>
                                        <th class="py-3 px-4">È°ûÂûã</th>
                                        <th class="py-3 px-4">Áî®Êà∂</th>
                                        <th class="py-3 px-4">Êìç‰Ωú</th>
                                        <th class="py-3 px-4">Ë©≥ÊÉÖ</th>
                                    </tr>
                                </thead>
                                <tbody id="systemLogsTableBody">
                                    <tr><td colspan="5" class="text-center py-8 text-gray-500">ËºâÂÖ•‰∏≠...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ÂÇô‰ªΩÈÇÑÂéü Section -->
                <div id="backupRestoreSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">üíæ ÂÇô‰ªΩÈÇÑÂéü</h2>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-6">
                                <h3 class="text-lg font-semibold mb-4">üì§ Âª∫Á´ãÂÇô‰ªΩ</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂÇô‰ªΩÊâÄÊúâÁ≥ªÁµ±Ë≥áÊñôÂà∞Êú¨Âú∞</p>
                                <div class="space-y-3">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="backupActivities" checked class="rounded">
                                        <span>Ê¥ªÂãïË≥áÊñô</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="backupMembers" checked class="rounded">
                                        <span>ÊúÉÂì°Ë≥áÊñô</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="backupSettings" checked class="rounded">
                                        <span>Á≥ªÁµ±Ë®≠ÁΩÆ</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" id="backupFinance" checked class="rounded">
                                        <span>Ë≤°ÂãôË≥áÊñô</span>
                                    </label>
                                </div>
                                <button onclick="createBackup()" class="w-full mt-4 px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Âª∫Á´ãÂÇô‰ªΩ</button>
                            </div>
                            <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-6">
                                <h3 class="text-lg font-semibold mb-4">üì• ÈÇÑÂéüÂÇô‰ªΩ</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">ÂæûÂÇô‰ªΩÊ™îÊ°àÈÇÑÂéüÁ≥ªÁµ±Ë≥áÊñô</p>
                                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center">
                                    <input type="file" id="restoreFileInput" accept=".json" class="hidden" onchange="handleRestoreFile(event)">
                                    <button onclick="document.getElementById('restoreFileInput').click()" class="px-6 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÈÅ∏ÊìáÂÇô‰ªΩÊ™îÊ°à</button>
                                    <p class="text-sm text-gray-500 mt-2">ÊîØÊè¥ .json Ê†ºÂºè</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6">
                            <h3 class="text-lg font-semibold mb-4">üìú ÂÇô‰ªΩÊ≠∑Âè≤</h3>
                            <div id="backupHistoryList" class="space-y-2">
                                <p class="text-gray-500 dark:text-gray-400 text-center py-4">Â∞öÁÑ°ÂÇô‰ªΩË®òÈåÑ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========== Êõ¥Â§öÂäüËÉΩÂçÄÂ°äÁµêÊùü ========== -->

            </main>
        </div>
    </div>

    <!-- Activity Modal -->
    <div id="activityModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="activityModalTitle">Êñ∞Â¢ûÊ¥ªÂãï</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="activityForm" class="space-y-4">
                <input type="hidden" id="activityId">

                <!-- Ê¥ªÂãïÊ®ôÈ°å - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="activityTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="activityTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊ®ôÈ°åÔºàEnglishÔºâ</label>
                        <input type="text" id="activityTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊó•Êúü</label>
                    <input type="text" id="activityDate" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: 2024Âπ¥3Êúà15Êó•" required>
                </div>

                <!-- Ê¥ªÂãïÊèèËø∞ - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊèèËø∞ÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <textarea id="activityDescriptionZhTW" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊèèËø∞ÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <textarea id="activityDescriptionZhCN" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊèèËø∞ÔºàEnglishÔºâ</label>
                        <textarea id="activityDescriptionEn" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÈÄ£Áµê (ÈÅ∏Â°´)</label>
                    <input type="url" id="activityLink" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="https://example.com">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Modal -->
    <div id="projectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="projectModalTitle">Êñ∞Â¢ûÂ∞àÊ°à</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="projectForm" class="space-y-4">
                <input type="hidden" id="projectId">

                <!-- Â∞àÊ°àÊ®ôÈ°å - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="projectTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="projectTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊ®ôÈ°åÔºàEnglishÔºâ</label>
                        <input type="text" id="projectTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÁãÄÊÖã</label>
                    <select id="projectStatus" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="ÈÄ≤Ë°å‰∏≠">ÈÄ≤Ë°å‰∏≠</option>
                        <option value="Â∑≤ÂÆåÊàê">Â∑≤ÂÆåÊàê</option>
                        <option value="Ë®àÂäÉ‰∏≠">Ë®àÂäÉ‰∏≠</option>
                    </select>
                </div>

                <!-- Â∞àÊ°àÊèèËø∞ - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊèèËø∞ÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <textarea id="projectDescriptionZhTW" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊèèËø∞ÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <textarea id="projectDescriptionZhCN" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊèèËø∞ÔºàEnglishÔºâ</label>
                        <textarea id="projectDescriptionEn" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">‰ΩøÁî®ÊäÄË°ì (Áî®ÈÄóËôüÂàÜÈöî)</label>
                    <input type="text" id="projectTechnologies" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: React, Node.js, MongoDB">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂèÉËàáÊàêÂì°Êï∏</label>
                    <input type="number" id="projectMembers" min="0" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="0">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÈÄ£Áµê (ÈÅ∏Â°´)</label>
                    <input type="url" id="projectLink" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="https://github.com/...">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div id="teamMemberModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="teamMemberModalTitle">Êñ∞Â¢ûÂúòÈöäÊàêÂì°</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="teamMemberForm" class="space-y-4">
                <input type="hidden" id="teamMemberId">

                <!-- Name in 3 languages -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">ÊàêÂì°ÂßìÂêçÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="memberNameZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Âºµ‰∏â">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ÊàêÂì°ÂßìÂêçÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="memberNameZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Âº†‰∏â">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ÊàêÂì°ÂßìÂêçÔºàEnglishÔºâ</label>
                        <input type="text" id="memberNameEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Zhang San">
                    </div>
                </div>

                <!-- Position in 3 languages -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">ËÅ∑‰ΩçÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="memberPositionZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="ÊúÉÈï∑">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ËÅ∑‰ΩçÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="memberPositionZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰ºöÈïø">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ËÅ∑‰ΩçÔºàEnglishÔºâ</label>
                        <input type="text" id="memberPositionEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="President">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂ÔºàÈÅ∏Â°´Ôºâ</label>
                    <input type="email" id="memberEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="example@email.com">
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">ÊéíÂ∫èÈ†ÜÂ∫è<span class="text-red-500">*</span></label>
                    <input type="number" id="memberOrder" min="0" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="0">
                    <p class="text-xs text-gray-500 mt-1">Êï∏Â≠óË∂äÂ∞èÊéíÂ∫èË∂äÂâç</p>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">ÂõûË¶ÜË®äÊÅØ</h3>
                <button onclick="closeReplyModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="space-y-4 mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Áôº‰ª∂‰∫∫</p>
                    <p class="font-semibold" id="replyEmail"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">‰∏ªÊó®</p>
                    <p class="font-semibold" id="replySubject"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">ÂÖßÂÆπ</p>
                    <p id="replyOriginalMessage" class="whitespace-pre-wrap"></p>
                </div>
            </div>

            <form id="replyForm" onsubmit="handleReply(event)" class="space-y-4">
                <input type="hidden" id="replyContactId">
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂõûË¶ÜÂÖßÂÆπ</label>
                    <textarea id="replyContent" rows="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" required placeholder="Ë´ãËº∏ÂÖ•ÂõûË¶ÜÂÖßÂÆπ..."></textarea>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeReplyModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>ÁôºÈÄÅÂõûË¶Ü
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Set Username Modal -->
    <div id="setUsernameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="text-center mb-6">
                <svg class="w-16 h-16 mx-auto mb-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <h3 class="text-2xl font-bold">Ë®≠ÂÆöÁî®Êà∂Âêç</h3>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Ë´ãÁÇ∫ÊÇ®ÁöÑÂ∏≥ËôüË®≠ÂÆö‰∏ÄÂÄãÂîØ‰∏ÄÁöÑÁî®Êà∂Âêç</p>
            </div>

            <form id="setUsernameForm" onsubmit="return handleSetUsername(event)" class="space-y-4">
                <div>
                    <label for="newUsername" class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç</label>
                    <input type="text" id="newUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="3-20ÂÄãÂ≠óÁ¨¶ÔºåÂèØÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶" required pattern="[a-zA-Z0-9_-]{3,20}" title="Áî®Êà∂ÂêçÂøÖÈ†àÁÇ∫3-20ÂÄãÂ≠óÁ¨¶ÔºåÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Áî®Êà∂ÂêçË®≠ÂÆöÂæå‰∏çÂèØÊõ¥Êîπ</p>
                </div>
                <button type="submit" id="setUsernameBtn" class="w-full px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                    Á¢∫Ë™çË®≠ÂÆö
                </button>
            </form>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div id="userModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="userModalTitle">Á∑®ËºØÁî®Êà∂</h3>
                <button class="closeUserModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="userForm" class="space-y-4">
                <input type="hidden" id="userId">
                <div>
                    <label class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç</label>
                    <input type="text" id="userUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" readonly>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Áî®Êà∂Âêç‰∏çÂèØ‰øÆÊîπ</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂</label>
                    <input type="email" id="userEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" readonly>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÈõªÂ≠êÈÉµ‰ª∂‰∏çÂèØ‰øÆÊîπ</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂßìÂêç</label>
                    <input type="text" id="userName" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ËßíËâ≤</label>
                    <select id="userRole" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="user">ÊôÆÈÄöÁî®Êà∂</option>
                        <option value="admin">ÁÆ°ÁêÜÂì°</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÁãÄÊÖã</label>
                    <select id="userStatus" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="pending">ÂæÖÂØ©Ê†∏</option>
                        <option value="approved">Â∑≤ÊâπÂáÜ</option>
                        <option value="rejected">Â∑≤ÊãíÁµï</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeUserModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Êñ∞Â¢ûÁî®Êà∂</h3>
                <button class="closeAddUserModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="addUserForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">ÁúüÂØ¶ÂßìÂêç <span class="text-red-500">*</span></label>
                    <input type="text" id="addUserName" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•ÁúüÂØ¶ÂßìÂêç" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç <span class="text-red-500">*</span></label>
                    <input type="text" id="addUserUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="3-20Â≠óÁ¨¶ÔºåÂÉÖÂ≠óÊØçÊï∏Â≠ó‰∏ãÂäÉÁ∑öÈÄ£Â≠óÁ¨¶" required>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÂÉÖÂÖÅË®±Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑ö(_)ÂíåÈÄ£Â≠óÁ¨¶(-)</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂ <span class="text-red-500">*</span></label>
                    <input type="email" id="addUserEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•ÈõªÂ≠êÈÉµ‰ª∂" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂØÜÁ¢º <span class="text-red-500">*</span></label>
                    <input type="password" id="addUserPassword" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ëá≥Â∞ë6‰Ωç" required>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÂØÜÁ¢ºÈï∑Â∫¶Ëá≥Â∞ë6‰Ωç</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Á¢∫Ë™çÂØÜÁ¢º <span class="text-red-500">*</span></label>
                    <input type="password" id="addUserPasswordConfirm" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãÂÜçÊ¨°Ëº∏ÂÖ•ÂØÜÁ¢º" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ËßíËâ≤ <span class="text-red-500">*</span></label>
                    <select id="addUserRole" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="user">ÊôÆÈÄöÁî®Êà∂</option>
                        <option value="admin">ÁÆ°ÁêÜÂì°</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÁãÄÊÖã <span class="text-red-500">*</span></label>
                    <select id="addUserStatus" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="approved" selected>Â∑≤ÊâπÂáÜ</option>
                        <option value="pending">ÂæÖÂØ©Ê†∏</option>
                        <option value="rejected">Â∑≤ÊãíÁµï</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeAddUserModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÁôºÈÄÅÈ©óË≠âÁ¢º</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Verify Modal -->
    <div id="addUserVerifyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeAddUserVerifyModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤Âêë <span class="font-semibold" id="addUserVerifyEmail"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º</label>
                    <input type="text" id="addUserVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeAddUserVerifyModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmAddUser()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™çÂâµÂª∫</button>
            </div>
        </div>
    </div>

    <!-- Verify Username Modal -->
    <!-- Verify Name Modal -->
    <div id="verifyNameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyNameModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤Âêë <span class="font-semibold" id="verifyNameEmail"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º</label>
                    <input type="text" id="nameVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyNameModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmUpdateName()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- Verify Username Modal -->
    <div id="verifyUsernameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyUsernameModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤Âêë <span class="font-semibold" id="verifyUsernameEmail"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º</label>
                    <input type="text" id="usernameVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyUsernameModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmUpdateUsername()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- Verify Old Email Modal -->
    <div id="verifyOldEmailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âËàäÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyOldEmailModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤ÂêëÊÇ®ÁöÑËàäÈõªÈÉµ <span class="font-semibold" id="verifyOldEmailAddress"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•ËàäÈõªÈÉµÈ©óË≠âÁ¢º</label>
                    <input type="text" id="oldEmailVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyOldEmailModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmOldEmail()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">‰∏ã‰∏ÄÊ≠•</button>
            </div>
        </div>
    </div>

    <!-- Verify New Email Modal -->
    <div id="verifyNewEmailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÊñ∞ÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyNewEmailModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤ÂêëÊÇ®ÁöÑÊñ∞ÈõªÈÉµ <span class="font-semibold" id="verifyNewEmailAddress"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•Êñ∞ÈõªÈÉµÈ©óË≠âÁ¢º</label>
                    <input type="text" id="newEmailVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyNewEmailModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmUpdateEmail()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // EmailJS ÈÖçÁΩÆÔºàËàá index.html ‰øùÊåÅ‰∏ÄËá¥Ôºâ
        const emailJSConfig = {
            publicKey: 'wSb5w9ZOF2-9HGCu1',
            serviceId: 'ats-ÁßëÊäÄÂ≠∏ÊúÉ',
            templateId: 'template_nhcptbe'  // Áî®ÊñºÈ©óË≠âÁ¢ºÁöÑÊ®°Êùø
        };

        // ÂàùÂßãÂåñ EmailJS ‰∏¶Á¢∫‰øùÂÖ®ÂüüÂèØÁî®
        emailjs.init(emailJSConfig.publicKey);
        window.emailjs = emailjs; // Á¢∫‰øù emailjs Âú®ÂÖ®Âüü‰ΩúÁî®ÂüüÂèØÁî®
        window.emailJSConfig = emailJSConfig; // Â∞áÈÖçÁΩÆÊö¥Èú≤Âà∞ÂÖ®Âüü
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc, query, orderBy, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase ÈÖçÁΩÆÔºàËàá index.html ‰øùÊåÅ‰∏ÄËá¥Ôºâ
        const firebaseConfig = {
            apiKey: "AIzaSyCCXmBJkesxRi3ufdCRucd5vcmg-Ls_3Ks",
            authDomain: "tech-society-566dc.firebaseapp.com",
            projectId: "tech-society-566dc",
            storageBucket: "tech-society-566dc.firebasestorage.app",
            messagingSenderId: "1098408063649",
            appId: "1:1098408063649:web:ec07e23e03c43f92c7f6e0",
            measurementId: "G-05127H92FQ"
        };

        // ÂàùÂßãÂåñ Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Â≠òÂÇ®Âà∞ window ÂØπË±°‰ª•‰æõÂÖ∂‰ªñËÑöÊú¨‰ΩøÁî®
        window.firebaseAuth = auth;
        window.firebaseDB = db;
        window.firestoreModules = { collection, addDoc, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc, query, orderBy, where, serverTimestamp };
        window.authModules = { signInWithEmailAndPassword, signOut, onAuthStateChanged };

        // üî• ÈáçË¶ÅÔºöÂú® Firebase SDK Âä†ËºâÂÆåÊàêÂæåÁ´ãÂç≥ÂàùÂßãÂåñ
        console.log('Firebase SDK loaded successfully!');
        window.firebaseReady = true;
        if (window.initAuth) {
            window.initAuth();
        }
    </script>

    <script>
        console.log('=== ADMIN PAGE LOADED ===');

        // Á∞°ÂñÆÁöÑ alert ÂáΩÊï∏Ôºà‰∏ç‰æùË≥¥ÂÖ∂‰ªñ‰ª£Á¢ºÔºâ
        function showAlertSimple(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // üî• Áõ¥Êé•ÂÆöÁæ©ÁôªÂÖ•ÂáΩÊï∏Ôºàinline ÊñπÂºèÁ¢∫‰øù‰∏ÄÂÆöËÉΩÂü∑Ë°åÔºâ
        window.handleLogin = async function(event) {
            event.preventDefault();
            event.stopPropagation();
            console.log('handleLogin called!');

            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            const loginBtn = document.getElementById('loginBtn');

            const usernameOrEmail = emailInput.value.trim();
            const password = passwordInput.value;

            console.log('Username or Email:', usernameOrEmail);
            console.log('Password length:', password.length);

            if (!usernameOrEmail || !password) {
                showAlertSimple('Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç/ÈõªÈÉµÂíåÂØÜÁ¢º');
                loginBtn.textContent = 'ÁôªÂÖ•';
                loginBtn.disabled = false;
                return false;
            }

            loginBtn.textContent = 'ÁôªÂÖ•‰∏≠...';
            loginBtn.disabled = true;

            try {
                console.log('Waiting for Firebase...');
                // Á≠âÂæÖ Firebase Âä†Ëºâ
                let retries = 0;
                while (!window.authModules && retries < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    retries++;
                }

                if (!window.authModules) {
                    throw new Error('Firebase Âä†ËºâË∂ÖÊôÇ');
                }

                let email = usernameOrEmail;

                // Âà§Êñ∑Ëº∏ÂÖ•ÁöÑÊòØÈõªÈÉµÈÇÑÊòØÁî®Êà∂Âêç
                const isEmail = usernameOrEmail.includes('@');

                if (!isEmail) {
                    // Â¶ÇÊûú‰∏çÊòØÈõªÈÉµÔºåÊ†πÊìöÁî®Êà∂ÂêçÊü•Ë©¢Â∞çÊáâÁöÑÈõªÂ≠êÈÉµ‰ª∂
                    console.log('Input is username, looking up email...');
                    const { collection, query, where, getDocs } = window.firestoreModules;
                    const usersQuery = query(collection(window.firebaseDB, 'users'), where('username', '==', usernameOrEmail));
                    const usersSnapshot = await getDocs(usersQuery);

                    if (usersSnapshot.empty) {
                        throw { code: 'auth/user-not-found', message: 'Áî®Êà∂Âêç‰∏çÂ≠òÂú®' };
                    }

                    // Áç≤ÂèñÁî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂
                    const userData = usersSnapshot.docs[0].data();
                    email = userData.email;
                    console.log('Found email for username:', email);
                } else {
                    console.log('Input is email, logging in directly...');
                }

                console.log('Calling signInWithEmailAndPassword...');
                const userCredential = await window.authModules.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                console.log('Login successful:', userCredential.user.email);

                // Ê™¢Êü•Áî®Êà∂ÊòØÂê¶ÊúâË®≠ÂÆöÁî®Êà∂Âêç
                const user = userCredential.user;
                const userDoc = await window.firestoreModules.getDoc(window.firestoreModules.doc(window.firebaseDB, 'users', user.uid));
                const userData = userDoc.data();

                // Â¶ÇÊûúÁî®Êà∂Ê≤íÊúâÁî®Êà∂ÂêçÔºåË¶ÅÊ±ÇË®≠ÂÆö
                if (!userData.username) {
                    console.log('User has no username, prompting to set...');
                    // È°ØÁ§∫Ë®≠ÂÆöÁî®Êà∂Âêç Modal ÔºàÁ®çÂæåÂØ¶ÁèæÔºâ
                    window.pendingUser = user;
                    showSetUsernameModal();
                    loginBtn.textContent = 'ÁôªÂÖ•';
                    loginBtn.disabled = false;
                    return false;
                }

                // onAuthStateChanged will handle UI updates
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'ÁôªÂÖ•Â§±Êïó';

                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Â∏≥Ëôü‰∏çÂ≠òÂú®';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ÂØÜÁ¢ºÈåØË™§';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ÈÉµÁÆ±Ê†ºÂºè‰∏çÊ≠£Á¢∫';
                        break;
                    case 'auth/invalid-credential':
                        errorMessage = 'Â∏≥ËôüÊàñÂØÜÁ¢ºÈåØË™§';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ÁôªÂÖ•ÂòóË©¶Ê¨°Êï∏ÈÅéÂ§öÔºåË´ãÁ®çÂæåÂÜçË©¶';
                        break;
                    default:
                        errorMessage = `ÁôªÂÖ•Â§±ÊïóÔºö${error.message}`;
                }

                showAlertSimple(errorMessage);
                loginBtn.textContent = 'ÁôªÂÖ•';
                loginBtn.disabled = false;
            }

            return false; // Èò≤Ê≠¢Ë°®ÂñÆÊèê‰∫§
        };

        // üî• È°ØÁ§∫Ë®≠ÂÆöÁî®Êà∂Âêç Modal
        window.showSetUsernameModal = function() {
            document.getElementById('setUsernameModal').classList.remove('hidden');
        };

        // üî• ËôïÁêÜË®≠ÂÆöÁî®Êà∂Âêç
        window.handleSetUsername = async function(event) {
            event.preventDefault();
            event.stopPropagation();

            const usernameInput = document.getElementById('newUsername');
            const setUsernameBtn = document.getElementById('setUsernameBtn');
            const username = usernameInput.value.trim();

            if (!username) {
                showAlertSimple('Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç');
                return false;
            }

            // È©óË≠âÁî®Êà∂ÂêçÊ†ºÂºè
            const usernameRegex = /^[a-zA-Z0-9_-]{3,20}$/;
            if (!usernameRegex.test(username)) {
                showAlertSimple('Áî®Êà∂ÂêçÂøÖÈ†àÁÇ∫3-20ÂÄãÂ≠óÁ¨¶ÔºåÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶');
                return false;
            }

            setUsernameBtn.textContent = 'Ë®≠ÂÆö‰∏≠...';
            setUsernameBtn.disabled = true;

            try {
                // Ê™¢Êü•Áî®Êà∂ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                const { collection, query, where, getDocs, doc, updateDoc } = window.firestoreModules;
                const usernameQuery = query(collection(window.firebaseDB, 'users'), where('username', '==', username));
                const usernameSnapshot = await getDocs(usernameQuery);

                if (!usernameSnapshot.empty) {
                    showAlertSimple('Áî®Êà∂ÂêçÂ∑≤Ë¢´‰ΩøÁî®ÔºåË´ãÈÅ∏ÊìáÂÖ∂‰ªñÁî®Êà∂Âêç');
                    setUsernameBtn.textContent = 'Á¢∫Ë™çË®≠ÂÆö';
                    setUsernameBtn.disabled = false;
                    return false;
                }

                // Êõ¥Êñ∞Áî®Êà∂Âêç
                const user = window.pendingUser;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    username: username
                });

                // ÈóúÈñâ Modal ‰∏¶Ê∏ÖÁêÜ
                document.getElementById('setUsernameModal').classList.add('hidden');
                document.getElementById('setUsernameForm').reset();
                window.pendingUser = null;

                // Áî®Êà∂ÂêçË®≠ÂÆöÊàêÂäüÂæåÔºåonAuthStateChanged ÊúÉËá™ÂãïËôïÁêÜÂæåÁ∫åÊµÅÁ®ã
                showAlertSimple('Áî®Êà∂ÂêçË®≠ÂÆöÊàêÂäüÔºÅ');
            } catch (error) {
                console.error('Set username error:', error);
                showAlertSimple('Ë®≠ÂÆöÁî®Êà∂ÂêçÊôÇÁôºÁîüÈåØË™§Ôºö' + error.message);
                setUsernameBtn.textContent = 'Á¢∫Ë™çË®≠ÂÆö';
                setUsernameBtn.disabled = false;
            }

            return false;
        };

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        // User Management
        let currentUser = null;
        const SUPER_ADMIN_UID = 'vdNBS7qPdRV9qpV7CLgXwBflCf23';

        // Á≠âÂæÖ Firebase SDK Âä†ËºâÂÆåÊàêÂæåÂàùÂßãÂåñË™çË≠âÁõ£ËÅΩÂô®
        window.initAuth = function() {
            if (!window.authModules || !window.firebaseAuth) {
                console.error('Firebase not ready yet, retrying...');
                setTimeout(window.initAuth, 100);
                return;
            }

            console.log('Initializing auth state observer...');

            // Authentication State Observer
            window.authModules.onAuthStateChanged(window.firebaseAuth, async (user) => {
            if (user) {
                // Check user role in Firestore
                console.log('User logged in:', user.email, 'UID:', user.uid);
                try {
                    const { doc, getDoc } = window.firestoreModules;
                    const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));

                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        console.log('User data:', userData);
                        console.log('User role:', userData.role);
                        console.log('User status:', userData.status);
                        console.log('Super Admin UID:', SUPER_ADMIN_UID);
                        console.log('Current UID:', user.uid);
                        console.log('Is admin?', userData.role === 'admin');
                        console.log('Is super admin?', user.uid === SUPER_ADMIN_UID);

                        // Check if user is admin or super admin
                        if (userData.role === 'admin' || user.uid === SUPER_ADMIN_UID) {
                            if (userData.status !== 'approved') {
                                console.log('Status not approved:', userData.status);
                                showAlert('ÊÇ®ÁöÑÂ∏≥ËôüÂ∞öÊú™Ë¢´ÊâπÂáÜË®™ÂïèÁÆ°ÁêÜÂæåÂè∞„ÄÇÁãÄÊÖãÔºö' + userData.status);
                                await window.authModules.signOut(window.firebaseAuth);
                                return;
                            }

                            console.log('Access granted! Loading dashboard...');
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                name: userData.name || user.email,
                                role: userData.role
                            };

                            document.getElementById('currentUser').textContent = currentUser.name;
                            document.getElementById('loginScreen').classList.add('hidden');
                            document.getElementById('adminDashboard').classList.remove('hidden');
                            loadActivities();
                        } else {
                            console.log('Role check failed. Role:', userData.role);
                            showAlert('ÊÇ®Ê≤íÊúâÊ¨äÈôêË®™ÂïèÁÆ°ÁêÜÂæåÂè∞„ÄÇÊÇ®ÁöÑËßíËâ≤Ôºö' + (userData.role || 'ÁÑ°'));
                            await window.authModules.signOut(window.firebaseAuth);
                        }
                    } else {
                        console.log('User document does not exist for UID:', user.uid);
                        showAlert('Áî®Êà∂Ë≥áÊñô‰∏çÂ≠òÂú®ÔºàUID: ' + user.uid + 'Ôºâ');
                        await window.authModules.signOut(window.firebaseAuth);
                    }
                } catch (error) {
                    console.error('Error checking user role:', error);
                    showAlert('È©óË≠âÁî®Êà∂Ê¨äÈôêÊôÇÁôºÁîüÈåØË™§Ôºö' + error.message);
                    await window.authModules.signOut(window.firebaseAuth);
                }
            } else {
                // User is signed out
                console.log('User signed out');
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminDashboard').classList.add('hidden');
            }
        });
        };

        // Â¶ÇÊûú Firebase Â∑≤Á∂ìÂä†ËºâÔºåÁ´ãÂç≥ÂàùÂßãÂåñ
        if (window.firebaseReady) {
            window.initAuth();
        }

        // Login Handling Â∑≤ÈÄöÈÅé inline onsubmit ËôïÁêÜÔºàË¶ã window.handleLoginÔºâ

        // ÂàùÂßãÂåñÊâÄÊúâ UI ‰∫ã‰ª∂Áõ£ËÅΩÂô®
        function initUIHandlers() {
            console.log('Initializing UI handlers...');

            // Logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        await window.authModules.signOut(window.firebaseAuth);
                        document.getElementById('loginForm').reset();
                    } catch (error) {
                        console.error('Logout error:', error);
                        showAlert('ÁôªÂá∫ÊôÇÁôºÁîüÈåØË™§');
                    }
                });
            }

            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const section = btn.dataset.section;

                    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
                    document.getElementById(section + 'Section').classList.remove('hidden');

                    document.querySelectorAll('.nav-btn').forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                    });
                    btn.classList.add('bg-primary', 'text-white');

                    if (section === 'activities') {
                        loadActivities();
                    } else if (section === 'projects') {
                        loadProjects();
                    } else if (section === 'team') {
                        loadTeamMembers();
                    } else if (section === 'contacts') {
                        loadContacts();
                    } else if (section === 'users') {
                        loadUsers();
                    } else if (section === 'profile') {
                        loadProfile();
                    }
                });
            });

            // Set default active section
            const firstNavBtn = document.querySelector('.nav-btn');
            if (firstNavBtn) {
                firstNavBtn.click();
            }

            // Modal Handling
            document.querySelectorAll('.closeModal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('activityModal').classList.add('hidden');
                    document.getElementById('projectModal').classList.add('hidden');
                    document.getElementById('teamMemberModal').classList.add('hidden');
                });
            });
        }

        // Áï∂ DOM ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñÊâÄÊúâËôïÁêÜÂô®
        function initAllHandlers() {
            initUIHandlers();
            initActivityHandlers();
            initProjectHandlers();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAllHandlers);
        } else {
            initAllHandlers();
        }

        // Activities Management
        function initActivityHandlers() {
            const addActivityBtn = document.getElementById('addActivityBtn');
            if (addActivityBtn) {
                addActivityBtn.addEventListener('click', () => {
                    document.getElementById('activityModalTitle').textContent = 'Êñ∞Â¢ûÊ¥ªÂãï';
                    document.getElementById('activityForm').reset();
                    document.getElementById('activityId').value = '';
                    document.getElementById('activityModal').classList.remove('hidden');
                });
            }

            const activityForm = document.getElementById('activityForm');
            if (activityForm) {
                activityForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // ÂèñÂæóÂ§öË™ûË®ÄËº∏ÂÖ•ÂÄº
                    const titleZhTW = document.getElementById('activityTitleZhTW').value.trim();
                    const titleZhCN = document.getElementById('activityTitleZhCN').value.trim();
                    const titleEn = document.getElementById('activityTitleEn').value.trim();
                    const descriptionZhTW = document.getElementById('activityDescriptionZhTW').value.trim();
                    const descriptionZhCN = document.getElementById('activityDescriptionZhCN').value.trim();
                    const descriptionEn = document.getElementById('activityDescriptionEn').value.trim();

                    // È©óË≠âÔºöËá≥Â∞ëÈúÄË¶ÅÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ®ôÈ°åÂíåÊèèËø∞ÔºàÂª∫Ë≠∞ÁπÅÈ´î‰∏≠ÊñáÔºâ
                    if (!titleZhTW && !titleZhCN && !titleEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ¥ªÂãïÊ®ôÈ°åÔºÅ');
                        return;
                    }
                    if (!descriptionZhTW && !descriptionZhCN && !descriptionEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ¥ªÂãïÊèèËø∞ÔºÅ');
                        return;
                    }

                    const activityData = {
                        title: {
                            zhTW: titleZhTW,
                            zhCN: titleZhCN,
                            en: titleEn
                        },
                        date: document.getElementById('activityDate').value,
                        description: {
                            zhTW: descriptionZhTW,
                            zhCN: descriptionZhCN,
                            en: descriptionEn
                        },
                        link: document.getElementById('activityLink').value || ''
                    };

                    try {
                        const activityId = document.getElementById('activityId').value;

                        if (activityId) {
                            // Update existing activity
                            const { doc, updateDoc, serverTimestamp } = window.firestoreModules;
                            activityData.updatedAt = serverTimestamp();
                            await updateDoc(doc(window.firebaseDB, 'activities', activityId), activityData);
                            showAlert('Ê¥ªÂãïÂ∑≤Êõ¥Êñ∞ÔºÅ');
                        } else {
                            // Add new activity
                            const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                            activityData.createdAt = serverTimestamp();
                            await addDoc(collection(window.firebaseDB, 'activities'), activityData);
                            showAlert('Ê¥ªÂãïÂ∑≤Êñ∞Â¢ûÔºÅ');
                        }

                        document.getElementById('activityModal').classList.add('hidden');
                        loadActivities();
                    } catch (error) {
                        console.error('Error saving activity:', error);
                        showAlert('ÂÑ≤Â≠òÊ¥ªÂãïÊôÇÁôºÁîüÈåØË™§');
                    }
                });
            }
        }

        async function loadActivities() {
            const loadingEl = document.getElementById('activitiesLoading');
            const listEl = document.getElementById('activitiesList');
            const emptyEl = document.getElementById('activitiesEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'activities'), orderBy('date', 'desc'));
                const querySnapshot = await getDocs(q);

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                querySnapshot.forEach((docSnapshot) => {
                    const activity = docSnapshot.data();
                    const activityId = docSnapshot.id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÊîØÊåÅËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÂíåÊñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof activity.title === 'string'
                        ? activity.title
                        : (activity.title?.zhTW || activity.title?.zhCN || activity.title?.en || '');
                    const description = typeof activity.description === 'string'
                        ? activity.description
                        : (activity.description?.zhTW || activity.description?.zhCN || activity.description?.en || '');

                    const activityCard = document.createElement('div');
                    activityCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                    activityCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm text-primary font-semibold mb-2">${activity.date || ''}</div>
                                <h3 class="text-lg font-bold mb-2">${title}</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-2">${description}</p>
                                ${activity.link ? `<a href="${activity.link}" target="_blank" class="text-sm text-primary hover:underline">Êü•ÁúãÈÄ£Áµê ‚Üí</a>` : ''}
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editActivity('${activityId}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">Á∑®ËºØ</button>
                                <button onclick="deleteActivity('${activityId}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">Âà™Èô§</button>
                            </div>
                        </div>
                    `;

                    listEl.appendChild(activityCard);
                });

                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading activities:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Ê¥ªÂãïÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        window.editActivity = async (id) => {
            try {
                const { doc, getDocs, collection } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'activities'));

                let activityData = null;
                querySnapshot.forEach((docSnapshot) => {
                    if (docSnapshot.id === id) {
                        activityData = docSnapshot.data();
                    }
                });

                if (activityData) {
                    document.getElementById('activityId').value = id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÂ¶ÇÊûúÊï∏ÊìöÊòØËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÔºåËΩâÊèõÁÇ∫Êñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof activityData.title === 'string'
                        ? { zhTW: activityData.title, zhCN: '', en: '' }
                        : activityData.title;
                    const description = typeof activityData.description === 'string'
                        ? { zhTW: activityData.description, zhCN: '', en: '' }
                        : activityData.description;

                    // Â°´ÂÖÖÂ§öË™ûË®ÄË°®ÂñÆ
                    document.getElementById('activityTitleZhTW').value = title?.zhTW || '';
                    document.getElementById('activityTitleZhCN').value = title?.zhCN || '';
                    document.getElementById('activityTitleEn').value = title?.en || '';

                    document.getElementById('activityDate').value = activityData.date || '';

                    document.getElementById('activityDescriptionZhTW').value = description?.zhTW || '';
                    document.getElementById('activityDescriptionZhCN').value = description?.zhCN || '';
                    document.getElementById('activityDescriptionEn').value = description?.en || '';

                    document.getElementById('activityLink').value = activityData.link || '';
                    document.getElementById('activityModalTitle').textContent = 'Á∑®ËºØÊ¥ªÂãï';
                    document.getElementById('activityModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading activity:', error);
                showAlert('ËºâÂÖ•Ê¥ªÂãïË≥áÊñôÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteActivity = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ê¥ªÂãïÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'activities', id));
                    showAlert('Ê¥ªÂãïÂ∑≤Âà™Èô§ÔºÅ');
                    loadActivities();
                } catch (error) {
                    console.error('Error deleting activity:', error);
                    showAlert('Âà™Èô§Ê¥ªÂãïÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // Projects Management
        function initProjectHandlers() {
            const addProjectBtn = document.getElementById('addProjectBtn');
            if (addProjectBtn) {
                addProjectBtn.addEventListener('click', () => {
                    document.getElementById('projectModalTitle').textContent = 'Êñ∞Â¢ûÂ∞àÊ°à';
                    document.getElementById('projectForm').reset();
                    document.getElementById('projectId').value = '';
                    document.getElementById('projectModal').classList.remove('hidden');
                });
            }

            const projectForm = document.getElementById('projectForm');
            if (projectForm) {
                projectForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // ÂèñÂæóÂ§öË™ûË®ÄËº∏ÂÖ•ÂÄº
                    const titleZhTW = document.getElementById('projectTitleZhTW').value.trim();
                    const titleZhCN = document.getElementById('projectTitleZhCN').value.trim();
                    const titleEn = document.getElementById('projectTitleEn').value.trim();
                    const descriptionZhTW = document.getElementById('projectDescriptionZhTW').value.trim();
                    const descriptionZhCN = document.getElementById('projectDescriptionZhCN').value.trim();
                    const descriptionEn = document.getElementById('projectDescriptionEn').value.trim();

                    // È©óË≠âÔºöËá≥Â∞ëÈúÄË¶ÅÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ®ôÈ°åÂíåÊèèËø∞ÔºàÂª∫Ë≠∞ÁπÅÈ´î‰∏≠ÊñáÔºâ
                    if (!titleZhTW && !titleZhCN && !titleEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÂ∞àÊ°àÊ®ôÈ°åÔºÅ');
                        return;
                    }
                    if (!descriptionZhTW && !descriptionZhCN && !descriptionEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÂ∞àÊ°àÊèèËø∞ÔºÅ');
                        return;
                    }

                    const techInput = document.getElementById('projectTechnologies').value;
                    const technologies = techInput ? techInput.split(',').map(t => t.trim()) : [];

                    const projectData = {
                        title: {
                            zhTW: titleZhTW,
                            zhCN: titleZhCN,
                            en: titleEn
                        },
                        status: document.getElementById('projectStatus').value,
                        description: {
                            zhTW: descriptionZhTW,
                            zhCN: descriptionZhCN,
                            en: descriptionEn
                        },
                        technologies: technologies,
                        members: parseInt(document.getElementById('projectMembers').value) || 0,
                        link: document.getElementById('projectLink').value || ''
                    };

                    try {
                        const projectId = document.getElementById('projectId').value;

                        if (projectId) {
                            // Update existing project
                            const { doc, updateDoc, serverTimestamp } = window.firestoreModules;
                            projectData.updatedAt = serverTimestamp();
                            await updateDoc(doc(window.firebaseDB, 'projects', projectId), projectData);
                            showAlert('Â∞àÊ°àÂ∑≤Êõ¥Êñ∞ÔºÅ');
                        } else {
                            // Add new project
                            const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                            projectData.createdAt = serverTimestamp();
                            await addDoc(collection(window.firebaseDB, 'projects'), projectData);
                            showAlert('Â∞àÊ°àÂ∑≤Êñ∞Â¢ûÔºÅ');
                        }

                        document.getElementById('projectModal').classList.add('hidden');
                        loadProjects();
                    } catch (error) {
                        console.error('Error saving project:', error);
                        showAlert('ÂÑ≤Â≠òÂ∞àÊ°àÊôÇÁôºÁîüÈåØË™§');
                    }
                });
            }
        }

        async function loadProjects() {
            const loadingEl = document.getElementById('projectsLoading');
            const listEl = document.getElementById('projectsList');
            const emptyEl = document.getElementById('projectsEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'projects'));

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                querySnapshot.forEach((docSnapshot) => {
                    const project = docSnapshot.data();
                    const projectId = docSnapshot.id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÊîØÊåÅËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÂíåÊñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof project.title === 'string'
                        ? project.title
                        : (project.title?.zhTW || project.title?.zhCN || project.title?.en || '');
                    const description = typeof project.description === 'string'
                        ? project.description
                        : (project.description?.zhTW || project.description?.zhCN || project.description?.en || '');

                    const statusColors = {
                        'ÈÄ≤Ë°å‰∏≠': 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200',
                        'Â∑≤ÂÆåÊàê': 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200',
                        'Ë®àÂäÉ‰∏≠': 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200'
                    };

                    const statusClass = statusColors[project.status] || statusColors['ÈÄ≤Ë°å‰∏≠'];
                    const techTags = (project.technologies || []).map(tech =>
                        `<span class="px-2 py-1 bg-primary/10 text-primary rounded-full text-xs">${tech}</span>`
                    ).join(' ');

                    const projectCard = document.createElement('div');
                    projectCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                    projectCard.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h3 class="text-lg font-bold">${title}</h3>
                                    <span class="px-3 py-1 ${statusClass} rounded-full text-xs font-semibold">${project.status || 'ÈÄ≤Ë°å‰∏≠'}</span>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-3">${description}</p>
                                <div class="flex flex-wrap gap-2 mb-3">
                                    ${techTags}
                                </div>
                                <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                                    ÂèÉËàáÊàêÂì°: ${project.members || 0} ‰Ωç
                                </div>
                                ${project.link ? `<a href="${project.link}" target="_blank" class="text-sm text-primary hover:underline">Êü•ÁúãÂ∞àÊ°à ‚Üí</a>` : ''}
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editProject('${projectId}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">Á∑®ËºØ</button>
                                <button onclick="deleteProject('${projectId}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">Âà™Èô§</button>
                            </div>
                        </div>
                    `;

                    listEl.appendChild(projectCard);
                });

                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading projects:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Â∞àÊ°àÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        window.editProject = async (id) => {
            try {
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'projects'));

                let projectData = null;
                querySnapshot.forEach((docSnapshot) => {
                    if (docSnapshot.id === id) {
                        projectData = docSnapshot.data();
                    }
                });

                if (projectData) {
                    document.getElementById('projectId').value = id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÂ¶ÇÊûúÊï∏ÊìöÊòØËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÔºåËΩâÊèõÁÇ∫Êñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof projectData.title === 'string'
                        ? { zhTW: projectData.title, zhCN: '', en: '' }
                        : projectData.title;
                    const description = typeof projectData.description === 'string'
                        ? { zhTW: projectData.description, zhCN: '', en: '' }
                        : projectData.description;

                    // Â°´ÂÖÖÂ§öË™ûË®ÄË°®ÂñÆ
                    document.getElementById('projectTitleZhTW').value = title?.zhTW || '';
                    document.getElementById('projectTitleZhCN').value = title?.zhCN || '';
                    document.getElementById('projectTitleEn').value = title?.en || '';

                    document.getElementById('projectStatus').value = projectData.status || 'ÈÄ≤Ë°å‰∏≠';

                    document.getElementById('projectDescriptionZhTW').value = description?.zhTW || '';
                    document.getElementById('projectDescriptionZhCN').value = description?.zhCN || '';
                    document.getElementById('projectDescriptionEn').value = description?.en || '';

                    document.getElementById('projectTechnologies').value = (projectData.technologies || []).join(', ');
                    document.getElementById('projectMembers').value = projectData.members || 0;
                    document.getElementById('projectLink').value = projectData.link || '';
                    document.getElementById('projectModalTitle').textContent = 'Á∑®ËºØÂ∞àÊ°à';
                    document.getElementById('projectModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading project:', error);
                showAlert('ËºâÂÖ•Â∞àÊ°àË≥áÊñôÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteProject = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Â∞àÊ°àÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'projects', id));
                    showAlert('Â∞àÊ°àÂ∑≤Âà™Èô§ÔºÅ');
                    loadProjects();
                } catch (error) {
                    console.error('Error deleting project:', error);
                    showAlert('Âà™Èô§Â∞àÊ°àÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // ========================================
        // Team Management
        // ========================================

        // Add Team Member Button
        const addTeamMemberBtn = document.getElementById('addTeamMemberBtn');
        if (addTeamMemberBtn) {
            addTeamMemberBtn.addEventListener('click', () => {
                document.getElementById('teamMemberModalTitle').textContent = 'Êñ∞Â¢ûÂúòÈöäÊàêÂì°';
                document.getElementById('teamMemberForm').reset();
                document.getElementById('teamMemberId').value = '';
                document.getElementById('teamMemberModal').classList.remove('hidden');
            });
        }

        // Team Member Form Submit
        const teamMemberForm = document.getElementById('teamMemberForm');
        if (teamMemberForm) {
            teamMemberForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                // Get multilingual inputs
                const nameZhTW = document.getElementById('memberNameZhTW').value.trim();
                const nameZhCN = document.getElementById('memberNameZhCN').value.trim();
                const nameEn = document.getElementById('memberNameEn').value.trim();
                const positionZhTW = document.getElementById('memberPositionZhTW').value.trim();
                const positionZhCN = document.getElementById('memberPositionZhCN').value.trim();
                const positionEn = document.getElementById('memberPositionEn').value.trim();

                // Validation
                if (!nameZhTW || !positionZhTW) {
                    showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´ÁπÅÈ´î‰∏≠ÊñáÁöÑÂßìÂêçÂíåËÅ∑‰Ωç');
                    return;
                }

                const order = parseInt(document.getElementById('memberOrder').value);
                if (isNaN(order) || order < 0) {
                    showAlert('Ë´ãÂ°´ÂØ´ÊúâÊïàÁöÑÊéíÂ∫èÈ†ÜÂ∫èÔºà0ÊàñÊ≠£Êï¥Êï∏Ôºâ');
                    return;
                }

                const memberData = {
                    name_zhTW: nameZhTW,
                    name_zhCN: nameZhCN,
                    name_en: nameEn,
                    position_zhTW: positionZhTW,
                    position_zhCN: positionZhCN,
                    position_en: positionEn,
                    email: document.getElementById('memberEmail').value.trim() || '',
                    order: order
                };

                try {
                    const memberId = document.getElementById('teamMemberId').value;

                    if (memberId) {
                        const { doc, updateDoc, serverTimestamp } = window.firestoreModules;
                        memberData.updatedAt = serverTimestamp();
                        await updateDoc(doc(window.firebaseDB, 'team', memberId), memberData);
                        showAlert('ÂúòÈöäÊàêÂì°Â∑≤Êõ¥Êñ∞ÔºÅ');
                    } else {
                        const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                        memberData.createdAt = serverTimestamp();
                        await addDoc(collection(window.firebaseDB, 'team'), memberData);
                        showAlert('ÂúòÈöäÊàêÂì°Â∑≤Êñ∞Â¢ûÔºÅ');
                    }

                    document.getElementById('teamMemberModal').classList.add('hidden');
                    loadTeamMembers();
                } catch (error) {
                    console.error('Error saving team member:', error);
                    showAlert('ÂÑ≤Â≠òÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        async function loadTeamMembers() {
            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'team'), orderBy('order', 'asc'));
                const querySnapshot = await getDocs(q);

                const listEl = document.getElementById('teamList');

                if (querySnapshot.empty) {
                    listEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Êö´ÁÑ°ÂúòÈöäÊàêÂì°</p>';
                    return;
                }

                listEl.innerHTML = '';

                querySnapshot.forEach((doc) => {
                    const member = doc.data();

                    // Display preferring zhTW version
                    const name = member.name_zhTW || member.name_zhCN || member.name_en || 'Êú™ÂëΩÂêç';
                    const position = member.position_zhTW || member.position_zhCN || member.position_en || '';

                    listEl.innerHTML += `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-lg font-bold">
                                            ${name[0].toUpperCase()}
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-lg text-gray-800 dark:text-gray-200">${name}</h3>
                                            <p class="text-sm text-purple-600 dark:text-purple-400">${position}</p>
                                        </div>
                                    </div>
                                    ${member.email ? `<p class="text-sm text-gray-600 dark:text-gray-400 ml-15"><i class="fas fa-envelope mr-2"></i>${member.email}</p>` : ''}
                                    <p class="text-xs text-gray-500 dark:text-gray-500 ml-15 mt-1">ÊéíÂ∫è: ${member.order}</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editTeamMember('${doc.id}')" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm transition-colors">Á∑®ËºØ</button>
                                    <button onclick="deleteTeamMember('${doc.id}')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm transition-colors">Âà™Èô§</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Error loading team members:', error);
                document.getElementById('teamList').innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•ÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§</p>';
            }
        }

        window.editTeamMember = async (id) => {
            try {
                const { doc, getDocs, collection } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'team'));

                let memberData = null;
                querySnapshot.forEach((doc) => {
                    if (doc.id === id) {
                        memberData = doc.data();
                    }
                });

                if (memberData) {
                    document.getElementById('teamMemberId').value = id;
                    document.getElementById('memberNameZhTW').value = memberData.name_zhTW || '';
                    document.getElementById('memberNameZhCN').value = memberData.name_zhCN || '';
                    document.getElementById('memberNameEn').value = memberData.name_en || '';
                    document.getElementById('memberPositionZhTW').value = memberData.position_zhTW || '';
                    document.getElementById('memberPositionZhCN').value = memberData.position_zhCN || '';
                    document.getElementById('memberPositionEn').value = memberData.position_en || '';
                    document.getElementById('memberEmail').value = memberData.email || '';
                    document.getElementById('memberOrder').value = memberData.order || 0;

                    document.getElementById('teamMemberModalTitle').textContent = 'Á∑®ËºØÂúòÈöäÊàêÂì°';
                    document.getElementById('teamMemberModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading team member:', error);
                showAlert('ËºâÂÖ•ÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteTeamMember = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ÂúòÈöäÊàêÂì°ÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'team', id));
                    showAlert('ÂúòÈöäÊàêÂì°Â∑≤Âà™Èô§ÔºÅ');
                    loadTeamMembers();
                } catch (error) {
                    console.error('Error deleting team member:', error);
                    showAlert('Âà™Èô§ÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // ========================================
        // Alert and Confirm Functions
        // ========================================
        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition-colors">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                modal.remove();
                onConfirm();
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        window.showAlert = showAlert;
        window.showConfirm = showConfirm;

        // ========================================
        // Contacts Management
        // ========================================

        let currentFilter = 'all';
        let allContacts = [];

        async function loadContacts() {
            const loadingEl = document.getElementById('contactsLoading');
            const listEl = document.getElementById('contactsList');
            const emptyEl = document.getElementById('contactsEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'contact_submissions'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                allContacts = [];
                querySnapshot.forEach((docSnapshot) => {
                    const contact = docSnapshot.data();
                    allContacts.push({
                        id: docSnapshot.id,
                        ...contact
                    });
                });

                renderContacts();
            } catch (error) {
                console.error('Error loading contacts:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        function renderContacts() {
            const listEl = document.getElementById('contactsList');
            const emptyEl = document.getElementById('contactsEmptyState');

            let filteredContacts = allContacts;
            if (currentFilter === 'unread') {
                filteredContacts = allContacts.filter(c => c.status === 'unread');
            } else if (currentFilter === 'replied') {
                filteredContacts = allContacts.filter(c => c.status === 'replied');
            }

            if (filteredContacts.length === 0) {
                listEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑË®äÊÅØ</p>';
                emptyEl.classList.remove('hidden');
                return;
            }

            emptyEl.classList.add('hidden');

            listEl.innerHTML = '';
            filteredContacts.forEach((contact) => {
                const createdDate = contact.createdAt ? new Date(contact.createdAt.seconds * 1000).toLocaleString('zh-TW') : 'Êú™Áü•ÊôÇÈñì';
                const statusBadge = contact.status === 'replied'
                    ? '<span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-xs font-semibold">Â∑≤ÂõûË¶Ü</span>'
                    : '<span class="px-3 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full text-xs font-semibold">Êú™ËÆÄ</span>';

                const contactCard = document.createElement('div');
                contactCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                contactCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h3 class="text-lg font-bold">${contact.subject || ''}</h3>
                                ${statusBadge}
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                                <i class="fas fa-envelope mr-1"></i>${contact.email || ''}
                                <span class="mx-2">|</span>
                                <i class="fas fa-clock mr-1"></i>${createdDate}
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-3 whitespace-pre-wrap">${contact.message || ''}</p>
                            ${contact.reply ? `
                                <div class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                    <p class="text-sm font-semibold text-blue-800 dark:text-blue-300 mb-2">
                                        <i class="fas fa-reply mr-1"></i>ÊÇ®ÁöÑÂõûË¶Ü
                                    </p>
                                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">${contact.reply}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                        ÂõûË¶ÜÊôÇÈñìÔºö${contact.repliedAt ? new Date(contact.repliedAt.seconds * 1000).toLocaleString('zh-TW') : ''}
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="showReplyModal('${contact.id}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                <i class="fas fa-reply mr-1"></i>${contact.reply ? 'ÂÜçÊ¨°ÂõûË¶Ü' : 'ÂõûË¶Ü'}
                            </button>
                            <button onclick="deleteContact('${contact.id}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                <i class="fas fa-trash mr-1"></i>Âà™Èô§
                            </button>
                        </div>
                    </div>
                `;

                listEl.appendChild(contactCard);
            });

            listEl.classList.remove('hidden');
        }

        window.filterContacts = function(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            renderContacts();
        };

        window.showReplyModal = function(contactId) {
            const contact = allContacts.find(c => c.id === contactId);
            if (!contact) return;

            document.getElementById('replyContactId').value = contactId;
            document.getElementById('replyEmail').textContent = contact.email;
            document.getElementById('replySubject').textContent = contact.subject;
            document.getElementById('replyOriginalMessage').textContent = contact.message;
            document.getElementById('replyContent').value = contact.reply || '';

            document.getElementById('replyModal').classList.remove('hidden');
        };

        window.closeReplyModal = function() {
            document.getElementById('replyModal').classList.add('hidden');
            document.getElementById('replyForm').reset();
        };

        window.handleReply = async function(event) {
            event.preventDefault();

            const contactId = document.getElementById('replyContactId').value;
            const replyContent = document.getElementById('replyContent').value;
            const contact = allContacts.find(c => c.id === contactId);

            if (!contact) return;

            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'contact_submissions', contactId), {
                    reply: replyContent,
                    repliedAt: new Date(),
                    status: 'replied'
                });

                // ÁôºÈÄÅÈõªÈÉµÂõûË¶Ü
                const mailtoLink = `mailto:${contact.email}?subject=Re: ${encodeURIComponent(contact.subject)}&body=${encodeURIComponent(replyContent)}`;
                window.open(mailtoLink, '_blank');

                showAlert('ÂõûË¶ÜÂ∑≤‰øùÂ≠òÔºÅË´ãÂú®ÊÇ®ÁöÑÈõªÈÉµÂÆ¢Êà∂Á´ØÁôºÈÄÅÈÉµ‰ª∂„ÄÇ');
                closeReplyModal();
                loadContacts();
            } catch (error) {
                console.error('Error sending reply:', error);
                showAlert('ÂõûË¶ÜÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteContact = function(id) {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë®äÊÅØÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'contact_submissions', id));
                    showAlert('Ë®äÊÅØÂ∑≤Âà™Èô§ÔºÅ');
                    loadContacts();
                } catch (error) {
                    console.error('Error deleting contact:', error);
                    showAlert('Âà™Èô§Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // Âà™Èô§ÊâÄÊúâËÅØÁµ°Ë®äÊÅØ
        window.deleteAllContacts = function() {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÊâÄÊúâËÅØÁµ°Ë®äÊÅØÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ', async () => {
                try {
                    const { collection, getDocs, doc, deleteDoc } = window.firestoreModules;
                    const querySnapshot = await getDocs(collection(window.firebaseDB, 'contact_submissions'));

                    if (querySnapshot.empty) {
                        showAlert('Ê≤íÊúâË®äÊÅØÂèØÂà™Èô§');
                        return;
                    }

                    const deletePromises = [];
                    querySnapshot.forEach((docSnapshot) => {
                        deletePromises.push(deleteDoc(doc(window.firebaseDB, 'contact_submissions', docSnapshot.id)));
                    });

                    await Promise.all(deletePromises);
                    showAlert(`Â∑≤Âà™Èô§ ${deletePromises.length} Ê¢ùË®äÊÅØÔºÅ`);
                    loadContacts();
                } catch (error) {
                    console.error('Error deleting all contacts:', error);
                    showAlert('Âà™Èô§Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // ========================================
        // Hero Section Management
        // ========================================

        // Âú®Â∞éËà™ÊåâÈàï‰∫ã‰ª∂‰∏≠Ê∑ªÂä† hero ÂíåÂÖ∂‰ªñÊñ∞ÂäüËÉΩÁöÑËºâÂÖ•
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const originalHandler = btn.onclick;
            btn.addEventListener('click', () => {
                const section = btn.dataset.section;
                if (section === 'hero') {
                    loadHeroSettings();
                } else if (section === 'announcements') {
                    loadAnnouncements();
                } else if (section === 'contactSettings') {
                    loadContactSettings();
                } else if (section === 'anthemSettings') {
                    loadAnthemSettings();
                } else if (section === 'visitorStats') {
                    loadVisitorStats();
                } else if (section === 'profile') {
                    loadProfile();
                }
            });
        });

        async function loadHeroSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'hero'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('heroTitleZhTW').value = data.title?.zhTW || '';
                    document.getElementById('heroSubtitleZhTW').value = data.subtitle?.zhTW || '';
                    document.getElementById('heroTitleZhCN').value = data.title?.zhCN || '';
                    document.getElementById('heroSubtitleZhCN').value = data.subtitle?.zhCN || '';
                    document.getElementById('heroTitleEn').value = data.title?.en || '';
                    document.getElementById('heroSubtitleEn').value = data.subtitle?.en || '';
                }
            } catch (error) {
                console.error('Error loading hero settings:', error);
            }
        }

        const heroForm = document.getElementById('heroForm');
        if (heroForm) {
            heroForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const heroData = {
                    title: {
                        zhTW: document.getElementById('heroTitleZhTW').value,
                        zhCN: document.getElementById('heroTitleZhCN').value,
                        en: document.getElementById('heroTitleEn').value
                    },
                    subtitle: {
                        zhTW: document.getElementById('heroSubtitleZhTW').value,
                        zhCN: document.getElementById('heroSubtitleZhCN').value,
                        en: document.getElementById('heroSubtitleEn').value
                    }
                };

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'hero'), heroData);
                    showAlert('È¶ñÈ†ÅÊ®ôË™ûÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving hero settings:', error);
                    showAlert('ÂÑ≤Â≠òÈ¶ñÈ†ÅÊ®ôË™ûÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Contact Settings Management
        // ========================================

        async function loadContactSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'contact'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('contactAddressZhTW').value = data.address_zh_tw || data.address || '';
                    document.getElementById('contactAddressZhCN').value = data.address_zh_cn || '';
                    document.getElementById('contactAddressEn').value = data.address_en || '';
                    document.getElementById('contactPhone').value = data.phone || '';
                    document.getElementById('contactEmail').value = data.email || '';
                }
            } catch (error) {
                console.error('Error loading contact settings:', error);
            }
        }

        const contactSettingsForm = document.getElementById('contactSettingsForm');
        if (contactSettingsForm) {
            contactSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const contactData = {
                    address_zh_tw: document.getElementById('contactAddressZhTW').value,
                    address_zh_cn: document.getElementById('contactAddressZhCN').value,
                    address_en: document.getElementById('contactAddressEn').value,
                    phone: document.getElementById('contactPhone').value,
                    email: document.getElementById('contactEmail').value
                };

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'contact'), contactData);
                    showAlert('ËÅØÁµ°Ë≥áË®äÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving contact settings:', error);
                    showAlert('ÂÑ≤Â≠òËÅØÁµ°Ë≥áË®äÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Anthem Settings Management
        // ========================================

        async function loadAnthemSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'anthem'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('anthemTitleZhTW').value = data.title_zh_tw || '';
                    document.getElementById('anthemTitleZhCN').value = data.title_zh_cn || '';
                    document.getElementById('anthemTitleEn').value = data.title_en || '';
                    document.getElementById('anthemDescZhTW').value = data.description_zh_tw || '';
                    document.getElementById('anthemDescZhCN').value = data.description_zh_cn || '';
                    document.getElementById('anthemDescEn').value = data.description_en || '';
                }
            } catch (error) {
                console.error('Error loading anthem settings:', error);
            }
        }

        const anthemSettingsForm = document.getElementById('anthemSettingsForm');
        if (anthemSettingsForm) {
            anthemSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const anthemData = {
                    title_zh_tw: document.getElementById('anthemTitleZhTW').value,
                    title_zh_cn: document.getElementById('anthemTitleZhCN').value,
                    title_en: document.getElementById('anthemTitleEn').value,
                    description_zh_tw: document.getElementById('anthemDescZhTW').value,
                    description_zh_cn: document.getElementById('anthemDescZhCN').value,
                    description_en: document.getElementById('anthemDescEn').value
                };

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'anthem'), anthemData);
                    showAlert('ÊúÉÊ≠åË®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving anthem settings:', error);
                    showAlert('ÂÑ≤Â≠òÊúÉÊ≠åË®≠ÁΩÆÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Visitor Stats Management
        // ========================================

        async function loadVisitorStats() {
            await refreshVisitorStats();
            await loadWebsiteStatus();
            await loadVisitorSettings();
            await loadVisitorHistory();
        }

        // ËºâÂÖ•Á∂≤Á´ôÁãÄÊÖã
        async function loadWebsiteStatus() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const websiteDoc = await getDoc(doc(window.firebaseDB, 'settings', 'website'));

                const toggle = document.getElementById('websiteDisabledToggle');
                if (websiteDoc.exists()) {
                    const data = websiteDoc.data();
                    toggle.checked = data.disabled === true;
                } else {
                    toggle.checked = false;
                }

                updateWebsiteStatusMessage(toggle.checked);
            } catch (error) {
                console.error('Error loading website status:', error);
            }
        }

        // Êõ¥Êñ∞Á∂≤Á´ôÁãÄÊÖãË®äÊÅØ
        function updateWebsiteStatusMessage(isDisabled) {
            const messageDiv = document.getElementById('websiteStatusMessage');
            if (isDisabled) {
                messageDiv.className = 'mt-4 p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300';
                messageDiv.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Á∂≤Á´ôÁõÆÂâçÂ∑≤ÂÅúÁî®ÔºåË®™ÂÆ¢Â∞áÁúãÂà∞Á∂≠Ë≠∑È†ÅÈù¢„ÄÇ';
                messageDiv.classList.remove('hidden');
            } else {
                messageDiv.className = 'mt-4 p-3 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300';
                messageDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Á∂≤Á´ôÊ≠£Â∏∏ÈÅã‰Ωú‰∏≠„ÄÇ';
                messageDiv.classList.remove('hidden');
            }
        }

        // ÂÑ≤Â≠òÁ∂≤Á´ôÁãÄÊÖã
        async function saveWebsiteStatus(isDisabled) {
            try {
                const { doc, setDoc } = window.firestoreModules;
                await setDoc(doc(window.firebaseDB, 'settings', 'website'), {
                    disabled: isDisabled,
                    updatedAt: new Date()
                });

                updateWebsiteStatusMessage(isDisabled);
                showNotification(isDisabled ? 'Á∂≤Á´ôÂ∑≤ÂÅúÁî®' : 'Á∂≤Á´ôÂ∑≤ÂïüÁî®', 'success');
            } catch (error) {
                console.error('Error saving website status:', error);
                showNotification('ÂÑ≤Â≠òÂ§±Êïó: ' + error.message, 'error');
            }
        }

        // ========================================
        // Ë∏¢Âá∫Ë®™ÂÆ¢ÂäüËÉΩ
        // ========================================

        // È°ØÁ§∫Á¢∫Ë™çÂ∞çË©±Ê°Ü
        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => {
                modal.remove();
            });

            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                modal.remove();
                onConfirm();
            });
        }

        // Ë∏¢Âá∫ÊâÄÊúâË®™ÂÆ¢ÔºàÁõ¥Êé•Ë∏¢Âá∫Ôºâ
        async function kickOutAllVisitors() {
            showConfirmDialog('Á¢∫ÂÆöË¶ÅË∏¢Âá∫ÊâÄÊúâÂú®Á∑öË®™ÂÆ¢ÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÊí§Èä∑„ÄÇ', async () => {
                await performKickOutAll();
            });
        }

        async function performKickOutAll() {
            try {
                const { collection, query, where, getDocs, updateDoc, doc, serverTimestamp } = window.firestoreModules;

                const visitorsRef = collection(window.firebaseDB, 'visitors');
                const activeQuery = query(visitorsRef, where('active', '==', true));
                const snapshot = await getDocs(activeQuery);

                let kickedCount = 0;
                const batch = [];

                snapshot.forEach(docSnapshot => {
                    batch.push(updateDoc(doc(window.firebaseDB, 'visitors', docSnapshot.id), {
                        active: false,
                        kickedAt: new Date(),
                        kickReason: 'admin_kick_all'
                    }));
                    kickedCount++;
                });

                await Promise.all(batch);

                showNotification(`Â∑≤Ë∏¢Âá∫ ${kickedCount} ‰ΩçË®™ÂÆ¢`, 'success');
                refreshVisitorStats();
            } catch (error) {
                console.error('Ë∏¢Âá∫Ë®™ÂÆ¢Â§±Êïó:', error);
                showNotification('Ë∏¢Âá∫Â§±Êïó: ' + error.message, 'error');
            }
        }

        // ÁôºÈÄÅË∏¢Âá∫Ë≠¶ÂëäÔºà30ÁßíÂÄíÊï∏Ôºâ
        async function sendKickWarning() {
            try {
                const { doc, setDoc } = window.firestoreModules;

                // Ë®≠ÁΩÆË∏¢Âá∫Ë≠¶ÂëäÊôÇÈñìÊà≥
                await setDoc(doc(window.firebaseDB, 'settings', 'kick_warning'), {
                    active: true,
                    warningTime: new Date(),
                    kickTime: new Date(Date.now() + 30000) // 30ÁßíÂæå
                });

                showNotification('Â∑≤ÁôºÈÄÅË∏¢Âá∫Ë≠¶ÂëäÔºåË®™ÂÆ¢ÈúÄÂú®30ÁßíÂÖßÂõûÊáâ', 'success');
                document.getElementById('cancelKickWarningBtn').classList.remove('hidden');
            } catch (error) {
                console.error('ÁôºÈÄÅË≠¶ÂëäÂ§±Êïó:', error);
                showNotification('ÁôºÈÄÅÂ§±Êïó: ' + error.message, 'error');
            }
        }

        // ÂèñÊ∂àË∏¢Âá∫Ë≠¶Âëä
        async function cancelKickWarning() {
            try {
                const { doc, setDoc } = window.firestoreModules;

                await setDoc(doc(window.firebaseDB, 'settings', 'kick_warning'), {
                    active: false,
                    cancelledAt: new Date()
                });

                showNotification('Â∑≤ÂèñÊ∂àË∏¢Âá∫Ë≠¶Âëä', 'success');
                document.getElementById('cancelKickWarningBtn').classList.add('hidden');
            } catch (error) {
                console.error('ÂèñÊ∂àË≠¶ÂëäÂ§±Êïó:', error);
                showNotification('ÂèñÊ∂àÂ§±Êïó: ' + error.message, 'error');
            }
        }

        // Á∂ÅÂÆöÁ∂≤Á´ôÂÅúÁî®ÈñãÈóú
        document.addEventListener('DOMContentLoaded', () => {
            const toggle = document.getElementById('websiteDisabledToggle');
            if (toggle) {
                toggle.addEventListener('change', (e) => {
                    saveWebsiteStatus(e.target.checked);
                });
            }
        });

        window.refreshVisitorStats = async function() {
            try {
                const { collection, query, where, getDocs, orderBy, Timestamp } = window.firestoreModules;

                // Get online visitors (active within last 2 minutes)
                const twoMinutesAgo = new Date(Date.now() - 120000);
                const visitorsRef = collection(window.firebaseDB, 'visitors');

                // Get active visitors
                const activeQuery = query(
                    visitorsRef,
                    where('active', '==', true)
                );
                const activeSnapshot = await getDocs(activeQuery);

                // Filter by lastHeartbeat manually (Firestore compound query limitation)
                let onlineCount = 0;
                activeSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.lastHeartbeat) {
                        const heartbeatTime = data.lastHeartbeat.toDate ? data.lastHeartbeat.toDate() : new Date(data.lastHeartbeat);
                        if (heartbeatTime > twoMinutesAgo) {
                            onlineCount++;
                        }
                    }
                });

                document.getElementById('statOnlineVisitors').textContent = onlineCount;

                // Get today's visitors
                const today = new Date().toISOString().split('T')[0];
                const historyRef = collection(window.firebaseDB, 'visit_history');
                const todayQuery = query(historyRef, where('date', '==', today));
                const todaySnapshot = await getDocs(todayQuery);

                document.getElementById('statTodayVisitors').textContent = todaySnapshot.size;

                // Get total visitors
                const totalSnapshot = await getDocs(collection(window.firebaseDB, 'visit_history'));
                document.getElementById('statTotalVisitors').textContent = totalSnapshot.size;

            } catch (error) {
                console.error('Error refreshing visitor stats:', error);
            }
        };

        async function loadVisitorSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'visitor'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('visitorMaxLimit').value = data.maxVisitors || 0;
                } else {
                    document.getElementById('visitorMaxLimit').value = 0;
                }
            } catch (error) {
                console.error('Error loading visitor settings:', error);
            }
        }

        async function loadVisitorHistory() {
            const loadingEl = document.getElementById('visitorHistoryLoading');
            const listEl = document.getElementById('visitorHistoryList');
            const emptyEl = document.getElementById('visitorHistoryEmpty');
            const tableBody = document.getElementById('visitorHistoryTableBody');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            tableBody.innerHTML = '';

            try {
                const { collection, getDocs } = window.firestoreModules;
                const historySnapshot = await getDocs(collection(window.firebaseDB, 'visit_history'));

                loadingEl.classList.add('hidden');

                if (historySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                // Group by date
                const dateMap = {};
                historySnapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.date || 'unknown';
                    if (!dateMap[date]) {
                        dateMap[date] = 0;
                    }
                    dateMap[date]++;
                });

                // Sort by date (newest first)
                const sortedDates = Object.keys(dateMap).sort((a, b) => b.localeCompare(a));

                // Only show last 30 days
                const recentDates = sortedDates.slice(0, 30);

                recentDates.forEach(date => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50';
                    row.innerHTML = `
                        <td class="px-4 py-3">${date}</td>
                        <td class="px-4 py-3 font-semibold">${dateMap[date]}</td>
                    `;
                    tableBody.appendChild(row);
                });

                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading visitor history:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Ê≠∑Âè≤Êï∏ÊìöÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        // Visitor Settings Form
        const visitorSettingsForm = document.getElementById('visitorSettingsForm');
        if (visitorSettingsForm) {
            visitorSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const maxVisitors = parseInt(document.getElementById('visitorMaxLimit').value) || 0;

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'visitor'), {
                        maxVisitors: maxVisitors,
                        updatedAt: new Date()
                    });
                    showAlert('Ë®™ÂÆ¢ÈôêÂà∂Ë®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving visitor settings:', error);
                    showAlert('ÂÑ≤Â≠òË®≠ÁΩÆÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Announcements Management
        // ========================================

        // ÂÖ¨ÂëäË≥áÊñôÂø´Âèñ
        let announcementsCache = [];

        async function loadAnnouncements() {
            const loadingEl = document.getElementById('announcementsLoading');
            const listEl = document.getElementById('announcementsList');
            const emptyEl = document.getElementById('announcementsEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'announcements'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                loadingEl.classList.add('hidden');

                // Áµ±Ë®àÊï∏Êìö
                let stats = { total: 0, active: 0, pinned: 0, urgent: 0 };

                if (querySnapshot.empty) {
                    updateAnnouncementStats(stats);
                    emptyEl.classList.remove('hidden');
                    announcementsCache = [];
                    return;
                }

                // ÂÖàÊåâÁΩÆÈ†ÇÂíåÊôÇÈñìÊéíÂ∫è
                const sortedDocs = querySnapshot.docs.sort((a, b) => {
                    const aData = a.data();
                    const bData = b.data();
                    if (aData.pinned && !bData.pinned) return -1;
                    if (!aData.pinned && bData.pinned) return 1;
                    const aTime = aData.createdAt?.seconds || 0;
                    const bTime = bData.createdAt?.seconds || 0;
                    return bTime - aTime;
                });

                // Êõ¥Êñ∞Âø´Âèñ
                announcementsCache = sortedDocs.map(doc => ({ id: doc.id, ...doc.data() }));

                sortedDocs.forEach((docSnapshot) => {
                    const announcement = docSnapshot.data();
                    const announcementId = docSnapshot.id;

                    // Êõ¥Êñ∞Áµ±Ë®à
                    stats.total++;
                    if (announcement.active) stats.active++;
                    if (announcement.pinned) stats.pinned++;
                    if (announcement.category === 'urgent') stats.urgent++;

                    const createdDate = announcement.createdAt ? new Date(announcement.createdAt.seconds * 1000).toLocaleString('zh-TW') : 'Êú™Áü•ÊôÇÈñì';

                    const categoryLabels = {
                        'general': { icon: 'üü¢', text: '‰∏ÄËà¨', color: 'bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200' },
                        'important': { icon: 'üü°', text: 'ÈáçË¶Å', color: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' },
                        'urgent': { icon: 'üî¥', text: 'Á∑äÊÄ•', color: 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' },
                        'event': { icon: 'üîµ', text: 'Ê¥ªÂãï', color: 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200' }
                    };
                    const category = announcement.category || 'general';
                    const categoryLabel = categoryLabels[category] || categoryLabels['general'];

                    // ÂÆöÊôÇÁôºÂ∏ÉÁãÄÊÖã
                    let scheduleInfo = '';
                    let isScheduled = false;
                    const now = new Date();
                    if (announcement.startTime) {
                        const startDate = announcement.startTime.seconds ? new Date(announcement.startTime.seconds * 1000) : new Date(announcement.startTime);
                        if (startDate > now) {
                            scheduleInfo = `<span class="text-orange-500 text-xs"><i class="fas fa-clock mr-1"></i>È†êÂÆö ${startDate.toLocaleString('zh-TW')} ÁôºÂ∏É</span>`;
                            isScheduled = true;
                        }
                    }
                    if (announcement.endTime) {
                        const endDate = announcement.endTime.seconds ? new Date(announcement.endTime.seconds * 1000) : new Date(announcement.endTime);
                        if (endDate < now) {
                            scheduleInfo = `<span class="text-gray-400 text-xs"><i class="fas fa-times-circle mr-1"></i>Â∑≤Êñº ${endDate.toLocaleString('zh-TW')} ÁµêÊùü</span>`;
                        } else {
                            scheduleInfo += scheduleInfo ? ' | ' : '';
                            scheduleInfo += `<span class="text-blue-500 text-xs"><i class="fas fa-hourglass-end mr-1"></i>ÁµêÊùüÊñº ${endDate.toLocaleString('zh-TW')}</span>`;
                        }
                    }

                    const imagePreview = announcement.imageUrl ? `
                        <div class="mt-3">
                            <img src="${announcement.imageUrl}" alt="ÂÖ¨ÂëäÂúñÁâá" class="max-h-32 rounded-lg object-cover cursor-pointer hover:opacity-80 transition-opacity" onclick="window.open('${announcement.imageUrl}', '_blank')">
                        </div>
                    ` : '';

                    const editDataStr = encodeURIComponent(JSON.stringify({
                        id: announcementId,
                        title: announcement.title || '',
                        content: announcement.content || '',
                        imageUrl: announcement.imageUrl || '',
                        category: announcement.category || 'general',
                        pinned: announcement.pinned || false,
                        startTime: announcement.startTime ? (announcement.startTime.seconds ? new Date(announcement.startTime.seconds * 1000).toISOString().slice(0, 16) : new Date(announcement.startTime).toISOString().slice(0, 16)) : '',
                        endTime: announcement.endTime ? (announcement.endTime.seconds ? new Date(announcement.endTime.seconds * 1000).toISOString().slice(0, 16) : new Date(announcement.endTime).toISOString().slice(0, 16)) : ''
                    }));

                    const announcementCard = document.createElement('div');
                    announcementCard.className = 'announcement-card bg-gray-50 dark:bg-gray-700 rounded-xl p-6 border-l-4 transition-all hover:shadow-md';
                    announcementCard.style.borderLeftColor = announcement.pinned ? '#f59e0b' : (announcement.category === 'urgent' ? '#ef4444' : '#5D5CDE');
                    announcementCard.dataset.category = category;
                    announcementCard.dataset.active = announcement.active ? 'true' : 'false';
                    announcementCard.dataset.pinned = announcement.pinned ? 'true' : 'false';
                    announcementCard.dataset.scheduled = isScheduled ? 'true' : 'false';
                    announcementCard.dataset.title = (announcement.title || '').toLowerCase();
                    announcementCard.dataset.content = (announcement.content || '').toLowerCase();

                    announcementCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex flex-wrap items-center gap-2 mb-2">
                                    ${announcement.pinned ? '<span class="text-xl animate-pulse" title="ÁΩÆÈ†Ç">üìå</span>' : ''}
                                    <h3 class="text-lg font-bold">${announcement.title || ''}</h3>
                                    <span class="px-2 py-0.5 ${categoryLabel.color} rounded-full text-xs font-semibold">
                                        ${categoryLabel.icon} ${categoryLabel.text}
                                    </span>
                                    <span class="px-2 py-0.5 ${announcement.active ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300'} rounded-full text-xs font-semibold">
                                        ${announcement.active ? '‚úì ÂïüÁî®‰∏≠' : '‚óã Â∑≤ÂÅúÁî®'}
                                    </span>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-2 whitespace-pre-wrap">${announcement.content || ''}</p>
                                ${imagePreview}
                                <div class="flex flex-wrap items-center gap-3 mt-3 text-sm text-gray-500 dark:text-gray-400">
                                    <span>üïê ${createdDate}</span>
                                    ${scheduleInfo}
                                </div>
                            </div>
                            <div class="flex flex-col gap-2 ml-4">
                                <button onclick="editAnnouncement('${editDataStr}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    ‚úèÔ∏è Á∑®ËºØ
                                </button>
                                <button onclick="togglePinAnnouncement('${announcementId}', ${!announcement.pinned})" class="px-4 py-2 ${announcement.pinned ? 'bg-orange-500 hover:bg-orange-600' : 'bg-gray-400 hover:bg-gray-500'} text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    üìå ${announcement.pinned ? 'ÂèñÊ∂àÁΩÆÈ†Ç' : 'ÁΩÆÈ†Ç'}
                                </button>
                                <button onclick="toggleAnnouncement('${announcementId}', ${!announcement.active})" class="px-4 py-2 ${announcement.active ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-500 hover:bg-green-600'} text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    ${announcement.active ? '‚è∏Ô∏è ÂÅúÁî®' : '‚ñ∂Ô∏è ÂïüÁî®'}
                                </button>
                                <button onclick="deleteAnnouncement('${announcementId}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    üóëÔ∏è Âà™Èô§
                                </button>
                            </div>
                        </div>
                    `;

                    listEl.appendChild(announcementCard);
                });

                updateAnnouncementStats(stats);
                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading announcements:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<div class="text-6xl mb-4">‚ùå</div><p class="text-red-500">ËºâÂÖ•Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        function updateAnnouncementStats(stats) {
            const totalEl = document.getElementById('annStatTotal');
            const activeEl = document.getElementById('annStatActive');
            const pinnedEl = document.getElementById('annStatPinned');
            const urgentEl = document.getElementById('annStatUrgent');
            if (totalEl) totalEl.textContent = stats.total;
            if (activeEl) activeEl.textContent = stats.active;
            if (pinnedEl) pinnedEl.textContent = stats.pinned;
            if (urgentEl) urgentEl.textContent = stats.urgent;
        }

        window.filterAnnouncements = function() {
            const categoryFilter = document.getElementById('annFilterCategory')?.value || '';
            const statusFilter = document.getElementById('annFilterStatus')?.value || '';
            const searchInput = (document.getElementById('annSearchInput')?.value || '').toLowerCase();

            document.querySelectorAll('.announcement-card').forEach(card => {
                let show = true;

                // ÂàÜÈ°ûÁØ©ÈÅ∏
                if (categoryFilter && card.dataset.category !== categoryFilter) {
                    show = false;
                }

                // ÁãÄÊÖãÁØ©ÈÅ∏
                if (statusFilter) {
                    if (statusFilter === 'active' && card.dataset.active !== 'true') show = false;
                    if (statusFilter === 'inactive' && card.dataset.active !== 'false') show = false;
                    if (statusFilter === 'pinned' && card.dataset.pinned !== 'true') show = false;
                    if (statusFilter === 'scheduled' && card.dataset.scheduled !== 'true') show = false;
                }

                // ÊêúÂ∞ã
                if (searchInput) {
                    const title = card.dataset.title || '';
                    const content = card.dataset.content || '';
                    if (!title.includes(searchInput) && !content.includes(searchInput)) {
                        show = false;
                    }
                }

                card.style.display = show ? 'block' : 'none';
            });
        };

        window.clearAnnouncementFilters = function() {
            const categorySelect = document.getElementById('annFilterCategory');
            const statusSelect = document.getElementById('annFilterStatus');
            const searchInput = document.getElementById('annSearchInput');
            if (categorySelect) categorySelect.value = '';
            if (statusSelect) statusSelect.value = '';
            if (searchInput) searchInput.value = '';
            filterAnnouncements();
        };

        window.refreshAnnouncements = function() {
            loadAnnouncements();
            showAlert('ÂÖ¨ÂëäÂàóË°®Â∑≤Âà∑Êñ∞');
        };

        window.togglePinAnnouncement = async function(id, pinned) {
            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'announcements', id), { pinned: pinned });
                showAlert(pinned ? 'ÂÖ¨ÂëäÂ∑≤ÁΩÆÈ†Ç' : 'Â∑≤ÂèñÊ∂àÁΩÆÈ†Ç');
                loadAnnouncements();
            } catch (error) {
                console.error('Toggle pin error:', error);
                showAlert('Êìç‰ΩúÂ§±ÊïóÔºö' + error.message);
            }
        };

        const addAnnouncementBtn = document.getElementById('addAnnouncementBtn');
        if (addAnnouncementBtn) {
            addAnnouncementBtn.addEventListener('click', () => {
                showEnhancedAnnouncementDialog();
            });
        }

        // Â¢ûÂº∑ÁâàÂÖ¨ÂëäÂ∞çË©±Ê°Ü
        function showEnhancedAnnouncementDialog(editData = null) {
            const isEdit = !!editData;
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 overflow-y-auto py-8';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg w-full my-auto">
                    <h3 class="text-xl font-bold mb-4">${isEdit ? 'Á∑®ËºØË®äÊÅØ' : 'Êñ∞Â¢ûË®äÊÅØ'}</h3>
                    <div class="space-y-4 max-h-[70vh] overflow-y-auto">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ê®ôÈ°å *</label>
                            <input type="text" id="annTitle" value="${editData?.title || ''}" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂÖßÂÆπ *</label>
                            <textarea id="annContent" rows="4" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none">${editData?.content || ''}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂúñÁâá URLÔºàÈÅ∏Â°´Ôºâ</label>
                            <input type="url" id="annImageUrl" value="${editData?.imageUrl || ''}" placeholder="https://example.com/image.jpg" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂàÜÈ°ûÊ®ôÁ±§</label>
                            <select id="annCategory" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                <option value="general" ${editData?.category === 'general' ? 'selected' : ''}>üü¢ ‰∏ÄËà¨</option>
                                <option value="important" ${editData?.category === 'important' ? 'selected' : ''}>üü° ÈáçË¶Å</option>
                                <option value="urgent" ${editData?.category === 'urgent' ? 'selected' : ''}>üî¥ Á∑äÊÄ•</option>
                                <option value="event" ${editData?.category === 'event' ? 'selected' : ''}>üîµ Ê¥ªÂãï</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="annPinned" ${editData?.pinned ? 'checked' : ''} class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                                <span class="text-sm font-semibold">üìå ÁΩÆÈ†ÇÂÖ¨Âëä</span>
                            </label>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <label class="block text-sm font-semibold mb-2">ÂÆöÊôÇÁôºÂ∏ÉÔºàÈÅ∏Â°´Ôºâ</label>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">ÈñãÂßãÊôÇÈñì</label>
                                    <input type="datetime-local" id="annStartTime" value="${editData?.startTime || ''}" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">ÁµêÊùüÊôÇÈñì</label>
                                    <input type="datetime-local" id="annEndTime" value="${editData?.endTime || ''}" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ÁïôÁ©∫Ë°®Á§∫Á´ãÂç≥ÁôºÂ∏É‰∏îÊ∞∏‰πÖÊúâÊïà</p>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded transition-colors">${isEdit ? 'Êõ¥Êñ∞' : 'Êñ∞Â¢û'}</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', async () => {
                const title = document.getElementById('annTitle').value.trim();
                const content = document.getElementById('annContent').value.trim();
                const imageUrl = document.getElementById('annImageUrl').value.trim();
                const category = document.getElementById('annCategory').value;
                const pinned = document.getElementById('annPinned').checked;
                const startTime = document.getElementById('annStartTime').value;
                const endTime = document.getElementById('annEndTime').value;

                if (!title || !content) {
                    showAlert('Ë´ãËº∏ÂÖ•Ê®ôÈ°åÂíåÂÖßÂÆπ');
                    return;
                }

                try {
                    const { collection, addDoc, doc, updateDoc } = window.firestoreModules;
                    const data = {
                        title,
                        content,
                        imageUrl,
                        category,
                        pinned,
                        startTime: startTime ? new Date(startTime) : null,
                        endTime: endTime ? new Date(endTime) : null,
                        active: true,
                        updatedAt: new Date()
                    };

                    if (isEdit) {
                        await updateDoc(doc(window.firebaseDB, 'announcements', editData.id), data);
                        showAlert('Ë®äÊÅØÂ∑≤Êõ¥Êñ∞ÔºÅ');
                    } else {
                        data.createdAt = new Date();
                        await addDoc(collection(window.firebaseDB, 'announcements'), data);
                        showAlert('Ë®äÊÅØÂ∑≤Êñ∞Â¢ûÔºÅ');
                    }

                    modal.remove();
                    loadAnnouncements();
                } catch (error) {
                    console.error('Error saving announcement:', error);
                    showAlert('ÂÑ≤Â≠òË®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }
        window.showEnhancedAnnouncementDialog = showEnhancedAnnouncementDialog;

        // Á∑®ËºØÂÖ¨ÂëäÊåâÈàïËôïÁêÜ
        window.editAnnouncement = function(encodedData) {
            try {
                const editData = JSON.parse(decodeURIComponent(encodedData));
                showEnhancedAnnouncementDialog(editData);
            } catch (error) {
                console.error('Error parsing announcement data:', error);
                showAlert('ÁÑ°Ê≥ïÁ∑®ËºØÊ≠§ÂÖ¨Âëä');
            }
        };

        window.toggleAnnouncement = async (id, active) => {
            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'announcements', id), { active });
                showAlert(active ? 'Ë®äÊÅØÂ∑≤ÂïüÁî®ÔºÅ' : 'Ë®äÊÅØÂ∑≤ÂÅúÁî®ÔºÅ');
                loadAnnouncements();
            } catch (error) {
                console.error('Error toggling announcement:', error);
                showAlert('Êõ¥Êñ∞Ë®äÊÅØÁãÄÊÖãÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteAnnouncement = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë®äÊÅØÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'announcements', id));
                    showAlert('Ë®äÊÅØÂ∑≤Âà™Èô§ÔºÅ');
                    loadAnnouncements();
                } catch (error) {
                    console.error('Error deleting announcement:', error);
                    showAlert('Âà™Èô§Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // Prompt Dialog for Announcements
        function showPromptDialog(dialogTitle, label1, label2, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">${dialogTitle}</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">${label1}</label>
                            <input type="text" id="promptInput1" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">${label2}</label>
                            <textarea id="promptInput2" rows="4" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded transition-colors">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const input1 = modal.querySelector('#promptInput1');
            const input2 = modal.querySelector('#promptInput2');

            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                const value1 = input1.value.trim();
                const value2 = input2.value.trim();
                modal.remove();
                onConfirm(value1, value2);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            // Focus on first input
            setTimeout(() => input1.focus(), 100);
        }

        // ========================================
        // User Management
        // ========================================

        let currentUserFilter = 'all';
        let allUsers = [];

        async function loadUsers() {
            const loadingEl = document.getElementById('usersLoading');
            const listEl = document.getElementById('usersList');
            const emptyEl = document.getElementById('usersEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'users'));

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                allUsers = [];
                querySnapshot.forEach((docSnapshot) => {
                    const user = docSnapshot.data();
                    allUsers.push({
                        id: docSnapshot.id,
                        ...user
                    });
                });

                renderUsers();
            } catch (error) {
                console.error('Error loading users:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Áî®Êà∂ÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        function renderUsers() {
            const listEl = document.getElementById('usersList');
            const emptyEl = document.getElementById('usersEmptyState');

            let filteredUsers = allUsers;

            // Filter by role or status
            if (currentUserFilter === 'admin') {
                filteredUsers = allUsers.filter(u => u.role === 'admin');
            } else if (currentUserFilter === 'user') {
                filteredUsers = allUsers.filter(u => u.role === 'user' || !u.role);
            } else if (currentUserFilter === 'pending') {
                filteredUsers = allUsers.filter(u => u.status === 'pending');
            } else if (currentUserFilter === 'approved') {
                filteredUsers = allUsers.filter(u => u.status === 'approved');
            } else if (currentUserFilter === 'rejected') {
                filteredUsers = allUsers.filter(u => u.status === 'rejected');
            }

            if (filteredUsers.length === 0) {
                listEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁî®Êà∂</p>';
                emptyEl.classList.remove('hidden');
                return;
            }

            emptyEl.classList.add('hidden');

            listEl.innerHTML = '';
            filteredUsers.forEach((user) => {
                const roleColors = {
                    'admin': 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200',
                    'user': 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200'
                };

                const statusColors = {
                    'pending': 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200',
                    'approved': 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200',
                    'rejected': 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'
                };

                const roleClass = roleColors[user.role] || roleColors['user'];
                const statusClass = statusColors[user.status] || statusColors['pending'];

                const roleText = user.role === 'admin' ? 'ÁÆ°ÁêÜÂì°' : 'ÊôÆÈÄöÁî®Êà∂';
                const statusText = {
                    'pending': 'ÂæÖÂØ©Ê†∏',
                    'approved': 'Â∑≤ÊâπÂáÜ',
                    'rejected': 'Â∑≤ÊãíÁµï'
                }[user.status] || 'ÂæÖÂØ©Ê†∏';

                const userCard = document.createElement('div');
                userCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                userCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-3">
                                <h3 class="text-lg font-bold">${user.name || 'Êú™Ë®≠ÂÆöÂßìÂêç'}</h3>
                                <span class="px-3 py-1 ${roleClass} rounded-full text-xs font-semibold">${roleText}</span>
                                <span class="px-3 py-1 ${statusClass} rounded-full text-xs font-semibold">${statusText}</span>
                            </div>
                            <div class="space-y-1 text-sm text-gray-600 dark:text-gray-400">
                                <p><span class="font-semibold">Áî®Êà∂Âêç:</span> ${user.username || 'Êú™Ë®≠ÂÆö'}</p>
                                <p><span class="font-semibold">ÈõªÂ≠êÈÉµ‰ª∂:</span> ${user.email || ''}</p>
                                <p><span class="font-semibold">Áî®Êà∂ ID:</span> ${user.id}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editUser('${user.id}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                Á∑®ËºØ
                            </button>
                            <button onclick="deleteUser('${user.id}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                Âà™Èô§
                            </button>
                        </div>
                    </div>
                `;

                listEl.appendChild(userCard);
            });

            listEl.classList.remove('hidden');
        }

        window.filterUsers = function(filter) {
            currentUserFilter = filter;
            document.querySelectorAll('.user-filter-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            renderUsers();
        };

        window.editUser = async function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('userId').value = userId;
            document.getElementById('userUsername').value = user.username || 'Êú™Ë®≠ÂÆö';
            document.getElementById('userEmail').value = user.email || '';
            document.getElementById('userName').value = user.name || '';
            document.getElementById('userRole').value = user.role || 'user';
            document.getElementById('userStatus').value = user.status || 'pending';

            document.getElementById('userModal').classList.remove('hidden');
        };

        window.deleteUser = function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            // Prevent deleting super admin
            if (userId === SUPER_ADMIN_UID) {
                showAlert('ÁÑ°Ê≥ïÂà™Èô§Ë∂ÖÁ¥öÁÆ°ÁêÜÂì°Â∏≥Ëôü');
                return;
            }

            // Prevent deleting yourself
            if (userId === currentUser.uid) {
                showAlert('ÁÑ°Ê≥ïÂà™Èô§Ëá™Â∑±ÁöÑÂ∏≥Ëôü');
                return;
            }

            showConfirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§Áî®Êà∂ "${user.name || user.username || user.email}" ÂóéÔºü`, async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'users', userId));
                    showAlert('Áî®Êà∂Â∑≤Âà™Èô§ÔºÅ');
                    loadUsers();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    showAlert('Âà™Èô§Áî®Êà∂ÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // User Modal Handlers
        document.querySelectorAll('.closeUserModal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('userModal').classList.add('hidden');
            });
        });

        const userForm = document.getElementById('userForm');
        if (userForm) {
            userForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const userId = document.getElementById('userId').value;
                const userData = {
                    name: document.getElementById('userName').value,
                    role: document.getElementById('userRole').value,
                    status: document.getElementById('userStatus').value
                };

                try {
                    const { doc, updateDoc } = window.firestoreModules;
                    await updateDoc(doc(window.firebaseDB, 'users', userId), userData);
                    showAlert('Áî®Êà∂Ë≥áÊñôÂ∑≤Êõ¥Êñ∞ÔºÅ');
                    document.getElementById('userModal').classList.add('hidden');
                    loadUsers();
                } catch (error) {
                    console.error('Error updating user:', error);
                    showAlert('Êõ¥Êñ∞Áî®Êà∂Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Profile Management
        // ========================================

        let verificationCodes = {
            username: { code: '', email: '', timestamp: 0, newUsername: '' },
            oldEmail: { code: '', email: '', timestamp: 0 },
            newEmail: { code: '', email: '', timestamp: 0, newEmailAddress: '' }
        };

        // Load and display current user profile
        async function loadProfile() {
            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));

                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    document.getElementById('profileCurrentUsername').textContent = userData.username || 'Êú™Ë®≠ÂÆö';
                    document.getElementById('profileCurrentEmail').textContent = userData.email || user.email;
                    document.getElementById('profileCurrentName').textContent = userData.name || 'Êú™Ë®≠ÂÆö';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Generate 6-digit verification code
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Send verification email using EmailJS
        async function sendVerificationEmail(email, code, purpose) {
            try {
                // Á¢∫‰øù emailjs Â∑≤ËºâÂÖ•
                if (typeof window.emailjs === 'undefined') {
                    console.error('EmailJS is not loaded');
                    return false;
                }

                const templateParams = {
                    to_email: email,
                    verification_code: code,
                    purpose: purpose
                };

                // ‰ΩøÁî®Ëàá index.html Áõ∏ÂêåÁöÑÈÖçÁΩÆ
                await window.emailjs.send(
                    window.emailJSConfig.serviceId,
                    window.emailJSConfig.templateId,
                    templateParams
                );
                return true;
            } catch (error) {
                console.error('Error sending email:', error);
                return false;
            }
        }

        // Check if username exists
        async function checkUsernameExists(username) {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'users'), where('username', '==', username));
                const snapshot = await getDocs(q);
                return !snapshot.empty;
            } catch (error) {
                console.error('Error checking username:', error);
                return false;
            }
        }

        // Check if email exists
        async function checkEmailExists(email) {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'users'), where('email', '==', email));
                const snapshot = await getDocs(q);
                return !snapshot.empty;
            } catch (error) {
                console.error('Error checking email:', error);
                return false;
            }
        }

        // Start update username process
        // Start update name process
        window.startUpdateName = async function() {
            const newName = document.getElementById('profileNewName').value.trim();

            if (!newName) {
                showAlert('Ë´ãËº∏ÂÖ•Êñ∞ÂßìÂêç');
                return;
            }

            if (newName.length < 2 || newName.length > 50) {
                showAlert('ÂßìÂêçÂøÖÈ†àÁÇ∫ 2-50 ÂÄãÂ≠óÁ¨¶');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));
                const currentName = userDoc.data().name;

                if (newName === currentName) {
                    showAlert('Êñ∞ÂßìÂêçËàáÁï∂ÂâçÂßìÂêçÁõ∏Âêå');
                    return;
                }

                const email = userDoc.data().email || user.email;
                const code = generateVerificationCode();

                // Send verification email
                const sent = await sendVerificationEmail(email, code, '‰øÆÊîπÂßìÂêç');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store verification code
                verificationCodes.name = {
                    code: code,
                    email: email,
                    timestamp: Date.now(),
                    newName: newName
                };

                // Show verification modal
                document.getElementById('verifyNameEmail').textContent = email;
                document.getElementById('nameVerifyCode').value = '';
                document.getElementById('verifyNameModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error starting name update:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify name modal
        window.closeVerifyNameModal = function() {
            document.getElementById('verifyNameModal').classList.add('hidden');
            document.getElementById('nameVerifyCode').value = '';
        };

        // Confirm update name
        window.confirmUpdateName = async function() {
            const inputCode = document.getElementById('nameVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.name.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÁôºÈÄÅ');
                closeVerifyNameModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.name.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    name: verificationCodes.name.newName
                });

                showAlert('ÂßìÂêçÂ∑≤ÊàêÂäü‰øÆÊîπÔºÅ');
                closeVerifyNameModal();
                document.getElementById('profileNewName').value = '';
                loadProfile();
            } catch (error) {
                console.error('Error updating name:', error);
                showAlert('‰øÆÊîπÂßìÂêçÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Start update username process
        window.startUpdateUsername = async function() {
            const newUsername = document.getElementById('profileNewUsername').value.trim();

            if (!newUsername) {
                showAlert('Ë´ãËº∏ÂÖ•Êñ∞Áî®Êà∂Âêç');
                return;
            }

            if (newUsername.length < 3 || newUsername.length > 20) {
                showAlert('Áî®Êà∂ÂêçÂøÖÈ†àÁÇ∫ 3-20 ÂÄãÂ≠óÁ¨¶');
                return;
            }

            if (!/^[a-zA-Z0-9_-]+$/.test(newUsername)) {
                showAlert('Áî®Êà∂ÂêçÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));
                const currentUsername = userDoc.data().username;

                if (newUsername === currentUsername) {
                    showAlert('Êñ∞Áî®Êà∂ÂêçËàáÁï∂ÂâçÁî®Êà∂ÂêçÁõ∏Âêå');
                    return;
                }

                // Check if username already exists
                const exists = await checkUsernameExists(newUsername);
                if (exists) {
                    showAlert('Ê≠§Áî®Êà∂ÂêçÂ∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                const email = userDoc.data().email || user.email;
                const code = generateVerificationCode();

                // Send verification email
                const sent = await sendVerificationEmail(email, code, '‰øÆÊîπÁî®Êà∂Âêç');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store verification code
                verificationCodes.username = {
                    code: code,
                    email: email,
                    timestamp: Date.now(),
                    newUsername: newUsername
                };

                // Show verification modal
                document.getElementById('verifyUsernameEmail').textContent = email;
                document.getElementById('usernameVerifyCode').value = '';
                document.getElementById('verifyUsernameModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error starting username update:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify username modal
        window.closeVerifyUsernameModal = function() {
            document.getElementById('verifyUsernameModal').classList.add('hidden');
            document.getElementById('usernameVerifyCode').value = '';
        };

        // Confirm update username
        window.confirmUpdateUsername = async function() {
            const inputCode = document.getElementById('usernameVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.username.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÁôºÈÄÅ');
                closeVerifyUsernameModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.username.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    username: verificationCodes.username.newUsername
                });

                showAlert('Áî®Êà∂ÂêçÂ∑≤ÊàêÂäü‰øÆÊîπÔºÅ');
                closeVerifyUsernameModal();
                document.getElementById('profileNewUsername').value = '';
                loadProfile();
            } catch (error) {
                console.error('Error updating username:', error);
                showAlert('‰øÆÊîπÁî®Êà∂ÂêçÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Start update email process
        window.startUpdateEmail = async function() {
            const newEmail = document.getElementById('profileNewEmail').value.trim();

            if (!newEmail) {
                showAlert('Ë´ãËº∏ÂÖ•Êñ∞ÈõªÂ≠êÈÉµ‰ª∂');
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(newEmail)) {
                showAlert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈõªÂ≠êÈÉµ‰ª∂Âú∞ÂùÄ');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));
                const currentEmail = userDoc.data().email || user.email;

                if (newEmail === currentEmail) {
                    showAlert('Êñ∞ÈõªÂ≠êÈÉµ‰ª∂ËàáÁï∂ÂâçÈõªÂ≠êÈÉµ‰ª∂Áõ∏Âêå');
                    return;
                }

                // Check if email already exists
                const exists = await checkEmailExists(newEmail);
                if (exists) {
                    showAlert('Ê≠§ÈõªÂ≠êÈÉµ‰ª∂Â∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                // Send verification code to old email
                const code = generateVerificationCode();
                const sent = await sendVerificationEmail(currentEmail, code, 'È©óË≠âËàäÈõªÂ≠êÈÉµ‰ª∂');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store verification code
                verificationCodes.oldEmail = {
                    code: code,
                    email: currentEmail,
                    timestamp: Date.now()
                };

                verificationCodes.newEmail.newEmailAddress = newEmail;

                // Show old email verification modal
                document.getElementById('verifyOldEmailAddress').textContent = currentEmail;
                document.getElementById('oldEmailVerifyCode').value = '';
                document.getElementById('verifyOldEmailModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑËàäÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error starting email update:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify old email modal
        window.closeVerifyOldEmailModal = function() {
            document.getElementById('verifyOldEmailModal').classList.add('hidden');
            document.getElementById('oldEmailVerifyCode').value = '';
        };

        // Confirm old email and send new email verification
        window.confirmOldEmail = async function() {
            const inputCode = document.getElementById('oldEmailVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.oldEmail.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÁôºÈÄÅ');
                closeVerifyOldEmailModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.oldEmail.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            // Old email verified, now send code to new email
            try {
                const newEmail = verificationCodes.newEmail.newEmailAddress;
                const code = generateVerificationCode();
                const sent = await sendVerificationEmail(newEmail, code, 'È©óË≠âÊñ∞ÈõªÂ≠êÈÉµ‰ª∂');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store new email verification code
                verificationCodes.newEmail.code = code;
                verificationCodes.newEmail.email = newEmail;
                verificationCodes.newEmail.timestamp = Date.now();

                // Close old email modal and show new email modal
                closeVerifyOldEmailModal();
                document.getElementById('verifyNewEmailAddress').textContent = newEmail;
                document.getElementById('newEmailVerifyCode').value = '';
                document.getElementById('verifyNewEmailModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑÊñ∞ÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error sending new email verification:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify new email modal
        window.closeVerifyNewEmailModal = function() {
            document.getElementById('verifyNewEmailModal').classList.add('hidden');
            document.getElementById('newEmailVerifyCode').value = '';
        };

        // Confirm update email
        window.confirmUpdateEmail = async function() {
            const inputCode = document.getElementById('newEmailVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.newEmail.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÈñãÂßã');
                closeVerifyNewEmailModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.newEmail.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    email: verificationCodes.newEmail.newEmailAddress
                });

                showAlert('ÈõªÂ≠êÈÉµ‰ª∂Â∑≤ÊàêÂäü‰øÆÊîπÔºÅ');
                closeVerifyNewEmailModal();
                document.getElementById('profileNewEmail').value = '';
                loadProfile();
            } catch (error) {
                console.error('Error updating email:', error);
                showAlert('‰øÆÊîπÈõªÂ≠êÈÉµ‰ª∂ÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // ==================== Add User Functionality ====================

        // Store verification data for new user
        let newUserData = null;

        // Open add user modal
        document.getElementById('addUserBtn').addEventListener('click', () => {
            document.getElementById('addUserForm').reset();
            document.getElementById('addUserStatus').value = 'approved'; // È†êË®≠ÁÇ∫Â∑≤ÊâπÂáÜ
            document.getElementById('addUserModal').classList.remove('hidden');
        });

        // Close add user modal
        document.querySelectorAll('.closeAddUserModal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserForm').reset();
            });
        });

        // Close add user verify modal
        window.closeAddUserVerifyModal = function() {
            document.getElementById('addUserVerifyModal').classList.add('hidden');
            document.getElementById('addUserVerifyCode').value = '';
        };

        // Handle add user form submission (send verification code)
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Áç≤ÂèñË°®ÂñÆÊï∏Êìö
            const name = document.getElementById('addUserName').value.trim();
            const username = document.getElementById('addUserUsername').value.trim();
            const email = document.getElementById('addUserEmail').value.trim();
            const password = document.getElementById('addUserPassword').value;
            const passwordConfirm = document.getElementById('addUserPasswordConfirm').value;
            const role = document.getElementById('addUserRole').value;
            const status = document.getElementById('addUserStatus').value;

            // È©óË≠âÁî®Êà∂ÂêçÊ†ºÂºè
            const usernameRegex = /^[a-zA-Z0-9_-]{3,20}$/;
            if (!usernameRegex.test(username)) {
                showAlert('Áî®Êà∂ÂêçÊ†ºÂºè‰∏çÊ≠£Á¢∫ÔºåÂÉÖÂÖÅË®±3-20ÂÄãÂ≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑ö(_)ÊàñÈÄ£Â≠óÁ¨¶(-)');
                return;
            }

            // È©óË≠âÂØÜÁ¢ºÈï∑Â∫¶
            if (password.length < 6) {
                showAlert('ÂØÜÁ¢ºÈï∑Â∫¶Ëá≥Â∞ë6‰Ωç');
                return;
            }

            // È©óË≠âÂÖ©Ê¨°ÂØÜÁ¢ºÊòØÂê¶‰∏ÄËá¥
            if (password !== passwordConfirm) {
                showAlert('ÂÖ©Ê¨°ÂØÜÁ¢ºËº∏ÂÖ•‰∏ç‰∏ÄËá¥');
                return;
            }

            try {
                // Ê™¢Êü•Áî®Êà∂ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                const { collection, getDocs, query, where } = window.firestoreModules;
                const usersRef = collection(window.firebaseDB, 'users');

                const usernameQuery = query(usersRef, where('username', '==', username));
                const usernameSnapshot = await getDocs(usernameQuery);
                if (!usernameSnapshot.empty) {
                    showAlert('Ê≠§Áî®Êà∂ÂêçÂ∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                // Ê™¢Êü•ÈõªÂ≠êÈÉµ‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®
                const emailQuery = query(usersRef, where('email', '==', email));
                const emailSnapshot = await getDocs(emailQuery);
                if (!emailSnapshot.empty) {
                    showAlert('Ê≠§ÈõªÂ≠êÈÉµ‰ª∂Â∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                // ÁîüÊàêÈ©óË≠âÁ¢º
                const verificationCode = generateVerificationCode();

                // ÁôºÈÄÅÈ©óË≠âÁ¢ºÂà∞Êñ∞Áî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂
                await sendVerificationEmail(email, verificationCode, 'Êñ∞Áî®Êà∂Ë®ªÂÜä');

                // Êö´Â≠òÁî®Êà∂Êï∏ÊìöÂíåÈ©óË≠âÁ¢º
                newUserData = {
                    name,
                    username,
                    email,
                    password,
                    role,
                    status,
                    verificationCode,
                    timestamp: Date.now()
                };

                // ÈóúÈñâÊñ∞Â¢ûÁî®Êà∂ modalÔºåÊâìÈñãÈ©óË≠âÁ¢º modal
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserVerifyEmail').textContent = email;
                document.getElementById('addUserVerifyCode').value = '';
                document.getElementById('addUserVerifyModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞Êñ∞Áî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error in add user process:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        });

        // Confirm add user (verify code and create account)
        window.confirmAddUser = async function() {
            const inputCode = document.getElementById('addUserVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            if (!newUserData) {
                showAlert('È©óË≠âÊï∏ÊìöÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÈñãÂßã');
                closeAddUserVerifyModal();
                return;
            }

            // Ê™¢Êü•È©óË≠âÁ¢ºÊòØÂê¶ÈÅéÊúüÔºà10ÂàÜÈêòÔºâ
            const elapsed = Date.now() - newUserData.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÈñãÂßã');
                closeAddUserVerifyModal();
                newUserData = null;
                return;
            }

            // È©óË≠âÈ©óË≠âÁ¢º
            if (inputCode !== newUserData.verificationCode) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                // ÂâµÂª∫Êñ∞Áî®Êà∂
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'users'), {
                    name: newUserData.name,
                    username: newUserData.username,
                    email: newUserData.email,
                    password: newUserData.password, // Ê≥®ÊÑèÔºöÂØ¶ÈöõÊáâÁî®‰∏≠ÊáâË©≤Âä†ÂØÜÂØÜÁ¢º
                    role: newUserData.role,
                    status: newUserData.status,
                    createdAt: new Date().toISOString()
                });

                showAlert('Êñ∞Áî®Êà∂ÂâµÂª∫ÊàêÂäüÔºÅ');
                closeAddUserVerifyModal();
                newUserData = null;

                // Âà∑Êñ∞Áî®Êà∂ÂàóË°®
                loadUsers();
            } catch (error) {
                console.error('Error creating user:', error);
                showAlert('ÂâµÂª∫Áî®Êà∂ÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // ==================== End Add User Functionality ====================

        // ========================================
        // ÂäüËÉΩÂ¢ûÂº∑ - Ë®™ÂÆ¢Áµ±Ë®à„ÄÅÂúñË°®„ÄÅÈÄöÁü•Á≠â
        // ========================================

        // ÂúñË°®ÈÄ±ÊúüÁãÄÊÖã
        let currentChartPeriod = '7d';

        // Ë®≠ÁΩÆÂúñË°®ÈÄ±Êúü
        window.setChartPeriod = function(period) {
            currentChartPeriod = period;
            document.querySelectorAll('.chart-period-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    btn.classList.add('bg-primary', 'text-white');
                } else {
                    btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                    btn.classList.remove('bg-primary', 'text-white');
                }
            });
            loadVisitorTrendChart();
        };

        // ËºâÂÖ•Ë®™ÂÆ¢Ë∂®Âã¢ÂúñË°®
        async function loadVisitorTrendChart() {
            const container = document.getElementById('visitorTrendChart');
            if (!container) return;

            const days = currentChartPeriod === '7d' ? 7 : 30;
            const data = [];

            try {
                const { collection, query, where, getDocs } = window.firestoreModules;

                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];

                    const q = query(
                        collection(window.firebaseDB, 'visit_history'),
                        where('date', '==', dateStr)
                    );
                    const snapshot = await getDocs(q);
                    data.push({ date: dateStr, count: snapshot.size });
                }

                const maxCount = Math.max(...data.map(d => d.count), 1);

                container.innerHTML = data.map((d, i) => {
                    const height = (d.count / maxCount) * 100;
                    const shortDate = d.date.slice(5); // MM-DD
                    return `
                        <div class="flex flex-col items-center flex-1" title="${d.date}: ${d.count} Ê¨°Ë®™Âïè">
                            <div class="w-full bg-primary/20 rounded-t relative flex-1 flex flex-col justify-end">
                                <div class="bg-primary rounded-t transition-all duration-500" style="height: ${height}%"></div>
                            </div>
                            <span class="text-xs text-gray-500 mt-1 ${days > 7 ? 'hidden md:block' : ''}">${shortDate}</span>
                            <span class="text-xs font-semibold">${d.count}</span>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('ËºâÂÖ•Ë∂®Âã¢ÂúñË°®Â§±Êïó:', error);
                container.innerHTML = '<p class="text-gray-500 text-center w-full">ËºâÂÖ•Â§±Êïó</p>';
            }
        }

        // ËºâÂÖ•Ë®™ÂïèÊôÇÊÆµÂàÜÊûê
        async function loadHourlyChart() {
            const container = document.getElementById('hourlyChart');
            if (!container) return;

            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const today = new Date().toISOString().split('T')[0];
                const hourCounts = new Array(24).fill(0);

                const q = query(
                    collection(window.firebaseDB, 'visit_history'),
                    where('date', '==', today)
                );
                const snapshot = await getDocs(q);

                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.visitedAt) {
                        const hour = new Date(data.visitedAt.seconds * 1000).getHours();
                        hourCounts[hour]++;
                    }
                });

                const maxCount = Math.max(...hourCounts, 1);

                // È°ØÁ§∫ÈõôÂàóÔºà0-11ÊôÇÂíå12-23ÊôÇÔºâ
                container.innerHTML = hourCounts.map((count, hour) => {
                    const height = (count / maxCount) * 100;
                    return `
                        <div class="flex flex-col items-center justify-end h-full" title="${hour}ÊôÇ: ${count} Ê¨°">
                            <div class="w-full bg-blue-500 rounded-t transition-all duration-300" style="height: ${Math.max(height, 5)}%"></div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('ËºâÂÖ•ÊôÇÊÆµÂàÜÊûêÂ§±Êïó:', error);
            }
        }

        // ËºâÂÖ•Ë®≠ÂÇôÁµ±Ë®à
        async function loadDeviceStats() {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'visitors'),
                    where('active', '==', true)
                );
                const snapshot = await getDocs(q);

                let mobile = 0, tablet = 0, desktop = 0;

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const ua = (data.userAgent || '').toLowerCase();

                    if (/ipad|tablet|playbook|silk/i.test(ua)) {
                        tablet++;
                    } else if (/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(ua)) {
                        mobile++;
                    } else {
                        desktop++;
                    }
                });

                document.getElementById('mobileCount').textContent = mobile;
                document.getElementById('tabletCount').textContent = tablet;
                document.getElementById('desktopCount').textContent = desktop;
            } catch (error) {
                console.error('ËºâÂÖ•Ë®≠ÂÇôÁµ±Ë®àÂ§±Êïó:', error);
            }
        }

        // ËºâÂÖ•ÁÆ°ÁêÜÂì°Êìç‰ΩúÊó•Ë™å
        async function loadAdminLogs() {
            const container = document.getElementById('adminLogsContainer');
            if (!container) return;

            try {
                const { collection, query, orderBy, limit, getDocs } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'admin_logs'),
                    orderBy('timestamp', 'desc'),
                    limit(50)
                );
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Êö´ÁÑ°Êìç‰ΩúÊó•Ë™å</p>';
                    return;
                }

                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const log = doc.data();
                    const time = log.timestamp ? new Date(log.timestamp.seconds * 1000).toLocaleString('zh-TW') : 'Êú™Áü•ÊôÇÈñì';
                    const div = document.createElement('div');
                    div.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-sm';
                    div.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-semibold">${log.adminName || 'ÁÆ°ÁêÜÂì°'}</span>
                                <span class="text-gray-600 dark:text-gray-400"> ${log.action || 'Âü∑Ë°åÊìç‰Ωú'}</span>
                            </div>
                            <span class="text-xs text-gray-500">${time}</span>
                        </div>
                        ${log.details ? `<p class="text-gray-500 dark:text-gray-400 text-xs mt-1">${log.details}</p>` : ''}
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('ËºâÂÖ•Êìç‰ΩúÊó•Ë™åÂ§±Êïó:', error);
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ËºâÂÖ•Â§±Êïó</p>';
            }
        }
        window.loadAdminLogs = loadAdminLogs;

        // Ë®òÈåÑÁÆ°ÁêÜÂì°Êìç‰Ωú
        async function logAdminAction(action, details = '') {
            try {
                const { collection, addDoc } = window.firestoreModules;
                const user = window.firebaseAuth.currentUser;
                await addDoc(collection(window.firebaseDB, 'admin_logs'), {
                    adminId: user?.uid || 'unknown',
                    adminName: user?.displayName || user?.email || 'ÁÆ°ÁêÜÂì°',
                    action: action,
                    details: details,
                    timestamp: new Date()
                });
            } catch (error) {
                console.error('Ë®òÈåÑÊìç‰ΩúÊó•Ë™åÂ§±Êïó:', error);
            }
        }

        // Â∞éÂá∫Ë®™ÂÆ¢Áµ±Ë®à CSV
        window.exportVisitorStats = async function() {
            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'visit_history'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);

                const dateCounts = {};
                snapshot.forEach(doc => {
                    const date = doc.data().date;
                    dateCounts[date] = (dateCounts[date] || 0) + 1;
                });

                let csv = 'Êó•Êúü,Ë®™ÂïèÊ¨°Êï∏\n';
                Object.entries(dateCounts).forEach(([date, count]) => {
                    csv += `${date},${count}\n`;
                });

                downloadCSV(csv, 'visitor_stats.csv');
                logAdminAction('Â∞éÂá∫Ë®™ÂÆ¢Áµ±Ë®à');
                showAlert('Ë®™ÂÆ¢Áµ±Ë®àÂ∑≤Â∞éÂá∫ÔºÅ');
            } catch (error) {
                console.error('Â∞éÂá∫Â§±Êïó:', error);
                showAlert('Â∞éÂá∫Â§±Êïó');
            }
        };

        // Â∞éÂá∫ËÅØÁµ°Ë®äÊÅØ CSV
        window.exportContactMessages = async function() {
            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'contact_submissions'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);

                let csv = 'ÂßìÂêç,ÈõªÈÉµ,‰∏ªÈ°å,Ë®äÊÅØ,ÊôÇÈñì,ÁãÄÊÖã\n';
                snapshot.forEach(doc => {
                    const d = doc.data();
                    const time = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleString('zh-TW') : '';
                    csv += `"${d.name || ''}","${d.email || ''}","${d.subject || ''}","${(d.message || '').replace(/"/g, '""')}","${time}","${d.status || 'unread'}"\n`;
                });

                downloadCSV(csv, 'contact_messages.csv');
                logAdminAction('Â∞éÂá∫ËÅØÁµ°Ë®äÊÅØ');
                showAlert('ËÅØÁµ°Ë®äÊÅØÂ∑≤Â∞éÂá∫ÔºÅ');
            } catch (error) {
                console.error('Â∞éÂá∫Â§±Êïó:', error);
                showAlert('Â∞éÂá∫Â§±Êïó');
            }
        };

        // ‰∏ãËºâ CSV ËºîÂä©ÂáΩÊï∏
        function downloadCSV(content, filename) {
            const blob = new Blob(['\ufeff' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // Ê∏ÖÁêÜËàäÊï∏Êìö
        window.cleanOldData = function() {
            showConfirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁêÜ30Â§©ÂâçÁöÑË®™ÂÆ¢Ë®òÈåÑÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ', async () => {
                try {
                    const { collection, query, where, getDocs, deleteDoc, doc } = window.firestoreModules;
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    const dateStr = thirtyDaysAgo.toISOString().split('T')[0];

                    const q = query(
                        collection(window.firebaseDB, 'visit_history'),
                        where('date', '<', dateStr)
                    );
                    const snapshot = await getDocs(q);

                    let count = 0;
                    const deletePromises = [];
                    snapshot.forEach(docSnap => {
                        deletePromises.push(deleteDoc(doc(window.firebaseDB, 'visit_history', docSnap.id)));
                        count++;
                    });

                    await Promise.all(deletePromises);
                    logAdminAction('Ê∏ÖÁêÜËàäÊï∏Êìö', `Âà™Èô§‰∫Ü ${count} Ê¢ùË®òÈåÑ`);
                    showAlert(`Â∑≤Ê∏ÖÁêÜ ${count} Ê¢ùËàäË®òÈåÑÔºÅ`);
                    loadVisitorStats();
                } catch (error) {
                    console.error('Ê∏ÖÁêÜÂ§±Êïó:', error);
                    showAlert('Ê∏ÖÁêÜÂ§±Êïó');
                }
            });
        };

        // ËºâÂÖ•Êú™ËÆÄË®äÊÅØÊï∏Èáè
        async function loadUnreadContactsCount() {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'contact_submissions'),
                    where('status', '==', 'unread')
                );
                const snapshot = await getDocs(q);
                const count = snapshot.size;

                const badge = document.getElementById('unreadContactsBadge');
                if (badge) {
                    if (count > 0) {
                        badge.textContent = count > 99 ? '99+' : count;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('ËºâÂÖ•Êú™ËÆÄÊï∏ÈáèÂ§±Êïó:', error);
            }
        }

        // ÁôªÂÖ•Â§±ÊïóË®àÊï∏ÔºàÂÆâÂÖ®ÊÄßÔºâ
        let loginAttempts = {};
        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_DURATION = 15 * 60 * 1000; // 15ÂàÜÈêò

        function checkLoginAttempts(email) {
            const now = Date.now();
            const attempts = loginAttempts[email];

            if (attempts && attempts.count >= MAX_LOGIN_ATTEMPTS) {
                const timeLeft = LOCKOUT_DURATION - (now - attempts.lastAttempt);
                if (timeLeft > 0) {
                    const minutes = Math.ceil(timeLeft / 60000);
                    return { blocked: true, message: `ÁôªÂÖ•ÂòóË©¶Ê¨°Êï∏ÈÅéÂ§öÔºåË´ã ${minutes} ÂàÜÈêòÂæåÂÜçË©¶` };
                } else {
                    delete loginAttempts[email];
                }
            }
            return { blocked: false };
        }

        function recordLoginAttempt(email, success) {
            if (success) {
                delete loginAttempts[email];
            } else {
                if (!loginAttempts[email]) {
                    loginAttempts[email] = { count: 0, lastAttempt: 0 };
                }
                loginAttempts[email].count++;
                loginAttempts[email].lastAttempt = Date.now();
            }
        }

        // ÊéíÈöäË®≠ÁΩÆË°®ÂñÆ
        const queueSettingsForm = document.getElementById('queueSettingsForm');
        if (queueSettingsForm) {
            queueSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'queue'), {
                        customMessage: document.getElementById('queueCustomMessage').value,
                        imageUrl: document.getElementById('queueImageUrl').value,
                        waitTimePerPerson: parseInt(document.getElementById('queueWaitTimePerPerson').value) || 2
                    }, { merge: true });

                    logAdminAction('Êõ¥Êñ∞ÊéíÈöäË®≠ÁΩÆ');
                    showAlert('ÊéíÈöäË®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('ÂÑ≤Â≠òÊéíÈöäË®≠ÁΩÆÂ§±Êïó:', error);
                    showAlert('ÂÑ≤Â≠òÂ§±Êïó');
                }
            });
        }

        // ËºâÂÖ•ÊéíÈöäË®≠ÁΩÆ
        async function loadQueueSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const docSnap = await getDoc(doc(window.firebaseDB, 'settings', 'queue'));

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const msgEl = document.getElementById('queueCustomMessage');
                    const imgEl = document.getElementById('queueImageUrl');
                    const timeEl = document.getElementById('queueWaitTimePerPerson');

                    if (msgEl) msgEl.value = data.customMessage || '';
                    if (imgEl) imgEl.value = data.imageUrl || '';
                    if (timeEl) timeEl.value = data.waitTimePerPerson || 2;
                }
            } catch (error) {
                console.error('ËºâÂÖ•ÊéíÈöäË®≠ÁΩÆÂ§±Êïó:', error);
            }
        }

        // Êì¥Â±ï loadVisitorStats ÂáΩÊï∏
        const originalLoadVisitorStats = window.loadVisitorStats || loadVisitorStats;
        window.loadVisitorStats = async function() {
            await originalLoadVisitorStats();
            await loadVisitorTrendChart();
            await loadHourlyChart();
            await loadDeviceStats();
            await loadAdminLogs();
            await loadQueueSettings();
        };

        // ÂàùÂßãÂåñÊôÇËºâÂÖ•Êú™ËÆÄÊï∏Èáè
        setTimeout(() => {
            loadUnreadContactsCount();
            // ÂÆöÊúüÊõ¥Êñ∞Êú™ËÆÄÊï∏Èáè
            setInterval(loadUnreadContactsCount, 30000);
        }, 2000);

        // ========================================
        // Êñ∞ÂäüËÉΩ JavaScript ÂáΩÊï∏
        // ========================================

        // === ÊúÉÂì°Ê™îÊ°àÁ≥ªÁµ± ===
        async function loadMemberProfiles() {
            const listEl = document.getElementById('memberProfilesList');
            if (!listEl) return;
            try {
                const { collection, getDocs } = window.firestoreModules;
                const snapshot = await getDocs(collection(window.firebaseDB, 'users'));
                if (snapshot.empty) {
                    listEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Êö´ÁÑ°ÊúÉÂì°Ë≥áÊñô</p>';
                    return;
                }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const card = document.createElement('div');
                    card.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4 flex items-center space-x-4';
                    card.innerHTML = `
                        <div class="w-14 h-14 rounded-full bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center text-white text-xl font-bold">
                            ${(user.displayName || user.email || '?').charAt(0).toUpperCase()}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold truncate">${user.displayName || 'Êú™Ë®≠ÁΩÆ'}</p>
                            <p class="text-sm text-gray-500 truncate">${user.email || ''}</p>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded text-xs">${user.points || 0} Á©çÂàÜ</span>
                                <span class="px-2 py-0.5 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded text-xs">${user.level || 'ÊôÆÈÄöÊúÉÂì°'}</span>
                            </div>
                        </div>
                        <button onclick="viewMemberDetail('${doc.id}')" class="px-3 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg text-sm">Êü•Áúã</button>
                    `;
                    listEl.appendChild(card);
                });
            } catch (error) {
                console.error('ËºâÂÖ•ÊúÉÂì°Ë≥áÊñôÂ§±Êïó:', error);
                listEl.innerHTML = '<p class="text-red-500 col-span-full text-center py-8">ËºâÂÖ•Â§±Êïó</p>';
            }
        }
        window.searchMembers = function() {
            const query = document.getElementById('memberSearchInput').value.toLowerCase();
            const cards = document.querySelectorAll('#memberProfilesList > div');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) ? '' : 'none';
            });
        };
        window.viewMemberDetail = function(userId) {
            showAlert('ÊúÉÂì°Ë©≥ÊÉÖÂäüËÉΩÈñãÁôº‰∏≠');
        };

        // === Á©çÂàÜÁ≥ªÁµ± ===
        async function loadPointsSystem() {
            try {
                const { collection, getDocs, query, orderBy, limit } = window.firestoreModules;
                // ËºâÂÖ•Á©çÂàÜË¶èÂâá
                const rulesSnapshot = await getDocs(collection(window.firebaseDB, 'points_rules'));
                const rulesEl = document.getElementById('pointsRulesList');
                document.getElementById('pointsRulesCount').textContent = rulesSnapshot.size;
                if (rulesSnapshot.empty) {
                    rulesEl.innerHTML = '<p class="text-gray-500 text-center py-4">Êö´ÁÑ°Á©çÂàÜË¶èÂâáÔºåË´ãÊñ∞Â¢û</p>';
                } else {
                    rulesEl.innerHTML = '';
                    rulesSnapshot.forEach(doc => {
                        const rule = doc.data();
                        const el = document.createElement('div');
                        el.className = 'flex items-center justify-between bg-gray-50 dark:bg-gray-700 rounded-lg p-4';
                        el.innerHTML = `
                            <div>
                                <p class="font-semibold">${rule.name}</p>
                                <p class="text-sm text-gray-500">${rule.description || ''}</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-2xl font-bold text-primary">+${rule.points}</span>
                                <button onclick="deletePointsRule('${doc.id}')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm">Âà™Èô§</button>
                            </div>
                        `;
                        rulesEl.appendChild(el);
                    });
                }
                // ËºâÂÖ•ÊéíË°åÊ¶ú
                const usersQuery = query(collection(window.firebaseDB, 'users'), orderBy('points', 'desc'), limit(10));
                const usersSnapshot = await getDocs(usersQuery);
                const leaderboardEl = document.getElementById('pointsLeaderboard');
                if (usersSnapshot.empty) {
                    leaderboardEl.innerHTML = '<p class="text-gray-500 text-center py-4">Êö´ÁÑ°ÊéíË°åË≥áÊñô</p>';
                } else {
                    leaderboardEl.innerHTML = '';
                    let rank = 1;
                    usersSnapshot.forEach(doc => {
                        const user = doc.data();
                        const el = document.createElement('div');
                        el.className = 'flex items-center justify-between py-2 border-b border-gray-200 dark:border-gray-600 last:border-0';
                        const medals = ['ü•á', 'ü•à', 'ü•â'];
                        el.innerHTML = `
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl w-8">${medals[rank-1] || rank}</span>
                                <span class="font-semibold">${user.displayName || user.email || 'ÂåøÂêçÁî®Êà∂'}</span>
                            </div>
                            <span class="text-xl font-bold text-primary">${user.points || 0}</span>
                        `;
                        leaderboardEl.appendChild(el);
                        rank++;
                    });
                }
            } catch (error) {
                console.error('ËºâÂÖ•Á©çÂàÜÁ≥ªÁµ±Â§±Êïó:', error);
            }
        }
        window.showAddPointsRuleDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÁ©çÂàÜË¶èÂâá</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ë¶èÂâáÂêçÁ®±</label>
                            <input type="text" id="ruleNameInput" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="‰æãÂ¶ÇÔºöÂèÉÂä†Ê¥ªÂãï">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Á©çÂàÜÊï∏Èáè</label>
                            <input type="number" id="rulePointsInput" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="10" min="1">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Ë™™ÊòéÔºàÈÅ∏Â°´Ôºâ</label>
                            <input type="text" id="ruleDescInput" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="Ë¶èÂâáË™™Êòé">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const name = document.getElementById('ruleNameInput').value.trim();
                const points = parseInt(document.getElementById('rulePointsInput').value) || 0;
                const description = document.getElementById('ruleDescInput').value.trim();
                if (!name || points < 1) { showAlert('Ë´ãÂ°´ÂØ´Ë¶èÂâáÂêçÁ®±ÂíåÁ©çÂàÜÊï∏Èáè'); return; }
                try {
                    const { collection, addDoc } = window.firestoreModules;
                    await addDoc(collection(window.firebaseDB, 'points_rules'), { name, points, description, createdAt: new Date() });
                    modal.remove();
                    showAlert('Á©çÂàÜË¶èÂâáÂ∑≤Êñ∞Â¢ûÔºÅ');
                    loadPointsSystem();
                } catch (error) { showAlert('Êñ∞Â¢ûÂ§±ÊïóÔºö' + error.message); }
            };
        };
        window.deletePointsRule = async function(id) {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë¶èÂâáÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'points_rules', id));
                    showAlert('Ë¶èÂâáÂ∑≤Âà™Èô§');
                    loadPointsSystem();
                } catch (error) { showAlert('Âà™Èô§Â§±Êïó'); }
            });
        };

        // === ÊàêÂ∞±ÂæΩÁ´†Á≥ªÁµ± ===
        async function loadAchievements() {
            const listEl = document.getElementById('badgesList');
            if (!listEl) return;
            try {
                const { collection, getDocs } = window.firestoreModules;
                const snapshot = await getDocs(collection(window.firebaseDB, 'badges'));
                if (snapshot.empty) {
                    listEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Êö´ÁÑ°ÂæΩÁ´†ÔºåÈªûÊìä‰∏äÊñπÊåâÈàïÊñ∞Â¢û</p>';
                    return;
                }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const badge = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4 text-center hover:shadow-lg transition-shadow';
                    el.innerHTML = `
                        <div class="text-5xl mb-2">${badge.icon || 'üèÜ'}</div>
                        <p class="font-semibold">${badge.name}</p>
                        <p class="text-xs text-gray-500 mt-1">${badge.condition || ''}</p>
                        <button onclick="deleteBadge('${doc.id}')" class="mt-2 px-2 py-1 bg-red-500 text-white rounded text-xs">Âà™Èô§</button>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) {
                listEl.innerHTML = '<p class="text-red-500 col-span-full text-center py-8">ËºâÂÖ•Â§±Êïó</p>';
            }
        }
        window.showAddBadgeDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÂæΩÁ´†</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂæΩÁ´†ÂúñÁ§∫</label>
                            <input type="text" id="badgeIconInput" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-3xl text-center" placeholder="üèÜ" maxlength="2">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂæΩÁ´†ÂêçÁ®±</label>
                            <input type="text" id="badgeNameInput" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="Ê¥ªË∫çÊúÉÂì°">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Áç≤ÂæóÊ¢ù‰ª∂</label>
                            <input type="text" id="badgeCondInput" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="ÂèÉÂä†10Ê¨°Ê¥ªÂãï">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const icon = document.getElementById('badgeIconInput').value || 'üèÜ';
                const name = document.getElementById('badgeNameInput').value.trim();
                const condition = document.getElementById('badgeCondInput').value.trim();
                if (!name) { showAlert('Ë´ãÂ°´ÂØ´ÂæΩÁ´†ÂêçÁ®±'); return; }
                try {
                    const { collection, addDoc } = window.firestoreModules;
                    await addDoc(collection(window.firebaseDB, 'badges'), { icon, name, condition, createdAt: new Date() });
                    modal.remove();
                    showAlert('ÂæΩÁ´†Â∑≤Êñ∞Â¢ûÔºÅ');
                    loadAchievements();
                } catch (error) { showAlert('Êñ∞Â¢ûÂ§±Êïó'); }
            };
        };
        window.deleteBadge = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ê≠§ÂæΩÁ´†Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'badges', id));
                showAlert('Â∑≤Âà™Èô§');
                loadAchievements();
            });
        };

        // === Ê¥ªÂãïÂ†±ÂêçÁ≥ªÁµ± ===
        async function loadEventRegistrations() {
            const listEl = document.getElementById('registrationEventsList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'event_registrations'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°Â†±ÂêçÊ¥ªÂãï</p>';
                    return;
                }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const event = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4';
                    const registered = event.registeredCount || 0;
                    const limit = event.limit || 0;
                    const percentage = limit > 0 ? Math.min((registered / limit) * 100, 100) : 0;
                    el.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-lg">${event.title}</h3>
                                <p class="text-sm text-gray-500">${event.date || ''} | ${event.location || ''}</p>
                            </div>
                            <span class="px-3 py-1 ${event.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full text-xs font-semibold">
                                ${event.active ? 'ÈñãÊîæÂ†±Âêç' : 'Â∑≤ÁµêÊùü'}
                            </span>
                        </div>
                        <div class="mb-2">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Â†±Âêç‰∫∫Êï∏</span>
                                <span>${registered} / ${limit || 'ÁÑ°ÈôêÂà∂'}</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                <div class="bg-primary h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button onclick="viewRegistrations('${doc.id}')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm">Êü•ÁúãÂ†±Âêç</button>
                            <button onclick="deleteEventRegistration('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) {
                listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>';
            }
        }
        window.showCreateRegistrationDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÂ†±ÂêçÊ¥ªÂãï</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÂêçÁ®±</label><input type="text" id="regEventTitle" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"></div>
                        <div><label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊó•Êúü</label><input type="date" id="regEventDate" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"></div>
                        <div><label class="block text-sm font-semibold mb-2">Âú∞Èªû</label><input type="text" id="regEventLocation" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"></div>
                        <div><label class="block text-sm font-semibold mb-2">‰∫∫Êï∏‰∏äÈôêÔºà0=ÁÑ°ÈôêÂà∂Ôºâ</label><input type="number" id="regEventLimit" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" value="0" min="0"></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const title = document.getElementById('regEventTitle').value.trim();
                const date = document.getElementById('regEventDate').value;
                const location = document.getElementById('regEventLocation').value.trim();
                const limit = parseInt(document.getElementById('regEventLimit').value) || 0;
                if (!title) { showAlert('Ë´ãÂ°´ÂØ´Ê¥ªÂãïÂêçÁ®±'); return; }
                try {
                    const { collection, addDoc } = window.firestoreModules;
                    await addDoc(collection(window.firebaseDB, 'event_registrations'), { title, date, location, limit, registeredCount: 0, active: true, createdAt: new Date() });
                    modal.remove();
                    showAlert('Â†±ÂêçÊ¥ªÂãïÂ∑≤Âª∫Á´ãÔºÅ');
                    loadEventRegistrations();
                } catch (error) { showAlert('Êñ∞Â¢ûÂ§±Êïó'); }
            };
        };
        window.viewRegistrations = function(id) { showAlert('Êü•ÁúãÂ†±ÂêçÂêçÂñÆÂäüËÉΩÈñãÁôº‰∏≠'); };
        window.deleteEventRegistration = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ê≠§Â†±ÂêçÊ¥ªÂãïÔºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'event_registrations', id));
                showAlert('Â∑≤Âà™Èô§');
                loadEventRegistrations();
            });
        };

        // === QR Code Á∞ΩÂà∞ ===
        let currentCalendarDate = new Date();
        window.generateQRCode = async function() {
            const eventId = document.getElementById('qrEventSelect').value;
            if (!eventId) { showAlert('Ë´ãÂÖàÈÅ∏ÊìáÊ¥ªÂãï'); return; }
            const qrData = `CHECKIN:${eventId}:${Date.now()}`;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrData)}`;
            document.getElementById('qrCodeDisplay').innerHTML = `<img src="${qrUrl}" alt="QR Code" class="mx-auto">`;
        };
        let currentQREventId = null;
        let qrRefreshInterval = null;
        let qrEventsData = {};

        async function loadQREvents() {
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'activities'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                const select = document.getElementById('qrEventSelect');
                if (select) {
                    select.innerHTML = '<option value="">-- Ë´ãÈÅ∏ÊìáÊ¥ªÂãï --</option>';
                    qrEventsData = {};
                    snapshot.forEach(doc => {
                        const act = doc.data();
                        const title = act.title?.zhTW || act.title?.en || 'Êú™ÂëΩÂêçÊ¥ªÂãï';
                        const dateStr = act.date?.seconds ? new Date(act.date.seconds * 1000).toLocaleDateString('zh-TW') : '';
                        qrEventsData[doc.id] = { ...act, id: doc.id, title };
                        select.innerHTML += `<option value="${doc.id}">${title} ${dateStr ? '(' + dateStr + ')' : ''}</option>`;
                    });
                }
            } catch (e) { console.error(e); }
        }

        window.refreshQREvents = function() {
            loadQREvents();
            showAlert('Ê¥ªÂãïÂàóË°®Â∑≤Âà∑Êñ∞ÔºÅ');
        };

        window.generateQRCodeForEvent = async function() {
            const select = document.getElementById('qrEventSelect');
            const eventId = select.value;
            const display = document.getElementById('qrCodeDisplay');
            const hint = document.getElementById('qrCodeHint');
            const actions = document.getElementById('qrCodeActions');
            const eventInfo = document.getElementById('selectedEventInfo');

            if (!eventId) {
                display.innerHTML = `<div class="w-48 h-48 flex items-center justify-center text-gray-400">
                    <div class="text-center">
                        <svg class="w-16 h-16 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                        </svg>
                        <p class="text-sm">Ë´ãÈÅ∏ÊìáÊ¥ªÂãï</p>
                    </div>
                </div>`;
                hint.textContent = 'ÈÅ∏ÊìáÊ¥ªÂãïÂæåËá™ÂãïÁîüÊàêÁ∞ΩÂà∞Á¢º';
                actions.classList.add('hidden');
                eventInfo.classList.add('hidden');
                currentQREventId = null;
                clearQRStats();
                return;
            }

            currentQREventId = eventId;
            const eventData = qrEventsData[eventId];
            const checkinUrl = `${window.location.origin}/checkin?event=${eventId}&t=${Date.now()}`;
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(checkinUrl)}`;

            display.innerHTML = `<img src="${qrApiUrl}" alt="QR Code" class="w-48 h-48" id="qrCodeImage">`;
            hint.innerHTML = `<span class="text-green-600">‚úì QR Code Â∑≤ÁîüÊàê</span><br><span class="text-xs">${eventData?.title || 'Ê¥ªÂãï'}</span>`;
            actions.classList.remove('hidden');
            eventInfo.classList.remove('hidden');

            // Êõ¥Êñ∞Ê¥ªÂãïË≥áË®ä
            document.getElementById('qrEventName').textContent = eventData?.title || '-';
            document.getElementById('qrEventDate').textContent = eventData?.date?.seconds ? new Date(eventData.date.seconds * 1000).toLocaleDateString('zh-TW') : '-';

            // ËºâÂÖ•Á∞ΩÂà∞Ë®òÈåÑÂíåÁµ±Ë®à
            await loadCheckinRecords(eventId);

            // Ë®≠ÂÆöËá™ÂãïÂà∑Êñ∞
            if (qrRefreshInterval) clearInterval(qrRefreshInterval);
            const autoRefresh = document.getElementById('qrAutoRefresh');
            if (autoRefresh && autoRefresh.checked) {
                qrRefreshInterval = setInterval(() => loadCheckinRecords(eventId), 30000);
            }
        };

        async function loadCheckinRecords(eventId) {
            const container = document.getElementById('checkinRecordsList');
            try {
                const { collection, getDocs, query, where, orderBy } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'checkin_records'),
                    where('eventId', '==', eventId),
                    orderBy('checkinTime', 'desc')
                );
                const snapshot = await getDocs(q);

                let present = 0, late = 0;
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">Â∞öÁÑ°Á∞ΩÂà∞Ë®òÈåÑ</p>';
                } else {
                    container.innerHTML = snapshot.docs.map(doc => {
                        const d = doc.data();
                        const time = d.checkinTime?.seconds ? new Date(d.checkinTime.seconds * 1000).toLocaleTimeString('zh-TW') : '-';
                        if (d.status === 'late') late++; else present++;
                        const statusBadge = d.status === 'late' ? '<span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded">ÈÅ≤Âà∞</span>' : '<span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">Ê∫ñÊôÇ</span>';
                        return `<div class="flex items-center justify-between p-2 bg-white dark:bg-gray-800 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-primary/20 rounded-full flex items-center justify-center text-primary font-bold text-sm">${(d.memberName || '?')[0]}</div>
                                <div><p class="font-medium text-sm">${d.memberName || 'Êú™Áü•'}</p><p class="text-xs text-gray-500">${time}</p></div>
                            </div>
                            ${statusBadge}
                        </div>`;
                    }).join('');
                }

                // Êõ¥Êñ∞Áµ±Ë®à
                document.getElementById('qrStatPresent').textContent = present;
                document.getElementById('qrStatLate').textContent = late;
                document.getElementById('qrCheckinCount').textContent = present + late;

                // ÂèñÂæóÂ†±Âêç‰∫∫Êï∏
                const regQuery = query(collection(window.firebaseDB, 'event_registrations'), where('eventId', '==', eventId));
                const regSnapshot = await getDocs(regQuery);
                const total = regSnapshot.size;
                document.getElementById('qrStatTotal').textContent = total;
                document.getElementById('qrStatAbsent').textContent = Math.max(0, total - present - late);

            } catch (error) {
                console.error('Error loading checkin records:', error);
                container.innerHTML = '<p class="text-red-500 text-center py-4">ËºâÂÖ•Â§±Êïó</p>';
            }
        }

        function clearQRStats() {
            document.getElementById('qrStatPresent').textContent = '0';
            document.getElementById('qrStatLate').textContent = '0';
            document.getElementById('qrStatAbsent').textContent = '0';
            document.getElementById('qrStatTotal').textContent = '0';
            document.getElementById('qrCheckinCount').textContent = '0';
            document.getElementById('checkinRecordsList').innerHTML = '<p class="text-gray-500 text-center py-8">ÈÅ∏ÊìáÊ¥ªÂãïÂæåÈ°ØÁ§∫Ë®òÈåÑ</p>';
        }

        window.downloadQRCode = function() {
            const img = document.getElementById('qrCodeImage');
            if (!img) { showAlert('Ë´ãÂÖàÁîüÊàê QR Code'); return; }
            const a = document.createElement('a');
            a.href = img.src;
            a.download = `checkin_qr_${currentQREventId || 'event'}.png`;
            a.click();
        };

        window.copyCheckinLink = function() {
            if (!currentQREventId) { showAlert('Ë´ãÂÖàÈÅ∏ÊìáÊ¥ªÂãï'); return; }
            const link = `${window.location.origin}/checkin?event=${currentQREventId}`;
            navigator.clipboard.writeText(link).then(() => {
                showAlert('Á∞ΩÂà∞ÈÄ£ÁµêÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
            }).catch(() => {
                showAlert('Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïË§áË£Ω');
            });
        };

        window.printQRCode = function() {
            const img = document.getElementById('qrCodeImage');
            if (!img) { showAlert('Ë´ãÂÖàÁîüÊàê QR Code'); return; }
            const eventData = qrEventsData[currentQREventId] || {};
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html><head><title>Á∞ΩÂà∞ QR Code</title>
                <style>body{font-family:sans-serif;text-align:center;padding:40px;}h1{color:#5D5CDE;}img{margin:20px auto;}</style>
                </head><body>
                <h1>üì± Ê¥ªÂãïÁ∞ΩÂà∞</h1>
                <h2>${eventData.title || 'Ê¥ªÂãï'}</h2>
                <img src="${img.src}" width="300" height="300">
                <p>Ë´ãÊéÉÊèè QR Code ÈÄ≤Ë°åÁ∞ΩÂà∞</p>
                <p style="color:#888;font-size:12px;">ÁßëÊäÄÂ≠∏ÊúÉ</p>
                <script>window.print();window.close();</script>
                </body></html>
            `);
        };

        window.exportCheckinRecords = async function() {
            if (!currentQREventId) { showAlert('Ë´ãÂÖàÈÅ∏ÊìáÊ¥ªÂãï'); return; }
            try {
                const { collection, getDocs, query, where, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'checkin_records'), where('eventId', '==', currentQREventId), orderBy('checkinTime', 'desc'));
                const snapshot = await getDocs(q);
                const data = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return {
                        ÂßìÂêç: d.memberName || '',
                        ÊôÇÈñì: d.checkinTime?.seconds ? new Date(d.checkinTime.seconds * 1000).toLocaleString('zh-TW') : '',
                        ÁãÄÊÖã: d.status === 'late' ? 'ÈÅ≤Âà∞' : 'Ê∫ñÊôÇ'
                    };
                });
                const csv = '\ufeffÂßìÂêç,ÊôÇÈñì,ÁãÄÊÖã\n' + data.map(r => `${r.ÂßìÂêç},${r.ÊôÇÈñì},${r.ÁãÄÊÖã}`).join('\n');
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `checkin_${currentQREventId}_${new Date().toISOString().slice(0,10)}.csv`;
                a.click(); URL.revokeObjectURL(url);
                showAlert('ÂåØÂá∫ÂÆåÊàêÔºÅ');
            } catch (error) { showAlert('ÂåØÂá∫Â§±Êïó'); }
        };

        // === Ë°å‰∫ãÊõÜ ===
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const display = document.getElementById('currentMonthDisplay');
            if (!grid || !display) return;
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            display.textContent = `${year}Âπ¥${month + 1}Êúà`;
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            grid.innerHTML = '';
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += '<div class="p-2"></div>';
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
                grid.innerHTML += `
                    <div class="p-2 text-center rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${isToday ? 'bg-primary text-white' : ''}">
                        ${day}
                    </div>
                `;
            }
        }
        window.prevMonth = function() { currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1); renderCalendar(); };
        window.nextMonth = function() { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1); renderCalendar(); };

        // === ÊäïÁ•®Á≥ªÁµ± ===
        async function loadPolls() {
            const listEl = document.getElementById('pollsList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'polls'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°ÊäïÁ•®</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const poll = doc.data();
                    const totalVotes = (poll.options || []).reduce((sum, opt) => sum + (opt.votes || 0), 0);
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4';
                    el.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-bold text-lg">${poll.question}</h3>
                            <span class="px-3 py-1 ${poll.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full text-xs">${poll.active ? 'ÈÄ≤Ë°å‰∏≠' : 'Â∑≤ÁµêÊùü'}</span>
                        </div>
                        <div class="space-y-2 mb-3">
                            ${(poll.options || []).map(opt => `
                                <div class="flex items-center">
                                    <span class="w-24 text-sm truncate">${opt.text}</span>
                                    <div class="flex-1 mx-2 bg-gray-200 dark:bg-gray-600 rounded-full h-4">
                                        <div class="bg-primary h-4 rounded-full" style="width: ${totalVotes > 0 ? (opt.votes / totalVotes * 100) : 0}%"></div>
                                    </div>
                                    <span class="text-sm w-12 text-right">${opt.votes || 0}Á•®</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button onclick="togglePoll('${doc.id}', ${!poll.active})" class="px-3 py-1 ${poll.active ? 'bg-yellow-500' : 'bg-green-500'} text-white rounded text-sm">${poll.active ? 'ÁµêÊùü' : 'ÈñãÂïü'}</button>
                            <button onclick="deletePoll('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreatePollDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÊäïÁ•®</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">ÊäïÁ•®ÂïèÈ°å</label><input type="text" id="pollQuestion" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"></div>
                        <div><label class="block text-sm font-semibold mb-2">ÈÅ∏È†ÖÔºàÊØèË°å‰∏ÄÂÄãÔºâ</label><textarea id="pollOptions" rows="4" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" placeholder="ÈÅ∏È†ÖA\nÈÅ∏È†ÖB\nÈÅ∏È†ÖC"></textarea></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const question = document.getElementById('pollQuestion').value.trim();
                const optionsText = document.getElementById('pollOptions').value.trim();
                if (!question || !optionsText) { showAlert('Ë´ãÂ°´ÂØ´ÂïèÈ°åÂíåÈÅ∏È†Ö'); return; }
                const options = optionsText.split('\n').filter(o => o.trim()).map(text => ({ text: text.trim(), votes: 0 }));
                try {
                    const { collection, addDoc } = window.firestoreModules;
                    await addDoc(collection(window.firebaseDB, 'polls'), { question, options, active: true, createdAt: new Date() });
                    modal.remove();
                    showAlert('ÊäïÁ•®Â∑≤Âª∫Á´ãÔºÅ');
                    loadPolls();
                } catch (error) { showAlert('Êñ∞Â¢ûÂ§±Êïó'); }
            };
        };
        window.togglePoll = async function(id, active) {
            const { doc, updateDoc } = window.firestoreModules;
            await updateDoc(doc(window.firebaseDB, 'polls', id), { active });
            loadPolls();
        };
        window.deletePoll = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ê≠§ÊäïÁ•®Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'polls', id));
                loadPolls();
            });
        };

        // === ÂïèÂç∑Ë™øÊü• ===
        async function loadSurveys() {
            const listEl = document.getElementById('surveysList');
            if (!listEl) return;
            try {
                const { collection, getDocs } = window.firestoreModules;
                const snapshot = await getDocs(collection(window.firebaseDB, 'surveys'));
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°ÂïèÂç∑</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const survey = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4 flex justify-between items-center';
                    el.innerHTML = `
                        <div>
                            <h3 class="font-bold">${survey.title}</h3>
                            <p class="text-sm text-gray-500">${survey.responses || 0} ‰ªΩÂõûË¶Ü</p>
                        </div>
                        <button onclick="deleteSurvey('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm">Âà™Èô§</button>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateSurveyDialog = function() { showAlert('ÂïèÂç∑Âª∫Á´ãÂäüËÉΩÈñãÁôº‰∏≠'); };
        window.deleteSurvey = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'surveys', id));
                loadSurveys();
            });
        };

        // === Ë≥áÊ∫êÈ†êÁ¥Ñ ===
        async function loadResources() {
            const listEl = document.getElementById('resourcesList');
            if (!listEl) return;
            try {
                const { collection, getDocs } = window.firestoreModules;
                const snapshot = await getDocs(collection(window.firebaseDB, 'resources'));
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Êö´ÁÑ°ÂèØÈ†êÁ¥ÑË≥áÊ∫ê</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const res = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4';
                    el.innerHTML = `
                        <div class="text-4xl mb-2">${res.icon || 'üè¢'}</div>
                        <h3 class="font-bold">${res.name}</h3>
                        <p class="text-sm text-gray-500">${res.description || ''}</p>
                        <div class="mt-3 flex justify-between">
                            <span class="px-2 py-1 ${res.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} rounded text-xs">${res.available ? 'ÂèØÈ†êÁ¥Ñ' : 'Â∑≤È†êÁ¥Ñ'}</span>
                            <button onclick="deleteResource('${doc.id}')" class="text-red-500 text-sm">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 col-span-full text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddResourceDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûË≥áÊ∫ê</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">ÂúñÁ§∫</label><input type="text" id="resIcon" class="w-full px-4 py-2 rounded-lg border text-3xl text-center" placeholder="üè¢" maxlength="2"></div>
                        <div><label class="block text-sm font-semibold mb-2">ÂêçÁ®±</label><input type="text" id="resName" class="w-full px-4 py-2 rounded-lg border" placeholder="ÊúÉË≠∞ÂÆ§A"></div>
                        <div><label class="block text-sm font-semibold mb-2">Ë™™Êòé</label><input type="text" id="resDesc" class="w-full px-4 py-2 rounded-lg border" placeholder="ÂèØÂÆπÁ¥ç10‰∫∫"></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const icon = document.getElementById('resIcon').value || 'üè¢';
                const name = document.getElementById('resName').value.trim();
                const description = document.getElementById('resDesc').value.trim();
                if (!name) { showAlert('Ë´ãÂ°´ÂØ´ÂêçÁ®±'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'resources'), { icon, name, description, available: true });
                modal.remove();
                loadResources();
            };
        };
        window.deleteResource = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'resources', id));
                loadResources();
            });
        };

        // === ÈÄöÁü•‰∏≠ÂøÉ ===
        async function loadNotifications() {
            const listEl = document.getElementById('notificationsList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'notifications'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°ÈÄöÁü•</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const notif = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-4 flex items-start space-x-3';
                    el.innerHTML = `
                        <div class="text-2xl">${notif.icon || 'üîî'}</div>
                        <div class="flex-1">
                            <h4 class="font-semibold">${notif.title}</h4>
                            <p class="text-sm text-gray-500">${notif.message}</p>
                            <p class="text-xs text-gray-400 mt-1">${notif.createdAt?.seconds ? new Date(notif.createdAt.seconds * 1000).toLocaleString('zh-TW') : ''}</p>
                        </div>
                        <button onclick="deleteNotification('${doc.id}')" class="text-red-500 text-sm">Âà™Èô§</button>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showSendNotificationDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">ÁôºÈÄÅÈÄöÁü•</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">Ê®ôÈ°å</label><input type="text" id="notifTitle" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">ÂÖßÂÆπ</label><textarea id="notifMessage" rows="3" class="w-full px-4 py-2 rounded-lg border"></textarea></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">ÁôºÈÄÅ</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const title = document.getElementById('notifTitle').value.trim();
                const message = document.getElementById('notifMessage').value.trim();
                if (!title) { showAlert('Ë´ãÂ°´ÂØ´Ê®ôÈ°å'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'notifications'), { title, message, icon: 'üîî', createdAt: new Date() });
                modal.remove();
                showAlert('ÈÄöÁü•Â∑≤ÁôºÈÄÅÔºÅ');
                loadNotifications();
            };
        };
        window.filterNotifications = function(type) { showAlert('ÁØ©ÈÅ∏ÂäüËÉΩÈñãÁôº‰∏≠'); };
        window.deleteNotification = async function(id) {
            const { doc, deleteDoc } = window.firestoreModules;
            await deleteDoc(doc(window.firebaseDB, 'notifications', id));
            loadNotifications();
        };

        // === Ë®éË´ñÂçÄ ===
        async function loadForum() {
            const listEl = document.getElementById('forumTopicsList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'forum_topics'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°Ë®éË´ñ‰∏ªÈ°å</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const topic = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4';
                    el.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold">${topic.title}</h3>
                                <p class="text-sm text-gray-500">Áî± ${topic.author || 'ÂåøÂêç'} ÁôºËµ∑ | ${topic.replies || 0} ÂâáÂõûË¶Ü</p>
                            </div>
                            <button onclick="deleteForumTopic('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateTopicDialog = function() { showAlert('‰∏ªÈ°åÂª∫Á´ãÂäüËÉΩÈñãÁôº‰∏≠'); };
        window.deleteForumTopic = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'forum_topics', id));
                loadForum();
            });
        };

        // === Ê¥ªÂãïÁõ∏Á∞ø ===
        async function loadPhotoGallery() {
            const listEl = document.getElementById('albumsList');
            if (!listEl) return;
            try {
                const { collection, getDocs } = window.firestoreModules;
                const snapshot = await getDocs(collection(window.firebaseDB, 'albums'));
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Êö´ÁÑ°Áõ∏Á∞ø</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const album = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-100 dark:bg-gray-700 rounded-xl overflow-hidden cursor-pointer hover:shadow-lg transition-shadow';
                    el.innerHTML = `
                        <div class="aspect-square bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center text-white text-4xl">${album.cover ? `<img src="${album.cover}" class="w-full h-full object-cover">` : 'üì∑'}</div>
                        <div class="p-3">
                            <h4 class="font-semibold truncate">${album.name}</h4>
                            <p class="text-xs text-gray-500">${album.photoCount || 0} ÂºµÁÖßÁâá</p>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 col-span-full text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateAlbumDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÁõ∏Á∞ø</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">Áõ∏Á∞øÂêçÁ®±</label><input type="text" id="albumName" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">Â∞ÅÈù¢ÂúñÁâáURLÔºàÈÅ∏Â°´Ôºâ</label><input type="url" id="albumCover" class="w-full px-4 py-2 rounded-lg border"></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const name = document.getElementById('albumName').value.trim();
                const cover = document.getElementById('albumCover').value.trim();
                if (!name) { showAlert('Ë´ãÂ°´ÂØ´Áõ∏Á∞øÂêçÁ®±'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'albums'), { name, cover, photoCount: 0, createdAt: new Date() });
                modal.remove();
                loadPhotoGallery();
            };
        };

        // === ÂππÈÉ®ÁÆ°ÁêÜ ===
        async function loadExecutives() {
            const listEl = document.getElementById('executivesList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'executives'), orderBy('order', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°ÂππÈÉ®Ë≥áÊñô</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const exec = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4 flex items-center space-x-4';
                    el.innerHTML = `
                        <div class="w-14 h-14 rounded-full bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center text-white text-xl font-bold">
                            ${(exec.name || '?').charAt(0)}
                        </div>
                        <div class="flex-1">
                            <p class="font-bold">${exec.name}</p>
                            <p class="text-sm text-primary">${exec.position}</p>
                            <p class="text-xs text-gray-500">${exec.term || ''}</p>
                        </div>
                        <button onclick="deleteExecutive('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm">Âà™Èô§</button>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddExecutiveDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÂππÈÉ®</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">ÂßìÂêç</label><input type="text" id="execName" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">ËÅ∑‰Ωç</label><input type="text" id="execPosition" class="w-full px-4 py-2 rounded-lg border" placeholder="‰∏ªÂ∏≠ / ÂâØ‰∏ªÂ∏≠ / Âππ‰∫ã..."></div>
                        <div><label class="block text-sm font-semibold mb-2">‰ªªÊúü</label><input type="text" id="execTerm" class="w-full px-4 py-2 rounded-lg border" placeholder="2024-2025"></div>
                        <div><label class="block text-sm font-semibold mb-2">ÊéíÂ∫èÔºàÊï∏Â≠óË∂äÂ∞èË∂äÂâçÔºâ</label><input type="number" id="execOrder" class="w-full px-4 py-2 rounded-lg border" value="1" min="1"></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const name = document.getElementById('execName').value.trim();
                const position = document.getElementById('execPosition').value.trim();
                const term = document.getElementById('execTerm').value.trim();
                const order = parseInt(document.getElementById('execOrder').value) || 1;
                if (!name || !position) { showAlert('Ë´ãÂ°´ÂØ´ÂßìÂêçÂíåËÅ∑‰Ωç'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'executives'), { name, position, term, order, createdAt: new Date() });
                modal.remove();
                loadExecutives();
            };
        };
        window.deleteExecutive = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'executives', id));
                loadExecutives();
            });
        };

        // === Ë≤°ÂãôÁÆ°ÁêÜ ===
        async function loadFinance() {
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'transactions'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                let totalIncome = 0, totalExpense = 0;
                const listEl = document.getElementById('transactionsList');
                if (snapshot.empty) {
                    listEl.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Êö´ÁÑ°‰∫§ÊòìË®òÈåÑ</td></tr>';
                } else {
                    listEl.innerHTML = '';
                    snapshot.forEach(doc => {
                        const tx = doc.data();
                        if (tx.type === 'income') totalIncome += tx.amount || 0;
                        else totalExpense += tx.amount || 0;
                        listEl.innerHTML += `
                            <tr class="border-b border-gray-100 dark:border-gray-700">
                                <td class="px-4 py-3">${tx.date || ''}</td>
                                <td class="px-4 py-3">${tx.description || ''}</td>
                                <td class="px-4 py-3"><span class="px-2 py-1 ${tx.type === 'income' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} rounded text-xs">${tx.type === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}</span></td>
                                <td class="px-4 py-3 text-right ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}">${tx.type === 'income' ? '+' : '-'}$${tx.amount || 0}</td>
                                <td class="px-4 py-3 text-center"><button onclick="deleteTransaction('${doc.id}')" class="text-red-500 text-sm">Âà™Èô§</button></td>
                            </tr>
                        `;
                    });
                }
                document.getElementById('totalIncome').textContent = `$${totalIncome.toLocaleString()}`;
                document.getElementById('totalExpense').textContent = `$${totalExpense.toLocaleString()}`;
                document.getElementById('totalBalance').textContent = `$${(totalIncome - totalExpense).toLocaleString()}`;
            } catch (error) { console.error(error); }
        }
        window.showAddTransactionDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢û‰∫§Êòì</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">È°ûÂûã</label><select id="txType" class="w-full px-4 py-2 rounded-lg border"><option value="income">Êî∂ÂÖ•</option><option value="expense">ÊîØÂá∫</option></select></div>
                        <div><label class="block text-sm font-semibold mb-2">Êó•Êúü</label><input type="date" id="txDate" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">Ë™™Êòé</label><input type="text" id="txDesc" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">ÈáëÈ°ç</label><input type="number" id="txAmount" class="w-full px-4 py-2 rounded-lg border" min="0"></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const type = document.getElementById('txType').value;
                const date = document.getElementById('txDate').value;
                const description = document.getElementById('txDesc').value.trim();
                const amount = parseFloat(document.getElementById('txAmount').value) || 0;
                if (!date || amount <= 0) { showAlert('Ë´ãÂ°´ÂØ´Êó•ÊúüÂíåÈáëÈ°ç'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'transactions'), { type, date, description, amount, createdAt: new Date() });
                modal.remove();
                loadFinance();
            };
        };
        window.deleteTransaction = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'transactions', id));
                loadFinance();
            });
        };

        // === Ë®™ÂÆ¢ÁïôË®ÄÊùø ===
        async function loadGuestbook() {
            const listEl = document.getElementById('guestbookList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'guestbook'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°ÁïôË®Ä</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const msg = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4';
                    el.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="font-semibold">${msg.name || 'Ë®™ÂÆ¢'}</span>
                                <span class="text-xs text-gray-500 ml-2">${msg.createdAt?.seconds ? new Date(msg.createdAt.seconds * 1000).toLocaleString('zh-TW') : ''}</span>
                            </div>
                            <span class="px-2 py-1 ${msg.approved ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'} rounded text-xs">${msg.approved ? 'Â∑≤ÈÄöÈÅé' : 'ÂæÖÂØ©Ê†∏'}</span>
                        </div>
                        <p class="text-gray-600 dark:text-gray-300">${msg.message}</p>
                        <div class="flex justify-end space-x-2 mt-2">
                            ${!msg.approved ? `<button onclick="approveGuestbook('${doc.id}')" class="px-3 py-1 bg-green-500 text-white rounded text-sm">ÈÄöÈÅé</button>` : ''}
                            <button onclick="deleteGuestbook('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.filterGuestbook = function(type) { showAlert('ÁØ©ÈÅ∏ÂäüËÉΩÈñãÁôº‰∏≠'); };
        window.approveGuestbook = async function(id) {
            const { doc, updateDoc } = window.firestoreModules;
            await updateDoc(doc(window.firebaseDB, 'guestbook', id), { approved: true });
            loadGuestbook();
        };
        window.deleteGuestbook = async function(id) {
            const { doc, deleteDoc } = window.firestoreModules;
            await deleteDoc(doc(window.firebaseDB, 'guestbook', id));
            loadGuestbook();
        };

        // === Â∏∏Ë¶ãÂïèÈ°å FAQ ===
        async function loadFAQ() {
            const listEl = document.getElementById('faqList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'faq'), orderBy('order', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°Â∏∏Ë¶ãÂïèÈ°å</p>'; return; }
                listEl.innerHTML = '';
                snapshot.forEach(doc => {
                    const faq = doc.data();
                    const el = document.createElement('div');
                    el.className = 'bg-gray-50 dark:bg-gray-700 rounded-xl p-4';
                    el.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold text-primary">Q: ${faq.question}</h4>
                                <p class="text-gray-600 dark:text-gray-300 mt-2">A: ${faq.answer}</p>
                            </div>
                            <button onclick="deleteFAQ('${doc.id}')" class="px-3 py-1 bg-red-500 text-white rounded text-sm ml-4">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddFaqDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÂïèÈ°å</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">ÂïèÈ°å</label><input type="text" id="faqQ" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">Á≠îÊ°à</label><textarea id="faqA" rows="4" class="w-full px-4 py-2 rounded-lg border"></textarea></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const question = document.getElementById('faqQ').value.trim();
                const answer = document.getElementById('faqA').value.trim();
                if (!question || !answer) { showAlert('Ë´ãÂ°´ÂØ´ÂïèÈ°åÂíåÁ≠îÊ°à'); return; }
                const { collection, addDoc, getDocs } = window.firestoreModules;
                const existing = await getDocs(collection(window.firebaseDB, 'faq'));
                await addDoc(collection(window.firebaseDB, 'faq'), { question, answer, order: existing.size + 1, createdAt: new Date() });
                modal.remove();
                loadFAQ();
            };
        };
        window.deleteFAQ = async function(id) {
            showConfirm('Á¢∫ÂÆöÂà™Èô§Ôºü', async () => {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, 'faq', id));
                loadFAQ();
            });
        };

        // === Âø´ÈÄüÁ≠ÜË®ò ===
        async function loadQuickNotes() {
            const listEl = document.getElementById('notesList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const user = window.firebaseAuth.currentUser;
                if (!user) { listEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Ë´ãÂÖàÁôªÂÖ•</p>'; return; }
                const q = query(collection(window.firebaseDB, 'notes'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Êö´ÁÑ°Á≠ÜË®ò</p>'; return; }
                listEl.innerHTML = '';
                const colors = ['bg-yellow-100', 'bg-pink-100', 'bg-blue-100', 'bg-green-100', 'bg-purple-100'];
                let i = 0;
                snapshot.forEach(doc => {
                    const note = doc.data();
                    const el = document.createElement('div');
                    el.className = `${colors[i % colors.length]} dark:bg-opacity-20 rounded-xl p-4 min-h-[150px] flex flex-col`;
                    el.innerHTML = `
                        <div class="flex-1">
                            <h4 class="font-bold mb-2">${note.title || 'ÁÑ°Ê®ôÈ°å'}</h4>
                            <p class="text-sm text-gray-600">${note.content || ''}</p>
                        </div>
                        <div class="flex justify-between items-center mt-2 text-xs text-gray-400">
                            <span>${note.createdAt?.seconds ? new Date(note.createdAt.seconds * 1000).toLocaleDateString('zh-TW') : ''}</span>
                            <button onclick="deleteNote('${doc.id}')" class="text-red-500">Âà™Èô§</button>
                        </div>
                    `;
                    listEl.appendChild(el);
                    i++;
                });
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 col-span-full text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddNoteDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÁ≠ÜË®ò</h3>
                    <div class="space-y-4">
                        <div><label class="block text-sm font-semibold mb-2">Ê®ôÈ°å</label><input type="text" id="noteTitle" class="w-full px-4 py-2 rounded-lg border"></div>
                        <div><label class="block text-sm font-semibold mb-2">ÂÖßÂÆπ</label><textarea id="noteContent" rows="5" class="w-full px-4 py-2 rounded-lg border"></textarea></div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const title = document.getElementById('noteTitle').value.trim();
                const content = document.getElementById('noteContent').value.trim();
                if (!content) { showAlert('Ë´ãÂ°´ÂØ´ÂÖßÂÆπ'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'notes'), { title, content, createdAt: new Date() });
                modal.remove();
                loadQuickNotes();
            };
        };
        window.deleteNote = async function(id) {
            const { doc, deleteDoc } = window.firestoreModules;
            await deleteDoc(doc(window.firebaseDB, 'notes', id));
            loadQuickNotes();
        };

        // === ÂæÖËæ¶‰∫ãÈ†Ö ===
        async function loadTodoList() {
            const listEl = document.getElementById('todoItemsList');
            if (!listEl) return;
            try {
                const { collection, getDocs, query, orderBy } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'todos'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) { listEl.innerHTML = '<p class="text-gray-500 text-center py-8">Êö´ÁÑ°ÂæÖËæ¶‰∫ãÈ†Ö</p>'; updateTodoProgress(0, 0); return; }
                listEl.innerHTML = '';
                let completed = 0, total = 0;
                snapshot.forEach(doc => {
                    const todo = doc.data();
                    total++;
                    if (todo.completed) completed++;
                    const el = document.createElement('div');
                    el.className = `flex items-center space-x-3 p-3 rounded-lg ${todo.completed ? 'bg-green-50 dark:bg-green-900/20' : 'bg-gray-50 dark:bg-gray-700'}`;
                    el.innerHTML = `
                        <input type="checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo('${doc.id}', this.checked)" class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                        <span class="flex-1 ${todo.completed ? 'line-through text-gray-400' : ''}">${todo.text}</span>
                        <button onclick="deleteTodo('${doc.id}')" class="text-red-500 text-sm">Âà™Èô§</button>
                    `;
                    listEl.appendChild(el);
                });
                updateTodoProgress(completed, total);
            } catch (error) { listEl.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        function updateTodoProgress(completed, total) {
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            const progressEl = document.getElementById('todoProgress');
            const barEl = document.getElementById('todoProgressBar');
            if (progressEl) progressEl.textContent = `${percentage}%`;
            if (barEl) barEl.style.width = `${percentage}%`;
        }
        window.showAddTodoDialog = function() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">Êñ∞Â¢ûÂæÖËæ¶</h3>
                    <div><input type="text" id="todoText" class="w-full px-4 py-3 rounded-lg border" placeholder="Ëº∏ÂÖ•ÂæÖËæ¶‰∫ãÈ†Ö..."></div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white rounded">Êñ∞Â¢û</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            modal.querySelector('.confirm-btn').onclick = async () => {
                const text = document.getElementById('todoText').value.trim();
                if (!text) { showAlert('Ë´ãËº∏ÂÖ•ÂæÖËæ¶‰∫ãÈ†Ö'); return; }
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'todos'), { text, completed: false, createdAt: new Date() });
                modal.remove();
                loadTodoList();
            };
        };
        window.toggleTodo = async function(id, completed) {
            const { doc, updateDoc } = window.firestoreModules;
            await updateDoc(doc(window.firebaseDB, 'todos', id), { completed });
            loadTodoList();
        };
        window.deleteTodo = async function(id) {
            const { doc, deleteDoc } = window.firestoreModules;
            await deleteDoc(doc(window.firebaseDB, 'todos', id));
            loadTodoList();
        };

        // === Á∂≠Ë≠∑Ê®°Âºè ===
        async function loadMaintenanceSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const docRef = await getDoc(doc(window.firebaseDB, 'settings', 'maintenance'));
                if (docRef.exists()) {
                    const data = docRef.data();
                    document.getElementById('maintenanceModeToggle').checked = data.enabled || false;
                    document.getElementById('maintenanceMessage').value = data.message || '';
                    if (data.endTime?.seconds) {
                        document.getElementById('maintenanceEndTime').value = new Date(data.endTime.seconds * 1000).toISOString().slice(0, 16);
                    }
                }
            } catch (error) { console.error(error); }
        }
        window.toggleMaintenanceMode = async function() {
            const enabled = document.getElementById('maintenanceModeToggle').checked;
            try {
                const { doc, setDoc } = window.firestoreModules;
                await setDoc(doc(window.firebaseDB, 'settings', 'maintenance'), { enabled }, { merge: true });
                showAlert(enabled ? 'Á∂≠Ë≠∑Ê®°ÂºèÂ∑≤ÂïüÁî®ÔºÅ' : 'Á∂≠Ë≠∑Ê®°ÂºèÂ∑≤ÈóúÈñâ');
            } catch (error) { showAlert('Ë®≠ÁΩÆÂ§±Êïó'); }
        };
        window.saveMaintenanceSettings = async function() {
            const message = document.getElementById('maintenanceMessage').value;
            const endTimeStr = document.getElementById('maintenanceEndTime').value;
            const endTime = endTimeStr ? new Date(endTimeStr) : null;
            try {
                const { doc, setDoc } = window.firestoreModules;
                await setDoc(doc(window.firebaseDB, 'settings', 'maintenance'), { message, endTime }, { merge: true });
                showAlert('Á∂≠Ë≠∑Ë®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
            } catch (error) { showAlert('ÂÑ≤Â≠òÂ§±Êïó'); }
        };

        // === ‰∏ªÈ°åË®≠ÁΩÆ ===
        window.setThemeColor = function(color) {
            document.documentElement.style.setProperty('--color-primary', color);
        };
        window.applyCustomColor = function() {
            const color = document.getElementById('customThemeColor').value;
            setThemeColor(color);
        };
        window.saveThemeSettings = async function() {
            const color = document.getElementById('customThemeColor').value;
            const siteName = document.getElementById('siteNameInput').value.trim();
            try {
                const { doc, setDoc } = window.firestoreModules;
                await setDoc(doc(window.firebaseDB, 'settings', 'theme'), { primaryColor: color, siteName }, { merge: true });
                showAlert('‰∏ªÈ°åË®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
            } catch (error) { showAlert('ÂÑ≤Â≠òÂ§±Êïó'); }
        };

        // === ÈÉµ‰ª∂Ê®°Êùø ===
        async function loadEmailTemplates() {
            const container = document.getElementById('emailTemplatesList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'email_templates'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°ÈÉµ‰ª∂Ê®°Êùø</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                        <div class="flex justify-between items-start">
                            <div><h3 class="font-semibold">${d.name || 'Êú™ÂëΩÂêçÊ®°Êùø'}</h3>
                            <p class="text-sm text-gray-500">${d.subject || ''}</p></div>
                            <div class="flex space-x-2">
                                <button onclick="editEmailTemplate('${doc.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Á∑®ËºØ</button>
                                <button onclick="deleteEmailTemplate('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Âà™Èô§</button>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateEmailTemplateDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÈÉµ‰ª∂Ê®°Êùø', [
                { id: 'tplName', label: 'Ê®°ÊùøÂêçÁ®±', type: 'text', required: true },
                { id: 'tplSubject', label: 'ÈÉµ‰ª∂‰∏ªÊó®', type: 'text', required: true },
                { id: 'tplBody', label: 'ÈÉµ‰ª∂ÂÖßÂÆπ', type: 'textarea', required: true }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'email_templates'), { name: data.tplName, subject: data.tplSubject, body: data.tplBody, createdAt: serverTimestamp() });
                showAlert('Ê®°ÊùøÂ∑≤Âª∫Á´ãÔºÅ'); loadEmailTemplates();
            });
        };
        window.deleteEmailTemplate = async function(id) { await genericDelete('email_templates', id, 'ÈÉµ‰ª∂Ê®°Êùø', loadEmailTemplates); };

        // === Á§æÁæ§ÈÄ£Áµê ===
        async function loadSocialLinks() {
            const container = document.getElementById('socialLinksList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'social_links'), orderBy('order', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-2">Â∞öÁÑ°Á§æÁæ§ÈÄ£Áµê</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const icons = { facebook: 'üìò', instagram: 'üì∑', youtube: 'üé¨', twitter: 'üê¶', discord: 'üí¨', line: 'üíö', website: 'üåê' };
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4 flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${icons[d.platform] || 'üîó'}</span>
                            <div><h3 class="font-semibold">${d.name || d.platform}</h3><p class="text-sm text-gray-500 truncate max-w-[200px]">${d.url}</p></div>
                        </div>
                        <button onclick="deleteSocialLink('${doc.id}')" class="text-red-600 hover:text-red-800">Âà™Èô§</button>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 col-span-2">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddSocialLinkDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÁ§æÁæ§ÈÄ£Áµê', [
                { id: 'slPlatform', label: 'Âπ≥Âè∞', type: 'select', options: ['facebook', 'instagram', 'youtube', 'twitter', 'discord', 'line', 'website'], required: true },
                { id: 'slName', label: 'È°ØÁ§∫ÂêçÁ®±', type: 'text', required: true },
                { id: 'slUrl', label: 'ÈÄ£ÁµêÁ∂≤ÂùÄ', type: 'url', required: true }
            ], async (data) => {
                const { collection, addDoc, getDocs, query: q } = window.firestoreModules;
                const existing = await getDocs(q(collection(window.firebaseDB, 'social_links')));
                await addDoc(collection(window.firebaseDB, 'social_links'), { platform: data.slPlatform, name: data.slName, url: data.slUrl, order: existing.size });
                showAlert('ÈÄ£ÁµêÂ∑≤Êñ∞Â¢ûÔºÅ'); loadSocialLinks();
            });
        };
        window.deleteSocialLink = async function(id) { await genericDelete('social_links', id, 'Á§æÁæ§ÈÄ£Áµê', loadSocialLinks); };

        // === ÊúÉË≠∞Ë®òÈåÑ ===
        async function loadMeetingMinutes() {
            const container = document.getElementById('meetingMinutesList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'meeting_minutes'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°ÊúÉË≠∞Ë®òÈåÑ</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const date = d.date?.seconds ? new Date(d.date.seconds * 1000).toLocaleDateString('zh-TW') : '';
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                        <div class="flex justify-between items-start">
                            <div><h3 class="font-semibold">${d.title || 'Êú™ÂëΩÂêçÊúÉË≠∞'}</h3>
                            <p class="text-sm text-gray-500">üìÖ ${date} | üë• ${d.attendees || 0} ‰∫∫</p></div>
                            <div class="flex space-x-2">
                                <button onclick="viewMeeting('${doc.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Êü•Áúã</button>
                                <button onclick="deleteMeeting('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Âà™Èô§</button>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateMeetingDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÊúÉË≠∞Ë®òÈåÑ', [
                { id: 'mtTitle', label: 'ÊúÉË≠∞Ê®ôÈ°å', type: 'text', required: true },
                { id: 'mtDate', label: 'ÊúÉË≠∞Êó•Êúü', type: 'date', required: true },
                { id: 'mtAttendees', label: 'Âá∫Â∏≠‰∫∫Êï∏', type: 'number', required: true },
                { id: 'mtContent', label: 'ÊúÉË≠∞ÂÖßÂÆπ', type: 'textarea', required: true }
            ], async (data) => {
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'meeting_minutes'), { title: data.mtTitle, date: new Date(data.mtDate), attendees: parseInt(data.mtAttendees), content: data.mtContent });
                showAlert('ÊúÉË≠∞Ë®òÈåÑÂ∑≤Âª∫Á´ãÔºÅ'); loadMeetingMinutes();
            });
        };
        window.viewMeeting = async function(id) {
            const { doc, getDoc } = window.firestoreModules;
            const docSnap = await getDoc(doc(window.firebaseDB, 'meeting_minutes', id));
            if (docSnap.exists()) {
                const d = docSnap.data();
                showInfoDialog('ÊúÉË≠∞Ë®òÈåÑ', `<h3 class="font-bold text-lg mb-2">${d.title}</h3><p class="whitespace-pre-wrap">${d.content}</p>`);
            }
        };
        window.deleteMeeting = async function(id) { await genericDelete('meeting_minutes', id, 'ÊúÉË≠∞Ë®òÈåÑ', loadMeetingMinutes); };

        // === Êñá‰ª∂Â∫´ ===
        async function loadDocumentLibrary() {
            const container = document.getElementById('documentLibraryList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'documents'), orderBy('uploadedAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">Â∞öÁÑ°Êñá‰ª∂</p>';
                    return;
                }
                const icons = { pdf: 'üìÑ', doc: 'üìù', xls: 'üìä', ppt: 'üìä', zip: 'üì¶', img: 'üñºÔ∏è' };
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const ext = (d.filename || '').split('.').pop()?.toLowerCase() || '';
                    const icon = icons[ext] || 'üìé';
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                        <div class="text-3xl mb-2">${icon}</div>
                        <h3 class="font-semibold text-sm truncate">${d.filename || 'Êú™ÂëΩÂêçÊñá‰ª∂'}</h3>
                        <p class="text-xs text-gray-500">${d.category || 'ÂÖ∂‰ªñ'} | ${d.size || '-'}</p>
                        <div class="flex space-x-2 mt-2">
                            <button onclick="deleteDocument('${doc.id}')" class="text-red-600 hover:text-red-800 text-xs">Âà™Èô§</button>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 col-span-3">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showUploadDocumentDialog = function() {
            showGenericFormDialog('‰∏äÂÇ≥Êñá‰ª∂', [
                { id: 'docName', label: 'Êñá‰ª∂ÂêçÁ®±', type: 'text', required: true },
                { id: 'docCategory', label: 'È°ûÂà•', type: 'select', options: ['manual', 'form', 'report', 'other'], required: true },
                { id: 'docUrl', label: 'Êñá‰ª∂ÈÄ£Áµê', type: 'url', required: true }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'documents'), { filename: data.docName, category: data.docCategory, url: data.docUrl, uploadedAt: serverTimestamp() });
                showAlert('Êñá‰ª∂Â∑≤‰∏äÂÇ≥ÔºÅ'); loadDocumentLibrary();
            });
        };
        window.deleteDocument = async function(id) { await genericDelete('documents', id, 'Êñá‰ª∂', loadDocumentLibrary); };

        // === ÊïôÂ≠∏Ë≥áÊ∫ê ===
        async function loadLearningResources() {
            const container = document.getElementById('learningResourcesList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'learning_resources'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">Â∞öÁÑ°ÊïôÂ≠∏Ë≥áÊ∫ê</p>';
                    return;
                }
                const icons = { video: 'üé¨', article: 'üì∞', tutorial: 'üìö', tool: 'üîß' };
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4 resource-item" data-type="${d.type}">
                        <div class="text-2xl mb-2">${icons[d.type] || 'üìñ'}</div>
                        <h3 class="font-semibold">${d.title || 'Êú™ÂëΩÂêç'}</h3>
                        <p class="text-sm text-gray-500 line-clamp-2">${d.description || ''}</p>
                        <div class="flex justify-between items-center mt-3">
                            <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">${d.type}</span>
                            <button onclick="deleteResource('${doc.id}')" class="text-red-600 hover:text-red-800 text-xs">Âà™Èô§</button>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 col-span-3">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddResourceDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÊïôÂ≠∏Ë≥áÊ∫ê', [
                { id: 'resTitle', label: 'Ë≥áÊ∫êÊ®ôÈ°å', type: 'text', required: true },
                { id: 'resType', label: 'È°ûÂûã', type: 'select', options: ['video', 'article', 'tutorial', 'tool'], required: true },
                { id: 'resUrl', label: 'ÈÄ£Áµê', type: 'url', required: true },
                { id: 'resDesc', label: 'ÊèèËø∞', type: 'textarea' }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'learning_resources'), { title: data.resTitle, type: data.resType, url: data.resUrl, description: data.resDesc, createdAt: serverTimestamp() });
                showAlert('Ë≥áÊ∫êÂ∑≤Êñ∞Â¢ûÔºÅ'); loadLearningResources();
            });
        };
        window.filterResources = function(type) {
            document.querySelectorAll('.resource-item').forEach(item => {
                item.style.display = (type === 'all' || item.dataset.type === type) ? 'block' : 'none';
            });
        };
        window.deleteResource = async function(id) { await genericDelete('learning_resources', id, 'ÊïôÂ≠∏Ë≥áÊ∫ê', loadLearningResources); };

        // === Â∞àÊ°àËøΩËπ§ ===
        async function loadProjectTracker() {
            const container = document.getElementById('projectTrackerList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'project_tracker'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                let total = 0, inProgress = 0, completed = 0, pending = 0;
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°Â∞àÊ°à</p>';
                } else {
                    container.innerHTML = snapshot.docs.map(doc => {
                        const d = doc.data();
                        total++;
                        if (d.status === 'in_progress') inProgress++;
                        else if (d.status === 'completed') completed++;
                        else pending++;
                        const statusColors = { pending: 'bg-yellow-100 text-yellow-800', in_progress: 'bg-blue-100 text-blue-800', completed: 'bg-green-100 text-green-800' };
                        const statusLabels = { pending: 'ÂæÖËôïÁêÜ', in_progress: 'ÈÄ≤Ë°å‰∏≠', completed: 'Â∑≤ÂÆåÊàê' };
                        return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                            <div class="flex justify-between items-start">
                                <div class="flex-1"><h3 class="font-semibold">${d.name || 'Êú™ÂëΩÂêçÂ∞àÊ°à'}</h3>
                                <p class="text-sm text-gray-500">${d.description || ''}</p>
                                <div class="mt-2"><div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-primary h-2 rounded-full" style="width: ${d.progress || 0}%"></div></div>
                                <p class="text-xs text-gray-500 mt-1">${d.progress || 0}% ÂÆåÊàê</p></div></div>
                                <div class="flex flex-col items-end space-y-2">
                                    <span class="px-2 py-1 rounded text-xs ${statusColors[d.status] || statusColors.pending}">${statusLabels[d.status] || 'ÂæÖËôïÁêÜ'}</span>
                                    <button onclick="deleteProject('${doc.id}')" class="text-red-600 hover:text-red-800 text-xs">Âà™Èô§</button>
                                </div>
                            </div>
                        </div>`;
                    }).join('');
                }
                document.getElementById('projectsTotal').textContent = total;
                document.getElementById('projectsInProgress').textContent = inProgress;
                document.getElementById('projectsCompleted').textContent = completed;
                document.getElementById('projectsPending').textContent = pending;
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateProjectDialog = function() {
            showGenericFormDialog('Êñ∞Âª∫Â∞àÊ°à', [
                { id: 'projName', label: 'Â∞àÊ°àÂêçÁ®±', type: 'text', required: true },
                { id: 'projDesc', label: 'ÊèèËø∞', type: 'textarea' },
                { id: 'projStatus', label: 'ÁãÄÊÖã', type: 'select', options: ['pending', 'in_progress', 'completed'], required: true },
                { id: 'projProgress', label: 'ÈÄ≤Â∫¶ (%)', type: 'number', required: true }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'project_tracker'), { name: data.projName, description: data.projDesc, status: data.projStatus, progress: parseInt(data.projProgress), createdAt: serverTimestamp() });
                showAlert('Â∞àÊ°àÂ∑≤Âª∫Á´ãÔºÅ'); loadProjectTracker();
            });
        };
        window.deleteProject = async function(id) { await genericDelete('project_tracker', id, 'Â∞àÊ°à', loadProjectTracker); };

        // === Â∞èÁµÑÁÆ°ÁêÜ ===
        async function loadTeamGroups() {
            const container = document.getElementById('teamGroupsList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'team_groups'), orderBy('name', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">Â∞öÁÑ°Â∞èÁµÑ</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center text-primary font-bold">${(d.name || 'G')[0]}</div>
                            <div><h3 class="font-semibold">${d.name || 'Êú™ÂëΩÂêçÂ∞èÁµÑ'}</h3>
                            <p class="text-xs text-gray-500">${(d.members || []).length} ‰ΩçÊàêÂì°</p></div>
                        </div>
                        <p class="text-sm text-gray-500 line-clamp-2">${d.description || ''}</p>
                        <div class="flex justify-end mt-3">
                            <button onclick="deleteGroup('${doc.id}')" class="text-red-600 hover:text-red-800 text-xs">Âà™Èô§</button>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 col-span-3">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateGroupDialog = function() {
            showGenericFormDialog('Âª∫Á´ãÂ∞èÁµÑ', [
                { id: 'grpName', label: 'Â∞èÁµÑÂêçÁ®±', type: 'text', required: true },
                { id: 'grpDesc', label: 'ÊèèËø∞', type: 'textarea' },
                { id: 'grpLeader', label: 'ÁµÑÈï∑', type: 'text' }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'team_groups'), { name: data.grpName, description: data.grpDesc, leader: data.grpLeader, members: [], createdAt: serverTimestamp() });
                showAlert('Â∞èÁµÑÂ∑≤Âª∫Á´ãÔºÅ'); loadTeamGroups();
            });
        };
        window.deleteGroup = async function(id) { await genericDelete('team_groups', id, 'Â∞èÁµÑ', loadTeamGroups); };

        // === ËÄÉÂã§Ë®òÈåÑ ===
        async function loadAttendanceRecords() {
            const tbody = document.getElementById('attendanceTableBody');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'attendance_records'), orderBy('checkinTime', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Â∞öÁÑ°ËÄÉÂã§Ë®òÈåÑ</td></tr>';
                    return;
                }
                tbody.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const time = d.checkinTime?.seconds ? new Date(d.checkinTime.seconds * 1000).toLocaleString('zh-TW') : '-';
                    const statusColors = { present: 'bg-green-100 text-green-800', absent: 'bg-red-100 text-red-800', late: 'bg-yellow-100 text-yellow-800' };
                    const statusLabels = { present: 'Âá∫Â∏≠', absent: 'Áº∫Â∏≠', late: 'ÈÅ≤Âà∞' };
                    return `<tr class="border-b border-gray-100 dark:border-gray-700">
                        <td class="py-3 px-4">${d.memberName || '-'}</td>
                        <td class="py-3 px-4">${d.eventName || '-'}</td>
                        <td class="py-3 px-4">${time}</td>
                        <td class="py-3 px-4"><span class="px-2 py-1 rounded text-xs ${statusColors[d.status] || ''}">${statusLabels[d.status] || d.status}</span></td>
                        <td class="py-3 px-4"><button onclick="deleteAttendance('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Âà™Èô§</button></td>
                    </tr>`;
                }).join('');
            } catch (error) { tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-red-500">ËºâÂÖ•Â§±Êïó</td></tr>'; }
        }
        window.showAddAttendanceDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûËÄÉÂã§Ë®òÈåÑ', [
                { id: 'attMember', label: 'ÊúÉÂì°ÂêçÁ®±', type: 'text', required: true },
                { id: 'attEvent', label: 'Ê¥ªÂãïÂêçÁ®±', type: 'text', required: true },
                { id: 'attStatus', label: 'ÁãÄÊÖã', type: 'select', options: ['present', 'absent', 'late'], required: true }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'attendance_records'), { memberName: data.attMember, eventName: data.attEvent, status: data.attStatus, checkinTime: serverTimestamp() });
                showAlert('Ë®òÈåÑÂ∑≤Êñ∞Â¢ûÔºÅ'); loadAttendanceRecords();
            });
        };
        window.exportAttendance = function() { showAlert('ËÄÉÂã§Ë≥áÊñôÂåØÂá∫ÂäüËÉΩÈñãÁôº‰∏≠...'); };
        window.deleteAttendance = async function(id) { await genericDelete('attendance_records', id, 'ËÄÉÂã§Ë®òÈåÑ', loadAttendanceRecords); };

        // === ÁçéÊá≤Ë®òÈåÑ ===
        async function loadRewardsPenalties() {
            const container = document.getElementById('rewardsPenaltiesList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'rewards_penalties'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                let rewards = 0, penalties = 0;
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°ÁçéÊá≤Ë®òÈåÑ</p>';
                } else {
                    container.innerHTML = snapshot.docs.map(doc => {
                        const d = doc.data();
                        if (d.type === 'reward') rewards++; else penalties++;
                        const icon = d.type === 'reward' ? 'üèÜ' : '‚ö†Ô∏è';
                        const color = d.type === 'reward' ? 'border-green-300 bg-green-50 dark:bg-green-900/20' : 'border-red-300 bg-red-50 dark:bg-red-900/20';
                        return `<div class="border ${color} rounded-xl p-4">
                            <div class="flex justify-between items-start">
                                <div><span class="text-xl mr-2">${icon}</span><span class="font-semibold">${d.memberName || '-'}</span>
                                <p class="text-sm text-gray-600 mt-1">${d.reason || ''}</p></div>
                                <button onclick="deleteRewardPenalty('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Âà™Èô§</button>
                            </div>
                        </div>`;
                    }).join('');
                }
                document.getElementById('rewardsCount').textContent = rewards;
                document.getElementById('penaltiesCount').textContent = penalties;
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddRewardPenaltyDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÁçéÊá≤Ë®òÈåÑ', [
                { id: 'rpMember', label: 'ÊúÉÂì°ÂêçÁ®±', type: 'text', required: true },
                { id: 'rpType', label: 'È°ûÂûã', type: 'select', options: ['reward', 'penalty'], required: true },
                { id: 'rpReason', label: 'ÂéüÂõ†', type: 'textarea', required: true }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'rewards_penalties'), { memberName: data.rpMember, type: data.rpType, reason: data.rpReason, createdAt: serverTimestamp() });
                showAlert('Ë®òÈåÑÂ∑≤Êñ∞Â¢ûÔºÅ'); loadRewardsPenalties();
            });
        };
        window.deleteRewardPenalty = async function(id) { await genericDelete('rewards_penalties', id, 'ÁçéÊá≤Ë®òÈåÑ', loadRewardsPenalties); };

        // === Ë¥äÂä©ÂïÜ ===
        async function loadSponsors() {
            const container = document.getElementById('sponsorsList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'sponsors'), orderBy('tier', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">Â∞öÁÑ°Ë¥äÂä©ÂïÜ</p>';
                    return;
                }
                const tierColors = { platinum: 'border-purple-300 bg-purple-50', gold: 'border-yellow-300 bg-yellow-50', silver: 'border-gray-300 bg-gray-50', bronze: 'border-orange-300 bg-orange-50' };
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border ${tierColors[d.tier] || 'border-gray-200'} rounded-xl p-4">
                        <div class="w-full h-20 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center mb-3">${d.logo ? `<img src="${d.logo}" class="max-h-16">` : 'üè¢'}</div>
                        <h3 class="font-semibold">${d.name || 'Êú™ÂëΩÂêç'}</h3>
                        <p class="text-xs text-gray-500 uppercase">${d.tier || 'standard'}</p>
                        <button onclick="deleteSponsor('${doc.id}')" class="text-red-600 hover:text-red-800 text-xs mt-2">Âà™Èô§</button>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 col-span-3">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddSponsorDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûË¥äÂä©ÂïÜ', [
                { id: 'spName', label: 'ÂÖ¨Âè∏ÂêçÁ®±', type: 'text', required: true },
                { id: 'spTier', label: 'Á≠âÁ¥ö', type: 'select', options: ['platinum', 'gold', 'silver', 'bronze'], required: true },
                { id: 'spLogo', label: 'Logo ÈÄ£Áµê', type: 'url' },
                { id: 'spWebsite', label: 'Á∂≤Á´ôÈÄ£Áµê', type: 'url' }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'sponsors'), { name: data.spName, tier: data.spTier, logo: data.spLogo, website: data.spWebsite, createdAt: serverTimestamp() });
                showAlert('Ë¥äÂä©ÂïÜÂ∑≤Êñ∞Â¢ûÔºÅ'); loadSponsors();
            });
        };
        window.deleteSponsor = async function(id) { await genericDelete('sponsors', id, 'Ë¥äÂä©ÂïÜ', loadSponsors); };

        // === Âêà‰ΩúÂ§•‰º¥ ===
        async function loadPartners() {
            const container = document.getElementById('partnersList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'partners'), orderBy('name', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 col-span-3">Â∞öÁÑ°Âêà‰ΩúÂ§•‰º¥</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                        <div class="w-full h-20 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center mb-3">${d.logo ? `<img src="${d.logo}" class="max-h-16">` : 'ü§ù'}</div>
                        <h3 class="font-semibold">${d.name || 'Êú™ÂëΩÂêç'}</h3>
                        <p class="text-sm text-gray-500">${d.type || ''}</p>
                        <button onclick="deletePartner('${doc.id}')" class="text-red-600 hover:text-red-800 text-xs mt-2">Âà™Èô§</button>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 col-span-3">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddPartnerDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÂêà‰ΩúÂ§•‰º¥', [
                { id: 'ptName', label: 'ÂêçÁ®±', type: 'text', required: true },
                { id: 'ptType', label: 'È°ûÂûã', type: 'text', required: true },
                { id: 'ptLogo', label: 'Logo ÈÄ£Áµê', type: 'url' },
                { id: 'ptWebsite', label: 'Á∂≤Á´ôÈÄ£Áµê', type: 'url' }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'partners'), { name: data.ptName, type: data.ptType, logo: data.ptLogo, website: data.ptWebsite, createdAt: serverTimestamp() });
                showAlert('Âêà‰ΩúÂ§•‰º¥Â∑≤Êñ∞Â¢ûÔºÅ'); loadPartners();
            });
        };
        window.deletePartner = async function(id) { await genericDelete('partners', id, 'Âêà‰ΩúÂ§•‰º¥', loadPartners); };

        // === ÊØîË≥ΩË®òÈåÑ ===
        async function loadCompetitions() {
            const container = document.getElementById('competitionsList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'competitions'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);
                let gold = 0, silver = 0, bronze = 0;
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°ÊØîË≥ΩË®òÈåÑ</p>';
                } else {
                    container.innerHTML = snapshot.docs.map(doc => {
                        const d = doc.data();
                        if (d.award === 'gold') gold++;
                        else if (d.award === 'silver') silver++;
                        else if (d.award === 'bronze') bronze++;
                        const awards = { gold: 'ü•á', silver: 'ü•à', bronze: 'ü•â', none: '' };
                        const date = d.date?.seconds ? new Date(d.date.seconds * 1000).toLocaleDateString('zh-TW') : '';
                        return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                            <div class="flex justify-between items-start">
                                <div><span class="text-2xl mr-2">${awards[d.award] || ''}</span><span class="font-semibold">${d.name || 'Êú™ÂëΩÂêçÊØîË≥Ω'}</span>
                                <p class="text-sm text-gray-500">üìÖ ${date} | üë§ ${d.participants || ''}</p></div>
                                <button onclick="deleteCompetition('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Âà™Èô§</button>
                            </div>
                        </div>`;
                    }).join('');
                }
                document.getElementById('goldMedals').textContent = 'ü•á ' + gold;
                document.getElementById('silverMedals').textContent = 'ü•à ' + silver;
                document.getElementById('bronzeMedals').textContent = 'ü•â ' + bronze;
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddCompetitionDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÊØîË≥ΩË®òÈåÑ', [
                { id: 'compName', label: 'ÊØîË≥ΩÂêçÁ®±', type: 'text', required: true },
                { id: 'compDate', label: 'ÊØîË≥ΩÊó•Êúü', type: 'date', required: true },
                { id: 'compParticipants', label: 'ÂèÉË≥ΩËÄÖ', type: 'text' },
                { id: 'compAward', label: 'Áç≤Áçé', type: 'select', options: ['gold', 'silver', 'bronze', 'none'] }
            ], async (data) => {
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'competitions'), { name: data.compName, date: new Date(data.compDate), participants: data.compParticipants, award: data.compAward });
                showAlert('ÊØîË≥ΩË®òÈåÑÂ∑≤Êñ∞Â¢ûÔºÅ'); loadCompetitions();
            });
        };
        window.deleteCompetition = async function(id) { await genericDelete('competitions', id, 'ÊØîË≥ΩË®òÈåÑ', loadCompetitions); };

        // === Ë≠âÊõ∏ÁîüÊàê ===
        let currentCertStyle = 'classic';
        let currentCertColor = '#5D5CDE';
        let certificateHistoryData = [];

        const certTypeLabels = {
            participation: { label: 'ÂèÉËàáË≠âÊõ∏', icon: 'üé´', desc: 'ÊÑüË¨ùÂèÉËàá' },
            completion: { label: 'ÂÆåÊàêË≠âÊõ∏', icon: '‚úÖ', desc: 'ÂúìÊªøÂÆåÊàê' },
            excellence: { label: 'ÂÑ™ÁßÄË≠âÊõ∏', icon: '‚≠ê', desc: 'Ë°®ÁèæÂÑ™Áï∞' },
            award: { label: 'Áç≤ÁçéË≠âÊõ∏', icon: 'üèÜ', desc: 'Ê¶ÆÁç≤ÊÆäÊ¶Æ' },
            appreciation: { label: 'ÊÑüË¨ùÁãÄ', icon: 'üíñ', desc: 'ÁâπÊ≠§Ëá¥Ë¨ù' },
            volunteer: { label: 'ÂøóÂ∑•Ë≠âÊõ∏', icon: 'ü§ù', desc: 'ÊúçÂãôÂ•âÁçª' }
        };

        const certRankLabels = {
            none: { label: '', decoration: '' },
            first: { label: 'Á¨¨‰∏ÄÂêç', decoration: 'ü•á' },
            second: { label: 'Á¨¨‰∫åÂêç', decoration: 'ü•à' },
            third: { label: 'Á¨¨‰∏âÂêç', decoration: 'ü•â' },
            special: { label: 'ÁâπÂà•Áçé', decoration: 'üåü' },
            honorable: { label: '‰Ω≥‰Ωú', decoration: 'üéñÔ∏è' }
        };

        const certStyles = {
            classic: {
                bg: 'linear-gradient(135deg, #f5f5dc 0%, #fff8dc 100%)',
                border: '4px double',
                font: 'serif',
                shadow: '0 4px 20px rgba(0,0,0,0.15)'
            },
            modern: {
                bg: 'linear-gradient(135deg, #ffffff 0%, #f0f4f8 100%)',
                border: '2px solid',
                font: 'sans-serif',
                shadow: '0 10px 40px rgba(0,0,0,0.1)'
            },
            elegant: {
                bg: 'linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%)',
                border: '3px double',
                font: 'Georgia, serif',
                shadow: '0 8px 30px rgba(0,0,0,0.12)'
            },
            minimal: {
                bg: '#ffffff',
                border: '1px solid',
                font: 'system-ui, sans-serif',
                shadow: '0 2px 10px rgba(0,0,0,0.05)'
            }
        };

        window.setCertStyle = function(style) {
            currentCertStyle = style;
            document.querySelectorAll('[onclick^="setCertStyle"]').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-primary', 'bg-primary/20');
            });
            event.target.classList.add('ring-2', 'ring-primary', 'bg-primary/20');
            updateCertificatePreview();
        };

        window.setCertColor = function(color) {
            currentCertColor = color;
            document.querySelectorAll('[onclick^="setCertColor"]').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2');
            });
            event.target.classList.add('ring-2', 'ring-offset-2');
            updateCertificatePreview();
        };

        window.generateCertNumber = function() {
            const prefix = 'CERT';
            const year = new Date().getFullYear();
            const random = Math.random().toString(36).substring(2, 8).toUpperCase();
            const certNumber = `${prefix}-${year}-${random}`;
            document.getElementById('certNumber').value = certNumber;
            updateCertificatePreview();
        };

        window.updateCertificatePreview = function() {
            const type = document.getElementById('certType').value;
            const recipient = document.getElementById('certRecipient').value || 'Áç≤ÁçéËÄÖÂßìÂêç';
            const eventName = document.getElementById('certEvent').value || 'Ê¥ªÂãïÂêçÁ®±';
            const date = document.getElementById('certDate').value || new Date().toISOString().split('T')[0];
            const issuer = document.getElementById('certIssuer')?.value || 'ÁßëÊäÄÂ≠∏ÊúÉ';
            const rank = document.getElementById('certRank')?.value || 'none';
            const description = document.getElementById('certDescription')?.value || '';
            const certNumber = document.getElementById('certNumber')?.value || '';

            const typeInfo = certTypeLabels[type];
            const rankInfo = certRankLabels[rank];
            const style = certStyles[currentCertStyle];

            const formattedDate = date ? new Date(date).toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric' }) : '';

            const preview = document.getElementById('certificatePreview');
            preview.innerHTML = `
                <div id="certContent" style="
                    width: 100%;
                    max-width: 600px;
                    margin: 0 auto;
                    padding: 40px;
                    background: ${style.bg};
                    border: ${style.border} ${currentCertColor};
                    border-radius: 12px;
                    box-shadow: ${style.shadow};
                    font-family: ${style.font};
                    text-align: center;
                    position: relative;
                ">
                    <!-- Ë£ùÈ£æËßí -->
                    <div style="position: absolute; top: 10px; left: 10px; width: 30px; height: 30px; border-top: 3px solid ${currentCertColor}; border-left: 3px solid ${currentCertColor};"></div>
                    <div style="position: absolute; top: 10px; right: 10px; width: 30px; height: 30px; border-top: 3px solid ${currentCertColor}; border-right: 3px solid ${currentCertColor};"></div>
                    <div style="position: absolute; bottom: 10px; left: 10px; width: 30px; height: 30px; border-bottom: 3px solid ${currentCertColor}; border-left: 3px solid ${currentCertColor};"></div>
                    <div style="position: absolute; bottom: 10px; right: 10px; width: 30px; height: 30px; border-bottom: 3px solid ${currentCertColor}; border-right: 3px solid ${currentCertColor};"></div>

                    <!-- ÂúñÊ®ô -->
                    <div style="font-size: 48px; margin-bottom: 10px;">${typeInfo.icon}</div>

                    <!-- Ê®ôÈ°å -->
                    <h1 style="font-size: 28px; color: ${currentCertColor}; margin-bottom: 20px; font-weight: bold; letter-spacing: 4px;">
                        ${typeInfo.label}
                    </h1>

                    ${rankInfo.label ? `<div style="font-size: 20px; color: ${currentCertColor}; margin-bottom: 15px;">${rankInfo.decoration} ${rankInfo.label} ${rankInfo.decoration}</div>` : ''}

                    <!-- Ê≠£Êñá -->
                    <p style="font-size: 16px; color: #666; margin-bottom: 10px;">Ëå≤Ë≠âÊòé</p>
                    <p style="font-size: 32px; font-weight: bold; color: #333; margin: 20px 0; border-bottom: 2px solid ${currentCertColor}; padding-bottom: 10px; display: inline-block;">
                        ${recipient}
                    </p>

                    <p style="font-size: 16px; color: #555; margin: 20px 0; line-height: 1.8;">
                        ÂèÉËàá„Äå<strong>${eventName}</strong>„Äç<br>
                        ${typeInfo.desc}${description ? 'Ôºå' + description : ''}
                    </p>

                    <!-- Êó•ÊúüËàáÁ∞ΩÁôºËÄÖ -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed ${currentCertColor};">
                        <p style="font-size: 14px; color: #888;">È†íÁôºÊó•ÊúüÔºö${formattedDate}</p>
                        <p style="font-size: 16px; color: #666; margin-top: 10px;">${issuer} Êï¨Ë¥à</p>
                    </div>

                    ${certNumber ? `<p style="position: absolute; bottom: 15px; right: 20px; font-size: 10px; color: #aaa;">No. ${certNumber}</p>` : ''}
                </div>
            `;
        };

        window.generateCertificate = function() {
            const recipient = document.getElementById('certRecipient').value;
            const eventName = document.getElementById('certEvent').value;
            if (!recipient || !eventName) {
                showAlert('Ë´ãÂ°´ÂØ´Áç≤ÁçéËÄÖÂßìÂêçÂíåÊ¥ªÂãïÂêçÁ®±');
                return;
            }
            updateCertificatePreview();
            showAlert('Ë≠âÊõ∏Â∑≤ÁîüÊàêÔºÅÊÇ®ÂèØ‰ª•‰∏ãËºâÊàñÂàóÂç∞');
        };

        window.downloadCertificate = async function() {
            const certContent = document.getElementById('certContent');
            if (!certContent) {
                showAlert('Ë´ãÂÖàÁîüÊàêË≠âÊõ∏');
                return;
            }

            try {
                // ‰ΩøÁî® html2canvas Â∫´
                if (typeof html2canvas === 'undefined') {
                    // ÂãïÊÖãËºâÂÖ• html2canvas
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="97ffe3fafba5f4f6f9e1f6e4d7a6b9a3b9a6">[email&#160;protected]</a>/dist/html2canvas.min.js';
                    document.head.appendChild(script);
                    await new Promise(resolve => script.onload = resolve);
                }

                const canvas = await html2canvas(certContent, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    useCORS: true
                });

                const link = document.createElement('a');
                const recipient = document.getElementById('certRecipient').value || 'certificate';
                link.download = `certificate_${recipient}_${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                showAlert('Ë≠âÊõ∏Â∑≤‰∏ãËºâÔºÅ');
            } catch (error) {
                console.error('Download error:', error);
                showAlert('‰∏ãËºâÂ§±ÊïóÔºåË´ãÂòóË©¶‰ΩøÁî®ÂàóÂç∞ÂäüËÉΩ');
            }
        };

        window.printCertificate = function() {
            const certContent = document.getElementById('certContent');
            if (!certContent) {
                showAlert('Ë´ãÂÖàÁîüÊàêË≠âÊõ∏');
                return;
            }

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>ÂàóÂç∞Ë≠âÊõ∏</title>
                    <style>
                        body { margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
                        @media print {
                            body { padding: 0; }
                            @page { size: A4 landscape; margin: 10mm; }
                        }
                    </style>
                </head>
                <body>
                    ${certContent.outerHTML}
                    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>window.onload = function() { window.print(); }<\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        };

        window.saveCertificateRecord = async function() {
            const recipient = document.getElementById('certRecipient').value;
            const eventName = document.getElementById('certEvent').value;
            if (!recipient || !eventName) {
                showAlert('Ë´ãÂ°´ÂØ´Áç≤ÁçéËÄÖÂßìÂêçÂíåÊ¥ªÂãïÂêçÁ®±');
                return;
            }

            try {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                const certData = {
                    type: document.getElementById('certType').value,
                    recipient: recipient,
                    event: eventName,
                    date: document.getElementById('certDate').value,
                    issuer: document.getElementById('certIssuer')?.value || 'ÁßëÊäÄÂ≠∏ÊúÉ',
                    rank: document.getElementById('certRank')?.value || 'none',
                    description: document.getElementById('certDescription')?.value || '',
                    certNumber: document.getElementById('certNumber')?.value || '',
                    style: currentCertStyle,
                    color: currentCertColor,
                    createdAt: serverTimestamp()
                };

                await addDoc(collection(window.firebaseDB, 'certificates'), certData);
                showAlert('Ë≠âÊõ∏Ë®òÈåÑÂ∑≤ÂÑ≤Â≠òÔºÅ');
                loadCertificateHistory();
            } catch (error) {
                console.error('Save error:', error);
                showAlert('ÂÑ≤Â≠òÂ§±ÊïóÔºö' + error.message);
            }
        };

        async function loadCertificateHistory() {
            const container = document.getElementById('certificateHistory');
            if (!container) return;

            try {
                const { collection, getDocs, orderBy, query, limit } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'certificates'), orderBy('createdAt', 'desc'), limit(10));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">Â∞öÁÑ°Ë≠âÊõ∏Ë®òÈåÑ</p>';
                    return;
                }

                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const typeInfo = certTypeLabels[d.type] || certTypeLabels.participation;
                    const createdDate = d.createdAt?.toDate?.() ? d.createdAt.toDate().toLocaleDateString('zh-TW') : '';
                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">${typeInfo.icon}</span>
                                <div>
                                    <p class="font-medium">${d.recipient}</p>
                                    <p class="text-sm text-gray-500">${d.event} - ${typeInfo.label}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-500">${createdDate}</p>
                                <button onclick="loadCertificateFromHistory('${doc.id}')" class="text-xs text-primary hover:underline">ÈáçÊñ∞ËºâÂÖ•</button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Load history error:', error);
                container.innerHTML = '<p class="text-red-500 text-center py-4">ËºâÂÖ•Â§±Êïó</p>';
            }
        }

        window.loadCertificateFromHistory = async function(certId) {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const docRef = doc(window.firebaseDB, 'certificates', certId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const d = docSnap.data();
                    document.getElementById('certType').value = d.type || 'participation';
                    document.getElementById('certRecipient').value = d.recipient || '';
                    document.getElementById('certEvent').value = d.event || '';
                    document.getElementById('certDate').value = d.date || '';
                    if (document.getElementById('certIssuer')) document.getElementById('certIssuer').value = d.issuer || '';
                    if (document.getElementById('certRank')) document.getElementById('certRank').value = d.rank || 'none';
                    if (document.getElementById('certDescription')) document.getElementById('certDescription').value = d.description || '';
                    if (document.getElementById('certNumber')) document.getElementById('certNumber').value = d.certNumber || '';
                    currentCertStyle = d.style || 'classic';
                    currentCertColor = d.color || '#5D5CDE';
                    updateCertificatePreview();
                    showAlert('Ë≠âÊõ∏Ë≥áÊñôÂ∑≤ËºâÂÖ•ÔºÅ');
                }
            } catch (error) {
                console.error('Load from history error:', error);
                showAlert('ËºâÂÖ•Â§±Êïó');
            }
        };

        // === ÂïèÈ°åÂõûÂ†± ===
        async function loadBugReports() {
            const container = document.getElementById('bugReportsList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'bug_reports'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°ÂïèÈ°åÂõûÂ†±</p>';
                    return;
                }
                const statusColors = { open: 'bg-red-100 text-red-800', in_progress: 'bg-yellow-100 text-yellow-800', resolved: 'bg-green-100 text-green-800', closed: 'bg-gray-100 text-gray-800' };
                const statusLabels = { open: 'ÂæÖËôïÁêÜ', in_progress: 'ËôïÁêÜ‰∏≠', resolved: 'Â∑≤Ëß£Ê±∫', closed: 'Â∑≤ÈóúÈñâ' };
                const priorityColors = { high: 'text-red-600', medium: 'text-yellow-600', low: 'text-green-600' };
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4 bug-item" data-status="${d.status}" data-priority="${d.priority}">
                        <div class="flex justify-between items-start">
                            <div><h3 class="font-semibold">${d.title || 'Êú™ÂëΩÂêçÂïèÈ°å'}</h3>
                            <p class="text-sm text-gray-500 line-clamp-2">${d.description || ''}</p>
                            <div class="flex space-x-2 mt-2">
                                <span class="px-2 py-1 rounded text-xs ${statusColors[d.status] || ''}">${statusLabels[d.status] || d.status}</span>
                                <span class="text-xs ${priorityColors[d.priority] || ''}">ÂÑ™ÂÖàÁ¥ö: ${d.priority || 'medium'}</span>
                            </div></div>
                            <button onclick="updateBugStatus('${doc.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Êõ¥Êñ∞ÁãÄÊÖã</button>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.filterBugReports = function() {
            const status = document.getElementById('bugStatusFilter').value;
            const priority = document.getElementById('bugPriorityFilter').value;
            document.querySelectorAll('.bug-item').forEach(item => {
                const matchStatus = !status || item.dataset.status === status;
                const matchPriority = !priority || item.dataset.priority === priority;
                item.style.display = (matchStatus && matchPriority) ? 'block' : 'none';
            });
        };
        window.updateBugStatus = async function(id) {
            showGenericFormDialog('Êõ¥Êñ∞ÂïèÈ°åÁãÄÊÖã', [
                { id: 'bugStatus', label: 'ÁãÄÊÖã', type: 'select', options: ['open', 'in_progress', 'resolved', 'closed'], required: true }
            ], async (data) => {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'bug_reports', id), { status: data.bugStatus });
                showAlert('ÁãÄÊÖãÂ∑≤Êõ¥Êñ∞ÔºÅ'); loadBugReports();
            });
        };

        // === ÊÑèË¶ãÁÆ± ===
        async function loadSuggestionBox() {
            const container = document.getElementById('suggestionsList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'suggestions'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                let total = 0, pending = 0, implemented = 0;
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°Âª∫Ë≠∞</p>';
                } else {
                    container.innerHTML = snapshot.docs.map(doc => {
                        const d = doc.data();
                        total++;
                        if (d.status === 'pending') pending++;
                        else if (d.status === 'implemented') implemented++;
                        const statusLabels = { pending: 'ÂæÖÂØ©Ê†∏', approved: 'Â∑≤ÊâπÂáÜ', implemented: 'Â∑≤Êé°Á¥ç', rejected: 'Â∑≤ÊãíÁµï' };
                        return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4">
                            <div class="flex justify-between items-start">
                                <div><p class="text-sm">${d.content || ''}</p>
                                <p class="text-xs text-gray-500 mt-2">- ${d.submitter || 'ÂåøÂêç'}</p></div>
                                <div class="flex flex-col items-end space-y-2">
                                    <span class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">${statusLabels[d.status] || 'ÂæÖÂØ©Ê†∏'}</span>
                                    <button onclick="updateSuggestionStatus('${doc.id}')" class="text-blue-600 hover:text-blue-800 text-xs">Êõ¥Êñ∞ÁãÄÊÖã</button>
                                </div>
                            </div>
                        </div>`;
                    }).join('');
                }
                document.getElementById('suggestionsTotal').textContent = total;
                document.getElementById('suggestionsPending').textContent = pending;
                document.getElementById('suggestionsImplemented').textContent = implemented;
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.updateSuggestionStatus = async function(id) {
            showGenericFormDialog('Êõ¥Êñ∞Âª∫Ë≠∞ÁãÄÊÖã', [
                { id: 'sugStatus', label: 'ÁãÄÊÖã', type: 'select', options: ['pending', 'approved', 'implemented', 'rejected'], required: true }
            ], async (data) => {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'suggestions', id), { status: data.sugStatus });
                showAlert('ÁãÄÊÖãÂ∑≤Êõ¥Êñ∞ÔºÅ'); loadSuggestionBox();
            });
        };

        // === Áü•Ë≠òÂ∫´ ===
        async function loadKnowledgeBase() {
            const container = document.getElementById('knowledgeBaseList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'knowledge_base'), orderBy('updatedAt', 'desc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Â∞öÁÑ°ÊñáÁ´†</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-4 kb-item" data-title="${(d.title || '').toLowerCase()}" data-tags="${(d.tags || []).join(' ').toLowerCase()}">
                        <div class="flex justify-between items-start">
                            <div><h3 class="font-semibold">${d.title || 'Êú™ÂëΩÂêçÊñáÁ´†'}</h3>
                            <p class="text-sm text-gray-500 line-clamp-2">${d.summary || ''}</p>
                            <div class="flex flex-wrap gap-1 mt-2">${(d.tags || []).map(t => `<span class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">${t}</span>`).join('')}</div></div>
                            <div class="flex space-x-2">
                                <button onclick="viewArticle('${doc.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Êü•Áúã</button>
                                <button onclick="deleteArticle('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Âà™Èô§</button>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showCreateArticleDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÊñáÁ´†', [
                { id: 'kbTitle', label: 'ÊñáÁ´†Ê®ôÈ°å', type: 'text', required: true },
                { id: 'kbSummary', label: 'ÊëòË¶Å', type: 'text' },
                { id: 'kbContent', label: 'ÂÖßÂÆπ', type: 'textarea', required: true },
                { id: 'kbTags', label: 'Ê®ôÁ±§ (ÈÄóËôüÂàÜÈöî)', type: 'text' }
            ], async (data) => {
                const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                const tags = data.kbTags ? data.kbTags.split(',').map(t => t.trim()) : [];
                await addDoc(collection(window.firebaseDB, 'knowledge_base'), { title: data.kbTitle, summary: data.kbSummary, content: data.kbContent, tags, createdAt: serverTimestamp(), updatedAt: serverTimestamp() });
                showAlert('ÊñáÁ´†Â∑≤Âª∫Á´ãÔºÅ'); loadKnowledgeBase();
            });
        };
        window.searchKnowledge = function() {
            const search = document.getElementById('knowledgeSearch').value.toLowerCase();
            document.querySelectorAll('.kb-item').forEach(item => {
                const title = item.dataset.title || '';
                const tags = item.dataset.tags || '';
                item.style.display = (title.includes(search) || tags.includes(search)) ? 'block' : 'none';
            });
        };
        window.viewArticle = async function(id) {
            const { doc, getDoc } = window.firestoreModules;
            const docSnap = await getDoc(doc(window.firebaseDB, 'knowledge_base', id));
            if (docSnap.exists()) {
                const d = docSnap.data();
                showInfoDialog(d.title, `<div class="prose dark:prose-invert max-w-none">${d.content}</div>`);
            }
        };
        window.deleteArticle = async function(id) { await genericDelete('knowledge_base', id, 'ÊñáÁ´†', loadKnowledgeBase); };

        // === Ê®ôÁ±§ÁÆ°ÁêÜ ===
        async function loadTagManagement() {
            const container = document.getElementById('tagsList');
            try {
                const { collection, getDocs, orderBy, query } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'tags'), orderBy('name', 'asc'));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8 w-full">Â∞öÁÑ°Ê®ôÁ±§</p>';
                    return;
                }
                container.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    return `<div class="inline-flex items-center space-x-2 px-4 py-2 rounded-full" style="background-color: ${d.color || '#8B5CF6'}20; color: ${d.color || '#8B5CF6'}">
                        <span>#${d.name || ''}</span>
                        <button onclick="deleteTag('${doc.id}')" class="hover:text-red-600">&times;</button>
                    </div>`;
                }).join('');
            } catch (error) { container.innerHTML = '<p class="text-red-500 text-center py-8 w-full">ËºâÂÖ•Â§±Êïó</p>'; }
        }
        window.showAddTagDialog = function() {
            showGenericFormDialog('Êñ∞Â¢ûÊ®ôÁ±§', [
                { id: 'tagName', label: 'Ê®ôÁ±§ÂêçÁ®±', type: 'text', required: true },
                { id: 'tagColor', label: 'È°èËâ≤', type: 'color', value: '#8B5CF6' }
            ], async (data) => {
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'tags'), { name: data.tagName, color: data.tagColor });
                showAlert('Ê®ôÁ±§Â∑≤Âª∫Á´ãÔºÅ'); loadTagManagement();
            });
        };
        window.deleteTag = async function(id) { await genericDelete('tags', id, 'Ê®ôÁ±§', loadTagManagement); };

        // === Êï∏ÊìöÂåØÂá∫ ===
        window.exportData = async function(type) {
            showAlert(`Ê≠£Âú®ÂåØÂá∫ ${type} Ë≥áÊñô...`);
            try {
                const { collection, getDocs } = window.firestoreModules;
                let data = {};
                const collections = type === 'all' ? ['activities', 'users', 'attendance_records', 'transactions', 'event_registrations'] : [type === 'members' ? 'users' : type];
                for (const col of collections) {
                    const snapshot = await getDocs(collection(window.firebaseDB, col));
                    data[col] = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                }
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `export_${type}_${new Date().toISOString().slice(0,10)}.json`;
                a.click(); URL.revokeObjectURL(url);
                showAlert('ÂåØÂá∫ÂÆåÊàêÔºÅ');
            } catch (error) { showAlert('ÂåØÂá∫Â§±ÊïóÔºö' + error.message); }
        };

        // === Á≥ªÁµ±Êó•Ë™å ===
        async function loadSystemLogs() {
            const tbody = document.getElementById('systemLogsTableBody');
            try {
                const { collection, getDocs, orderBy, query, limit } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'system_logs'), orderBy('timestamp', 'desc'), limit(100));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-500">Â∞öÁÑ°Á≥ªÁµ±Êó•Ë™å</td></tr>';
                    return;
                }
                const typeColors = { login: 'text-blue-600', create: 'text-green-600', update: 'text-yellow-600', delete: 'text-red-600', error: 'text-red-600 font-bold' };
                tbody.innerHTML = snapshot.docs.map(doc => {
                    const d = doc.data();
                    const time = d.timestamp?.seconds ? new Date(d.timestamp.seconds * 1000).toLocaleString('zh-TW') : '-';
                    return `<tr class="border-b border-gray-100 dark:border-gray-700 log-item" data-type="${d.type}" data-date="${d.timestamp?.seconds ? new Date(d.timestamp.seconds * 1000).toISOString().slice(0,10) : ''}">
                        <td class="py-2 px-4 text-xs">${time}</td>
                        <td class="py-2 px-4 ${typeColors[d.type] || ''}">${d.type || '-'}</td>
                        <td class="py-2 px-4">${d.user || '-'}</td>
                        <td class="py-2 px-4">${d.action || '-'}</td>
                        <td class="py-2 px-4 text-xs text-gray-500 truncate max-w-[200px]">${d.details || '-'}</td>
                    </tr>`;
                }).join('');
            } catch (error) { tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-red-500">ËºâÂÖ•Â§±Êïó</td></tr>'; }
        }
        window.filterLogs = function() {
            const type = document.getElementById('logTypeFilter').value;
            const date = document.getElementById('logDateFilter').value;
            document.querySelectorAll('.log-item').forEach(item => {
                const matchType = !type || item.dataset.type === type;
                const matchDate = !date || item.dataset.date === date;
                item.style.display = (matchType && matchDate) ? 'table-row' : 'none';
            });
        };
        window.clearOldLogs = function() { showAlert('Ê∏ÖÈô§ËàäÊó•Ë™åÂäüËÉΩÈñãÁôº‰∏≠...'); };

        // === ÂÇô‰ªΩÈÇÑÂéü ===
        window.createBackup = async function() {
            showAlert('Ê≠£Âú®Âª∫Á´ãÂÇô‰ªΩ...');
            try {
                const { collection, getDocs } = window.firestoreModules;
                const backup = { timestamp: new Date().toISOString(), data: {} };
                const collections = [];
                if (document.getElementById('backupActivities').checked) collections.push('activities');
                if (document.getElementById('backupMembers').checked) collections.push('users');
                if (document.getElementById('backupSettings').checked) collections.push('settings');
                if (document.getElementById('backupFinance').checked) collections.push('transactions');
                for (const col of collections) {
                    const snapshot = await getDocs(collection(window.firebaseDB, col));
                    backup.data[col] = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                }
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `backup_${new Date().toISOString().slice(0,10)}.json`;
                a.click(); URL.revokeObjectURL(url);
                showAlert('ÂÇô‰ªΩÂÆåÊàêÔºÅ');
            } catch (error) { showAlert('ÂÇô‰ªΩÂ§±ÊïóÔºö' + error.message); }
        };
        window.handleRestoreFile = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    showAlert(`ÂÇô‰ªΩÊ™îÊ°àËºâÂÖ•ÊàêÂäüÔºÅÂåÖÂê´ ${Object.keys(backup.data || {}).length} ÂÄãÈõÜÂêà„ÄÇÈÇÑÂéüÂäüËÉΩÈñãÁôº‰∏≠...`);
                } catch (error) { showAlert('Ê™îÊ°àÊ†ºÂºèÈåØË™§'); }
            };
            reader.readAsText(file);
        };

        // === ÈÄöÁî®Ë°®ÂñÆÂ∞çË©±Ê°Ü ===
        function showGenericFormDialog(title, fields, onSubmit) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">${title}</h3>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl">&times;</button>
                </div>
                <form id="genericForm" class="space-y-4">
                    ${fields.map(f => {
                        if (f.type === 'select') {
                            return `<div><label class="block text-sm font-semibold mb-2">${f.label}</label>
                                <select id="${f.id}" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" ${f.required ? 'required' : ''}>
                                    ${f.options.map(o => `<option value="${o}">${o}</option>`).join('')}
                                </select></div>`;
                        } else if (f.type === 'textarea') {
                            return `<div><label class="block text-sm font-semibold mb-2">${f.label}</label>
                                <textarea id="${f.id}" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" ${f.required ? 'required' : ''}></textarea></div>`;
                        } else {
                            return `<div><label class="block text-sm font-semibold mb-2">${f.label}</label>
                                <input type="${f.type}" id="${f.id}" value="${f.value || ''}" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" ${f.required ? 'required' : ''}></div>`;
                        }
                    }).join('')}
                    <button type="submit" class="w-full px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç</button>
                </form>
            </div>`;
            document.body.appendChild(modal);
            modal.querySelector('form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = {};
                fields.forEach(f => { data[f.id] = document.getElementById(f.id).value; });
                try { await onSubmit(data); modal.remove(); } catch (error) { showAlert('Êìç‰ΩúÂ§±ÊïóÔºö' + error.message); }
            });
        }

        function showInfoDialog(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">${title}</h3>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl">&times;</button>
                </div>
                <div>${content}</div>
            </div>`;
            document.body.appendChild(modal);
        }

        async function genericDelete(collectionName, id, itemName, reloadFunc) {
            if (!window.confirmDialog) {
                window.confirmDialog = function(message) {
                    return new Promise(resolve => {
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                        modal.innerHTML = `<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                            <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                            <div class="flex justify-end space-x-3">
                                <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                                <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Á¢∫Ë™ç</button>
                            </div>
                        </div>`;
                        document.body.appendChild(modal);
                        modal.querySelector('.cancel-btn').onclick = () => { modal.remove(); resolve(false); };
                        modal.querySelector('.confirm-btn').onclick = () => { modal.remove(); resolve(true); };
                    });
                };
            }
            const confirmed = await window.confirmDialog(`Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§${itemName}ÂóéÔºü`);
            if (!confirmed) return;
            try {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, collectionName, id));
                showAlert(`${itemName}Â∑≤Âà™Èô§ÔºÅ`);
                reloadFunc();
            } catch (error) { showAlert('Âà™Èô§Â§±Êïó'); }
        }

        // === ÂàáÊèõÂäüËÉΩÂçÄÂ°äÊôÇËºâÂÖ•Â∞çÊáâË≥áÊñô ===
        const originalSwitchSection = window.switchSection || function() {};
        window.switchSection = function(sectionId) {
            // ÂëºÂè´ÂéüÊú¨ÁöÑÂàáÊèõÂäüËÉΩ
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            const target = document.getElementById(sectionId + 'Section');
            if (target) target.classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-primary/10', 'text-primary', 'font-semibold');
                if (btn.dataset.section === sectionId) {
                    btn.classList.add('bg-primary/10', 'text-primary', 'font-semibold');
                }
            });
            // ËºâÂÖ•Â∞çÊáâË≥áÊñô
            switch(sectionId) {
                case 'memberProfiles': loadMemberProfiles(); break;
                case 'pointsSystem': loadPointsSystem(); break;
                case 'achievements': loadAchievements(); break;
                case 'eventRegistration': loadEventRegistrations(); break;
                case 'qrCheckin': loadQREvents(); break;
                case 'calendarView': renderCalendar(); break;
                case 'votingSystem': loadPolls(); break;
                case 'surveys': loadSurveys(); break;
                case 'resourceBooking': loadResources(); break;
                case 'notificationCenter': loadNotifications(); break;
                case 'forum': loadForum(); break;
                case 'photoGallery': loadPhotoGallery(); break;
                case 'executives': loadExecutives(); break;
                case 'finance': loadFinance(); break;
                case 'guestbook': loadGuestbook(); break;
                case 'faq': loadFAQ(); break;
                case 'quickNotes': loadQuickNotes(); break;
                case 'todoList': loadTodoList(); break;
                case 'maintenance': loadMaintenanceSettings(); break;
                // Êñ∞Â¢ûÂäüËÉΩ
                case 'emailTemplates': loadEmailTemplates(); break;
                case 'socialLinks': loadSocialLinks(); break;
                case 'meetingMinutes': loadMeetingMinutes(); break;
                case 'documentLibrary': loadDocumentLibrary(); break;
                case 'learningResources': loadLearningResources(); break;
                case 'projectTracker': loadProjectTracker(); break;
                case 'teamGroups': loadTeamGroups(); break;
                case 'attendanceRecords': loadAttendanceRecords(); break;
                case 'rewardsPenalties': loadRewardsPenalties(); break;
                case 'sponsors': loadSponsors(); break;
                case 'partners': loadPartners(); break;
                case 'competitions': loadCompetitions(); break;
                case 'certificates': break;
                case 'bugReports': loadBugReports(); break;
                case 'suggestionBox': loadSuggestionBox(); break;
                case 'knowledgeBase': loadKnowledgeBase(); break;
                case 'tagManagement': loadTagManagement(); break;
                case 'dataExport': break;
                case 'systemLogs': loadSystemLogs(); break;
                case 'backupRestore': break;
            }
        };

    </script>

    <!-- ÁâàÊú¨ËôüÈ°ØÁ§∫ -->
    <div class="fixed bottom-2 right-2 text-xs text-gray-400 dark:text-gray-600 bg-white dark:bg-gray-800 px-3 py-1 rounded-full shadow-sm z-50">
        v5.0.0 - ÂæåÂè∞Ôºà43È†ÖÊñ∞ÂäüËÉΩÔºâ
    </div>
</body>
</html>
