<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁßëÊäÄÂ≠∏ÊúÉÁÆ°ÁêÜÂæåÂè∞ | Admin Panel v5.7.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4a49b8',
                    }
                }
            }
        }
    </script>
    <style>
        html {
            scroll-behavior: smooth;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-[#181818] text-gray-900 dark:text-gray-100">

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-lg max-w-md w-full">
            <div class="text-center mb-8">
                <svg class="w-16 h-16 mx-auto mb-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <h1 class="text-2xl font-bold">ÁßëÊäÄÂ≠∏ÊúÉÁÆ°ÁêÜÂæåÂè∞</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Ë´ãÁôªÂÖ•‰ª•ÁπºÁ∫å</p>
            </div>

            <form id="loginForm" onsubmit="return handleLogin(event)" class="space-y-4">
                <div>
                    <label for="loginEmail" class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç</label>
                    <input type="text" id="loginEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç" required>
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-semibold mb-2">ÂØÜÁ¢º</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="Ë´ãËº∏ÂÖ•ÂØÜÁ¢º" required>
                </div>
                <button type="submit" id="loginBtn" class="w-full px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                    ÁôªÂÖ•
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-40">
            <div class="px-6 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <div>
                        <h1 class="text-xl font-bold">ÁßëÊäÄÂ≠∏ÊúÉÁÆ°ÁêÜÂæåÂè∞</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Ê≠°ËøéÂõû‰æÜÔºå<span id="currentUser"></span></p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary transition-colors">ËøîÂõûÂâçÂè∞</a>
                    <button id="logoutBtn" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                        ÁôªÂá∫
                    </button>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- Sidebar -->
            <aside class="w-64 bg-white dark:bg-gray-800 min-h-screen shadow-sm">
                <nav class="p-4 space-y-2">
                    <button data-section="activities" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Ê¥ªÂãïÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="projects" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        <span>Â∞àÊ°àÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="team" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span>ÂúòÈöäÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="contacts" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3 relative">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        <span>ËÅØÁµ°Ë®äÊÅØ</span>
                        <span id="unreadContactsBadge" class="hidden absolute right-2 top-1/2 -translate-y-1/2 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full min-w-[20px] text-center">0</span>
                    </button>
                    <button data-section="users" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <span>Áî®Êà∂ÁÆ°ÁêÜ</span>
                    </button>
                    <button data-section="hero" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
                        </svg>
                        <span>È¶ñÈ†ÅÊ®ôË™û</span>
                    </button>
                    <button data-section="announcements" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                        </svg>
                        <span>ÊúÄÊñ∞Ë®äÊÅØ</span>
                    </button>
                    <button data-section="contactSettings" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>ËÅØÁµ°Ë®≠ÁΩÆ</span>
                    </button>
                    <button data-section="anthemSettings" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                        </svg>
                        <span>ÊúÉÊ≠åË®≠ÁΩÆ</span>
                    </button>
                    <button data-section="visitorStats" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>Ë®™ÂÆ¢Áµ±Ë®à</span>
                    </button>
                    <button data-section="memberCard" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        <span>ÊúÉÂì°Âç°Á≥ªÁµ±</span>
                    </button>
                    <a href="checkin.html" target="_blank" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3 bg-gradient-to-r from-green-500/10 to-teal-500/10 border border-green-500/30">
                        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                        </svg>
                        <span class="text-green-600 dark:text-green-400 font-semibold">Á∞ΩÂà∞ÁÆ°ÁêÜ</span>
                        <svg class="w-4 h-4 ml-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                    </a>
                    <button data-section="profile" class="nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span>ÂÄã‰∫∫Ë≥áÊñô</span>
                    </button>

                    </nav>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-8">
                <!-- Activities Section -->
                <div id="activitiesSection" class="section">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Ê¥ªÂãïÁÆ°ÁêÜ</h2>
                            <button id="addActivityBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                + Êñ∞Â¢ûÊ¥ªÂãï
                            </button>
                        </div>

                        <!-- Activities List -->
                        <div id="activitiesLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="activitiesList" class="space-y-4 hidden"></div>
                        <div id="activitiesEmptyState" class="text-center py-12 hidden">
                            <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°Ê¥ªÂãïË≥áÊñô</p>
                        </div>
                    </div>
                </div>

                <!-- Projects Section -->
                <div id="projectsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">Â∞àÊ°àÁÆ°ÁêÜ</h2>
                            <button id="addProjectBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                + Êñ∞Â¢ûÂ∞àÊ°à
                            </button>
                        </div>

                        <!-- Projects List -->
                        <div id="projectsLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="projectsList" class="space-y-4 hidden"></div>
                        <div id="projectsEmptyState" class="text-center py-12 hidden">
                            <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°Â∞àÊ°àË≥áÊñô</p>
                        </div>
                    </div>
                </div>

                <!-- Team Section -->
                <div id="teamSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ÂúòÈöäÁÆ°ÁêÜ</h2>
                            <button id="addTeamMemberBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                + Êñ∞Â¢ûÊàêÂì°
                            </button>
                        </div>

                        <!-- Team Members List -->
                        <div id="teamList" class="space-y-4">
                            <!-- Team members will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Contacts Section -->
                <div id="contactsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ËÅØÁµ°Ë®äÊÅØ</h2>
                            <div class="flex space-x-2 items-center">
                                <button onclick="filterContacts('all')" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold transition-colors">
                                    ÂÖ®ÈÉ®
                                </button>
                                <button onclick="filterContacts('unread')" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold transition-colors">
                                    Êú™ËÆÄ
                                </button>
                                <button onclick="filterContacts('replied')" class="filter-btn px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm font-semibold transition-colors">
                                    Â∑≤ÂõûË¶Ü
                                </button>
                                <span class="border-l border-gray-300 dark:border-gray-600 h-6 mx-2"></span>
                                <button onclick="deleteAllContacts()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                    ÂÖ®ÈÉ®Âà™Èô§
                                </button>
                            </div>
                        </div>

                        <!-- Contacts List -->
                        <div id="contactsLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="contactsList" class="space-y-4 hidden"></div>
                        <div id="contactsEmptyState" class="text-center py-12 hidden">
                            <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°ËÅØÁµ°Ë®äÊÅØ</p>
                        </div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="usersSection" class="section hidden">
                    <!-- Áî®Êà∂Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">Á∏ΩÁî®Êà∂</p>
                                    <p class="text-2xl font-bold" id="userStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üë•</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm">ÁÆ°ÁêÜÂì°</p>
                                    <p class="text-2xl font-bold" id="userStatAdmin">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üëë</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">Â∑≤ÊâπÂáÜ</p>
                                    <p class="text-2xl font-bold" id="userStatApproved">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100 text-sm">ÂæÖÂØ©Ê†∏</p>
                                    <p class="text-2xl font-bold" id="userStatPending">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚è≥</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Â∑≤ÊãíÁµï</p>
                                    <p class="text-2xl font-bold" id="userStatRejected">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚ùå</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üë•</span> Áî®Êà∂ÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="exportUsersToCSV()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors">
                                    üì• ÂåØÂá∫CSV
                                </button>
                                <button id="addUserBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢ûÁî®Êà∂
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ËßíËâ≤:</label>
                                <select id="userFilterRole" onchange="filterUsersAdvanced()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="admin">üëë ÁÆ°ÁêÜÂì°</option>
                                    <option value="moderator">üõ°Ô∏è Áâà‰∏ª</option>
                                    <option value="user">üë§ ÊôÆÈÄöÁî®Êà∂</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÁãÄÊÖã:</label>
                                <select id="userFilterStatus" onchange="filterUsersAdvanced()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="approved">‚úÖ Â∑≤ÊâπÂáÜ</option>
                                    <option value="pending">‚è≥ ÂæÖÂØ©Ê†∏</option>
                                    <option value="rejected">‚ùå Â∑≤ÊãíÁµï</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[200px]">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÊêúÂ∞ã:</label>
                                <input type="text" id="userSearchInput" oninput="filterUsersAdvanced()" placeholder="ÂßìÂêç„ÄÅÈÉµÁÆ±..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                            </div>
                            <button onclick="clearUserFilters()" class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                ‚úï Ê∏ÖÈô§
                            </button>
                        </div>

                        <!-- Users List -->
                        <div id="usersLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="usersList" class="space-y-4 hidden"></div>
                        <div id="usersEmptyState" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">üë§</div>
                            <p class="text-gray-500 dark:text-gray-400 text-lg">Êö´ÁÑ°Áî®Êà∂Ë≥áÊñô</p>
                            <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">ÈªûÊìä„ÄåÊñ∞Â¢ûÁî®Êà∂„Äç‰æÜÂª∫Á´ãÁ¨¨‰∏Ä‰ΩçÁî®Êà∂</p>
                        </div>
                    </div>
                </div>

                <!-- Hero Section -->
                <div id="heroSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">È¶ñÈ†ÅÊ®ôË™ûË®≠ÁΩÆ</h2>
                        </div>

                        <form id="heroForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2">‰∏ªÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ê≠°Ëøé‰æÜÂà∞ÁßëÊäÄÂ≠∏ÊúÉ">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÂâØÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroSubtitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Êé¢Á¥¢ÁßëÊäÄÔºåÂâµÊñ∞Êú™‰æÜ">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">‰∏ªÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ê¨¢ËøéÊù•Âà∞ÁßëÊäÄÂ≠¶‰ºö">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÂâØÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                                <input type="text" id="heroSubtitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Êé¢Á¥¢ÁßëÊäÄÔºåÂàõÊñ∞Êú™Êù•">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">‰∏ªÊ®ôÈ°åÔºàEnglishÔºâ</label>
                                <input type="text" id="heroTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Welcome to Tech Society">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÂâØÊ®ôÈ°åÔºàEnglishÔºâ</label>
                                <input type="text" id="heroSubtitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Explore Technology, Innovate the Future">
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                    ÂÑ≤Â≠òÊ®ôË™û
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Announcements Section -->
                <div id="announcementsSection" class="section hidden">
                    <!-- Áµ±Ë®àÈù¢Êùø -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm">ÂÖ®ÈÉ®ÂÖ¨Âëä</p>
                                    <p class="text-2xl font-bold" id="annStatTotal">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üì¢</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">ÂïüÁî®‰∏≠</p>
                                    <p class="text-2xl font-bold" id="annStatActive">0</p>
                                </div>
                                <span class="text-3xl opacity-80">‚úÖ</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm">ÁΩÆÈ†Ç</p>
                                    <p class="text-2xl font-bold" id="annStatPinned">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üìå</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-4 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">Á∑äÊÄ•</p>
                                    <p class="text-2xl font-bold" id="annStatUrgent">0</p>
                                </div>
                                <span class="text-3xl opacity-80">üî¥</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="text-3xl">üì£</span> ÊúÄÊñ∞Ë®äÊÅØÁÆ°ÁêÜ
                            </h2>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="refreshAnnouncements()" class="px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors" title="Âà∑Êñ∞">
                                    üîÑ Âà∑Êñ∞
                                </button>
                                <button id="addAnnouncementBtn" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors shadow-md">
                                    ‚ûï Êñ∞Â¢ûË®äÊÅØ
                                </button>
                            </div>
                        </div>

                        <!-- ÁØ©ÈÅ∏Â∑•ÂÖ∑Âàó -->
                        <div class="flex flex-wrap gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÂàÜÈ°û:</label>
                                <select id="annFilterCategory" onchange="filterAnnouncements()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="general">üü¢ ‰∏ÄËà¨</option>
                                    <option value="important">üü° ÈáçË¶Å</option>
                                    <option value="urgent">üî¥ Á∑äÊÄ•</option>
                                    <option value="event">üîµ Ê¥ªÂãï</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÁãÄÊÖã:</label>
                                <select id="annFilterStatus" onchange="filterAnnouncements()" class="px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                                    <option value="">ÂÖ®ÈÉ®</option>
                                    <option value="active">ÂïüÁî®‰∏≠</option>
                                    <option value="inactive">Â∑≤ÂÅúÁî®</option>
                                    <option value="pinned">ÁΩÆÈ†Ç</option>
                                    <option value="scheduled">È†êÂÆöÁôºÂ∏É</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 flex-1 min-w-[200px]">
                                <label class="text-sm font-medium text-gray-600 dark:text-gray-300">ÊêúÂ∞ã:</label>
                                <input type="text" id="annSearchInput" oninput="filterAnnouncements()" placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠ó..." class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary outline-none">
                            </div>
                            <button onclick="clearAnnouncementFilters()" class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                ‚úï Ê∏ÖÈô§ÁØ©ÈÅ∏
                            </button>
                        </div>

                        <!-- Announcements List -->
                        <div id="announcementsLoading" class="flex justify-center py-12">
                            <div class="loading-spinner"></div>
                        </div>
                        <div id="announcementsList" class="space-y-4 hidden"></div>
                        <div id="announcementsEmptyState" class="text-center py-12 hidden">
                            <div class="text-6xl mb-4">üì≠</div>
                            <p class="text-gray-500 dark:text-gray-400 text-lg">Êö´ÁÑ°Ë®äÊÅØË≥áÊñô</p>
                            <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">ÈªûÊìä„ÄåÊñ∞Â¢ûË®äÊÅØ„Äç‰æÜÂª∫Á´ãÁ¨¨‰∏ÄÂâáÂÖ¨Âëä</p>
                        </div>
                    </div>
                </div>

                <!-- Contact Settings Section -->
                <div id="contactSettingsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ËÅØÁµ°Ë≥áË®äË®≠ÁΩÆ</h2>
                        </div>

                        <form id="contactSettingsForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÁπÅÈ´î‰∏≠ÊñáÂú∞ÂùÄ</label>
                                <input type="text" id="contactAddressZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: È¶ôÊ∏Ø‰πùÈæç...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Á∞°È´î‰∏≠ÊñáÂú∞ÂùÄ</label>
                                <input type="text" id="contactAddressZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: È¶ôÊ∏Ø‰πùÈæô...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">English Address</label>
                                <input type="text" id="contactAddressEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="e.g., Kowloon, Hong Kong...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÈõªË©±</label>
                                <input type="tel" id="contactPhone" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="+852 1234 5678">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂</label>
                                <input type="email" id="contactEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="contact@techsociety.com">
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                    ÂÑ≤Â≠òËÅØÁµ°Ë≥áË®ä
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Anthem Settings Section -->
                <div id="anthemSettingsSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ÊúÉÊ≠åË®≠ÁΩÆ</h2>
                        </div>

                        <form id="anthemSettingsForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÁπÅÈ´î‰∏≠ÊñáÊ®ôÈ°å</label>
                                    <input type="text" id="anthemTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: ÁßëÊäÄÂ≠∏ÊúÉÊúÉÊ≠å">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Á∞°È´î‰∏≠ÊñáÊ®ôÈ°å</label>
                                    <input type="text" id="anthemTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: ÁßëÊäÄÂ≠¶‰ºö‰ºöÊ≠å">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">English Title</label>
                                    <input type="text" id="anthemTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="e.g., Science and Technology Club Anthem">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÁπÅÈ´î‰∏≠ÊñáÊèèËø∞</label>
                                    <textarea id="anthemDescZhTW" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="‰æãÂ¶Ç: ËÅÜËÅΩÊàëÂÄëÁöÑÊúÉÊ≠åÔºåÊÑüÂèóÁßëÊäÄÂ≠∏ÊúÉÁöÑÁ≤æÁ•ûËàáÁÜ±ÊÉÖ"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Á∞°È´î‰∏≠ÊñáÊèèËø∞</label>
                                    <textarea id="anthemDescZhCN" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="‰æãÂ¶Ç: ËÅÜÂê¨Êàë‰ª¨ÁöÑ‰ºöÊ≠åÔºåÊÑüÂèóÁßëÊäÄÂ≠¶‰ºöÁöÑÁ≤æÁ•û‰∏éÁÉ≠ÊÉÖ"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">English Description</label>
                                    <textarea id="anthemDescEn" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="e.g., Listen to our anthem and feel the spirit and passion"></textarea>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                    ÂÑ≤Â≠òÊúÉÊ≠åË®≠ÁΩÆ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Visitor Stats Section -->
                <div id="visitorStatsSection" class="section hidden">
                    <div class="space-y-6">
                        <!-- Real-time Stats -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Âç≥ÊôÇË®™ÂÆ¢Êï∏Êìö</h2>
                                <button onclick="refreshVisitorStats()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg text-sm font-semibold transition-colors">
                                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Âà∑Êñ∞
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <!-- Online Visitors -->
                                <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm opacity-80">ÁõÆÂâçÂú®Á∑öË®™ÂÆ¢</p>
                                            <p class="text-4xl font-bold mt-2" id="statOnlineVisitors">-</p>
                                        </div>
                                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>

                                <!-- Today Visitors -->
                                <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm opacity-80">‰ªäÊó•Ë®™ÂïèÊï∏</p>
                                            <p class="text-4xl font-bold mt-2" id="statTodayVisitors">-</p>
                                        </div>
                                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                </div>

                                <!-- Total Visitors -->
                                <div class="bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm opacity-80">Á∏ΩË®™ÂïèÊï∏</p>
                                            <p class="text-4xl font-bold mt-2" id="statTotalVisitors">-</p>
                                        </div>
                                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Kick Out Actions -->
                            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-semibold mb-4">Ë®™ÂÆ¢ÁÆ°ÁêÜÊìç‰Ωú</h3>
                                <div class="flex flex-wrap gap-3">
                                    <button onclick="kickOutAllVisitors()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-colors flex items-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Ë∏¢Âá∫ÊâÄÊúâË®™ÂÆ¢
                                    </button>
                                    <button onclick="sendKickWarning()" class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-colors flex items-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                        </svg>
                                        ÁôºÈÄÅË∏¢Âá∫Ë≠¶ÂëäÔºà30ÁßíÔºâ
                                    </button>
                                    <button onclick="cancelKickWarning()" id="cancelKickWarningBtn" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors flex items-center hidden">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                        ÂèñÊ∂àË≠¶Âëä
                                    </button>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-3">
                                    <span class="text-red-600 dark:text-red-400">Ë∏¢Âá∫ÊâÄÊúâË®™ÂÆ¢</span>ÔºöÁ´ãÂç≥Ë∏¢Âá∫ÊâÄÊúâÂú®Á∑öË®™ÂÆ¢„ÄÇ
                                    <span class="text-orange-600 dark:text-orange-400 ml-3">ÁôºÈÄÅË∏¢Âá∫Ë≠¶Âëä</span>ÔºöË®™ÂÆ¢ÈúÄÂú®30ÁßíÂÖßÈªûÊìäÁ¢∫Ë™çÔºåÂê¶ÂâáË¢´Ë∏¢Âá∫„ÄÇ
                                </p>
                            </div>
                        </div>

                        <!-- Website Status Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Á∂≤Á´ôÁãÄÊÖã</h2>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                <div>
                                    <h3 class="font-semibold text-lg">ÂÅúÁî®Á∂≤Á´ô</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                        ÂÅúÁî®ÂæåÔºåË®™ÂÆ¢Â∞áÁúãÂà∞Á∂≠Ë≠∑È†ÅÈù¢„ÄÇÁÆ°ÁêÜÂì°‰ªçÂèØÁôªÂÖ•ÈÄ≤ÂÖ•„ÄÇ
                                    </p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="websiteDisabledToggle" class="sr-only peer">
                                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 dark:peer-focus:ring-red-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-red-600"></div>
                                </label>
                            </div>

                            <div id="websiteStatusMessage" class="mt-4 p-3 rounded-lg hidden">
                            </div>
                        </div>

                        <!-- Visitor Limit Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Ë®™ÂÆ¢ÈôêÂà∂Ë®≠ÁΩÆ</h2>
                            </div>

                            <form id="visitorSettingsForm" class="space-y-6">
                                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4">
                                    <div class="flex items-start">
                                        <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                        </svg>
                                        <div>
                                            <p class="text-sm font-semibold text-yellow-800 dark:text-yellow-300">Ê≥®ÊÑè</p>
                                            <p class="text-sm text-yellow-700 dark:text-yellow-400 mt-1">
                                                Áï∂Ë®≠ÁΩÆÁöÑÊúÄÂ§ßË®™ÂÆ¢Êï∏Ë∂ÖÈÅéÊôÇÔºåÊñ∞Ë®™ÂÆ¢Â∞áÁúãÂà∞ÊéíÈöäÁ≠âÂÄôÈ†ÅÈù¢„ÄÇË®≠ÁΩÆÁÇ∫ 0 Ë°®Á§∫ÁÑ°ÈôêÂà∂„ÄÇ
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÊúÄÂ§ßÂêåÊôÇË®™ÂÆ¢Êï∏</label>
                                    <input type="number" id="visitorMaxLimit" min="0" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: 100Ôºà0 Ë°®Á§∫ÁÑ°ÈôêÂà∂Ôºâ">
                                    <p class="text-xs text-gray-500 mt-2">Ëº∏ÂÖ• 0 Ë°®Á§∫‰∏çÈôêÂà∂Ë®™ÂÆ¢Êï∏Èáè</p>
                                </div>

                                <div class="flex justify-end">
                                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÂÑ≤Â≠òË®≠ÁΩÆ
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Ë®™ÂÆ¢Ë∂®Âã¢ÂúñË°® -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üìä Ë®™ÂÆ¢Ë∂®Âã¢ÂàÜÊûê</h2>
                                <div class="flex space-x-2">
                                    <button onclick="setChartPeriod('7d')" class="chart-period-btn px-3 py-1 bg-primary text-white rounded text-sm" data-period="7d">7Â§©</button>
                                    <button onclick="setChartPeriod('30d')" class="chart-period-btn px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded text-sm" data-period="30d">30Â§©</button>
                                </div>
                            </div>
                            <div id="visitorTrendChart" class="h-64 flex items-end justify-between space-x-1 bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                <!-- ÂúñË°®Â∞áÂãïÊÖãÁîüÊàê -->
                            </div>
                        </div>

                        <!-- Ë®™ÂïèÊôÇÊÆµÂàÜÊûê -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üïê Ë®™ÂïèÊôÇÊÆµÂàÜÊûê</h2>
                            </div>
                            <div id="hourlyChart" class="grid grid-cols-12 gap-1 h-32">
                                <!-- 24Â∞èÊôÇÂúñË°®Â∞áÂãïÊÖãÁîüÊàê -->
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-2">
                                <span>0ÊôÇ</span>
                                <span>6ÊôÇ</span>
                                <span>12ÊôÇ</span>
                                <span>18ÊôÇ</span>
                                <span>24ÊôÇ</span>
                            </div>
                        </div>

                        <!-- Ë®≠ÂÇôÈ°ûÂûãÁµ±Ë®à -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üì± Ë®≠ÂÇôÈ°ûÂûãÁµ±Ë®à</h2>
                            </div>
                            <div class="grid grid-cols-3 gap-4" id="deviceStatsContainer">
                                <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üì±</div>
                                    <p class="text-2xl font-bold text-blue-600" id="mobileCount">0</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">ÊâãÊ©ü</p>
                                </div>
                                <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üìü</div>
                                    <p class="text-2xl font-bold text-green-600" id="tabletCount">0</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Âπ≥Êùø</p>
                                </div>
                                <div class="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4 text-center">
                                    <div class="text-3xl mb-2">üíª</div>
                                    <p class="text-2xl font-bold text-purple-600" id="desktopCount">0</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">ÈõªËÖ¶</p>
                                </div>
                            </div>
                        </div>

                        <!-- Êï∏ÊìöÁÆ°ÁêÜ -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üì• Êï∏ÊìöÁÆ°ÁêÜ</h2>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                    <h3 class="font-semibold mb-3">Â∞éÂá∫Êï∏Êìö</h3>
                                    <div class="flex flex-wrap gap-2">
                                        <button onclick="exportVisitorStats()" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                            üìä Â∞éÂá∫Ë®™ÂÆ¢Áµ±Ë®à CSV
                                        </button>
                                        <button onclick="exportContactMessages()" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                            ‚úâÔ∏è Â∞éÂá∫ËÅØÁµ°Ë®äÊÅØ CSV
                                        </button>
                                    </div>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                    <h3 class="font-semibold mb-3">Ëá™ÂãïÊ∏ÖÁêÜ</h3>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Ëá™ÂãïÊ∏ÖÁêÜË∂ÖÈÅé30Â§©ÁöÑË®™ÂÆ¢Ë®òÈåÑ</p>
                                        </div>
                                        <button onclick="cleanOldData()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                            üóëÔ∏è Á´ãÂç≥Ê∏ÖÁêÜ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÁÆ°ÁêÜÂì°Êìç‰ΩúÊó•Ë™å -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üìù ÁÆ°ÁêÜÂì°Êìç‰ΩúÊó•Ë™å</h2>
                                <button onclick="loadAdminLogs()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg text-sm font-semibold transition-colors">
                                    Âà∑Êñ∞
                                </button>
                            </div>
                            <div id="adminLogsContainer" class="max-h-64 overflow-y-auto space-y-2">
                                <p class="text-gray-500 dark:text-gray-400 text-center py-4">ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>

                        <!-- Historical Data -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">Ê≠∑Âè≤Ë®™ÂïèÊï∏Êìö</h2>
                            </div>

                            <div id="visitorHistoryLoading" class="flex justify-center py-12">
                                <div class="loading-spinner"></div>
                            </div>

                            <div id="visitorHistoryList" class="hidden">
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                                <th class="px-4 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Êó•Êúü</th>
                                                <th class="px-4 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Ë®™ÂïèÊ¨°Êï∏</th>
                                            </tr>
                                        </thead>
                                        <tbody id="visitorHistoryTableBody">
                                            <!-- Êï∏ÊìöÂ∞áÂãïÊÖãÂä†Ëºâ -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div id="visitorHistoryEmpty" class="hidden text-center py-12">
                                <p class="text-gray-500 dark:text-gray-400">Êö´ÁÑ°Ê≠∑Âè≤Êï∏Êìö</p>
                            </div>
                        </div>

                        <!-- ÊéíÈöäÈ†ÅÈù¢Ëá™ÂÆöÁæ© -->
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold">üé´ ÊéíÈöäÈ†ÅÈù¢Ë®≠ÁΩÆ</h2>
                            </div>
                            <form id="queueSettingsForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Ëá™ÂÆöÁæ©ÊéíÈöäË®äÊÅØ</label>
                                    <textarea id="queueCustomMessage" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶ÇÔºöÊÑüË¨ùÊÇ®ÁöÑËÄêÂøÉÁ≠âÂæÖÔºåÊàëÂÄëÊúÉÁõ°Âø´ÁÇ∫ÊÇ®ÊúçÂãô..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">ÊéíÈöäÈ†ÅÈù¢ÂúñÁâá URL</label>
                                    <input type="url" id="queueImageUrl" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="https://example.com/image.jpg">
                                    <p class="text-xs text-gray-500 mt-1">ÁïôÁ©∫Ââá‰ΩøÁî®È†êË®≠Ê®£Âºè</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2">È†êË®àÊØè‰ΩçË®™ÂÆ¢Á≠âÂæÖÊôÇÈñìÔºàÂàÜÈêòÔºâ</label>
                                    <input type="number" id="queueWaitTimePerPerson" min="1" max="60" value="2" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="2">
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÂÑ≤Â≠òÊéíÈöäË®≠ÁΩÆ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Profile Section -->
                <div id="profileSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ÂÄã‰∫∫Ë≥áÊñô</h2>
                        </div>

                        <!-- Current User Info Display -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">Áï∂ÂâçË≥áÊñô</h3>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Áî®Êà∂Âêç</p>
                                        <p class="font-semibold" id="profileCurrentUsername">ËºâÂÖ•‰∏≠...</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">ÈõªÂ≠êÈÉµ‰ª∂</p>
                                        <p class="font-semibold" id="profileCurrentEmail">ËºâÂÖ•‰∏≠...</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">ÂßìÂêç</p>
                                        <p class="font-semibold" id="profileCurrentName">ËºâÂÖ•‰∏≠...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Update Name Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">‰øÆÊîπÂßìÂêç</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">‰øÆÊîπÂßìÂêçÈúÄË¶ÅÈ©óË≠âÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êñ∞ÂßìÂêç</label>
                                    <input type="text" id="profileNewName" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•Êñ∞ÂßìÂêç">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="startUpdateName()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÁôºÈÄÅÈ©óË≠âÁ¢º
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Update Username Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6 mb-6">
                            <h3 class="text-lg font-semibold mb-4">‰øÆÊîπÁî®Êà∂Âêç</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">‰øÆÊîπÁî®Êà∂ÂêçÈúÄË¶ÅÈ©óË≠âÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êñ∞Áî®Êà∂Âêç</label>
                                    <input type="text" id="profileNewUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•Êñ∞Áî®Êà∂Âêç">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="startUpdateUsername()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÁôºÈÄÅÈ©óË≠âÁ¢º
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Update Email Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                            <h3 class="text-lg font-semibold mb-4">‰øÆÊîπÈõªÂ≠êÈÉµ‰ª∂</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">‰øÆÊîπÈõªÂ≠êÈÉµ‰ª∂ÈúÄË¶ÅÈ©óË≠âËàäÈõªÈÉµÂíåÊñ∞ÈõªÈÉµ</p>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2">Êñ∞ÈõªÂ≠êÈÉµ‰ª∂</label>
                                    <input type="email" id="profileNewEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•Êñ∞ÈõªÂ≠êÈÉµ‰ª∂">
                                </div>
                                <div class="flex justify-end">
                                    <button onclick="startUpdateEmail()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                                        ÈñãÂßãÈ©óË≠âÊµÅÁ®ã
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Member Card Section -->
                <div id="memberCardSection" class="section hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-3">
                                <span class="text-3xl">üí≥</span> ÊúÉÂì°Âç°Á≥ªÁµ±
                            </h2>
                            <button onclick="openMemberCardPopup()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-700 hover:to-cyan-700 text-white rounded-lg font-semibold transition-all flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                </svg>
                                ÈñãÂïüÊúÉÂì°Âç°Ë®≠Ë®àÁ≥ªÁµ±
                            </button>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-gradient-to-br from-purple-500/10 to-cyan-500/10 rounded-xl p-6 border border-purple-500/20">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold">Ë®òÂêçÊúÉÂì°Âç°</h3>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÂåÖÂê´ÊúÉÂì°ÂßìÂêç„ÄÅÁ∑®Ëôü„ÄÅËÅ∑‰ΩçÂíåÊúâÊïàÊó•Êúü</p>
                            </div>
                            <div class="bg-gradient-to-br from-green-500/10 to-teal-500/10 rounded-xl p-6 border border-green-500/20">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold">Ë≤ºÁ¥ôÁâàÊúÉÂì°Âç°</h3>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÂßìÂêçÂíåÊúâÊïàÊó•Êúü‰ΩøÁî®ÈÄèÊòéË≤ºÁ¥ô</p>
                            </div>
                            <div class="bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-xl p-6 border border-blue-500/20">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold">‰∏çË®òÂêçÊúÉÂì°Âç°</h3>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈÄöÁî®ÁâàÊú¨ÔºåÁÑ°ÂÄã‰∫∫Ë≥áÊñô</p>
                            </div>
                            <div class="bg-gradient-to-br from-yellow-500/10 to-orange-500/10 rounded-xl p-6 border border-yellow-500/20">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold">Ëá®ÊôÇÊúÉÂì°Âç°</h3>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">ÈÅ©Áî®ÊñºË®™ÂÆ¢ÊàñÁü≠ÊúüÊúÉÂì°</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6">
                            <h3 class="font-semibold mb-4 flex items-center gap-2">
                                <svg class="w-5 h-5 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                ‰ΩøÁî®Ë™™Êòé
                            </h3>
                            <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                                <li class="flex items-start gap-2">
                                    <span class="text-green-500 mt-0.5">‚úì</span>
                                    ÈªûÊìä„ÄåÈñãÂïüÊúÉÂì°Âç°Ë®≠Ë®àÁ≥ªÁµ±„ÄçÈÄ≤ÂÖ•Ë®≠Ë®àÈ†ÅÈù¢
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-500 mt-0.5">‚úì</span>
                                    ÈÅ∏ÊìáÊúÉÂì°Âç°È°ûÂûãÔºöË®òÂêç„ÄÅË≤ºÁ¥ôÁâà„ÄÅ‰∏çË®òÂêçÊàñËá®ÊôÇ
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-500 mt-0.5">‚úì</span>
                                    Â°´ÂØ´ÊúÉÂì°Ë≥áÊñôÔºà‰∏≠Ëã±ÊñáÂßìÂêç„ÄÅÁ∑®Ëôü„ÄÅËÅ∑‰ΩçÁ≠âÔºâ
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-500 mt-0.5">‚úì</span>
                                    ‰∏ãËºâÊúÉÂì°Âç°ÂúñÁâáÁî®ÊñºË£Ω‰ΩúÂØ¶È´îÂç°Áâá
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-500 mt-0.5">‚úì</span>
                                    Ë≤ºÁ¥ôÁâàÂèØÂè¶Â§ñ‰∏ãËºâÈÄèÊòéËÉåÊôØË≤ºÁ¥ô
                                </li>
                            </ul>
                        </div>

                        <div class="mt-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800">
                            <div class="flex items-start gap-3">
                                <svg class="w-5 h-5 text-purple-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                </svg>
                                <div>
                                    <p class="font-medium text-purple-700 dark:text-purple-300">ÊèêÁ§∫</p>
                                    <p class="text-sm text-purple-600 dark:text-purple-400">ÊúÉÂì°Âç°Ë®≠Ë®àÁ≥ªÁµ±ÊîØÊè¥‰∏≠Ëã±ÊñáÂßìÂêç„ÄÅÂ§öÁ®ÆËÅ∑‰ΩçÔºàÊúÉÈï∑„ÄÅÂâØÊúÉÈï∑„ÄÅ‰∏ªÂ∏≠Á≠âÔºâÔºå‰∏¶ÂèØ‰∏ãËºâÈ´òÊ∏ÖÂúñÁâáÁî®ÊñºÂç∞Âà∑„ÄÇ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Member Card Popup Modal -->
                <div id="memberCardModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[100] p-4">
                    <div class="bg-gray-900 rounded-2xl shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col">
                        <div class="flex justify-between items-center p-4 border-b border-gray-700">
                            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                                <span class="text-2xl">üí≥</span> ÊúÉÂì°Âç°Ë®≠Ë®àÁ≥ªÁµ±
                            </h3>
                            <button onclick="closeMemberCardPopup()" class="text-gray-400 hover:text-white transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="flex-1 overflow-hidden">
                            <iframe id="memberCardIframe" class="w-full h-full border-0"></iframe>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Activity Modal -->
    <div id="activityModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="activityModalTitle">Êñ∞Â¢ûÊ¥ªÂãï</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="activityForm" class="space-y-4">
                <input type="hidden" id="activityId">

                <!-- Ê¥ªÂãïÊ®ôÈ°å - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="activityTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="activityTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊ®ôÈ°åÔºàEnglishÔºâ</label>
                        <input type="text" id="activityTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊó•Êúü</label>
                    <input type="text" id="activityDate" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: 2024Âπ¥3Êúà15Êó•" required>
                </div>

                <!-- Ê¥ªÂãïÊèèËø∞ - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊèèËø∞ÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <textarea id="activityDescriptionZhTW" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊèèËø∞ÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <textarea id="activityDescriptionZhCN" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÊèèËø∞ÔºàEnglishÔºâ</label>
                        <textarea id="activityDescriptionEn" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Ê¥ªÂãïÈÄ£Áµê (ÈÅ∏Â°´)</label>
                    <input type="url" id="activityLink" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="https://example.com">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Project Modal -->
    <div id="projectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="projectModalTitle">Êñ∞Â¢ûÂ∞àÊ°à</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="projectForm" class="space-y-4">
                <input type="hidden" id="projectId">

                <!-- Â∞àÊ°àÊ®ôÈ°å - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊ®ôÈ°åÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="projectTitleZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊ®ôÈ°åÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="projectTitleZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊ®ôÈ°åÔºàEnglishÔºâ</label>
                        <input type="text" id="projectTitleEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÁãÄÊÖã</label>
                    <select id="projectStatus" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="ÈÄ≤Ë°å‰∏≠">ÈÄ≤Ë°å‰∏≠</option>
                        <option value="Â∑≤ÂÆåÊàê">Â∑≤ÂÆåÊàê</option>
                        <option value="Ë®àÂäÉ‰∏≠">Ë®àÂäÉ‰∏≠</option>
                    </select>
                </div>

                <!-- Â∞àÊ°àÊèèËø∞ - Â§öË™ûË®Ä -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊèèËø∞ÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <textarea id="projectDescriptionZhTW" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊèèËø∞ÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <textarea id="projectDescriptionZhCN" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÊèèËø∞ÔºàEnglishÔºâ</label>
                        <textarea id="projectDescriptionEn" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">‰ΩøÁî®ÊäÄË°ì (Áî®ÈÄóËôüÂàÜÈöî)</label>
                    <input type="text" id="projectTechnologies" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰æãÂ¶Ç: React, Node.js, MongoDB">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂèÉËàáÊàêÂì°Êï∏</label>
                    <input type="number" id="projectMembers" min="0" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="0">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Â∞àÊ°àÈÄ£ÁµêÔºàÈÅ∏Â°´ÔºåÊØèË°å‰∏ÄÂÄãÔºâ</label>
                    <textarea id="projectLinks" rows="3" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" placeholder="https://github.com/...&#10;https://example.com/demo"></textarea>
                    <p class="text-xs text-gray-500 mt-1">ÊîØÊè¥Â§öÂÄãÈÄ£ÁµêÔºåÊØèË°åËº∏ÂÖ•‰∏ÄÂÄã URL</p>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div id="teamMemberModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="teamMemberModalTitle">Êñ∞Â¢ûÂúòÈöäÊàêÂì°</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="teamMemberForm" class="space-y-4">
                <input type="hidden" id="teamMemberId">

                <!-- Name in 3 languages -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">ÊàêÂì°ÂßìÂêçÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="memberNameZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Âºµ‰∏â">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ÊàêÂì°ÂßìÂêçÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="memberNameZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Âº†‰∏â">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ÊàêÂì°ÂßìÂêçÔºàEnglishÔºâ</label>
                        <input type="text" id="memberNameEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Zhang San">
                    </div>
                </div>

                <!-- Position in 3 languages -->
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-semibold mb-2">ËÅ∑‰ΩçÔºàÁπÅÈ´î‰∏≠ÊñáÔºâ<span class="text-red-500">*</span></label>
                        <input type="text" id="memberPositionZhTW" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="ÊúÉÈï∑">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ËÅ∑‰ΩçÔºàÁ∞°È´î‰∏≠ÊñáÔºâ</label>
                        <input type="text" id="memberPositionZhCN" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="‰ºöÈïø">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ËÅ∑‰ΩçÔºàEnglishÔºâ</label>
                        <input type="text" id="memberPositionEn" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="President">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂ÔºàÈÅ∏Â°´Ôºâ</label>
                    <input type="email" id="memberEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="example@email.com">
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">ÊéíÂ∫èÈ†ÜÂ∫è<span class="text-red-500">*</span></label>
                    <input type="number" id="memberOrder" min="0" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="0">
                    <p class="text-xs text-gray-500 mt-1">Êï∏Â≠óË∂äÂ∞èÊéíÂ∫èË∂äÂâç</p>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">ÂõûË¶ÜË®äÊÅØ</h3>
                <button onclick="closeReplyModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="space-y-4 mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Áôº‰ª∂‰∫∫</p>
                    <p class="font-semibold" id="replyEmail"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">‰∏ªÊó®</p>
                    <p class="font-semibold" id="replySubject"></p>
                </div>
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">ÂÖßÂÆπ</p>
                    <p id="replyOriginalMessage" class="whitespace-pre-wrap"></p>
                </div>
            </div>

            <form id="replyForm" onsubmit="handleReply(event)" class="space-y-4">
                <input type="hidden" id="replyContactId">
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂõûË¶ÜÂÖßÂÆπ</label>
                    <textarea id="replyContent" rows="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none" required placeholder="Ë´ãËº∏ÂÖ•ÂõûË¶ÜÂÖßÂÆπ..."></textarea>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeReplyModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>ÁôºÈÄÅÂõûË¶Ü
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Set Username Modal -->
    <div id="setUsernameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="text-center mb-6">
                <svg class="w-16 h-16 mx-auto mb-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <h3 class="text-2xl font-bold">Ë®≠ÂÆöÁî®Êà∂Âêç</h3>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Ë´ãÁÇ∫ÊÇ®ÁöÑÂ∏≥ËôüË®≠ÂÆö‰∏ÄÂÄãÂîØ‰∏ÄÁöÑÁî®Êà∂Âêç</p>
            </div>

            <form id="setUsernameForm" onsubmit="return handleSetUsername(event)" class="space-y-4">
                <div>
                    <label for="newUsername" class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç</label>
                    <input type="text" id="newUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none" placeholder="3-20ÂÄãÂ≠óÁ¨¶ÔºåÂèØÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶" required pattern="[a-zA-Z0-9_-]{3,20}" title="Áî®Êà∂ÂêçÂøÖÈ†àÁÇ∫3-20ÂÄãÂ≠óÁ¨¶ÔºåÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Áî®Êà∂ÂêçË®≠ÂÆöÂæå‰∏çÂèØÊõ¥Êîπ</p>
                </div>
                <button type="submit" id="setUsernameBtn" class="w-full px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">
                    Á¢∫Ë™çË®≠ÂÆö
                </button>
            </form>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div id="userModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="userModalTitle">Á∑®ËºØÁî®Êà∂</h3>
                <button class="closeUserModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="userForm" class="space-y-4">
                <input type="hidden" id="userId">
                <div>
                    <label class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç</label>
                    <input type="text" id="userUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" readonly>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Áî®Êà∂Âêç‰∏çÂèØ‰øÆÊîπ</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂</label>
                    <input type="email" id="userEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" readonly>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÈõªÂ≠êÈÉµ‰ª∂‰∏çÂèØ‰øÆÊîπ</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂßìÂêç</label>
                    <input type="text" id="userName" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ËßíËâ≤</label>
                    <select id="userRole" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="user">ÊôÆÈÄöÁî®Êà∂</option>
                        <option value="admin">ÁÆ°ÁêÜÂì°</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÁãÄÊÖã</label>
                    <select id="userStatus" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="pending">ÂæÖÂØ©Ê†∏</option>
                        <option value="approved">Â∑≤ÊâπÂáÜ</option>
                        <option value="rejected">Â∑≤ÊãíÁµï</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeUserModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÂÑ≤Â≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Êñ∞Â¢ûÁî®Êà∂</h3>
                <button class="closeAddUserModal text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="addUserForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2">ÁúüÂØ¶ÂßìÂêç <span class="text-red-500">*</span></label>
                    <input type="text" id="addUserName" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•ÁúüÂØ¶ÂßìÂêç" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Áî®Êà∂Âêç <span class="text-red-500">*</span></label>
                    <input type="text" id="addUserUsername" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="3-20Â≠óÁ¨¶ÔºåÂÉÖÂ≠óÊØçÊï∏Â≠ó‰∏ãÂäÉÁ∑öÈÄ£Â≠óÁ¨¶" required>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÂÉÖÂÖÅË®±Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑ö(_)ÂíåÈÄ£Â≠óÁ¨¶(-)</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÈõªÂ≠êÈÉµ‰ª∂ <span class="text-red-500">*</span></label>
                    <input type="email" id="addUserEmail" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãËº∏ÂÖ•ÈõªÂ≠êÈÉµ‰ª∂" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÂØÜÁ¢º <span class="text-red-500">*</span></label>
                    <input type="password" id="addUserPassword" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ëá≥Â∞ë6‰Ωç" required>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ÂØÜÁ¢ºÈï∑Â∫¶Ëá≥Â∞ë6‰Ωç</p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Á¢∫Ë™çÂØÜÁ¢º <span class="text-red-500">*</span></label>
                    <input type="password" id="addUserPasswordConfirm" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none" placeholder="Ë´ãÂÜçÊ¨°Ëº∏ÂÖ•ÂØÜÁ¢º" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ËßíËâ≤ <span class="text-red-500">*</span></label>
                    <select id="addUserRole" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="user">ÊôÆÈÄöÁî®Êà∂</option>
                        <option value="admin">ÁÆ°ÁêÜÂì°</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">ÁãÄÊÖã <span class="text-red-500">*</span></label>
                    <select id="addUserStatus" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        <option value="approved" selected>Â∑≤ÊâπÂáÜ</option>
                        <option value="pending">ÂæÖÂØ©Ê†∏</option>
                        <option value="rejected">Â∑≤ÊãíÁµï</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" class="closeAddUserModal px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                    <button type="submit" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">ÁôºÈÄÅÈ©óË≠âÁ¢º</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Verify Modal -->
    <div id="addUserVerifyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeAddUserVerifyModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤Âêë <span class="font-semibold" id="addUserVerifyEmail"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º</label>
                    <input type="text" id="addUserVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeAddUserVerifyModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmAddUser()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™çÂâµÂª∫</button>
            </div>
        </div>
    </div>

    <!-- Verify Username Modal -->
    <!-- Verify Name Modal -->
    <div id="verifyNameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyNameModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤Âêë <span class="font-semibold" id="verifyNameEmail"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º</label>
                    <input type="text" id="nameVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyNameModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmUpdateName()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- Verify Username Modal -->
    <div id="verifyUsernameModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyUsernameModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤Âêë <span class="font-semibold" id="verifyUsernameEmail"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º</label>
                    <input type="text" id="usernameVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyUsernameModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmUpdateUsername()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- Verify Old Email Modal -->
    <div id="verifyOldEmailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âËàäÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyOldEmailModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤ÂêëÊÇ®ÁöÑËàäÈõªÈÉµ <span class="font-semibold" id="verifyOldEmailAddress"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•ËàäÈõªÈÉµÈ©óË≠âÁ¢º</label>
                    <input type="text" id="oldEmailVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyOldEmailModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmOldEmail()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">‰∏ã‰∏ÄÊ≠•</button>
            </div>
        </div>
    </div>

    <!-- Verify New Email Modal -->
    <div id="verifyNewEmailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">È©óË≠âÊñ∞ÈõªÂ≠êÈÉµ‰ª∂</h3>
                <button onclick="closeVerifyNewEmailModal()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="mb-6">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        ÊàëÂÄëÂ∑≤ÂêëÊÇ®ÁöÑÊñ∞ÈõªÈÉµ <span class="font-semibold" id="verifyNewEmailAddress"></span> ÁôºÈÄÅ‰∫ÜÈ©óË≠âÁ¢º
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">Ë´ãËº∏ÂÖ•Êñ∞ÈõªÈÉµÈ©óË≠âÁ¢º</label>
                    <input type="text" id="newEmailVerifyCode" maxlength="6" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none text-center text-2xl tracking-widest" placeholder="000000">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">È©óË≠âÁ¢ºÊúâÊïàÊúüÁÇ∫ 10 ÂàÜÈêò</p>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button onclick="closeVerifyNewEmailModal()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg font-semibold transition-colors">ÂèñÊ∂à</button>
                <button onclick="confirmUpdateEmail()" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // EmailJS ÈÖçÁΩÆÔºàËàá index.html ‰øùÊåÅ‰∏ÄËá¥Ôºâ
        const emailJSConfig = {
            publicKey: 'wSb5w9ZOF2-9HGCu1',
            serviceId: 'ats-ÁßëÊäÄÂ≠∏ÊúÉ',
            templateId: 'template_nhcptbe'  // Áî®ÊñºÈ©óË≠âÁ¢ºÁöÑÊ®°Êùø
        };

        // ÂàùÂßãÂåñ EmailJS ‰∏¶Á¢∫‰øùÂÖ®ÂüüÂèØÁî®
        emailjs.init(emailJSConfig.publicKey);
        window.emailjs = emailjs; // Á¢∫‰øù emailjs Âú®ÂÖ®Âüü‰ΩúÁî®ÂüüÂèØÁî®
        window.emailJSConfig = emailJSConfig; // Â∞áÈÖçÁΩÆÊö¥Èú≤Âà∞ÂÖ®Âüü
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc, deleteField, query, orderBy, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase ÈÖçÁΩÆÔºàËàá index.html ‰øùÊåÅ‰∏ÄËá¥Ôºâ
        const firebaseConfig = {
            apiKey: "AIzaSyCCXmBJkesxRi3ufdCRucd5vcmg-Ls_3Ks",
            authDomain: "tech-society-566dc.firebaseapp.com",
            projectId: "tech-society-566dc",
            storageBucket: "tech-society-566dc.firebasestorage.app",
            messagingSenderId: "1098408063649",
            appId: "1:1098408063649:web:ec07e23e03c43f92c7f6e0",
            measurementId: "G-05127H92FQ"
        };

        // ÂàùÂßãÂåñ Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Â≠òÂÇ®Âà∞ window ÂØπË±°‰ª•‰æõÂÖ∂‰ªñËÑöÊú¨‰ΩøÁî®
        window.firebaseAuth = auth;
        window.firebaseDB = db;
        window.firestoreModules = { collection, addDoc, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc, deleteField, query, orderBy, where, serverTimestamp };
        window.authModules = { signInWithEmailAndPassword, signOut, onAuthStateChanged };

        // üî• ÈáçË¶ÅÔºöÂú® Firebase SDK Âä†ËºâÂÆåÊàêÂæåÁ´ãÂç≥ÂàùÂßãÂåñ
        console.log('Firebase SDK loaded successfully!');
        window.firebaseReady = true;
        if (window.initAuth) {
            window.initAuth();
        }
    </script>

    <script>
        console.log('=== ADMIN PAGE LOADED ===');

        // Á∞°ÂñÆÁöÑ alert ÂáΩÊï∏Ôºà‰∏ç‰æùË≥¥ÂÖ∂‰ªñ‰ª£Á¢ºÔºâ
        function showAlertSimple(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // üî• Áõ¥Êé•ÂÆöÁæ©ÁôªÂÖ•ÂáΩÊï∏Ôºàinline ÊñπÂºèÁ¢∫‰øù‰∏ÄÂÆöËÉΩÂü∑Ë°åÔºâ
        window.handleLogin = async function(event) {
            event.preventDefault();
            event.stopPropagation();
            console.log('handleLogin called!');

            const emailInput = document.getElementById('loginEmail');
            const passwordInput = document.getElementById('loginPassword');
            const loginBtn = document.getElementById('loginBtn');

            const usernameOrEmail = emailInput.value.trim();
            const password = passwordInput.value;

            console.log('Username or Email:', usernameOrEmail);
            console.log('Password length:', password.length);

            if (!usernameOrEmail || !password) {
                showAlertSimple('Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç/ÈõªÈÉµÂíåÂØÜÁ¢º');
                loginBtn.textContent = 'ÁôªÂÖ•';
                loginBtn.disabled = false;
                return false;
            }

            loginBtn.textContent = 'ÁôªÂÖ•‰∏≠...';
            loginBtn.disabled = true;

            try {
                console.log('Waiting for Firebase...');
                // Á≠âÂæÖ Firebase Âä†Ëºâ
                let retries = 0;
                while (!window.authModules && retries < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    retries++;
                }

                if (!window.authModules) {
                    throw new Error('Firebase Âä†ËºâË∂ÖÊôÇ');
                }

                let email = usernameOrEmail;

                // Âà§Êñ∑Ëº∏ÂÖ•ÁöÑÊòØÈõªÈÉµÈÇÑÊòØÁî®Êà∂Âêç
                const isEmail = usernameOrEmail.includes('@');

                if (!isEmail) {
                    // Â¶ÇÊûú‰∏çÊòØÈõªÈÉµÔºåÊ†πÊìöÁî®Êà∂ÂêçÊü•Ë©¢Â∞çÊáâÁöÑÈõªÂ≠êÈÉµ‰ª∂
                    console.log('Input is username, looking up email...');
                    const { collection, query, where, getDocs } = window.firestoreModules;
                    const usersQuery = query(collection(window.firebaseDB, 'users'), where('username', '==', usernameOrEmail));
                    const usersSnapshot = await getDocs(usersQuery);

                    if (usersSnapshot.empty) {
                        throw { code: 'auth/user-not-found', message: 'Áî®Êà∂Âêç‰∏çÂ≠òÂú®' };
                    }

                    // Áç≤ÂèñÁî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂
                    const userData = usersSnapshot.docs[0].data();
                    email = userData.email;
                    console.log('Found email for username:', email);
                } else {
                    console.log('Input is email, logging in directly...');
                }

                console.log('Calling signInWithEmailAndPassword...');
                const userCredential = await window.authModules.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                console.log('Login successful:', userCredential.user.email);

                // Ê™¢Êü•Áî®Êà∂ÊòØÂê¶ÊúâË®≠ÂÆöÁî®Êà∂Âêç
                const user = userCredential.user;
                const userDoc = await window.firestoreModules.getDoc(window.firestoreModules.doc(window.firebaseDB, 'users', user.uid));
                const userData = userDoc.data();

                // Â¶ÇÊûúÁî®Êà∂Ê≤íÊúâÁî®Êà∂ÂêçÔºåË¶ÅÊ±ÇË®≠ÂÆö
                if (!userData.username) {
                    console.log('User has no username, prompting to set...');
                    // È°ØÁ§∫Ë®≠ÂÆöÁî®Êà∂Âêç Modal ÔºàÁ®çÂæåÂØ¶ÁèæÔºâ
                    window.pendingUser = user;
                    showSetUsernameModal();
                    loginBtn.textContent = 'ÁôªÂÖ•';
                    loginBtn.disabled = false;
                    return false;
                }

                // onAuthStateChanged will handle UI updates
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'ÁôªÂÖ•Â§±Êïó';

                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Â∏≥Ëôü‰∏çÂ≠òÂú®';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ÂØÜÁ¢ºÈåØË™§';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ÈÉµÁÆ±Ê†ºÂºè‰∏çÊ≠£Á¢∫';
                        break;
                    case 'auth/invalid-credential':
                        errorMessage = 'Â∏≥ËôüÊàñÂØÜÁ¢ºÈåØË™§';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ÁôªÂÖ•ÂòóË©¶Ê¨°Êï∏ÈÅéÂ§öÔºåË´ãÁ®çÂæåÂÜçË©¶';
                        break;
                    default:
                        errorMessage = `ÁôªÂÖ•Â§±ÊïóÔºö${error.message}`;
                }

                showAlertSimple(errorMessage);
                loginBtn.textContent = 'ÁôªÂÖ•';
                loginBtn.disabled = false;
            }

            return false; // Èò≤Ê≠¢Ë°®ÂñÆÊèê‰∫§
        };

        // üî• È°ØÁ§∫Ë®≠ÂÆöÁî®Êà∂Âêç Modal
        window.showSetUsernameModal = function() {
            document.getElementById('setUsernameModal').classList.remove('hidden');
        };

        // üî• ËôïÁêÜË®≠ÂÆöÁî®Êà∂Âêç
        window.handleSetUsername = async function(event) {
            event.preventDefault();
            event.stopPropagation();

            const usernameInput = document.getElementById('newUsername');
            const setUsernameBtn = document.getElementById('setUsernameBtn');
            const username = usernameInput.value.trim();

            if (!username) {
                showAlertSimple('Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç');
                return false;
            }

            // È©óË≠âÁî®Êà∂ÂêçÊ†ºÂºè
            const usernameRegex = /^[a-zA-Z0-9_-]{3,20}$/;
            if (!usernameRegex.test(username)) {
                showAlertSimple('Áî®Êà∂ÂêçÂøÖÈ†àÁÇ∫3-20ÂÄãÂ≠óÁ¨¶ÔºåÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶');
                return false;
            }

            setUsernameBtn.textContent = 'Ë®≠ÂÆö‰∏≠...';
            setUsernameBtn.disabled = true;

            try {
                // Ê™¢Êü•Áî®Êà∂ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                const { collection, query, where, getDocs, doc, updateDoc } = window.firestoreModules;
                const usernameQuery = query(collection(window.firebaseDB, 'users'), where('username', '==', username));
                const usernameSnapshot = await getDocs(usernameQuery);

                if (!usernameSnapshot.empty) {
                    showAlertSimple('Áî®Êà∂ÂêçÂ∑≤Ë¢´‰ΩøÁî®ÔºåË´ãÈÅ∏ÊìáÂÖ∂‰ªñÁî®Êà∂Âêç');
                    setUsernameBtn.textContent = 'Á¢∫Ë™çË®≠ÂÆö';
                    setUsernameBtn.disabled = false;
                    return false;
                }

                // Êõ¥Êñ∞Áî®Êà∂Âêç
                const user = window.pendingUser;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    username: username
                });

                // ÈóúÈñâ Modal ‰∏¶Ê∏ÖÁêÜ
                document.getElementById('setUsernameModal').classList.add('hidden');
                document.getElementById('setUsernameForm').reset();
                window.pendingUser = null;

                // Áî®Êà∂ÂêçË®≠ÂÆöÊàêÂäüÂæåÔºåonAuthStateChanged ÊúÉËá™ÂãïËôïÁêÜÂæåÁ∫åÊµÅÁ®ã
                showAlertSimple('Áî®Êà∂ÂêçË®≠ÂÆöÊàêÂäüÔºÅ');
            } catch (error) {
                console.error('Set username error:', error);
                showAlertSimple('Ë®≠ÂÆöÁî®Êà∂ÂêçÊôÇÁôºÁîüÈåØË™§Ôºö' + error.message);
                setUsernameBtn.textContent = 'Á¢∫Ë™çË®≠ÂÆö';
                setUsernameBtn.disabled = false;
            }

            return false;
        };

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        // User Management
        let currentUser = null;
        const SUPER_ADMIN_UID = 'vdNBS7qPdRV9qpV7CLgXwBflCf23';

        // Á≠âÂæÖ Firebase SDK Âä†ËºâÂÆåÊàêÂæåÂàùÂßãÂåñË™çË≠âÁõ£ËÅΩÂô®
        window.initAuth = function() {
            if (!window.authModules || !window.firebaseAuth) {
                console.error('Firebase not ready yet, retrying...');
                setTimeout(window.initAuth, 100);
                return;
            }

            console.log('Initializing auth state observer...');

            // Authentication State Observer
            window.authModules.onAuthStateChanged(window.firebaseAuth, async (user) => {
            if (user) {
                // Check user role in Firestore
                console.log('User logged in:', user.email, 'UID:', user.uid);
                try {
                    const { doc, getDoc } = window.firestoreModules;
                    const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));

                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        console.log('User data:', userData);
                        console.log('User role:', userData.role);
                        console.log('User status:', userData.status);
                        console.log('Super Admin UID:', SUPER_ADMIN_UID);
                        console.log('Current UID:', user.uid);
                        console.log('Is admin?', userData.role === 'admin');
                        console.log('Is super admin?', user.uid === SUPER_ADMIN_UID);

                        // Check if user is admin or super admin
                        if (userData.role === 'admin' || user.uid === SUPER_ADMIN_UID) {
                            if (userData.status !== 'approved') {
                                console.log('Status not approved:', userData.status);
                                showAlert('ÊÇ®ÁöÑÂ∏≥ËôüÂ∞öÊú™Ë¢´ÊâπÂáÜË®™ÂïèÁÆ°ÁêÜÂæåÂè∞„ÄÇÁãÄÊÖãÔºö' + userData.status);
                                await window.authModules.signOut(window.firebaseAuth);
                                return;
                            }

                            console.log('Access granted! Loading dashboard...');
                            currentUser = {
                                uid: user.uid,
                                email: user.email,
                                name: userData.name || user.email,
                                role: userData.role
                            };

                            document.getElementById('currentUser').textContent = currentUser.name;
                            document.getElementById('loginScreen').classList.add('hidden');
                            document.getElementById('adminDashboard').classList.remove('hidden');
                            loadActivities();
                        } else {
                            console.log('Role check failed. Role:', userData.role);
                            showAlert('ÊÇ®Ê≤íÊúâÊ¨äÈôêË®™ÂïèÁÆ°ÁêÜÂæåÂè∞„ÄÇÊÇ®ÁöÑËßíËâ≤Ôºö' + (userData.role || 'ÁÑ°'));
                            await window.authModules.signOut(window.firebaseAuth);
                        }
                    } else {
                        console.log('User document does not exist for UID:', user.uid);
                        showAlert('Áî®Êà∂Ë≥áÊñô‰∏çÂ≠òÂú®ÔºàUID: ' + user.uid + 'Ôºâ');
                        await window.authModules.signOut(window.firebaseAuth);
                    }
                } catch (error) {
                    console.error('Error checking user role:', error);
                    showAlert('È©óË≠âÁî®Êà∂Ê¨äÈôêÊôÇÁôºÁîüÈåØË™§Ôºö' + error.message);
                    await window.authModules.signOut(window.firebaseAuth);
                }
            } else {
                // User is signed out
                console.log('User signed out');
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminDashboard').classList.add('hidden');
            }
        });
        };

        // Â¶ÇÊûú Firebase Â∑≤Á∂ìÂä†ËºâÔºåÁ´ãÂç≥ÂàùÂßãÂåñ
        if (window.firebaseReady) {
            window.initAuth();
        }

        // Login Handling Â∑≤ÈÄöÈÅé inline onsubmit ËôïÁêÜÔºàË¶ã window.handleLoginÔºâ

        // ÂàùÂßãÂåñÊâÄÊúâ UI ‰∫ã‰ª∂Áõ£ËÅΩÂô®
        function initUIHandlers() {
            console.log('Initializing UI handlers...');

            // Logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    try {
                        await window.authModules.signOut(window.firebaseAuth);
                        document.getElementById('loginForm').reset();
                    } catch (error) {
                        console.error('Logout error:', error);
                        showAlert('ÁôªÂá∫ÊôÇÁôºÁîüÈåØË™§');
                    }
                });
            }

            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const section = btn.dataset.section;

                    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
                    document.getElementById(section + 'Section').classList.remove('hidden');

                    document.querySelectorAll('.nav-btn').forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                    });
                    btn.classList.add('bg-primary', 'text-white');

                    if (section === 'activities') {
                        loadActivities();
                    } else if (section === 'projects') {
                        loadProjects();
                    } else if (section === 'team') {
                        loadTeamMembers();
                    } else if (section === 'contacts') {
                        loadContacts();
                    } else if (section === 'users') {
                        loadUsers();
                    } else if (section === 'profile') {
                        loadProfile();
                    }
                });
            });

            // Set default active section
            const firstNavBtn = document.querySelector('.nav-btn');
            if (firstNavBtn) {
                firstNavBtn.click();
            }

            // Modal Handling
            document.querySelectorAll('.closeModal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('activityModal').classList.add('hidden');
                    document.getElementById('projectModal').classList.add('hidden');
                    document.getElementById('teamMemberModal').classList.add('hidden');
                });
            });
        }

        // Áï∂ DOM ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñÊâÄÊúâËôïÁêÜÂô®
        function initAllHandlers() {
            initUIHandlers();
            initActivityHandlers();
            initProjectHandlers();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAllHandlers);
        } else {
            initAllHandlers();
        }

        // Activities Management
        function initActivityHandlers() {
            const addActivityBtn = document.getElementById('addActivityBtn');
            if (addActivityBtn) {
                addActivityBtn.addEventListener('click', () => {
                    document.getElementById('activityModalTitle').textContent = 'Êñ∞Â¢ûÊ¥ªÂãï';
                    document.getElementById('activityForm').reset();
                    document.getElementById('activityId').value = '';
                    document.getElementById('activityModal').classList.remove('hidden');
                });
            }

            const activityForm = document.getElementById('activityForm');
            if (activityForm) {
                activityForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // ÂèñÂæóÂ§öË™ûË®ÄËº∏ÂÖ•ÂÄº
                    const titleZhTW = document.getElementById('activityTitleZhTW').value.trim();
                    const titleZhCN = document.getElementById('activityTitleZhCN').value.trim();
                    const titleEn = document.getElementById('activityTitleEn').value.trim();
                    const descriptionZhTW = document.getElementById('activityDescriptionZhTW').value.trim();
                    const descriptionZhCN = document.getElementById('activityDescriptionZhCN').value.trim();
                    const descriptionEn = document.getElementById('activityDescriptionEn').value.trim();

                    // È©óË≠âÔºöËá≥Â∞ëÈúÄË¶ÅÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ®ôÈ°åÂíåÊèèËø∞ÔºàÂª∫Ë≠∞ÁπÅÈ´î‰∏≠ÊñáÔºâ
                    if (!titleZhTW && !titleZhCN && !titleEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ¥ªÂãïÊ®ôÈ°åÔºÅ');
                        return;
                    }
                    if (!descriptionZhTW && !descriptionZhCN && !descriptionEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ¥ªÂãïÊèèËø∞ÔºÅ');
                        return;
                    }

                    const activityData = {
                        title: {
                            zhTW: titleZhTW,
                            zhCN: titleZhCN,
                            en: titleEn
                        },
                        date: document.getElementById('activityDate').value,
                        description: {
                            zhTW: descriptionZhTW,
                            zhCN: descriptionZhCN,
                            en: descriptionEn
                        },
                        link: document.getElementById('activityLink').value || ''
                    };

                    try {
                        const activityId = document.getElementById('activityId').value;

                        if (activityId) {
                            // Update existing activity
                            const { doc, updateDoc, serverTimestamp } = window.firestoreModules;
                            activityData.updatedAt = serverTimestamp();
                            await updateDoc(doc(window.firebaseDB, 'activities', activityId), activityData);
                            showAlert('Ê¥ªÂãïÂ∑≤Êõ¥Êñ∞ÔºÅ');
                        } else {
                            // Add new activity
                            const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                            activityData.createdAt = serverTimestamp();
                            await addDoc(collection(window.firebaseDB, 'activities'), activityData);
                            showAlert('Ê¥ªÂãïÂ∑≤Êñ∞Â¢ûÔºÅ');
                        }

                        document.getElementById('activityModal').classList.add('hidden');
                        loadActivities();
                    } catch (error) {
                        console.error('Error saving activity:', error);
                        showAlert('ÂÑ≤Â≠òÊ¥ªÂãïÊôÇÁôºÁîüÈåØË™§');
                    }
                });
            }
        }

        async function loadActivities() {
            const loadingEl = document.getElementById('activitiesLoading');
            const listEl = document.getElementById('activitiesList');
            const emptyEl = document.getElementById('activitiesEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'activities'), orderBy('date', 'desc'));
                const querySnapshot = await getDocs(q);

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                querySnapshot.forEach((docSnapshot) => {
                    const activity = docSnapshot.data();
                    const activityId = docSnapshot.id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÊîØÊåÅËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÂíåÊñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof activity.title === 'string'
                        ? activity.title
                        : (activity.title?.zhTW || activity.title?.zhCN || activity.title?.en || '');
                    const description = typeof activity.description === 'string'
                        ? activity.description
                        : (activity.description?.zhTW || activity.description?.zhCN || activity.description?.en || '');

                    const activityCard = document.createElement('div');
                    activityCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                    activityCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm text-primary font-semibold mb-2">${activity.date || ''}</div>
                                <h3 class="text-lg font-bold mb-2">${title}</h3>
                                <p class="text-gray-600 dark:text-gray-400 mb-2">${description}</p>
                                ${activity.link ? `<a href="${activity.link}" target="_blank" class="text-sm text-primary hover:underline">Êü•ÁúãÈÄ£Áµê ‚Üí</a>` : ''}
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editActivity('${activityId}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">Á∑®ËºØ</button>
                                <button onclick="deleteActivity('${activityId}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">Âà™Èô§</button>
                            </div>
                        </div>
                    `;

                    listEl.appendChild(activityCard);
                });

                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading activities:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Ê¥ªÂãïÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        window.editActivity = async (id) => {
            try {
                const { doc, getDocs, collection } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'activities'));

                let activityData = null;
                querySnapshot.forEach((docSnapshot) => {
                    if (docSnapshot.id === id) {
                        activityData = docSnapshot.data();
                    }
                });

                if (activityData) {
                    document.getElementById('activityId').value = id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÂ¶ÇÊûúÊï∏ÊìöÊòØËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÔºåËΩâÊèõÁÇ∫Êñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof activityData.title === 'string'
                        ? { zhTW: activityData.title, zhCN: '', en: '' }
                        : activityData.title;
                    const description = typeof activityData.description === 'string'
                        ? { zhTW: activityData.description, zhCN: '', en: '' }
                        : activityData.description;

                    // Â°´ÂÖÖÂ§öË™ûË®ÄË°®ÂñÆ
                    document.getElementById('activityTitleZhTW').value = title?.zhTW || '';
                    document.getElementById('activityTitleZhCN').value = title?.zhCN || '';
                    document.getElementById('activityTitleEn').value = title?.en || '';

                    document.getElementById('activityDate').value = activityData.date || '';

                    document.getElementById('activityDescriptionZhTW').value = description?.zhTW || '';
                    document.getElementById('activityDescriptionZhCN').value = description?.zhCN || '';
                    document.getElementById('activityDescriptionEn').value = description?.en || '';

                    document.getElementById('activityLink').value = activityData.link || '';
                    document.getElementById('activityModalTitle').textContent = 'Á∑®ËºØÊ¥ªÂãï';
                    document.getElementById('activityModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading activity:', error);
                showAlert('ËºâÂÖ•Ê¥ªÂãïË≥áÊñôÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteActivity = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ê¥ªÂãïÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'activities', id));
                    showAlert('Ê¥ªÂãïÂ∑≤Âà™Èô§ÔºÅ');
                    loadActivities();
                } catch (error) {
                    console.error('Error deleting activity:', error);
                    showAlert('Âà™Èô§Ê¥ªÂãïÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // Projects Management
        function initProjectHandlers() {
            const addProjectBtn = document.getElementById('addProjectBtn');
            if (addProjectBtn) {
                addProjectBtn.addEventListener('click', () => {
                    document.getElementById('projectModalTitle').textContent = 'Êñ∞Â¢ûÂ∞àÊ°à';
                    document.getElementById('projectForm').reset();
                    document.getElementById('projectId').value = '';
                    document.getElementById('projectModal').classList.remove('hidden');
                });
            }

            const projectForm = document.getElementById('projectForm');
            if (projectForm) {
                projectForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // ÂèñÂæóÂ§öË™ûË®ÄËº∏ÂÖ•ÂÄº
                    const titleZhTW = document.getElementById('projectTitleZhTW').value.trim();
                    const titleZhCN = document.getElementById('projectTitleZhCN').value.trim();
                    const titleEn = document.getElementById('projectTitleEn').value.trim();
                    const descriptionZhTW = document.getElementById('projectDescriptionZhTW').value.trim();
                    const descriptionZhCN = document.getElementById('projectDescriptionZhCN').value.trim();
                    const descriptionEn = document.getElementById('projectDescriptionEn').value.trim();

                    // È©óË≠âÔºöËá≥Â∞ëÈúÄË¶ÅÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÊ®ôÈ°åÂíåÊèèËø∞ÔºàÂª∫Ë≠∞ÁπÅÈ´î‰∏≠ÊñáÔºâ
                    if (!titleZhTW && !titleZhCN && !titleEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÂ∞àÊ°àÊ®ôÈ°åÔºÅ');
                        return;
                    }
                    if (!descriptionZhTW && !descriptionZhCN && !descriptionEn) {
                        showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´‰∏ÄÂÄãË™ûË®ÄÁâàÊú¨ÁöÑÂ∞àÊ°àÊèèËø∞ÔºÅ');
                        return;
                    }

                    const techInput = document.getElementById('projectTechnologies').value;
                    const technologies = techInput ? techInput.split(',').map(t => t.trim()) : [];

                    const projectData = {
                        title: {
                            zhTW: titleZhTW,
                            zhCN: titleZhCN,
                            en: titleEn
                        },
                        status: document.getElementById('projectStatus').value,
                        description: {
                            zhTW: descriptionZhTW,
                            zhCN: descriptionZhCN,
                            en: descriptionEn
                        },
                        technologies: technologies,
                        members: parseInt(document.getElementById('projectMembers').value) || 0,
                        links: (() => {
                            const linksText = document.getElementById('projectLinks').value.trim();
                            return linksText ? linksText.split('\n').map(l => l.trim()).filter(l => l && l.startsWith('http')) : [];
                        })()
                    };

                    try {
                        const projectId = document.getElementById('projectId').value;

                        if (projectId) {
                            // Update existing project
                            const { doc, updateDoc, serverTimestamp, deleteField } = window.firestoreModules;
                            projectData.updatedAt = serverTimestamp();
                            projectData.link = deleteField(); // Âà™Èô§ËàäÁöÑÂñÆ‰∏ÄÈÄ£ÁµêÊ¨Ñ‰Ωç
                            await updateDoc(doc(window.firebaseDB, 'projects', projectId), projectData);
                            showAlert('Â∞àÊ°àÂ∑≤Êõ¥Êñ∞ÔºÅ');
                        } else {
                            // Add new project
                            const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                            projectData.createdAt = serverTimestamp();
                            await addDoc(collection(window.firebaseDB, 'projects'), projectData);
                            showAlert('Â∞àÊ°àÂ∑≤Êñ∞Â¢ûÔºÅ');
                        }

                        document.getElementById('projectModal').classList.add('hidden');
                        loadProjects();
                    } catch (error) {
                        console.error('Error saving project:', error);
                        showAlert('ÂÑ≤Â≠òÂ∞àÊ°àÊôÇÁôºÁîüÈåØË™§');
                    }
                });
            }
        }

        async function loadProjects() {
            const loadingEl = document.getElementById('projectsLoading');
            const listEl = document.getElementById('projectsList');
            const emptyEl = document.getElementById('projectsEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'projects'));

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                querySnapshot.forEach((docSnapshot) => {
                    const project = docSnapshot.data();
                    const projectId = docSnapshot.id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÊîØÊåÅËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÂíåÊñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof project.title === 'string'
                        ? project.title
                        : (project.title?.zhTW || project.title?.zhCN || project.title?.en || '');
                    const description = typeof project.description === 'string'
                        ? project.description
                        : (project.description?.zhTW || project.description?.zhCN || project.description?.en || '');

                    const statusColors = {
                        'ÈÄ≤Ë°å‰∏≠': 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200',
                        'Â∑≤ÂÆåÊàê': 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200',
                        'Ë®àÂäÉ‰∏≠': 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200'
                    };

                    const statusClass = statusColors[project.status] || statusColors['ÈÄ≤Ë°å‰∏≠'];
                    const techTags = (project.technologies || []).map(tech =>
                        `<span class="px-2 py-1 bg-primary/10 text-primary rounded-full text-xs">${tech}</span>`
                    ).join(' ');

                    const projectCard = document.createElement('div');
                    projectCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                    projectCard.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h3 class="text-lg font-bold">${title}</h3>
                                    <span class="px-3 py-1 ${statusClass} rounded-full text-xs font-semibold">${project.status || 'ÈÄ≤Ë°å‰∏≠'}</span>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-3">${description}</p>
                                <div class="flex flex-wrap gap-2 mb-3">
                                    ${techTags}
                                </div>
                                <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                                    ÂèÉËàáÊàêÂì°: ${project.members || 0} ‰Ωç
                                </div>
                                ${(() => {
                                    const allLinks = [];
                                    if (project.link) allLinks.push(project.link);
                                    if (project.links && Array.isArray(project.links)) allLinks.push(...project.links);
                                    const uniqueLinks = [...new Set(allLinks)];
                                    if (uniqueLinks.length === 0) return '';
                                    return uniqueLinks.map((url, idx) => {
                                        const label = uniqueLinks.length > 1 ? 'Êü•ÁúãÈÄ£Áµê ' + (idx + 1) : 'Êü•ÁúãÂ∞àÊ°à';
                                        return '<a href="' + url + '" target="_blank" class="text-sm text-primary hover:underline mr-3">' + label + ' ‚Üí</a>';
                                    }).join('');
                                })()}
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editProject('${projectId}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">Á∑®ËºØ</button>
                                <button onclick="deleteProject('${projectId}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">Âà™Èô§</button>
                            </div>
                        </div>
                    `;

                    listEl.appendChild(projectCard);
                });

                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading projects:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Â∞àÊ°àÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        window.editProject = async (id) => {
            try {
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'projects'));

                let projectData = null;
                querySnapshot.forEach((docSnapshot) => {
                    if (docSnapshot.id === id) {
                        projectData = docSnapshot.data();
                    }
                });

                if (projectData) {
                    document.getElementById('projectId').value = id;

                    // ÂêëÂæåÂÖºÂÆπÔºöÂ¶ÇÊûúÊï∏ÊìöÊòØËàäÊ†ºÂºèÔºàÂ≠óÁ¨¶‰∏≤ÔºâÔºåËΩâÊèõÁÇ∫Êñ∞Ê†ºÂºèÔºàÂ∞çË±°Ôºâ
                    const title = typeof projectData.title === 'string'
                        ? { zhTW: projectData.title, zhCN: '', en: '' }
                        : projectData.title;
                    const description = typeof projectData.description === 'string'
                        ? { zhTW: projectData.description, zhCN: '', en: '' }
                        : projectData.description;

                    // Â°´ÂÖÖÂ§öË™ûË®ÄË°®ÂñÆ
                    document.getElementById('projectTitleZhTW').value = title?.zhTW || '';
                    document.getElementById('projectTitleZhCN').value = title?.zhCN || '';
                    document.getElementById('projectTitleEn').value = title?.en || '';

                    document.getElementById('projectStatus').value = projectData.status || 'ÈÄ≤Ë°å‰∏≠';

                    document.getElementById('projectDescriptionZhTW').value = description?.zhTW || '';
                    document.getElementById('projectDescriptionZhCN').value = description?.zhCN || '';
                    document.getElementById('projectDescriptionEn').value = description?.en || '';

                    document.getElementById('projectTechnologies').value = (projectData.technologies || []).join(', ');
                    document.getElementById('projectMembers').value = projectData.members || 0;
                    // ËôïÁêÜÂ§öÈÄ£Áµê
                    const existingLinks = projectData.links || [];
                    const singleLink = projectData.link || '';
                    let allLinks = [];
                    if (singleLink) allLinks.push(singleLink);
                    if (Array.isArray(existingLinks)) allLinks = allLinks.concat(existingLinks);
                    document.getElementById('projectLinks').value = [...new Set(allLinks)].join('\n');
                    document.getElementById('projectModalTitle').textContent = 'Á∑®ËºØÂ∞àÊ°à';
                    document.getElementById('projectModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading project:', error);
                showAlert('ËºâÂÖ•Â∞àÊ°àË≥áÊñôÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteProject = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Â∞àÊ°àÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'projects', id));
                    showAlert('Â∞àÊ°àÂ∑≤Âà™Èô§ÔºÅ');
                    loadProjects();
                } catch (error) {
                    console.error('Error deleting project:', error);
                    showAlert('Âà™Èô§Â∞àÊ°àÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // ========================================
        // Team Management
        // ========================================

        // Add Team Member Button
        const addTeamMemberBtn = document.getElementById('addTeamMemberBtn');
        if (addTeamMemberBtn) {
            addTeamMemberBtn.addEventListener('click', () => {
                document.getElementById('teamMemberModalTitle').textContent = 'Êñ∞Â¢ûÂúòÈöäÊàêÂì°';
                document.getElementById('teamMemberForm').reset();
                document.getElementById('teamMemberId').value = '';
                document.getElementById('teamMemberModal').classList.remove('hidden');
            });
        }

        // Team Member Form Submit
        const teamMemberForm = document.getElementById('teamMemberForm');
        if (teamMemberForm) {
            teamMemberForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                // Get multilingual inputs
                const nameZhTW = document.getElementById('memberNameZhTW').value.trim();
                const nameZhCN = document.getElementById('memberNameZhCN').value.trim();
                const nameEn = document.getElementById('memberNameEn').value.trim();
                const positionZhTW = document.getElementById('memberPositionZhTW').value.trim();
                const positionZhCN = document.getElementById('memberPositionZhCN').value.trim();
                const positionEn = document.getElementById('memberPositionEn').value.trim();

                // Validation
                if (!nameZhTW || !positionZhTW) {
                    showAlert('Ë´ãËá≥Â∞ëÂ°´ÂØ´ÁπÅÈ´î‰∏≠ÊñáÁöÑÂßìÂêçÂíåËÅ∑‰Ωç');
                    return;
                }

                const order = parseInt(document.getElementById('memberOrder').value);
                if (isNaN(order) || order < 0) {
                    showAlert('Ë´ãÂ°´ÂØ´ÊúâÊïàÁöÑÊéíÂ∫èÈ†ÜÂ∫èÔºà0ÊàñÊ≠£Êï¥Êï∏Ôºâ');
                    return;
                }

                const memberData = {
                    name_zhTW: nameZhTW,
                    name_zhCN: nameZhCN,
                    name_en: nameEn,
                    position_zhTW: positionZhTW,
                    position_zhCN: positionZhCN,
                    position_en: positionEn,
                    email: document.getElementById('memberEmail').value.trim() || '',
                    order: order
                };

                try {
                    const memberId = document.getElementById('teamMemberId').value;

                    if (memberId) {
                        const { doc, updateDoc, serverTimestamp } = window.firestoreModules;
                        memberData.updatedAt = serverTimestamp();
                        await updateDoc(doc(window.firebaseDB, 'team', memberId), memberData);
                        showAlert('ÂúòÈöäÊàêÂì°Â∑≤Êõ¥Êñ∞ÔºÅ');
                    } else {
                        const { collection, addDoc, serverTimestamp } = window.firestoreModules;
                        memberData.createdAt = serverTimestamp();
                        await addDoc(collection(window.firebaseDB, 'team'), memberData);
                        showAlert('ÂúòÈöäÊàêÂì°Â∑≤Êñ∞Â¢ûÔºÅ');
                    }

                    document.getElementById('teamMemberModal').classList.add('hidden');
                    loadTeamMembers();
                } catch (error) {
                    console.error('Error saving team member:', error);
                    showAlert('ÂÑ≤Â≠òÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        async function loadTeamMembers() {
            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'team'), orderBy('order', 'asc'));
                const querySnapshot = await getDocs(q);

                const listEl = document.getElementById('teamList');

                if (querySnapshot.empty) {
                    listEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Êö´ÁÑ°ÂúòÈöäÊàêÂì°</p>';
                    return;
                }

                listEl.innerHTML = '';

                querySnapshot.forEach((doc) => {
                    const member = doc.data();

                    // Display preferring zhTW version
                    const name = member.name_zhTW || member.name_zhCN || member.name_en || 'Êú™ÂëΩÂêç';
                    const position = member.position_zhTW || member.position_zhCN || member.position_en || '';

                    listEl.innerHTML += `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-lg font-bold">
                                            ${name[0].toUpperCase()}
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-lg text-gray-800 dark:text-gray-200">${name}</h3>
                                            <p class="text-sm text-purple-600 dark:text-purple-400">${position}</p>
                                        </div>
                                    </div>
                                    ${member.email ? `<p class="text-sm text-gray-600 dark:text-gray-400 ml-15"><i class="fas fa-envelope mr-2"></i>${member.email}</p>` : ''}
                                    <p class="text-xs text-gray-500 dark:text-gray-500 ml-15 mt-1">ÊéíÂ∫è: ${member.order}</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editTeamMember('${doc.id}')" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm transition-colors">Á∑®ËºØ</button>
                                    <button onclick="deleteTeamMember('${doc.id}')" class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm transition-colors">Âà™Èô§</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Error loading team members:', error);
                document.getElementById('teamList').innerHTML = '<p class="text-red-500 text-center py-8">ËºâÂÖ•ÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§</p>';
            }
        }

        window.editTeamMember = async (id) => {
            try {
                const { doc, getDocs, collection } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'team'));

                let memberData = null;
                querySnapshot.forEach((doc) => {
                    if (doc.id === id) {
                        memberData = doc.data();
                    }
                });

                if (memberData) {
                    document.getElementById('teamMemberId').value = id;
                    document.getElementById('memberNameZhTW').value = memberData.name_zhTW || '';
                    document.getElementById('memberNameZhCN').value = memberData.name_zhCN || '';
                    document.getElementById('memberNameEn').value = memberData.name_en || '';
                    document.getElementById('memberPositionZhTW').value = memberData.position_zhTW || '';
                    document.getElementById('memberPositionZhCN').value = memberData.position_zhCN || '';
                    document.getElementById('memberPositionEn').value = memberData.position_en || '';
                    document.getElementById('memberEmail').value = memberData.email || '';
                    document.getElementById('memberOrder').value = memberData.order || 0;

                    document.getElementById('teamMemberModalTitle').textContent = 'Á∑®ËºØÂúòÈöäÊàêÂì°';
                    document.getElementById('teamMemberModal').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading team member:', error);
                showAlert('ËºâÂÖ•ÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteTeamMember = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§ÂúòÈöäÊàêÂì°ÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'team', id));
                    showAlert('ÂúòÈöäÊàêÂì°Â∑≤Âà™Èô§ÔºÅ');
                    loadTeamMembers();
                } catch (error) {
                    console.error('Error deleting team member:', error);
                    showAlert('Âà™Èô§ÂúòÈöäÊàêÂì°ÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // ========================================
        // Alert and Confirm Functions
        // ========================================
        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded-lg transition-colors" onclick="this.closest('.fixed').remove()">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition-colors">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                modal.remove();
                onConfirm();
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        window.showAlert = showAlert;
        window.showConfirm = showConfirm;

        // ========================================
        // Contacts Management
        // ========================================

        let currentFilter = 'all';
        let allContacts = [];

        async function loadContacts() {
            const loadingEl = document.getElementById('contactsLoading');
            const listEl = document.getElementById('contactsList');
            const emptyEl = document.getElementById('contactsEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'contact_submissions'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                allContacts = [];
                querySnapshot.forEach((docSnapshot) => {
                    const contact = docSnapshot.data();
                    allContacts.push({
                        id: docSnapshot.id,
                        ...contact
                    });
                });

                renderContacts();
            } catch (error) {
                console.error('Error loading contacts:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        function renderContacts() {
            const listEl = document.getElementById('contactsList');
            const emptyEl = document.getElementById('contactsEmptyState');

            let filteredContacts = allContacts;
            if (currentFilter === 'unread') {
                filteredContacts = allContacts.filter(c => c.status === 'unread');
            } else if (currentFilter === 'replied') {
                filteredContacts = allContacts.filter(c => c.status === 'replied');
            }

            if (filteredContacts.length === 0) {
                listEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑË®äÊÅØ</p>';
                emptyEl.classList.remove('hidden');
                return;
            }

            emptyEl.classList.add('hidden');

            listEl.innerHTML = '';
            filteredContacts.forEach((contact) => {
                const createdDate = contact.createdAt ? new Date(contact.createdAt.seconds * 1000).toLocaleString('zh-TW') : 'Êú™Áü•ÊôÇÈñì';
                const statusBadge = contact.status === 'replied'
                    ? '<span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full text-xs font-semibold">Â∑≤ÂõûË¶Ü</span>'
                    : '<span class="px-3 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full text-xs font-semibold">Êú™ËÆÄ</span>';

                const contactCard = document.createElement('div');
                contactCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                contactCard.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h3 class="text-lg font-bold">${contact.subject || ''}</h3>
                                ${statusBadge}
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                                <i class="fas fa-envelope mr-1"></i>${contact.email || ''}
                                <span class="mx-2">|</span>
                                <i class="fas fa-clock mr-1"></i>${createdDate}
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-3 whitespace-pre-wrap">${contact.message || ''}</p>
                            ${contact.reply ? `
                                <div class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                    <p class="text-sm font-semibold text-blue-800 dark:text-blue-300 mb-2">
                                        <i class="fas fa-reply mr-1"></i>ÊÇ®ÁöÑÂõûË¶Ü
                                    </p>
                                    <p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap">${contact.reply}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                        ÂõûË¶ÜÊôÇÈñìÔºö${contact.repliedAt ? new Date(contact.repliedAt.seconds * 1000).toLocaleString('zh-TW') : ''}
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="showReplyModal('${contact.id}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                <i class="fas fa-reply mr-1"></i>${contact.reply ? 'ÂÜçÊ¨°ÂõûË¶Ü' : 'ÂõûË¶Ü'}
                            </button>
                            <button onclick="deleteContact('${contact.id}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                <i class="fas fa-trash mr-1"></i>Âà™Èô§
                            </button>
                        </div>
                    </div>
                `;

                listEl.appendChild(contactCard);
            });

            listEl.classList.remove('hidden');
        }

        window.filterContacts = function(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            renderContacts();
        };

        window.showReplyModal = function(contactId) {
            const contact = allContacts.find(c => c.id === contactId);
            if (!contact) return;

            document.getElementById('replyContactId').value = contactId;
            document.getElementById('replyEmail').textContent = contact.email;
            document.getElementById('replySubject').textContent = contact.subject;
            document.getElementById('replyOriginalMessage').textContent = contact.message;
            document.getElementById('replyContent').value = contact.reply || '';

            document.getElementById('replyModal').classList.remove('hidden');
        };

        window.closeReplyModal = function() {
            document.getElementById('replyModal').classList.add('hidden');
            document.getElementById('replyForm').reset();
        };

        window.handleReply = async function(event) {
            event.preventDefault();

            const contactId = document.getElementById('replyContactId').value;
            const replyContent = document.getElementById('replyContent').value;
            const contact = allContacts.find(c => c.id === contactId);

            if (!contact) return;

            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'contact_submissions', contactId), {
                    reply: replyContent,
                    repliedAt: new Date(),
                    status: 'replied'
                });

                // ÁôºÈÄÅÈõªÈÉµÂõûË¶Ü
                const mailtoLink = `mailto:${contact.email}?subject=Re: ${encodeURIComponent(contact.subject)}&body=${encodeURIComponent(replyContent)}`;
                window.open(mailtoLink, '_blank');

                showAlert('ÂõûË¶ÜÂ∑≤‰øùÂ≠òÔºÅË´ãÂú®ÊÇ®ÁöÑÈõªÈÉµÂÆ¢Êà∂Á´ØÁôºÈÄÅÈÉµ‰ª∂„ÄÇ');
                closeReplyModal();
                loadContacts();
            } catch (error) {
                console.error('Error sending reply:', error);
                showAlert('ÂõûË¶ÜÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteContact = function(id) {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë®äÊÅØÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'contact_submissions', id));
                    showAlert('Ë®äÊÅØÂ∑≤Âà™Èô§ÔºÅ');
                    loadContacts();
                } catch (error) {
                    console.error('Error deleting contact:', error);
                    showAlert('Âà™Èô§Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // Âà™Èô§ÊâÄÊúâËÅØÁµ°Ë®äÊÅØ
        window.deleteAllContacts = function() {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÊâÄÊúâËÅØÁµ°Ë®äÊÅØÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ', async () => {
                try {
                    const { collection, getDocs, doc, deleteDoc } = window.firestoreModules;
                    const querySnapshot = await getDocs(collection(window.firebaseDB, 'contact_submissions'));

                    if (querySnapshot.empty) {
                        showAlert('Ê≤íÊúâË®äÊÅØÂèØÂà™Èô§');
                        return;
                    }

                    const deletePromises = [];
                    querySnapshot.forEach((docSnapshot) => {
                        deletePromises.push(deleteDoc(doc(window.firebaseDB, 'contact_submissions', docSnapshot.id)));
                    });

                    await Promise.all(deletePromises);
                    showAlert(`Â∑≤Âà™Èô§ ${deletePromises.length} Ê¢ùË®äÊÅØÔºÅ`);
                    loadContacts();
                } catch (error) {
                    console.error('Error deleting all contacts:', error);
                    showAlert('Âà™Èô§Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // ========================================
        // Hero Section Management
        // ========================================

        // Âú®Â∞éËà™ÊåâÈàï‰∫ã‰ª∂‰∏≠Ê∑ªÂä† hero ÂíåÂÖ∂‰ªñÊñ∞ÂäüËÉΩÁöÑËºâÂÖ•
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const originalHandler = btn.onclick;
            btn.addEventListener('click', () => {
                const section = btn.dataset.section;
                if (section === 'hero') {
                    loadHeroSettings();
                } else if (section === 'announcements') {
                    loadAnnouncements();
                } else if (section === 'contactSettings') {
                    loadContactSettings();
                } else if (section === 'anthemSettings') {
                    loadAnthemSettings();
                } else if (section === 'visitorStats') {
                    loadVisitorStats();
                } else if (section === 'profile') {
                    loadProfile();
                }
            });
        });

        async function loadHeroSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'hero'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('heroTitleZhTW').value = data.title?.zhTW || '';
                    document.getElementById('heroSubtitleZhTW').value = data.subtitle?.zhTW || '';
                    document.getElementById('heroTitleZhCN').value = data.title?.zhCN || '';
                    document.getElementById('heroSubtitleZhCN').value = data.subtitle?.zhCN || '';
                    document.getElementById('heroTitleEn').value = data.title?.en || '';
                    document.getElementById('heroSubtitleEn').value = data.subtitle?.en || '';
                }
            } catch (error) {
                console.error('Error loading hero settings:', error);
            }
        }

        const heroForm = document.getElementById('heroForm');
        if (heroForm) {
            heroForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const heroData = {
                    title: {
                        zhTW: document.getElementById('heroTitleZhTW').value,
                        zhCN: document.getElementById('heroTitleZhCN').value,
                        en: document.getElementById('heroTitleEn').value
                    },
                    subtitle: {
                        zhTW: document.getElementById('heroSubtitleZhTW').value,
                        zhCN: document.getElementById('heroSubtitleZhCN').value,
                        en: document.getElementById('heroSubtitleEn').value
                    }
                };

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'hero'), heroData);
                    showAlert('È¶ñÈ†ÅÊ®ôË™ûÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving hero settings:', error);
                    showAlert('ÂÑ≤Â≠òÈ¶ñÈ†ÅÊ®ôË™ûÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Contact Settings Management
        // ========================================

        async function loadContactSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'contact'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('contactAddressZhTW').value = data.address_zh_tw || data.address || '';
                    document.getElementById('contactAddressZhCN').value = data.address_zh_cn || '';
                    document.getElementById('contactAddressEn').value = data.address_en || '';
                    document.getElementById('contactPhone').value = data.phone || '';
                    document.getElementById('contactEmail').value = data.email || '';
                }
            } catch (error) {
                console.error('Error loading contact settings:', error);
            }
        }

        const contactSettingsForm = document.getElementById('contactSettingsForm');
        if (contactSettingsForm) {
            contactSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const contactData = {
                    address_zh_tw: document.getElementById('contactAddressZhTW').value,
                    address_zh_cn: document.getElementById('contactAddressZhCN').value,
                    address_en: document.getElementById('contactAddressEn').value,
                    phone: document.getElementById('contactPhone').value,
                    email: document.getElementById('contactEmail').value
                };

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'contact'), contactData);
                    showAlert('ËÅØÁµ°Ë≥áË®äÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving contact settings:', error);
                    showAlert('ÂÑ≤Â≠òËÅØÁµ°Ë≥áË®äÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Anthem Settings Management
        // ========================================

        async function loadAnthemSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'anthem'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('anthemTitleZhTW').value = data.title_zh_tw || '';
                    document.getElementById('anthemTitleZhCN').value = data.title_zh_cn || '';
                    document.getElementById('anthemTitleEn').value = data.title_en || '';
                    document.getElementById('anthemDescZhTW').value = data.description_zh_tw || '';
                    document.getElementById('anthemDescZhCN').value = data.description_zh_cn || '';
                    document.getElementById('anthemDescEn').value = data.description_en || '';
                }
            } catch (error) {
                console.error('Error loading anthem settings:', error);
            }
        }

        const anthemSettingsForm = document.getElementById('anthemSettingsForm');
        if (anthemSettingsForm) {
            anthemSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const anthemData = {
                    title_zh_tw: document.getElementById('anthemTitleZhTW').value,
                    title_zh_cn: document.getElementById('anthemTitleZhCN').value,
                    title_en: document.getElementById('anthemTitleEn').value,
                    description_zh_tw: document.getElementById('anthemDescZhTW').value,
                    description_zh_cn: document.getElementById('anthemDescZhCN').value,
                    description_en: document.getElementById('anthemDescEn').value
                };

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'anthem'), anthemData);
                    showAlert('ÊúÉÊ≠åË®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving anthem settings:', error);
                    showAlert('ÂÑ≤Â≠òÊúÉÊ≠åË®≠ÁΩÆÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Visitor Stats Management
        // ========================================

        async function loadVisitorStats() {
            await refreshVisitorStats();
            await loadWebsiteStatus();
            await loadVisitorSettings();
            await loadVisitorHistory();
        }

        // ËºâÂÖ•Á∂≤Á´ôÁãÄÊÖã
        async function loadWebsiteStatus() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const websiteDoc = await getDoc(doc(window.firebaseDB, 'settings', 'website'));

                const toggle = document.getElementById('websiteDisabledToggle');
                if (websiteDoc.exists()) {
                    const data = websiteDoc.data();
                    toggle.checked = data.disabled === true;
                } else {
                    toggle.checked = false;
                }

                updateWebsiteStatusMessage(toggle.checked);
            } catch (error) {
                console.error('Error loading website status:', error);
            }
        }

        // Êõ¥Êñ∞Á∂≤Á´ôÁãÄÊÖãË®äÊÅØ
        function updateWebsiteStatusMessage(isDisabled) {
            const messageDiv = document.getElementById('websiteStatusMessage');
            if (isDisabled) {
                messageDiv.className = 'mt-4 p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300';
                messageDiv.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Á∂≤Á´ôÁõÆÂâçÂ∑≤ÂÅúÁî®ÔºåË®™ÂÆ¢Â∞áÁúãÂà∞Á∂≠Ë≠∑È†ÅÈù¢„ÄÇ';
                messageDiv.classList.remove('hidden');
            } else {
                messageDiv.className = 'mt-4 p-3 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300';
                messageDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Á∂≤Á´ôÊ≠£Â∏∏ÈÅã‰Ωú‰∏≠„ÄÇ';
                messageDiv.classList.remove('hidden');
            }
        }

        // ÂÑ≤Â≠òÁ∂≤Á´ôÁãÄÊÖã
        async function saveWebsiteStatus(isDisabled) {
            try {
                const { doc, setDoc } = window.firestoreModules;
                await setDoc(doc(window.firebaseDB, 'settings', 'website'), {
                    disabled: isDisabled,
                    updatedAt: new Date()
                });

                updateWebsiteStatusMessage(isDisabled);
                showNotification(isDisabled ? 'Á∂≤Á´ôÂ∑≤ÂÅúÁî®' : 'Á∂≤Á´ôÂ∑≤ÂïüÁî®', 'success');
            } catch (error) {
                console.error('Error saving website status:', error);
                showNotification('ÂÑ≤Â≠òÂ§±Êïó: ' + error.message, 'error');
            }
        }

        // ========================================
        // Ë∏¢Âá∫Ë®™ÂÆ¢ÂäüËÉΩ
        // ========================================

        // È°ØÁ§∫Á¢∫Ë™çÂ∞çË©±Ê°Ü
        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => {
                modal.remove();
            });

            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                modal.remove();
                onConfirm();
            });
        }

        // Ë∏¢Âá∫ÊâÄÊúâË®™ÂÆ¢ÔºàÁõ¥Êé•Ë∏¢Âá∫Ôºâ
        async function kickOutAllVisitors() {
            showConfirmDialog('Á¢∫ÂÆöË¶ÅË∏¢Âá∫ÊâÄÊúâÂú®Á∑öË®™ÂÆ¢ÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÊí§Èä∑„ÄÇ', async () => {
                await performKickOutAll();
            });
        }

        async function performKickOutAll() {
            try {
                const { collection, query, where, getDocs, updateDoc, doc, serverTimestamp } = window.firestoreModules;

                const visitorsRef = collection(window.firebaseDB, 'visitors');
                const activeQuery = query(visitorsRef, where('active', '==', true));
                const snapshot = await getDocs(activeQuery);

                let kickedCount = 0;
                const batch = [];

                snapshot.forEach(docSnapshot => {
                    batch.push(updateDoc(doc(window.firebaseDB, 'visitors', docSnapshot.id), {
                        active: false,
                        kickedAt: new Date(),
                        kickReason: 'admin_kick_all'
                    }));
                    kickedCount++;
                });

                await Promise.all(batch);

                showNotification(`Â∑≤Ë∏¢Âá∫ ${kickedCount} ‰ΩçË®™ÂÆ¢`, 'success');
                refreshVisitorStats();
            } catch (error) {
                console.error('Ë∏¢Âá∫Ë®™ÂÆ¢Â§±Êïó:', error);
                showNotification('Ë∏¢Âá∫Â§±Êïó: ' + error.message, 'error');
            }
        }

        // ÁôºÈÄÅË∏¢Âá∫Ë≠¶ÂëäÔºà30ÁßíÂÄíÊï∏Ôºâ
        async function sendKickWarning() {
            try {
                const { doc, setDoc } = window.firestoreModules;

                // Ë®≠ÁΩÆË∏¢Âá∫Ë≠¶ÂëäÊôÇÈñìÊà≥
                await setDoc(doc(window.firebaseDB, 'settings', 'kick_warning'), {
                    active: true,
                    warningTime: new Date(),
                    kickTime: new Date(Date.now() + 30000) // 30ÁßíÂæå
                });

                showNotification('Â∑≤ÁôºÈÄÅË∏¢Âá∫Ë≠¶ÂëäÔºåË®™ÂÆ¢ÈúÄÂú®30ÁßíÂÖßÂõûÊáâ', 'success');
                document.getElementById('cancelKickWarningBtn').classList.remove('hidden');
            } catch (error) {
                console.error('ÁôºÈÄÅË≠¶ÂëäÂ§±Êïó:', error);
                showNotification('ÁôºÈÄÅÂ§±Êïó: ' + error.message, 'error');
            }
        }

        // ÂèñÊ∂àË∏¢Âá∫Ë≠¶Âëä
        async function cancelKickWarning() {
            try {
                const { doc, setDoc } = window.firestoreModules;

                await setDoc(doc(window.firebaseDB, 'settings', 'kick_warning'), {
                    active: false,
                    cancelledAt: new Date()
                });

                showNotification('Â∑≤ÂèñÊ∂àË∏¢Âá∫Ë≠¶Âëä', 'success');
                document.getElementById('cancelKickWarningBtn').classList.add('hidden');
            } catch (error) {
                console.error('ÂèñÊ∂àË≠¶ÂëäÂ§±Êïó:', error);
                showNotification('ÂèñÊ∂àÂ§±Êïó: ' + error.message, 'error');
            }
        }

        // Á∂ÅÂÆöÁ∂≤Á´ôÂÅúÁî®ÈñãÈóú
        document.addEventListener('DOMContentLoaded', () => {
            const toggle = document.getElementById('websiteDisabledToggle');
            if (toggle) {
                toggle.addEventListener('change', (e) => {
                    saveWebsiteStatus(e.target.checked);
                });
            }
        });

        window.refreshVisitorStats = async function() {
            try {
                const { collection, query, where, getDocs, orderBy, Timestamp } = window.firestoreModules;

                // Get online visitors (active within last 2 minutes)
                const twoMinutesAgo = new Date(Date.now() - 120000);
                const visitorsRef = collection(window.firebaseDB, 'visitors');

                // Get active visitors
                const activeQuery = query(
                    visitorsRef,
                    where('active', '==', true)
                );
                const activeSnapshot = await getDocs(activeQuery);

                // Filter by lastHeartbeat manually (Firestore compound query limitation)
                let onlineCount = 0;
                activeSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.lastHeartbeat) {
                        const heartbeatTime = data.lastHeartbeat.toDate ? data.lastHeartbeat.toDate() : new Date(data.lastHeartbeat);
                        if (heartbeatTime > twoMinutesAgo) {
                            onlineCount++;
                        }
                    }
                });

                document.getElementById('statOnlineVisitors').textContent = onlineCount;

                // Get today's visitors
                const today = new Date().toISOString().split('T')[0];
                const historyRef = collection(window.firebaseDB, 'visit_history');
                const todayQuery = query(historyRef, where('date', '==', today));
                const todaySnapshot = await getDocs(todayQuery);

                document.getElementById('statTodayVisitors').textContent = todaySnapshot.size;

                // Get total visitors
                const totalSnapshot = await getDocs(collection(window.firebaseDB, 'visit_history'));
                document.getElementById('statTotalVisitors').textContent = totalSnapshot.size;

            } catch (error) {
                console.error('Error refreshing visitor stats:', error);
            }
        };

        async function loadVisitorSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const settingsDoc = await getDoc(doc(window.firebaseDB, 'settings', 'visitor'));

                if (settingsDoc.exists()) {
                    const data = settingsDoc.data();
                    document.getElementById('visitorMaxLimit').value = data.maxVisitors || 0;
                } else {
                    document.getElementById('visitorMaxLimit').value = 0;
                }
            } catch (error) {
                console.error('Error loading visitor settings:', error);
            }
        }

        async function loadVisitorHistory() {
            const loadingEl = document.getElementById('visitorHistoryLoading');
            const listEl = document.getElementById('visitorHistoryList');
            const emptyEl = document.getElementById('visitorHistoryEmpty');
            const tableBody = document.getElementById('visitorHistoryTableBody');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            tableBody.innerHTML = '';

            try {
                const { collection, getDocs } = window.firestoreModules;
                const historySnapshot = await getDocs(collection(window.firebaseDB, 'visit_history'));

                loadingEl.classList.add('hidden');

                if (historySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                // Group by date
                const dateMap = {};
                historySnapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.date || 'unknown';
                    if (!dateMap[date]) {
                        dateMap[date] = 0;
                    }
                    dateMap[date]++;
                });

                // Sort by date (newest first)
                const sortedDates = Object.keys(dateMap).sort((a, b) => b.localeCompare(a));

                // Only show last 30 days
                const recentDates = sortedDates.slice(0, 30);

                recentDates.forEach(date => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50';
                    row.innerHTML = `
                        <td class="px-4 py-3">${date}</td>
                        <td class="px-4 py-3 font-semibold">${dateMap[date]}</td>
                    `;
                    tableBody.appendChild(row);
                });

                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading visitor history:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Ê≠∑Âè≤Êï∏ÊìöÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        // Visitor Settings Form
        const visitorSettingsForm = document.getElementById('visitorSettingsForm');
        if (visitorSettingsForm) {
            visitorSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const maxVisitors = parseInt(document.getElementById('visitorMaxLimit').value) || 0;

                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'visitor'), {
                        maxVisitors: maxVisitors,
                        updatedAt: new Date()
                    });
                    showAlert('Ë®™ÂÆ¢ÈôêÂà∂Ë®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('Error saving visitor settings:', error);
                    showAlert('ÂÑ≤Â≠òË®≠ÁΩÆÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Announcements Management
        // ========================================

        // ÂÖ¨ÂëäË≥áÊñôÂø´Âèñ
        let announcementsCache = [];

        async function loadAnnouncements() {
            const loadingEl = document.getElementById('announcementsLoading');
            const listEl = document.getElementById('announcementsList');
            const emptyEl = document.getElementById('announcementsEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'announcements'), orderBy('createdAt', 'desc'));
                const querySnapshot = await getDocs(q);

                loadingEl.classList.add('hidden');

                // Áµ±Ë®àÊï∏Êìö
                let stats = { total: 0, active: 0, pinned: 0, urgent: 0 };

                if (querySnapshot.empty) {
                    updateAnnouncementStats(stats);
                    emptyEl.classList.remove('hidden');
                    announcementsCache = [];
                    return;
                }

                // ÂÖàÊåâÁΩÆÈ†ÇÂíåÊôÇÈñìÊéíÂ∫è
                const sortedDocs = querySnapshot.docs.sort((a, b) => {
                    const aData = a.data();
                    const bData = b.data();
                    if (aData.pinned && !bData.pinned) return -1;
                    if (!aData.pinned && bData.pinned) return 1;
                    const aTime = aData.createdAt?.seconds || 0;
                    const bTime = bData.createdAt?.seconds || 0;
                    return bTime - aTime;
                });

                // Êõ¥Êñ∞Âø´Âèñ
                announcementsCache = sortedDocs.map(doc => ({ id: doc.id, ...doc.data() }));

                sortedDocs.forEach((docSnapshot) => {
                    const announcement = docSnapshot.data();
                    const announcementId = docSnapshot.id;

                    // Êõ¥Êñ∞Áµ±Ë®à
                    stats.total++;
                    if (announcement.active) stats.active++;
                    if (announcement.pinned) stats.pinned++;
                    if (announcement.category === 'urgent') stats.urgent++;

                    const createdDate = announcement.createdAt ? new Date(announcement.createdAt.seconds * 1000).toLocaleString('zh-TW') : 'Êú™Áü•ÊôÇÈñì';

                    const categoryLabels = {
                        'general': { icon: 'üü¢', text: '‰∏ÄËà¨', color: 'bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-200' },
                        'important': { icon: 'üü°', text: 'ÈáçË¶Å', color: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' },
                        'urgent': { icon: 'üî¥', text: 'Á∑äÊÄ•', color: 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' },
                        'event': { icon: 'üîµ', text: 'Ê¥ªÂãï', color: 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200' }
                    };
                    const category = announcement.category || 'general';
                    const categoryLabel = categoryLabels[category] || categoryLabels['general'];

                    // ÂÆöÊôÇÁôºÂ∏ÉÁãÄÊÖã
                    let scheduleInfo = '';
                    let isScheduled = false;
                    const now = new Date();
                    if (announcement.startTime) {
                        const startDate = announcement.startTime.seconds ? new Date(announcement.startTime.seconds * 1000) : new Date(announcement.startTime);
                        if (startDate > now) {
                            scheduleInfo = `<span class="text-orange-500 text-xs"><i class="fas fa-clock mr-1"></i>È†êÂÆö ${startDate.toLocaleString('zh-TW')} ÁôºÂ∏É</span>`;
                            isScheduled = true;
                        }
                    }
                    if (announcement.endTime) {
                        const endDate = announcement.endTime.seconds ? new Date(announcement.endTime.seconds * 1000) : new Date(announcement.endTime);
                        if (endDate < now) {
                            scheduleInfo = `<span class="text-gray-400 text-xs"><i class="fas fa-times-circle mr-1"></i>Â∑≤Êñº ${endDate.toLocaleString('zh-TW')} ÁµêÊùü</span>`;
                        } else {
                            scheduleInfo += scheduleInfo ? ' | ' : '';
                            scheduleInfo += `<span class="text-blue-500 text-xs"><i class="fas fa-hourglass-end mr-1"></i>ÁµêÊùüÊñº ${endDate.toLocaleString('zh-TW')}</span>`;
                        }
                    }

                    const imagePreview = announcement.imageUrl ? `
                        <div class="mt-3">
                            <img src="${announcement.imageUrl}" alt="ÂÖ¨ÂëäÂúñÁâá" class="max-h-32 rounded-lg object-cover cursor-pointer hover:opacity-80 transition-opacity" onclick="window.open('${announcement.imageUrl}', '_blank')">
                        </div>
                    ` : '';

                    const editDataStr = encodeURIComponent(JSON.stringify({
                        id: announcementId,
                        title: announcement.title || '',
                        content: announcement.content || '',
                        imageUrl: announcement.imageUrl || '',
                        links: announcement.links || [],
                        category: announcement.category || 'general',
                        pinned: announcement.pinned || false,
                        startTime: announcement.startTime ? (announcement.startTime.seconds ? new Date(announcement.startTime.seconds * 1000).toISOString().slice(0, 16) : new Date(announcement.startTime).toISOString().slice(0, 16)) : '',
                        endTime: announcement.endTime ? (announcement.endTime.seconds ? new Date(announcement.endTime.seconds * 1000).toISOString().slice(0, 16) : new Date(announcement.endTime).toISOString().slice(0, 16)) : ''
                    }));

                    const announcementCard = document.createElement('div');
                    announcementCard.className = 'announcement-card bg-gray-50 dark:bg-gray-700 rounded-xl p-6 border-l-4 transition-all hover:shadow-md';
                    announcementCard.style.borderLeftColor = announcement.pinned ? '#f59e0b' : (announcement.category === 'urgent' ? '#ef4444' : '#5D5CDE');
                    announcementCard.dataset.category = category;
                    announcementCard.dataset.active = announcement.active ? 'true' : 'false';
                    announcementCard.dataset.pinned = announcement.pinned ? 'true' : 'false';
                    announcementCard.dataset.scheduled = isScheduled ? 'true' : 'false';
                    // ÊîØÊè¥Â§öË™ûË®ÄÊ†ºÂºè
                    const titleStr = typeof announcement.title === 'object' ? (announcement.title?.zhTW || '') : (announcement.title || '');
                    const contentStr = typeof announcement.content === 'object' ? (announcement.content?.zhTW || '') : (announcement.content || '');
                    announcementCard.dataset.title = titleStr.toLowerCase();
                    announcementCard.dataset.content = contentStr.toLowerCase();

                    announcementCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex flex-wrap items-center gap-2 mb-2">
                                    ${announcement.pinned ? '<span class="text-xl animate-pulse" title="ÁΩÆÈ†Ç">üìå</span>' : ''}
                                    <h3 class="text-lg font-bold">${titleStr}</h3>
                                    <span class="px-2 py-0.5 ${categoryLabel.color} rounded-full text-xs font-semibold">
                                        ${categoryLabel.icon} ${categoryLabel.text}
                                    </span>
                                    <span class="px-2 py-0.5 ${announcement.active ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300'} rounded-full text-xs font-semibold">
                                        ${announcement.active ? '‚úì ÂïüÁî®‰∏≠' : '‚óã Â∑≤ÂÅúÁî®'}
                                    </span>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-2 whitespace-pre-wrap">${contentStr}</p>
                                ${imagePreview}
                                <div class="flex flex-wrap items-center gap-3 mt-3 text-sm text-gray-500 dark:text-gray-400">
                                    <span>üïê ${createdDate}</span>
                                    ${scheduleInfo}
                                </div>
                            </div>
                            <div class="flex flex-col gap-2 ml-4">
                                <button onclick="editAnnouncement('${editDataStr}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    ‚úèÔ∏è Á∑®ËºØ
                                </button>
                                <button onclick="togglePinAnnouncement('${announcementId}', ${!announcement.pinned})" class="px-4 py-2 ${announcement.pinned ? 'bg-orange-500 hover:bg-orange-600' : 'bg-gray-400 hover:bg-gray-500'} text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    üìå ${announcement.pinned ? 'ÂèñÊ∂àÁΩÆÈ†Ç' : 'ÁΩÆÈ†Ç'}
                                </button>
                                <button onclick="toggleAnnouncement('${announcementId}', ${!announcement.active})" class="px-4 py-2 ${announcement.active ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-500 hover:bg-green-600'} text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    ${announcement.active ? '‚è∏Ô∏è ÂÅúÁî®' : '‚ñ∂Ô∏è ÂïüÁî®'}
                                </button>
                                <button onclick="deleteAnnouncement('${announcementId}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors shadow-sm">
                                    üóëÔ∏è Âà™Èô§
                                </button>
                            </div>
                        </div>
                    `;

                    listEl.appendChild(announcementCard);
                });

                updateAnnouncementStats(stats);
                listEl.classList.remove('hidden');
            } catch (error) {
                console.error('Error loading announcements:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<div class="text-6xl mb-4">‚ùå</div><p class="text-red-500">ËºâÂÖ•Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        function updateAnnouncementStats(stats) {
            const totalEl = document.getElementById('annStatTotal');
            const activeEl = document.getElementById('annStatActive');
            const pinnedEl = document.getElementById('annStatPinned');
            const urgentEl = document.getElementById('annStatUrgent');
            if (totalEl) totalEl.textContent = stats.total;
            if (activeEl) activeEl.textContent = stats.active;
            if (pinnedEl) pinnedEl.textContent = stats.pinned;
            if (urgentEl) urgentEl.textContent = stats.urgent;
        }

        window.filterAnnouncements = function() {
            const categoryFilter = document.getElementById('annFilterCategory')?.value || '';
            const statusFilter = document.getElementById('annFilterStatus')?.value || '';
            const searchInput = (document.getElementById('annSearchInput')?.value || '').toLowerCase();

            document.querySelectorAll('.announcement-card').forEach(card => {
                let show = true;

                // ÂàÜÈ°ûÁØ©ÈÅ∏
                if (categoryFilter && card.dataset.category !== categoryFilter) {
                    show = false;
                }

                // ÁãÄÊÖãÁØ©ÈÅ∏
                if (statusFilter) {
                    if (statusFilter === 'active' && card.dataset.active !== 'true') show = false;
                    if (statusFilter === 'inactive' && card.dataset.active !== 'false') show = false;
                    if (statusFilter === 'pinned' && card.dataset.pinned !== 'true') show = false;
                    if (statusFilter === 'scheduled' && card.dataset.scheduled !== 'true') show = false;
                }

                // ÊêúÂ∞ã
                if (searchInput) {
                    const title = card.dataset.title || '';
                    const content = card.dataset.content || '';
                    if (!title.includes(searchInput) && !content.includes(searchInput)) {
                        show = false;
                    }
                }

                card.style.display = show ? 'block' : 'none';
            });
        };

        window.clearAnnouncementFilters = function() {
            const categorySelect = document.getElementById('annFilterCategory');
            const statusSelect = document.getElementById('annFilterStatus');
            const searchInput = document.getElementById('annSearchInput');
            if (categorySelect) categorySelect.value = '';
            if (statusSelect) statusSelect.value = '';
            if (searchInput) searchInput.value = '';
            filterAnnouncements();
        };

        window.refreshAnnouncements = function() {
            loadAnnouncements();
            showAlert('ÂÖ¨ÂëäÂàóË°®Â∑≤Âà∑Êñ∞');
        };

        window.togglePinAnnouncement = async function(id, pinned) {
            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'announcements', id), { pinned: pinned });
                showAlert(pinned ? 'ÂÖ¨ÂëäÂ∑≤ÁΩÆÈ†Ç' : 'Â∑≤ÂèñÊ∂àÁΩÆÈ†Ç');
                loadAnnouncements();
            } catch (error) {
                console.error('Toggle pin error:', error);
                showAlert('Êìç‰ΩúÂ§±ÊïóÔºö' + error.message);
            }
        };

        const addAnnouncementBtn = document.getElementById('addAnnouncementBtn');
        if (addAnnouncementBtn) {
            addAnnouncementBtn.addEventListener('click', () => {
                showEnhancedAnnouncementDialog();
            });
        }

        // Â¢ûÂº∑ÁâàÂÖ¨ÂëäÂ∞çË©±Ê°Ü
        function showEnhancedAnnouncementDialog(editData = null) {
            const isEdit = !!editData;
            // ËôïÁêÜÂ∑≤ÊúâÁöÑÈÄ£Áµê
            const existingLinks = editData?.links || [];
            const existingLinksStr = Array.isArray(existingLinks) ? existingLinks.join('\n') : '';

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4 overflow-y-auto py-8';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl w-full my-auto">
                    <h3 class="text-xl font-bold mb-4">${isEdit ? 'Á∑®ËºØË®äÊÅØ' : 'Êñ∞Â¢ûË®äÊÅØ'}</h3>
                    <div class="space-y-4 max-h-[70vh] overflow-y-auto pr-2">
                        <!-- Â§öË™ûË®ÄÊ®ôÈ°å -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                            <label class="block text-sm font-semibold mb-3">üìù Ê®ôÈ°å *ÔºàÂ§öË™ûË®ÄÔºâ</label>
                            <div class="space-y-2">
                                <div class="flex items-center gap-2">
                                    <span class="w-16 text-xs text-gray-500">ÁπÅÈ´î</span>
                                    <input type="text" id="annTitleZhTW" value="${editData?.title?.zhTW || editData?.title || ''}" placeholder="ÁπÅÈ´î‰∏≠ÊñáÊ®ôÈ°å" class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="w-16 text-xs text-gray-500">ÁÆÄ‰Ωì</span>
                                    <input type="text" id="annTitleZhCN" value="${editData?.title?.zhCN || ''}" placeholder="ÁÆÄ‰Ωì‰∏≠ÊñáÊ†áÈ¢ò" class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="w-16 text-xs text-gray-500">English</span>
                                    <input type="text" id="annTitleEn" value="${editData?.title?.en || ''}" placeholder="English Title" class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                            </div>
                        </div>
                        <!-- Â§öË™ûË®ÄÂÖßÂÆπ -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                            <label class="block text-sm font-semibold mb-3">üìÑ ÂÖßÂÆπ *ÔºàÂ§öË™ûË®ÄÔºâ</label>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-xs text-gray-500">ÁπÅÈ´î‰∏≠Êñá</span>
                                    <textarea id="annContentZhTW" rows="2" placeholder="ÁπÅÈ´î‰∏≠ÊñáÂÖßÂÆπ" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none mt-1">${editData?.content?.zhTW || editData?.content || ''}</textarea>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-500">ÁÆÄ‰Ωì‰∏≠Êñá</span>
                                    <textarea id="annContentZhCN" rows="2" placeholder="ÁÆÄ‰Ωì‰∏≠ÊñáÂÜÖÂÆπ" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none mt-1">${editData?.content?.zhCN || ''}</textarea>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-500">English</span>
                                    <textarea id="annContentEn" rows="2" placeholder="English Content" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none mt-1">${editData?.content?.en || ''}</textarea>
                                </div>
                            </div>
                        </div>
                        <!-- ÈÄ£ÁµêÂçÄÂüü -->
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                            <label class="block text-sm font-semibold mb-2">üîó ÈÄ£ÁµêÔºàÈÅ∏Â°´ÔºåÊØèË°å‰∏ÄÂÄãÔºâ</label>
                            <textarea id="annLinks" rows="3" placeholder="https://example.com/link1&#10;https://example.com/link2" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none">${existingLinksStr}</textarea>
                            <p class="text-xs text-gray-500 mt-1">ÊîØÊè¥Â§öÂÄãÈÄ£ÁµêÔºåÊØèË°åËº∏ÂÖ•‰∏ÄÂÄã URL</p>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂúñÁâá URLÔºàÈÅ∏Â°´Ôºâ</label>
                            <input type="url" id="annImageUrl" value="${editData?.imageUrl || ''}" placeholder="https://example.com/image.jpg" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">ÂàÜÈ°ûÊ®ôÁ±§</label>
                            <select id="annCategory" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                <option value="general" ${editData?.category === 'general' ? 'selected' : ''}>üü¢ ‰∏ÄËà¨</option>
                                <option value="important" ${editData?.category === 'important' ? 'selected' : ''}>üü° ÈáçË¶Å</option>
                                <option value="urgent" ${editData?.category === 'urgent' ? 'selected' : ''}>üî¥ Á∑äÊÄ•</option>
                                <option value="event" ${editData?.category === 'event' ? 'selected' : ''}>üîµ Ê¥ªÂãï</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="annPinned" ${editData?.pinned ? 'checked' : ''} class="w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                                <span class="text-sm font-semibold">üìå ÁΩÆÈ†ÇÂÖ¨Âëä</span>
                            </label>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <label class="block text-sm font-semibold mb-2">ÂÆöÊôÇÁôºÂ∏ÉÔºàÈÅ∏Â°´Ôºâ</label>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">ÈñãÂßãÊôÇÈñì</label>
                                    <input type="datetime-local" id="annStartTime" value="${editData?.startTime || ''}" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">ÁµêÊùüÊôÇÈñì</label>
                                    <input type="datetime-local" id="annEndTime" value="${editData?.endTime || ''}" class="w-full px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">ÁïôÁ©∫Ë°®Á§∫Á´ãÂç≥ÁôºÂ∏É‰∏îÊ∞∏‰πÖÊúâÊïà</p>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded transition-colors">${isEdit ? 'Êõ¥Êñ∞' : 'Êñ∞Â¢û'}</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', async () => {
                // Â§öË™ûË®ÄÊ®ôÈ°å
                const titleZhTW = document.getElementById('annTitleZhTW').value.trim();
                const titleZhCN = document.getElementById('annTitleZhCN').value.trim();
                const titleEn = document.getElementById('annTitleEn').value.trim();

                // Â§öË™ûË®ÄÂÖßÂÆπ
                const contentZhTW = document.getElementById('annContentZhTW').value.trim();
                const contentZhCN = document.getElementById('annContentZhCN').value.trim();
                const contentEn = document.getElementById('annContentEn').value.trim();

                // ÈÄ£Áµê
                const linksText = document.getElementById('annLinks').value.trim();
                const links = linksText ? linksText.split('\n').map(l => l.trim()).filter(l => l && l.startsWith('http')) : [];

                const imageUrl = document.getElementById('annImageUrl').value.trim();
                const category = document.getElementById('annCategory').value;
                const pinned = document.getElementById('annPinned').checked;
                const startTime = document.getElementById('annStartTime').value;
                const endTime = document.getElementById('annEndTime').value;

                if (!titleZhTW || !contentZhTW) {
                    showAlert('Ë´ãËá≥Â∞ëËº∏ÂÖ•ÁπÅÈ´î‰∏≠ÊñáÁöÑÊ®ôÈ°åÂíåÂÖßÂÆπ');
                    return;
                }

                try {
                    const { collection, addDoc, doc, updateDoc } = window.firestoreModules;
                    const data = {
                        title: {
                            zhTW: titleZhTW,
                            zhCN: titleZhCN || titleZhTW,
                            en: titleEn || titleZhTW
                        },
                        content: {
                            zhTW: contentZhTW,
                            zhCN: contentZhCN || contentZhTW,
                            en: contentEn || contentZhTW
                        },
                        links,
                        imageUrl,
                        category,
                        pinned,
                        startTime: startTime ? new Date(startTime) : null,
                        endTime: endTime ? new Date(endTime) : null,
                        active: true,
                        updatedAt: new Date()
                    };

                    if (isEdit) {
                        const { deleteField } = window.firestoreModules;
                        data.link = deleteField(); // Âà™Èô§ËàäÁöÑÂñÆ‰∏ÄÈÄ£ÁµêÊ¨Ñ‰Ωç
                        await updateDoc(doc(window.firebaseDB, 'announcements', editData.id), data);
                        showAlert('Ë®äÊÅØÂ∑≤Êõ¥Êñ∞ÔºÅ');
                    } else {
                        data.createdAt = new Date();
                        await addDoc(collection(window.firebaseDB, 'announcements'), data);
                        showAlert('Ë®äÊÅØÂ∑≤Êñ∞Â¢ûÔºÅ');
                    }

                    modal.remove();
                    loadAnnouncements();
                } catch (error) {
                    console.error('Error saving announcement:', error);
                    showAlert('ÂÑ≤Â≠òË®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }
        window.showEnhancedAnnouncementDialog = showEnhancedAnnouncementDialog;

        // Á∑®ËºØÂÖ¨ÂëäÊåâÈàïËôïÁêÜ
        window.editAnnouncement = function(encodedData) {
            try {
                const editData = JSON.parse(decodeURIComponent(encodedData));
                showEnhancedAnnouncementDialog(editData);
            } catch (error) {
                console.error('Error parsing announcement data:', error);
                showAlert('ÁÑ°Ê≥ïÁ∑®ËºØÊ≠§ÂÖ¨Âëä');
            }
        };

        window.toggleAnnouncement = async (id, active) => {
            try {
                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'announcements', id), { active });
                showAlert(active ? 'Ë®äÊÅØÂ∑≤ÂïüÁî®ÔºÅ' : 'Ë®äÊÅØÂ∑≤ÂÅúÁî®ÔºÅ');
                loadAnnouncements();
            } catch (error) {
                console.error('Error toggling announcement:', error);
                showAlert('Êõ¥Êñ∞Ë®äÊÅØÁãÄÊÖãÊôÇÁôºÁîüÈåØË™§');
            }
        };

        window.deleteAnnouncement = (id) => {
            showConfirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§Ë®äÊÅØÂóéÔºü', async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'announcements', id));
                    showAlert('Ë®äÊÅØÂ∑≤Âà™Èô§ÔºÅ');
                    loadAnnouncements();
                } catch (error) {
                    console.error('Error deleting announcement:', error);
                    showAlert('Âà™Èô§Ë®äÊÅØÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // Prompt Dialog for Announcements
        function showPromptDialog(dialogTitle, label1, label2, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full">
                    <h3 class="text-xl font-bold mb-4">${dialogTitle}</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">${label1}</label>
                            <input type="text" id="promptInput1" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">${label2}</label>
                            <textarea id="promptInput2" rows="4" class="w-full px-4 py-2 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary outline-none resize-none"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">ÂèñÊ∂à</button>
                        <button class="confirm-btn px-6 py-2 bg-primary text-white hover:bg-primary-dark rounded transition-colors">Á¢∫ÂÆö</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const input1 = modal.querySelector('#promptInput1');
            const input2 = modal.querySelector('#promptInput2');

            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                const value1 = input1.value.trim();
                const value2 = input2.value.trim();
                modal.remove();
                onConfirm(value1, value2);
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            // Focus on first input
            setTimeout(() => input1.focus(), 100);
        }

        // ========================================
        // User Management
        // ========================================

        let currentUserFilter = 'all';
        let allUsers = [];

        async function loadUsers() {
            const loadingEl = document.getElementById('usersLoading');
            const listEl = document.getElementById('usersList');
            const emptyEl = document.getElementById('usersEmptyState');

            loadingEl.classList.remove('hidden');
            listEl.classList.add('hidden');
            emptyEl.classList.add('hidden');
            listEl.innerHTML = '';

            try {
                const { collection, getDocs } = window.firestoreModules;
                const querySnapshot = await getDocs(collection(window.firebaseDB, 'users'));

                loadingEl.classList.add('hidden');

                if (querySnapshot.empty) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                allUsers = [];
                querySnapshot.forEach((docSnapshot) => {
                    const user = docSnapshot.data();
                    allUsers.push({
                        id: docSnapshot.id,
                        ...user
                    });
                });

                renderUsers();
            } catch (error) {
                console.error('Error loading users:', error);
                loadingEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-red-500">ËºâÂÖ•Áî®Êà∂ÊôÇÁôºÁîüÈåØË™§</p>';
                emptyEl.classList.remove('hidden');
            }
        }

        function renderUsers() {
            const listEl = document.getElementById('usersList');
            const emptyEl = document.getElementById('usersEmptyState');

            let filteredUsers = allUsers;

            // Filter by role or status
            if (currentUserFilter === 'admin') {
                filteredUsers = allUsers.filter(u => u.role === 'admin');
            } else if (currentUserFilter === 'user') {
                filteredUsers = allUsers.filter(u => u.role === 'user' || !u.role);
            } else if (currentUserFilter === 'pending') {
                filteredUsers = allUsers.filter(u => u.status === 'pending');
            } else if (currentUserFilter === 'approved') {
                filteredUsers = allUsers.filter(u => u.status === 'approved');
            } else if (currentUserFilter === 'rejected') {
                filteredUsers = allUsers.filter(u => u.status === 'rejected');
            }

            if (filteredUsers.length === 0) {
                listEl.classList.add('hidden');
                emptyEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÁî®Êà∂</p>';
                emptyEl.classList.remove('hidden');
                return;
            }

            emptyEl.classList.add('hidden');

            listEl.innerHTML = '';
            filteredUsers.forEach((user) => {
                const roleColors = {
                    'admin': 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200',
                    'user': 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200'
                };

                const statusColors = {
                    'pending': 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200',
                    'approved': 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200',
                    'rejected': 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'
                };

                const roleClass = roleColors[user.role] || roleColors['user'];
                const statusClass = statusColors[user.status] || statusColors['pending'];

                const roleText = user.role === 'admin' ? 'ÁÆ°ÁêÜÂì°' : 'ÊôÆÈÄöÁî®Êà∂';
                const statusText = {
                    'pending': 'ÂæÖÂØ©Ê†∏',
                    'approved': 'Â∑≤ÊâπÂáÜ',
                    'rejected': 'Â∑≤ÊãíÁµï'
                }[user.status] || 'ÂæÖÂØ©Ê†∏';

                const userCard = document.createElement('div');
                userCard.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-6';
                userCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-3">
                                <h3 class="text-lg font-bold">${user.name || 'Êú™Ë®≠ÂÆöÂßìÂêç'}</h3>
                                <span class="px-3 py-1 ${roleClass} rounded-full text-xs font-semibold">${roleText}</span>
                                <span class="px-3 py-1 ${statusClass} rounded-full text-xs font-semibold">${statusText}</span>
                            </div>
                            <div class="space-y-1 text-sm text-gray-600 dark:text-gray-400">
                                <p><span class="font-semibold">Áî®Êà∂Âêç:</span> ${user.username || 'Êú™Ë®≠ÂÆö'}</p>
                                <p><span class="font-semibold">ÈõªÂ≠êÈÉµ‰ª∂:</span> ${user.email || ''}</p>
                                <p><span class="font-semibold">Áî®Êà∂ ID:</span> ${user.id}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="editUser('${user.id}')" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                Á∑®ËºØ
                            </button>
                            <button onclick="deleteUser('${user.id}')" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition-colors">
                                Âà™Èô§
                            </button>
                        </div>
                    </div>
                `;

                listEl.appendChild(userCard);
            });

            listEl.classList.remove('hidden');
        }

        window.filterUsers = function(filter) {
            currentUserFilter = filter;
            document.querySelectorAll('.user-filter-btn').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700');
            event.target.classList.add('bg-primary', 'text-white');
            renderUsers();
        };

        window.editUser = async function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('userId').value = userId;
            document.getElementById('userUsername').value = user.username || 'Êú™Ë®≠ÂÆö';
            document.getElementById('userEmail').value = user.email || '';
            document.getElementById('userName').value = user.name || '';
            document.getElementById('userRole').value = user.role || 'user';
            document.getElementById('userStatus').value = user.status || 'pending';

            document.getElementById('userModal').classList.remove('hidden');
        };

        window.deleteUser = function(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            // Prevent deleting super admin
            if (userId === SUPER_ADMIN_UID) {
                showAlert('ÁÑ°Ê≥ïÂà™Èô§Ë∂ÖÁ¥öÁÆ°ÁêÜÂì°Â∏≥Ëôü');
                return;
            }

            // Prevent deleting yourself
            if (userId === currentUser.uid) {
                showAlert('ÁÑ°Ê≥ïÂà™Èô§Ëá™Â∑±ÁöÑÂ∏≥Ëôü');
                return;
            }

            showConfirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§Áî®Êà∂ "${user.name || user.username || user.email}" ÂóéÔºü`, async () => {
                try {
                    const { doc, deleteDoc } = window.firestoreModules;
                    await deleteDoc(doc(window.firebaseDB, 'users', userId));
                    showAlert('Áî®Êà∂Â∑≤Âà™Èô§ÔºÅ');
                    loadUsers();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    showAlert('Âà™Èô§Áî®Êà∂ÊôÇÁôºÁîüÈåØË™§');
                }
            });
        };

        // User Modal Handlers
        document.querySelectorAll('.closeUserModal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('userModal').classList.add('hidden');
            });
        });

        const userForm = document.getElementById('userForm');
        if (userForm) {
            userForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const userId = document.getElementById('userId').value;
                const userData = {
                    name: document.getElementById('userName').value,
                    role: document.getElementById('userRole').value,
                    status: document.getElementById('userStatus').value
                };

                try {
                    const { doc, updateDoc } = window.firestoreModules;
                    await updateDoc(doc(window.firebaseDB, 'users', userId), userData);
                    showAlert('Áî®Êà∂Ë≥áÊñôÂ∑≤Êõ¥Êñ∞ÔºÅ');
                    document.getElementById('userModal').classList.add('hidden');
                    loadUsers();
                } catch (error) {
                    console.error('Error updating user:', error);
                    showAlert('Êõ¥Êñ∞Áî®Êà∂Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§');
                }
            });
        }

        // ========================================
        // Profile Management
        // ========================================

        let verificationCodes = {
            username: { code: '', email: '', timestamp: 0, newUsername: '' },
            oldEmail: { code: '', email: '', timestamp: 0 },
            newEmail: { code: '', email: '', timestamp: 0, newEmailAddress: '' }
        };

        // Load and display current user profile
        async function loadProfile() {
            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));

                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    document.getElementById('profileCurrentUsername').textContent = userData.username || 'Êú™Ë®≠ÂÆö';
                    document.getElementById('profileCurrentEmail').textContent = userData.email || user.email;
                    document.getElementById('profileCurrentName').textContent = userData.name || 'Êú™Ë®≠ÂÆö';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Generate 6-digit verification code
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Send verification email using EmailJS
        async function sendVerificationEmail(email, code, purpose) {
            try {
                // Á¢∫‰øù emailjs Â∑≤ËºâÂÖ•
                if (typeof window.emailjs === 'undefined') {
                    console.error('EmailJS is not loaded');
                    return false;
                }

                const templateParams = {
                    to_email: email,
                    verification_code: code,
                    purpose: purpose
                };

                // ‰ΩøÁî®Ëàá index.html Áõ∏ÂêåÁöÑÈÖçÁΩÆ
                await window.emailjs.send(
                    window.emailJSConfig.serviceId,
                    window.emailJSConfig.templateId,
                    templateParams
                );
                return true;
            } catch (error) {
                console.error('Error sending email:', error);
                return false;
            }
        }

        // Check if username exists
        async function checkUsernameExists(username) {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'users'), where('username', '==', username));
                const snapshot = await getDocs(q);
                return !snapshot.empty;
            } catch (error) {
                console.error('Error checking username:', error);
                return false;
            }
        }

        // Check if email exists
        async function checkEmailExists(email) {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'users'), where('email', '==', email));
                const snapshot = await getDocs(q);
                return !snapshot.empty;
            } catch (error) {
                console.error('Error checking email:', error);
                return false;
            }
        }

        // Start update username process
        // Start update name process
        window.startUpdateName = async function() {
            const newName = document.getElementById('profileNewName').value.trim();

            if (!newName) {
                showAlert('Ë´ãËº∏ÂÖ•Êñ∞ÂßìÂêç');
                return;
            }

            if (newName.length < 2 || newName.length > 50) {
                showAlert('ÂßìÂêçÂøÖÈ†àÁÇ∫ 2-50 ÂÄãÂ≠óÁ¨¶');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));
                const currentName = userDoc.data().name;

                if (newName === currentName) {
                    showAlert('Êñ∞ÂßìÂêçËàáÁï∂ÂâçÂßìÂêçÁõ∏Âêå');
                    return;
                }

                const email = userDoc.data().email || user.email;
                const code = generateVerificationCode();

                // Send verification email
                const sent = await sendVerificationEmail(email, code, '‰øÆÊîπÂßìÂêç');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store verification code
                verificationCodes.name = {
                    code: code,
                    email: email,
                    timestamp: Date.now(),
                    newName: newName
                };

                // Show verification modal
                document.getElementById('verifyNameEmail').textContent = email;
                document.getElementById('nameVerifyCode').value = '';
                document.getElementById('verifyNameModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error starting name update:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify name modal
        window.closeVerifyNameModal = function() {
            document.getElementById('verifyNameModal').classList.add('hidden');
            document.getElementById('nameVerifyCode').value = '';
        };

        // Confirm update name
        window.confirmUpdateName = async function() {
            const inputCode = document.getElementById('nameVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.name.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÁôºÈÄÅ');
                closeVerifyNameModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.name.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    name: verificationCodes.name.newName
                });

                showAlert('ÂßìÂêçÂ∑≤ÊàêÂäü‰øÆÊîπÔºÅ');
                closeVerifyNameModal();
                document.getElementById('profileNewName').value = '';
                loadProfile();
            } catch (error) {
                console.error('Error updating name:', error);
                showAlert('‰øÆÊîπÂßìÂêçÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Start update username process
        window.startUpdateUsername = async function() {
            const newUsername = document.getElementById('profileNewUsername').value.trim();

            if (!newUsername) {
                showAlert('Ë´ãËº∏ÂÖ•Êñ∞Áî®Êà∂Âêç');
                return;
            }

            if (newUsername.length < 3 || newUsername.length > 20) {
                showAlert('Áî®Êà∂ÂêçÂøÖÈ†àÁÇ∫ 3-20 ÂÄãÂ≠óÁ¨¶');
                return;
            }

            if (!/^[a-zA-Z0-9_-]+$/.test(newUsername)) {
                showAlert('Áî®Êà∂ÂêçÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑öÂíåÈÄ£Â≠óÁ¨¶');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));
                const currentUsername = userDoc.data().username;

                if (newUsername === currentUsername) {
                    showAlert('Êñ∞Áî®Êà∂ÂêçËàáÁï∂ÂâçÁî®Êà∂ÂêçÁõ∏Âêå');
                    return;
                }

                // Check if username already exists
                const exists = await checkUsernameExists(newUsername);
                if (exists) {
                    showAlert('Ê≠§Áî®Êà∂ÂêçÂ∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                const email = userDoc.data().email || user.email;
                const code = generateVerificationCode();

                // Send verification email
                const sent = await sendVerificationEmail(email, code, '‰øÆÊîπÁî®Êà∂Âêç');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store verification code
                verificationCodes.username = {
                    code: code,
                    email: email,
                    timestamp: Date.now(),
                    newUsername: newUsername
                };

                // Show verification modal
                document.getElementById('verifyUsernameEmail').textContent = email;
                document.getElementById('usernameVerifyCode').value = '';
                document.getElementById('verifyUsernameModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error starting username update:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify username modal
        window.closeVerifyUsernameModal = function() {
            document.getElementById('verifyUsernameModal').classList.add('hidden');
            document.getElementById('usernameVerifyCode').value = '';
        };

        // Confirm update username
        window.confirmUpdateUsername = async function() {
            const inputCode = document.getElementById('usernameVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.username.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÁôºÈÄÅ');
                closeVerifyUsernameModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.username.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    username: verificationCodes.username.newUsername
                });

                showAlert('Áî®Êà∂ÂêçÂ∑≤ÊàêÂäü‰øÆÊîπÔºÅ');
                closeVerifyUsernameModal();
                document.getElementById('profileNewUsername').value = '';
                loadProfile();
            } catch (error) {
                console.error('Error updating username:', error);
                showAlert('‰øÆÊîπÁî®Êà∂ÂêçÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Start update email process
        window.startUpdateEmail = async function() {
            const newEmail = document.getElementById('profileNewEmail').value.trim();

            if (!newEmail) {
                showAlert('Ë´ãËº∏ÂÖ•Êñ∞ÈõªÂ≠êÈÉµ‰ª∂');
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(newEmail)) {
                showAlert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÈõªÂ≠êÈÉµ‰ª∂Âú∞ÂùÄ');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, getDoc } = window.firestoreModules;
                const userDoc = await getDoc(doc(window.firebaseDB, 'users', user.uid));
                const currentEmail = userDoc.data().email || user.email;

                if (newEmail === currentEmail) {
                    showAlert('Êñ∞ÈõªÂ≠êÈÉµ‰ª∂ËàáÁï∂ÂâçÈõªÂ≠êÈÉµ‰ª∂Áõ∏Âêå');
                    return;
                }

                // Check if email already exists
                const exists = await checkEmailExists(newEmail);
                if (exists) {
                    showAlert('Ê≠§ÈõªÂ≠êÈÉµ‰ª∂Â∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                // Send verification code to old email
                const code = generateVerificationCode();
                const sent = await sendVerificationEmail(currentEmail, code, 'È©óË≠âËàäÈõªÂ≠êÈÉµ‰ª∂');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store verification code
                verificationCodes.oldEmail = {
                    code: code,
                    email: currentEmail,
                    timestamp: Date.now()
                };

                verificationCodes.newEmail.newEmailAddress = newEmail;

                // Show old email verification modal
                document.getElementById('verifyOldEmailAddress').textContent = currentEmail;
                document.getElementById('oldEmailVerifyCode').value = '';
                document.getElementById('verifyOldEmailModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑËàäÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error starting email update:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify old email modal
        window.closeVerifyOldEmailModal = function() {
            document.getElementById('verifyOldEmailModal').classList.add('hidden');
            document.getElementById('oldEmailVerifyCode').value = '';
        };

        // Confirm old email and send new email verification
        window.confirmOldEmail = async function() {
            const inputCode = document.getElementById('oldEmailVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.oldEmail.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÁôºÈÄÅ');
                closeVerifyOldEmailModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.oldEmail.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            // Old email verified, now send code to new email
            try {
                const newEmail = verificationCodes.newEmail.newEmailAddress;
                const code = generateVerificationCode();
                const sent = await sendVerificationEmail(newEmail, code, 'È©óË≠âÊñ∞ÈõªÂ≠êÈÉµ‰ª∂');

                if (!sent) {
                    showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
                    return;
                }

                // Store new email verification code
                verificationCodes.newEmail.code = code;
                verificationCodes.newEmail.email = newEmail;
                verificationCodes.newEmail.timestamp = Date.now();

                // Close old email modal and show new email modal
                closeVerifyOldEmailModal();
                document.getElementById('verifyNewEmailAddress').textContent = newEmail;
                document.getElementById('newEmailVerifyCode').value = '';
                document.getElementById('verifyNewEmailModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞ÊÇ®ÁöÑÊñ∞ÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error sending new email verification:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // Close verify new email modal
        window.closeVerifyNewEmailModal = function() {
            document.getElementById('verifyNewEmailModal').classList.add('hidden');
            document.getElementById('newEmailVerifyCode').value = '';
        };

        // Confirm update email
        window.confirmUpdateEmail = async function() {
            const inputCode = document.getElementById('newEmailVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            // Check if code is expired (10 minutes)
            const elapsed = Date.now() - verificationCodes.newEmail.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÈñãÂßã');
                closeVerifyNewEmailModal();
                return;
            }

            // Verify code
            if (inputCode !== verificationCodes.newEmail.code) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                const user = window.firebaseAuth.currentUser;
                if (!user) return;

                const { doc, updateDoc } = window.firestoreModules;
                await updateDoc(doc(window.firebaseDB, 'users', user.uid), {
                    email: verificationCodes.newEmail.newEmailAddress
                });

                showAlert('ÈõªÂ≠êÈÉµ‰ª∂Â∑≤ÊàêÂäü‰øÆÊîπÔºÅ');
                closeVerifyNewEmailModal();
                document.getElementById('profileNewEmail').value = '';
                loadProfile();
            } catch (error) {
                console.error('Error updating email:', error);
                showAlert('‰øÆÊîπÈõªÂ≠êÈÉµ‰ª∂ÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // ==================== Add User Functionality ====================

        // Store verification data for new user
        let newUserData = null;

        // Open add user modal
        document.getElementById('addUserBtn').addEventListener('click', () => {
            document.getElementById('addUserForm').reset();
            document.getElementById('addUserStatus').value = 'approved'; // È†êË®≠ÁÇ∫Â∑≤ÊâπÂáÜ
            document.getElementById('addUserModal').classList.remove('hidden');
        });

        // Close add user modal
        document.querySelectorAll('.closeAddUserModal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserForm').reset();
            });
        });

        // Close add user verify modal
        window.closeAddUserVerifyModal = function() {
            document.getElementById('addUserVerifyModal').classList.add('hidden');
            document.getElementById('addUserVerifyCode').value = '';
        };

        // Handle add user form submission (send verification code)
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Áç≤ÂèñË°®ÂñÆÊï∏Êìö
            const name = document.getElementById('addUserName').value.trim();
            const username = document.getElementById('addUserUsername').value.trim();
            const email = document.getElementById('addUserEmail').value.trim();
            const password = document.getElementById('addUserPassword').value;
            const passwordConfirm = document.getElementById('addUserPasswordConfirm').value;
            const role = document.getElementById('addUserRole').value;
            const status = document.getElementById('addUserStatus').value;

            // È©óË≠âÁî®Êà∂ÂêçÊ†ºÂºè
            const usernameRegex = /^[a-zA-Z0-9_-]{3,20}$/;
            if (!usernameRegex.test(username)) {
                showAlert('Áî®Êà∂ÂêçÊ†ºÂºè‰∏çÊ≠£Á¢∫ÔºåÂÉÖÂÖÅË®±3-20ÂÄãÂ≠óÊØç„ÄÅÊï∏Â≠ó„ÄÅ‰∏ãÂäÉÁ∑ö(_)ÊàñÈÄ£Â≠óÁ¨¶(-)');
                return;
            }

            // È©óË≠âÂØÜÁ¢ºÈï∑Â∫¶
            if (password.length < 6) {
                showAlert('ÂØÜÁ¢ºÈï∑Â∫¶Ëá≥Â∞ë6‰Ωç');
                return;
            }

            // È©óË≠âÂÖ©Ê¨°ÂØÜÁ¢ºÊòØÂê¶‰∏ÄËá¥
            if (password !== passwordConfirm) {
                showAlert('ÂÖ©Ê¨°ÂØÜÁ¢ºËº∏ÂÖ•‰∏ç‰∏ÄËá¥');
                return;
            }

            try {
                // Ê™¢Êü•Áî®Êà∂ÂêçÊòØÂê¶Â∑≤Â≠òÂú®
                const { collection, getDocs, query, where } = window.firestoreModules;
                const usersRef = collection(window.firebaseDB, 'users');

                const usernameQuery = query(usersRef, where('username', '==', username));
                const usernameSnapshot = await getDocs(usernameQuery);
                if (!usernameSnapshot.empty) {
                    showAlert('Ê≠§Áî®Êà∂ÂêçÂ∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                // Ê™¢Êü•ÈõªÂ≠êÈÉµ‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®
                const emailQuery = query(usersRef, where('email', '==', email));
                const emailSnapshot = await getDocs(emailQuery);
                if (!emailSnapshot.empty) {
                    showAlert('Ê≠§ÈõªÂ≠êÈÉµ‰ª∂Â∑≤Ë¢´‰ΩøÁî®');
                    return;
                }

                // ÁîüÊàêÈ©óË≠âÁ¢º
                const verificationCode = generateVerificationCode();

                // ÁôºÈÄÅÈ©óË≠âÁ¢ºÂà∞Êñ∞Áî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂
                await sendVerificationEmail(email, verificationCode, 'Êñ∞Áî®Êà∂Ë®ªÂÜä');

                // Êö´Â≠òÁî®Êà∂Êï∏ÊìöÂíåÈ©óË≠âÁ¢º
                newUserData = {
                    name,
                    username,
                    email,
                    password,
                    role,
                    status,
                    verificationCode,
                    timestamp: Date.now()
                };

                // ÈóúÈñâÊñ∞Â¢ûÁî®Êà∂ modalÔºåÊâìÈñãÈ©óË≠âÁ¢º modal
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserVerifyEmail').textContent = email;
                document.getElementById('addUserVerifyCode').value = '';
                document.getElementById('addUserVerifyModal').classList.remove('hidden');

                showAlert('È©óË≠âÁ¢ºÂ∑≤ÁôºÈÄÅÂà∞Êñ∞Áî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂');
            } catch (error) {
                console.error('Error in add user process:', error);
                showAlert('ÁôºÈÄÅÈ©óË≠âÁ¢ºÊôÇÁôºÁîüÈåØË™§');
            }
        });

        // Confirm add user (verify code and create account)
        window.confirmAddUser = async function() {
            const inputCode = document.getElementById('addUserVerifyCode').value.trim();

            if (!inputCode) {
                showAlert('Ë´ãËº∏ÂÖ•È©óË≠âÁ¢º');
                return;
            }

            if (!newUserData) {
                showAlert('È©óË≠âÊï∏ÊìöÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÈñãÂßã');
                closeAddUserVerifyModal();
                return;
            }

            // Ê™¢Êü•È©óË≠âÁ¢ºÊòØÂê¶ÈÅéÊúüÔºà10ÂàÜÈêòÔºâ
            const elapsed = Date.now() - newUserData.timestamp;
            if (elapsed > 10 * 60 * 1000) {
                showAlert('È©óË≠âÁ¢ºÂ∑≤ÈÅéÊúüÔºåË´ãÈáçÊñ∞ÈñãÂßã');
                closeAddUserVerifyModal();
                newUserData = null;
                return;
            }

            // È©óË≠âÈ©óË≠âÁ¢º
            if (inputCode !== newUserData.verificationCode) {
                showAlert('È©óË≠âÁ¢ºÈåØË™§');
                return;
            }

            try {
                // ÂâµÂª∫Êñ∞Áî®Êà∂
                const { collection, addDoc } = window.firestoreModules;
                await addDoc(collection(window.firebaseDB, 'users'), {
                    name: newUserData.name,
                    username: newUserData.username,
                    email: newUserData.email,
                    password: newUserData.password, // Ê≥®ÊÑèÔºöÂØ¶ÈöõÊáâÁî®‰∏≠ÊáâË©≤Âä†ÂØÜÂØÜÁ¢º
                    role: newUserData.role,
                    status: newUserData.status,
                    createdAt: new Date().toISOString()
                });

                showAlert('Êñ∞Áî®Êà∂ÂâµÂª∫ÊàêÂäüÔºÅ');
                closeAddUserVerifyModal();
                newUserData = null;

                // Âà∑Êñ∞Áî®Êà∂ÂàóË°®
                loadUsers();
            } catch (error) {
                console.error('Error creating user:', error);
                showAlert('ÂâµÂª∫Áî®Êà∂ÊôÇÁôºÁîüÈåØË™§');
            }
        };

        // ==================== End Add User Functionality ====================

        // ========================================
        // ÂäüËÉΩÂ¢ûÂº∑ - Ë®™ÂÆ¢Áµ±Ë®à„ÄÅÂúñË°®„ÄÅÈÄöÁü•Á≠â
        // ========================================

        // ÂúñË°®ÈÄ±ÊúüÁãÄÊÖã
        let currentChartPeriod = '7d';

        // Ë®≠ÁΩÆÂúñË°®ÈÄ±Êúü
        window.setChartPeriod = function(period) {
            currentChartPeriod = period;
            document.querySelectorAll('.chart-period-btn').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    btn.classList.add('bg-primary', 'text-white');
                } else {
                    btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                    btn.classList.remove('bg-primary', 'text-white');
                }
            });
            loadVisitorTrendChart();
        };

        // ËºâÂÖ•Ë®™ÂÆ¢Ë∂®Âã¢ÂúñË°®
        async function loadVisitorTrendChart() {
            const container = document.getElementById('visitorTrendChart');
            if (!container) return;

            const days = currentChartPeriod === '7d' ? 7 : 30;
            const data = [];

            try {
                const { collection, query, where, getDocs } = window.firestoreModules;

                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];

                    const q = query(
                        collection(window.firebaseDB, 'visit_history'),
                        where('date', '==', dateStr)
                    );
                    const snapshot = await getDocs(q);
                    data.push({ date: dateStr, count: snapshot.size });
                }

                const maxCount = Math.max(...data.map(d => d.count), 1);

                container.innerHTML = data.map((d, i) => {
                    const height = (d.count / maxCount) * 100;
                    const shortDate = d.date.slice(5); // MM-DD
                    return `
                        <div class="flex flex-col items-center flex-1" title="${d.date}: ${d.count} Ê¨°Ë®™Âïè">
                            <div class="w-full bg-primary/20 rounded-t relative flex-1 flex flex-col justify-end">
                                <div class="bg-primary rounded-t transition-all duration-500" style="height: ${height}%"></div>
                            </div>
                            <span class="text-xs text-gray-500 mt-1 ${days > 7 ? 'hidden md:block' : ''}">${shortDate}</span>
                            <span class="text-xs font-semibold">${d.count}</span>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('ËºâÂÖ•Ë∂®Âã¢ÂúñË°®Â§±Êïó:', error);
                container.innerHTML = '<p class="text-gray-500 text-center w-full">ËºâÂÖ•Â§±Êïó</p>';
            }
        }

        // ËºâÂÖ•Ë®™ÂïèÊôÇÊÆµÂàÜÊûê
        async function loadHourlyChart() {
            const container = document.getElementById('hourlyChart');
            if (!container) return;

            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const today = new Date().toISOString().split('T')[0];
                const hourCounts = new Array(24).fill(0);

                const q = query(
                    collection(window.firebaseDB, 'visit_history'),
                    where('date', '==', today)
                );
                const snapshot = await getDocs(q);

                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.visitedAt) {
                        const hour = new Date(data.visitedAt.seconds * 1000).getHours();
                        hourCounts[hour]++;
                    }
                });

                const maxCount = Math.max(...hourCounts, 1);

                // È°ØÁ§∫ÈõôÂàóÔºà0-11ÊôÇÂíå12-23ÊôÇÔºâ
                container.innerHTML = hourCounts.map((count, hour) => {
                    const height = (count / maxCount) * 100;
                    return `
                        <div class="flex flex-col items-center justify-end h-full" title="${hour}ÊôÇ: ${count} Ê¨°">
                            <div class="w-full bg-blue-500 rounded-t transition-all duration-300" style="height: ${Math.max(height, 5)}%"></div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('ËºâÂÖ•ÊôÇÊÆµÂàÜÊûêÂ§±Êïó:', error);
            }
        }

        // ËºâÂÖ•Ë®≠ÂÇôÁµ±Ë®à
        async function loadDeviceStats() {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'visitors'),
                    where('active', '==', true)
                );
                const snapshot = await getDocs(q);

                let mobile = 0, tablet = 0, desktop = 0;

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const ua = (data.userAgent || '').toLowerCase();

                    if (/ipad|tablet|playbook|silk/i.test(ua)) {
                        tablet++;
                    } else if (/mobile|iphone|ipod|android|blackberry|opera mini|iemobile/i.test(ua)) {
                        mobile++;
                    } else {
                        desktop++;
                    }
                });

                document.getElementById('mobileCount').textContent = mobile;
                document.getElementById('tabletCount').textContent = tablet;
                document.getElementById('desktopCount').textContent = desktop;
            } catch (error) {
                console.error('ËºâÂÖ•Ë®≠ÂÇôÁµ±Ë®àÂ§±Êïó:', error);
            }
        }

        // ËºâÂÖ•ÁÆ°ÁêÜÂì°Êìç‰ΩúÊó•Ë™å
        async function loadAdminLogs() {
            const container = document.getElementById('adminLogsContainer');
            if (!container) return;

            try {
                const { collection, query, orderBy, limit, getDocs } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'admin_logs'),
                    orderBy('timestamp', 'desc'),
                    limit(50)
                );
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">Êö´ÁÑ°Êìç‰ΩúÊó•Ë™å</p>';
                    return;
                }

                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const log = doc.data();
                    const time = log.timestamp ? new Date(log.timestamp.seconds * 1000).toLocaleString('zh-TW') : 'Êú™Áü•ÊôÇÈñì';
                    const div = document.createElement('div');
                    div.className = 'bg-gray-50 dark:bg-gray-700 rounded-lg p-3 text-sm';
                    div.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="font-semibold">${log.adminName || 'ÁÆ°ÁêÜÂì°'}</span>
                                <span class="text-gray-600 dark:text-gray-400"> ${log.action || 'Âü∑Ë°åÊìç‰Ωú'}</span>
                            </div>
                            <span class="text-xs text-gray-500">${time}</span>
                        </div>
                        ${log.details ? `<p class="text-gray-500 dark:text-gray-400 text-xs mt-1">${log.details}</p>` : ''}
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('ËºâÂÖ•Êìç‰ΩúÊó•Ë™åÂ§±Êïó:', error);
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ËºâÂÖ•Â§±Êïó</p>';
            }
        }
        window.loadAdminLogs = loadAdminLogs;

        // Ë®òÈåÑÁÆ°ÁêÜÂì°Êìç‰Ωú
        async function logAdminAction(action, details = '') {
            try {
                const { collection, addDoc } = window.firestoreModules;
                const user = window.firebaseAuth.currentUser;
                await addDoc(collection(window.firebaseDB, 'admin_logs'), {
                    adminId: user?.uid || 'unknown',
                    adminName: user?.displayName || user?.email || 'ÁÆ°ÁêÜÂì°',
                    action: action,
                    details: details,
                    timestamp: new Date()
                });
            } catch (error) {
                console.error('Ë®òÈåÑÊìç‰ΩúÊó•Ë™åÂ§±Êïó:', error);
            }
        }

        // Â∞éÂá∫Ë®™ÂÆ¢Áµ±Ë®à CSV
        window.exportVisitorStats = async function() {
            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'visit_history'), orderBy('date', 'desc'));
                const snapshot = await getDocs(q);

                const dateCounts = {};
                snapshot.forEach(doc => {
                    const date = doc.data().date;
                    dateCounts[date] = (dateCounts[date] || 0) + 1;
                });

                let csv = 'Êó•Êúü,Ë®™ÂïèÊ¨°Êï∏\n';
                Object.entries(dateCounts).forEach(([date, count]) => {
                    csv += `${date},${count}\n`;
                });

                downloadCSV(csv, 'visitor_stats.csv');
                logAdminAction('Â∞éÂá∫Ë®™ÂÆ¢Áµ±Ë®à');
                showAlert('Ë®™ÂÆ¢Áµ±Ë®àÂ∑≤Â∞éÂá∫ÔºÅ');
            } catch (error) {
                console.error('Â∞éÂá∫Â§±Êïó:', error);
                showAlert('Â∞éÂá∫Â§±Êïó');
            }
        };

        // Â∞éÂá∫ËÅØÁµ°Ë®äÊÅØ CSV
        window.exportContactMessages = async function() {
            try {
                const { collection, query, orderBy, getDocs } = window.firestoreModules;
                const q = query(collection(window.firebaseDB, 'contact_submissions'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);

                let csv = 'ÂßìÂêç,ÈõªÈÉµ,‰∏ªÈ°å,Ë®äÊÅØ,ÊôÇÈñì,ÁãÄÊÖã\n';
                snapshot.forEach(doc => {
                    const d = doc.data();
                    const time = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleString('zh-TW') : '';
                    csv += `"${d.name || ''}","${d.email || ''}","${d.subject || ''}","${(d.message || '').replace(/"/g, '""')}","${time}","${d.status || 'unread'}"\n`;
                });

                downloadCSV(csv, 'contact_messages.csv');
                logAdminAction('Â∞éÂá∫ËÅØÁµ°Ë®äÊÅØ');
                showAlert('ËÅØÁµ°Ë®äÊÅØÂ∑≤Â∞éÂá∫ÔºÅ');
            } catch (error) {
                console.error('Â∞éÂá∫Â§±Êïó:', error);
                showAlert('Â∞éÂá∫Â§±Êïó');
            }
        };

        // ‰∏ãËºâ CSV ËºîÂä©ÂáΩÊï∏
        function downloadCSV(content, filename) {
            const blob = new Blob(['\ufeff' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        // Ê∏ÖÁêÜËàäÊï∏Êìö
        window.cleanOldData = function() {
            showConfirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁêÜ30Â§©ÂâçÁöÑË®™ÂÆ¢Ë®òÈåÑÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©ÂéüÔºÅ', async () => {
                try {
                    const { collection, query, where, getDocs, deleteDoc, doc } = window.firestoreModules;
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    const dateStr = thirtyDaysAgo.toISOString().split('T')[0];

                    const q = query(
                        collection(window.firebaseDB, 'visit_history'),
                        where('date', '<', dateStr)
                    );
                    const snapshot = await getDocs(q);

                    let count = 0;
                    const deletePromises = [];
                    snapshot.forEach(docSnap => {
                        deletePromises.push(deleteDoc(doc(window.firebaseDB, 'visit_history', docSnap.id)));
                        count++;
                    });

                    await Promise.all(deletePromises);
                    logAdminAction('Ê∏ÖÁêÜËàäÊï∏Êìö', `Âà™Èô§‰∫Ü ${count} Ê¢ùË®òÈåÑ`);
                    showAlert(`Â∑≤Ê∏ÖÁêÜ ${count} Ê¢ùËàäË®òÈåÑÔºÅ`);
                    loadVisitorStats();
                } catch (error) {
                    console.error('Ê∏ÖÁêÜÂ§±Êïó:', error);
                    showAlert('Ê∏ÖÁêÜÂ§±Êïó');
                }
            });
        };

        // ËºâÂÖ•Êú™ËÆÄË®äÊÅØÊï∏Èáè
        async function loadUnreadContactsCount() {
            try {
                const { collection, query, where, getDocs } = window.firestoreModules;
                const q = query(
                    collection(window.firebaseDB, 'contact_submissions'),
                    where('status', '==', 'unread')
                );
                const snapshot = await getDocs(q);
                const count = snapshot.size;

                const badge = document.getElementById('unreadContactsBadge');
                if (badge) {
                    if (count > 0) {
                        badge.textContent = count > 99 ? '99+' : count;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('ËºâÂÖ•Êú™ËÆÄÊï∏ÈáèÂ§±Êïó:', error);
            }
        }

        // ÁôªÂÖ•Â§±ÊïóË®àÊï∏ÔºàÂÆâÂÖ®ÊÄßÔºâ
        let loginAttempts = {};
        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_DURATION = 15 * 60 * 1000; // 15ÂàÜÈêò

        function checkLoginAttempts(email) {
            const now = Date.now();
            const attempts = loginAttempts[email];

            if (attempts && attempts.count >= MAX_LOGIN_ATTEMPTS) {
                const timeLeft = LOCKOUT_DURATION - (now - attempts.lastAttempt);
                if (timeLeft > 0) {
                    const minutes = Math.ceil(timeLeft / 60000);
                    return { blocked: true, message: `ÁôªÂÖ•ÂòóË©¶Ê¨°Êï∏ÈÅéÂ§öÔºåË´ã ${minutes} ÂàÜÈêòÂæåÂÜçË©¶` };
                } else {
                    delete loginAttempts[email];
                }
            }
            return { blocked: false };
        }

        function recordLoginAttempt(email, success) {
            if (success) {
                delete loginAttempts[email];
            } else {
                if (!loginAttempts[email]) {
                    loginAttempts[email] = { count: 0, lastAttempt: 0 };
                }
                loginAttempts[email].count++;
                loginAttempts[email].lastAttempt = Date.now();
            }
        }

        // ÊéíÈöäË®≠ÁΩÆË°®ÂñÆ
        const queueSettingsForm = document.getElementById('queueSettingsForm');
        if (queueSettingsForm) {
            queueSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const { doc, setDoc } = window.firestoreModules;
                    await setDoc(doc(window.firebaseDB, 'settings', 'queue'), {
                        customMessage: document.getElementById('queueCustomMessage').value,
                        imageUrl: document.getElementById('queueImageUrl').value,
                        waitTimePerPerson: parseInt(document.getElementById('queueWaitTimePerPerson').value) || 2
                    }, { merge: true });

                    logAdminAction('Êõ¥Êñ∞ÊéíÈöäË®≠ÁΩÆ');
                    showAlert('ÊéíÈöäË®≠ÁΩÆÂ∑≤ÂÑ≤Â≠òÔºÅ');
                } catch (error) {
                    console.error('ÂÑ≤Â≠òÊéíÈöäË®≠ÁΩÆÂ§±Êïó:', error);
                    showAlert('ÂÑ≤Â≠òÂ§±Êïó');
                }
            });
        }

        // ËºâÂÖ•ÊéíÈöäË®≠ÁΩÆ
        async function loadQueueSettings() {
            try {
                const { doc, getDoc } = window.firestoreModules;
                const docSnap = await getDoc(doc(window.firebaseDB, 'settings', 'queue'));

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const msgEl = document.getElementById('queueCustomMessage');
                    const imgEl = document.getElementById('queueImageUrl');
                    const timeEl = document.getElementById('queueWaitTimePerPerson');

                    if (msgEl) msgEl.value = data.customMessage || '';
                    if (imgEl) imgEl.value = data.imageUrl || '';
                    if (timeEl) timeEl.value = data.waitTimePerPerson || 2;
                }
            } catch (error) {
                console.error('ËºâÂÖ•ÊéíÈöäË®≠ÁΩÆÂ§±Êïó:', error);
            }
        }

        // Êì¥Â±ï loadVisitorStats ÂáΩÊï∏
        const originalLoadVisitorStats = window.loadVisitorStats || loadVisitorStats;
        window.loadVisitorStats = async function() {
            await originalLoadVisitorStats();
            await loadVisitorTrendChart();
            await loadHourlyChart();
            await loadDeviceStats();
            await loadAdminLogs();
            await loadQueueSettings();
        };

        // ÂàùÂßãÂåñÊôÇËºâÂÖ•Êú™ËÆÄÊï∏Èáè
        setTimeout(() => {
            loadUnreadContactsCount();
            // ÂÆöÊúüÊõ¥Êñ∞Êú™ËÆÄÊï∏Èáè
            setInterval(loadUnreadContactsCount, 30000);
        }, 2000);

        // === ÈÄöÁî®Ë°®ÂñÆÂ∞çË©±Ê°Ü ===
        function showGenericFormDialog(title, fields, onSubmit) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">${title}</h3>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl">&times;</button>
                </div>
                <form id="genericForm" class="space-y-4">
                    ${fields.map(f => {
                        if (f.type === 'select') {
                            return `<div><label class="block text-sm font-semibold mb-2">${f.label}</label>
                                <select id="${f.id}" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" ${f.required ? 'required' : ''}>
                                    ${f.options.map(o => `<option value="${o}">${o}</option>`).join('')}
                                </select></div>`;
                        } else if (f.type === 'textarea') {
                            return `<div><label class="block text-sm font-semibold mb-2">${f.label}</label>
                                <textarea id="${f.id}" rows="4" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" ${f.required ? 'required' : ''}></textarea></div>`;
                        } else {
                            return `<div><label class="block text-sm font-semibold mb-2">${f.label}</label>
                                <input type="${f.type}" id="${f.id}" value="${f.value || ''}" class="w-full px-4 py-3 text-base rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700" ${f.required ? 'required' : ''}></div>`;
                        }
                    }).join('')}
                    <button type="submit" class="w-full px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-semibold transition-colors">Á¢∫Ë™ç</button>
                </form>
            </div>`;
            document.body.appendChild(modal);
            modal.querySelector('form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = {};
                fields.forEach(f => { data[f.id] = document.getElementById(f.id).value; });
                try { await onSubmit(data); modal.remove(); } catch (error) { showAlert('Êìç‰ΩúÂ§±ÊïóÔºö' + error.message); }
            });
        }

        function showInfoDialog(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">${title}</h3>
                    <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl">&times;</button>
                </div>
                <div>${content}</div>
            </div>`;
            document.body.appendChild(modal);
        }

        async function genericDelete(collectionName, id, itemName, reloadFunc) {
            if (!window.confirmDialog) {
                window.confirmDialog = function(message) {
                    return new Promise(resolve => {
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                        modal.innerHTML = `<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                            <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                            <div class="flex justify-end space-x-3">
                                <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">ÂèñÊ∂à</button>
                                <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Á¢∫Ë™ç</button>
                            </div>
                        </div>`;
                        document.body.appendChild(modal);
                        modal.querySelector('.cancel-btn').onclick = () => { modal.remove(); resolve(false); };
                        modal.querySelector('.confirm-btn').onclick = () => { modal.remove(); resolve(true); };
                    });
                };
            }
            const confirmed = await window.confirmDialog(`Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§${itemName}ÂóéÔºü`);
            if (!confirmed) return;
            try {
                const { doc, deleteDoc } = window.firestoreModules;
                await deleteDoc(doc(window.firebaseDB, collectionName, id));
                showAlert(`${itemName}Â∑≤Âà™Èô§ÔºÅ`);
                reloadFunc();
            } catch (error) { showAlert('Âà™Èô§Â§±Êïó'); }
        }

        // === ÂàáÊèõÂäüËÉΩÂçÄÂ°äÊôÇËºâÂÖ•Â∞çÊáâË≥áÊñô ===
        const originalSwitchSection = window.switchSection || function() {};
        window.switchSection = function(sectionId) {
            // ÂëºÂè´ÂéüÊú¨ÁöÑÂàáÊèõÂäüËÉΩ
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            const target = document.getElementById(sectionId + 'Section');
            if (target) target.classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-primary/10', 'text-primary', 'font-semibold');
                if (btn.dataset.section === sectionId) {
                    btn.classList.add('bg-primary/10', 'text-primary', 'font-semibold');
                }
            });
                    };

        // Member Card Popup Functions
        const memberCardHTML = `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊúÉÂì°Âç°Ë®≠Ë®à</title>
    <script src="https://cdn.tailwindcss.com"><\/script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"><\/script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"><\/script>
    <style>
        :root { --primary: #5D5CDE; --primary-dark: #4a49b8; --accent: #00D4FF; --accent-glow: rgba(0, 212, 255, 0.5); }
        body { font-family: 'Noto Sans TC', sans-serif; background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0d0d2b 100%); min-height: 100vh; }
        .card-container { perspective: 1000px; }
        .member-card { width: 428px; height: 270px; min-width: 428px; max-width: 428px; min-height: 270px; max-height: 270px; border-radius: 20px; position: relative; overflow: hidden; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; flex-shrink: 0; }
        .card-container:hover .member-card { transform: rotateY(10deg) rotateX(5deg); }
        .card-front { width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a3a 0%, #2d2d5a 50%, #1a1a3a 100%); border: 2px solid rgba(93, 92, 222, 0.5); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 40px rgba(93, 92, 222, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1); }
        .circuit-pattern { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.08; background-image: linear-gradient(rgba(0, 212, 255, 0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 212, 255, 0.3) 1px, transparent 1px), radial-gradient(circle at 20% 30%, rgba(93, 92, 222, 0.4) 0%, transparent 40%), radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.3) 0%, transparent 40%); background-size: 30px 30px, 30px 30px, 100% 100%, 100% 100%; }
        .logo-icon { font-family: 'Orbitron', monospace; font-weight: 800; font-size: 2rem; color: #00D4FF; }
        .chip { width: 50px; height: 40px; background: linear-gradient(135deg, #d4af37 0%, #f7e98e 50%, #d4af37 100%); border-radius: 6px; position: relative; box-shadow: 0 2px 10px rgba(212, 175, 55, 0.3); }
        .chip::before { content: ''; position: absolute; inset: 4px; background: linear-gradient(135deg, #b8941f, #e6d574, #b8941f); border-radius: 4px; }
        .chip::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; height: 60%; border: 2px solid rgba(0,0,0,0.2); border-radius: 2px; }
        .member-name { font-family: 'Orbitron', monospace; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; }
        .member-id { font-family: 'Orbitron', monospace; letter-spacing: 4px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .nfc-icon { position: absolute; right: 25px; top: 25px; width: 30px; height: 30px; opacity: 0.6; }
        .sticker-area { background: rgba(255, 255, 255, 0.08); border: 2px dashed rgba(0, 212, 255, 0.4); border-radius: 8px; min-height: 50px; display: flex; flex-direction: column; justify-content: center; padding: 8px 12px; }
        .sticker { background: transparent; border-radius: 6px; padding: 12px 20px; }
        .qr-container { width: 55px; height: 55px; background: white; border-radius: 4px; padding: 3px; display: flex; align-items: center; justify-content: center; }
        .qr-container img { width: 100% !important; height: 100% !important; }
        .input-field { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(93, 92, 222, 0.3); border-radius: 12px; padding: 12px 16px; color: white; font-size: 16px; transition: all 0.3s; }
        .input-field:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 20px rgba(0, 212, 255, 0.2); background: rgba(255, 255, 255, 0.08); }
        .input-field::placeholder { color: rgba(255, 255, 255, 0.4); }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #7B68EE); border: none; padding: 14px 28px; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 20px rgba(93, 92, 222, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(93, 92, 222, 0.6); }
        .btn-secondary { background: linear-gradient(135deg, #374151, #4b5563); border: none; padding: 14px 28px; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 20px rgba(55, 65, 81, 0.4); }
        .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(55, 65, 81, 0.6); }
        .btn-sticker { background: linear-gradient(135deg, #10b981, #059669); border: none; padding: 12px 24px; border-radius: 12px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4); }
        .btn-sticker:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6); }
        .card-back { width: 428px; height: 270px; min-width: 428px; max-width: 428px; min-height: 270px; max-height: 270px; border-radius: 20px; background: linear-gradient(135deg, #1a1a3a 0%, #2d2d5a 50%, #1a1a3a 100%); border: 2px solid rgba(93, 92, 222, 0.5); position: relative; overflow: hidden; flex-shrink: 0; }
        .magnetic-strip { position: absolute; top: 30px; left: 0; right: 0; height: 45px; background: linear-gradient(180deg, #1a1a1a 0%, #333 50%, #1a1a1a 100%); }
        .signature-area { position: relative; height: 28px; background: rgba(255, 255, 255, 0.9); border-radius: 4px; }
        .tab-btn { padding: 12px 20px; border-radius: 12px; font-weight: 600; transition: all 0.3s; border: none; cursor: pointer; }
        .tab-btn.active { background: linear-gradient(135deg, var(--primary), #7B68EE); color: white; }
        .tab-btn:not(.active) { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); }
        .tab-btn:not(.active):hover { background: rgba(255, 255, 255, 0.15); }
        /* Use container query or initial check instead of viewport-based media query to prevent resize on keyboard popup */
        .member-card.card-small, .card-back.card-small { width: 340px; height: 214px; min-width: 340px; max-width: 340px; min-height: 214px; max-height: 214px; }
        .card-small .logo-icon { font-size: 1.5rem; }
        .card-small .member-name { font-size: 0.9rem; }
        .card-small .member-id { max-width: 150px; }
    </style>
</head>
<body class="p-4 md:p-6" onload="initCardSize()">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-center gap-2 mb-6 flex-wrap">
            <button onclick="switchTab('named')" id="tabNamed" class="tab-btn active">Ë®òÂêçÊúÉÂì°Âç°</button>
            <button onclick="switchTab('sticker')" id="tabSticker" class="tab-btn">Ë≤ºÁ¥ôÁâàÊúÉÂì°Âç°</button>
            <button onclick="switchTab('anonymous')" id="tabAnonymous" class="tab-btn">‰∏çË®òÂêçÊúÉÂì°Âç°</button>
            <button onclick="switchTab('temporary')" id="tabTemporary" class="tab-btn">Ëá®ÊôÇÊúÉÂì°Âç°</button>
        </div>
        <div id="namedView">
            <div class="flex flex-col lg:flex-row gap-6 items-center justify-center mb-8">
                <div class="card-container">
                    <div id="namedCard" class="member-card card-front rounded-[20px]">
                        <div class="circuit-pattern"></div>
                        <svg class="nfc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--accent);"><path d="M6 8.32a7.43 7.43 0 0 1 0 7.36"/><path d="M9.46 6.21a11.76 11.76 0 0 1 0 11.58"/><path d="M12.91 4.1a15.91 15.91 0 0 1 .01 15.8"/><path d="M16.37 2a20.16 20.16 0 0 1 0 20"/></svg>
                        <div class="relative z-10 p-6 h-full flex flex-col justify-between">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center">
                                        <img src="https://pfst.cf2.poecdn.net/base/image/f51f06131e7dccefe87b6c4e9775bb4df5572cba70d97d94b9fdda40b4ad603c?w=915&h=829" alt="STC Logo" class="w-full h-full object-contain">
                                    </div>
                                    <div>
                                        <div class="logo-icon text-xl">ATS</div>
                                        <div class="text-[10px] text-gray-300">ÁßëÊäÄÂ≠∏ÊúÉ</div>
                                        <div class="text-[7px] text-gray-400 tracking-wider">SCIENCE AND TECHNOLOGY CLUB</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div id="namedDisplayRoleEn" class="text-[10px] text-cyan-400 font-semibold tracking-wider">MEMBER</div>
                                    <div id="namedDisplayRole" class="text-xs text-gray-300">ÊúÉÂì°</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="chip"></div>
                                <div class="flex-1">
                                    <div id="namedDisplayNameCn" class="text-white text-sm">Èô≥Â§ßÊñá</div>
                                    <div id="namedDisplayName" class="member-name text-white text-base tracking-wider">CHAN TAI MAN</div>
                                    <div class="text-[10px] text-gray-500">ÊåÅÂç°‰∫∫ CARDHOLDER</div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúÉÂì°Á∑®Ëôü MEMBER ID</div>
                                    <div id="namedDisplayId" class="member-id text-cyan-400 text-sm">ATS-2024-0001</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúâÊïàÊó•Êúü VALID THRU</div>
                                    <div id="namedDisplayExpiry" class="text-gray-300 text-sm font-medium">12/25</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Back Card -->
                <div class="card-container">
                    <div id="namedCardBack" class="card-back">
                        <div class="circuit-pattern"></div>
                        <div class="magnetic-strip"></div>
                        <div class="absolute top-[90px] left-5 right-5 flex gap-4 items-start">
                            <div class="flex-1">
                                <div class="text-[8px] text-gray-500 mb-1">Á∞ΩÂêçÂçÄ SIGNATURE (4cm x 0.8cm)</div>
                                <div class="signature-area flex items-center px-3"></div>
                            </div>
                            <div class="qr-container" id="qrcode1"></div>
                        </div>
                        <div class="absolute bottom-5 left-5 right-5">
                            <div class="text-[8px] text-gray-500 leading-relaxed mb-3">Ê≠§Âç°ÁÇ∫ÁßëÊäÄÂ≠∏ÊúÉÂÆòÊñπÊúÉÂì°ÊÜëË≠â„ÄÇÂ¶ÇÊúâÈÅ∫Â§±Ë´ãÁ´ãÂç≥ËÅØÁπ´Â≠∏ÊúÉ„ÄÇ<br>This card is the official membership credential of ATS Tech Society.</div>
                            <div class="text-[10px] text-gray-400 text-right"><span class="text-cyan-400">‚óè</span> tech-society-website-eta.vercel.app</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-6 md:p-8 mb-8">
                <h2 class="text-xl font-semibold text-white mb-6 flex items-center gap-2">
                    <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    Ëá™Ë®ÇÊúÉÂì°Âç°
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div><label class="block text-sm text-gray-400 mb-2">‰∏≠ÊñáÂßìÂêç</label><input type="text" id="namedMemberNameCn" class="input-field w-full" value="Èô≥Â§ßÊñá" oninput="updateNamedCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">Ëã±ÊñáÂßìÂêç</label><input type="text" id="namedMemberName" class="input-field w-full" value="CHAN TAI MAN" oninput="updateNamedCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">ÊúÉÂì°Á∑®Ëôü</label><input type="text" id="namedMemberId" class="input-field w-full" value="ATS-2024-0001" oninput="updateNamedCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">ËÅ∑‰Ωç</label><select id="namedMemberRole" class="input-field w-full" onchange="updateNamedCard()"><option value="ÊúÉÂì°">ÊúÉÂì°</option><option value="Âππ‰∫ã">Âππ‰∫ã</option><option value="ÂâØÊúÉÈï∑">ÂâØÊúÉÈï∑</option><option value="ÊúÉÈï∑">ÊúÉÈï∑</option><option value="ÂâØ‰∏ªÂ∏≠">ÂâØ‰∏ªÂ∏≠</option><option value="‰∏ªÂ∏≠">‰∏ªÂ∏≠</option><option value="È°ßÂïè">È°ßÂïè</option><option value="Ê¶ÆË≠ΩÊúÉÂì°">Ê¶ÆË≠ΩÊúÉÂì°</option></select></div>
                    <div><label class="block text-sm text-gray-400 mb-2">ÊúâÊïàÊó•Êúü</label><input type="month" id="namedExpiryDate" class="input-field w-full" value="2025-12" oninput="updateNamedCard()"></div>
                </div>
                <div class="flex flex-wrap gap-4 justify-center">
                    <button onclick="downloadCard('namedCard')" class="btn-primary flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        ‰∏ãËºâÊúÉÂì°Âç°ÔºàÊ≠£Èù¢Ôºâ
                    </button>
                    <button onclick="downloadCard('namedCardBack')" class="btn-secondary flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        ‰∏ãËºâÊúÉÂì°Âç°ÔºàËÉåÈù¢Ôºâ
                    </button>
                </div>
            </div>
        </div>
        <!-- STICKER VIEW -->
        <div id="stickerView" class="hidden">
            <div class="flex flex-col lg:flex-row gap-8 items-center justify-center mb-10">
                <div class="card-container">
                    <div id="stickerCard" class="member-card card-front rounded-[20px]">
                        <div class="circuit-pattern"></div>
                        <svg class="nfc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--accent);"><path d="M6 8.32a7.43 7.43 0 0 1 0 7.36"/><path d="M9.46 6.21a11.76 11.76 0 0 1 0 11.58"/><path d="M12.91 4.1a15.91 15.91 0 0 1 .01 15.8"/><path d="M16.37 2a20.16 20.16 0 0 1 0 20"/></svg>
                        <div class="relative z-10 p-6 h-full flex flex-col justify-between">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center">
                                        <img src="https://pfst.cf2.poecdn.net/base/image/f51f06131e7dccefe87b6c4e9775bb4df5572cba70d97d94b9fdda40b4ad603c?w=915&h=829" alt="STC Logo" class="w-full h-full object-contain">
                                    </div>
                                    <div>
                                        <div class="logo-icon text-xl">ATS</div>
                                        <div class="text-[10px] text-gray-300">ÁßëÊäÄÂ≠∏ÊúÉ</div>
                                        <div class="text-[7px] text-gray-400 tracking-wider">SCIENCE AND TECHNOLOGY CLUB</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-cyan-400 font-semibold tracking-wider">MEMBER</div>
                                    <div class="text-xs text-gray-300">ÊúÉÂì°</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="chip"></div>
                                <div class="flex-1 sticker-area"></div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúÉÂì°Á∑®Ëôü MEMBER ID</div>
                                    <div id="stickerDisplayId" class="member-id text-cyan-400 text-sm">ATS-2024-0001</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúâÊïàÊó•Êúü VALID THRU</div>
                                    <div class="sticker-area-small" style="background: rgba(255, 255, 255, 0.05); border: 1px dashed rgba(0, 212, 255, 0.3); border-radius: 4px; padding: 4px 12px; min-width: 50px; height: 20px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <h3 class="text-white font-semibold mb-4">Ë≤ºÁ¥ôÈ†êË¶Ω</h3>
                    <div class="mb-4">
                        <p class="text-gray-400 text-xs mb-2">ÂßìÂêçË≤ºÁ¥ôÔºàË≤ºÁ¥ôÂçÄÔºâ</p>
                        <div id="stickerPreviewName" class="sticker inline-block" style="white-space: nowrap;">
                            <div class="inline-flex items-center gap-2" style="white-space: nowrap;">
                                <span id="stickerDisplayNameCn" class="text-white text-sm font-medium" style="text-shadow: 0 0 3px rgba(0,0,0,0.8);">Èô≥Â§ßÊñá</span>
                                <span id="stickerDisplayName" class="member-name text-white text-sm tracking-wider" style="text-shadow: 0 0 3px rgba(0,0,0,0.8);">CHAN TAI MAN</span>
                            </div>
                        </div>
                        <p class="text-gray-500 text-xs mt-2">Âª∫Ë≠∞Â∞∫ÂØ∏Ôºö5cm x 1cm</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-xs mb-2">ÊúâÊïàÊó•ÊúüË≤ºÁ¥ôÔºàÂè≥‰∏ãËßíÔºâ</p>
                        <div id="stickerPreviewExpiry" class="sticker inline-block" style="white-space: nowrap;">
                            <div class="inline-flex items-center gap-1" style="white-space: nowrap;">
                                <span class="text-white text-xs" style="text-shadow: 0 0 3px rgba(0,0,0,0.8);">ÊúâÊïàÊó•ÊúüÔºö</span>
                                <span id="stickerDisplayExpiry" class="text-cyan-400 text-sm font-semibold" style="text-shadow: 0 0 3px rgba(0,0,0,0.8);">12/25</span>
                            </div>
                        </div>
                        <p class="text-gray-500 text-xs mt-2">Âª∫Ë≠∞Â∞∫ÂØ∏Ôºö3cm x 0.8cm</p>
                    </div>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-6 md:p-8 mb-8">
                <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-xl mb-6">
                    <p class="text-green-300 font-medium mb-1">Ë≤ºÁ¥ôÁâàÊúÉÂì°Âç°</p>
                    <p class="text-gray-400 text-sm">ÊúÉÂì°Âç°Êú¨Ë∫´‰∏çÂê´ÂßìÂêçÂíåÊúâÊïàÊó•ÊúüÔºåÊÇ®ÈúÄË¶Å‰∏ãËºâÂÖ©ÂºµË≤ºÁ¥ôÔºö<br>‚Ä¢ <span class="text-white">ÂßìÂêçË≤ºÁ¥ô</span> - Ë≤ºÂú®Âç°Áâá‰∏≠ÈñìÁöÑË≤ºÁ¥ôÂçÄ<br>‚Ä¢ <span class="text-cyan-400">ÊúâÊïàÊó•ÊúüË≤ºÁ¥ô</span> - Ë≤ºÂú®Âç°ÁâáÂè≥‰∏ãËßí</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div><label class="block text-sm text-gray-400 mb-2">ÊúÉÂì°Á∑®Ëôü</label><input type="text" id="stickerMemberId" class="input-field w-full" value="ATS-2024-0001" oninput="updateStickerCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">ÊúâÊïàÊó•Êúü</label><input type="month" id="stickerExpiryDate" class="input-field w-full" value="2025-12" oninput="updateStickerCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">‰∏≠ÊñáÂßìÂêçÔºàË≤ºÁ¥ôÔºâ</label><input type="text" id="stickerMemberNameCn" class="input-field w-full" value="Èô≥Â§ßÊñá" oninput="updateStickerCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">Ëã±ÊñáÂßìÂêçÔºàË≤ºÁ¥ôÔºâ</label><input type="text" id="stickerMemberName" class="input-field w-full" value="CHAN TAI MAN" oninput="updateStickerCard()"></div>
                </div>
                <div class="flex flex-wrap gap-4 justify-center">
                    <button onclick="downloadCard('stickerCard')" class="btn-primary flex items-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>‰∏ãËºâÊúÉÂì°Âç°</button>
                    <button onclick="downloadNameSticker()" class="btn-sticker flex items-center gap-2">‰∏ãËºâÂßìÂêçË≤ºÁ¥ô</button>
                    <button onclick="downloadExpirySticker()" class="btn-sticker flex items-center gap-2" style="background: linear-gradient(135deg, #0891b2, #0e7490);">‰∏ãËºâÊúâÊïàÊó•ÊúüË≤ºÁ¥ô</button>
                </div>
            </div>
        </div>
        <!-- ANONYMOUS VIEW -->
        <div id="anonymousView" class="hidden">
            <div class="flex flex-col lg:flex-row gap-8 items-center justify-center mb-10">
                <div class="card-container">
                    <div id="anonymousCard" class="member-card card-front rounded-[20px]">
                        <div class="circuit-pattern"></div>
                        <svg class="nfc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--accent);"><path d="M6 8.32a7.43 7.43 0 0 1 0 7.36"/><path d="M9.46 6.21a11.76 11.76 0 0 1 0 11.58"/><path d="M12.91 4.1a15.91 15.91 0 0 1 .01 15.8"/><path d="M16.37 2a20.16 20.16 0 0 1 0 20"/></svg>
                        <div class="relative z-10 p-6 h-full flex flex-col justify-between">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center">
                                        <img src="https://pfst.cf2.poecdn.net/base/image/f51f06131e7dccefe87b6c4e9775bb4df5572cba70d97d94b9fdda40b4ad603c?w=915&h=829" alt="STC Logo" class="w-full h-full object-contain">
                                    </div>
                                    <div>
                                        <div class="logo-icon text-xl">ATS</div>
                                        <div class="text-[10px] text-gray-300">ÁßëÊäÄÂ≠∏ÊúÉ</div>
                                        <div class="text-[7px] text-gray-400 tracking-wider">SCIENCE AND TECHNOLOGY CLUB</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-cyan-400 font-semibold tracking-wider">MEMBER</div>
                                    <div class="text-xs text-gray-300">ÊúÉÂì°</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="chip"></div>
                                <div class="flex-1">
                                    <div class="member-name text-white text-lg tracking-wider">MEMBER</div>
                                    <div class="text-[10px] text-gray-500 mt-1">ÊåÅÂç°‰∫∫ CARDHOLDER</div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúÉÂì°Á∑®Ëôü MEMBER ID</div>
                                    <div class="member-id text-cyan-400 text-sm">ATS-XXXX-XXXX</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúâÊïàÊó•Êúü VALID THRU</div>
                                    <div class="text-gray-300 text-sm font-medium">--/--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-6 md:p-8 mb-8">
                <div class="p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-xl mb-6">
                    <p class="text-cyan-300 font-medium mb-1">‰∏çË®òÂêçÊúÉÂì°Âç°</p>
                    <p class="text-gray-400 text-sm">Ê≠§Âç°Áâá‰∏çÂåÖÂê´ÂÄã‰∫∫Ë≥áÊñôÔºåÂèØÁî®ÊñºËá®ÊôÇÊúÉÂì°ÊàñÊ¥ªÂãïÂèÉËàáËÄÖ„ÄÇ</p>
                </div>
                <div class="flex flex-wrap gap-4 justify-center">
                    <button onclick="downloadCard('anonymousCard')" class="btn-primary flex items-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>‰∏ãËºâÊúÉÂì°Âç°</button>
                </div>
            </div>
        </div>
        <!-- TEMPORARY VIEW -->
        <div id="temporaryView" class="hidden">
            <div class="flex flex-col lg:flex-row gap-8 items-center justify-center mb-10">
                <div class="card-container">
                    <div id="temporaryCard" class="member-card card-front rounded-[20px]" style="border-color: rgba(251, 191, 36, 0.5); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 40px rgba(251, 191, 36, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);">
                        <div class="circuit-pattern"></div>
                        <svg class="nfc-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--accent);"><path d="M6 8.32a7.43 7.43 0 0 1 0 7.36"/><path d="M9.46 6.21a11.76 11.76 0 0 1 0 11.58"/><path d="M12.91 4.1a15.91 15.91 0 0 1 .01 15.8"/><path d="M16.37 2a20.16 20.16 0 0 1 0 20"/></svg>
                        <div class="relative z-10 p-6 h-full flex flex-col justify-between">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center">
                                        <img src="https://pfst.cf2.poecdn.net/base/image/f51f06131e7dccefe87b6c4e9775bb4df5572cba70d97d94b9fdda40b4ad603c?w=915&h=829" alt="STC Logo" class="w-full h-full object-contain">
                                    </div>
                                    <div>
                                        <div class="logo-icon text-xl" style="color: #fbbf24;">ATS</div>
                                        <div class="text-[10px] text-gray-300">ÁßëÊäÄÂ≠∏ÊúÉ</div>
                                        <div class="text-[7px] text-gray-400 tracking-wider">SCIENCE AND TECHNOLOGY CLUB</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-yellow-400 font-semibold tracking-wider">TEMPORARY</div>
                                    <div class="text-xs text-gray-300">Ëá®ÊôÇÊúÉÂì°</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="chip"></div>
                                <div class="flex-1">
                                    <div id="tempDisplayNameCn" class="text-white text-sm">Ë®™ÂÆ¢</div>
                                    <div id="tempDisplayName" class="member-name text-white text-base tracking-wider">VISITOR</div>
                                    <div class="text-[10px] text-gray-500">Ëá®ÊôÇÊåÅÂç°‰∫∫ TEMP CARDHOLDER</div>
                                </div>
                            </div>
                            <div class="flex items-end justify-between">
                                <div>
                                    <div class="text-[10px] text-gray-500 mb-1">Ëá®ÊôÇÁ∑®Ëôü TEMP ID</div>
                                    <div id="tempDisplayId" class="member-id text-yellow-400 text-sm">TMP-2024-0001</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] text-gray-500 mb-1">ÊúâÊïàÊó•Êúü VALID THRU</div>
                                    <div id="tempDisplayExpiry" class="text-gray-300 text-sm font-medium">12/25</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-6 md:p-8 mb-8">
                <div class="p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl mb-6">
                    <p class="text-yellow-300 font-medium mb-1">Ëá®ÊôÇÊúÉÂì°Âç°</p>
                    <p class="text-gray-400 text-sm">Ê≠§Âç°ÁâáÈÅ©Áî®ÊñºËá®ÊôÇË®™ÂÆ¢„ÄÅÊ¥ªÂãïÂèÉËàáËÄÖÊàñÁü≠ÊúüÊúÉÂì°„ÄÇ</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div><label class="block text-sm text-gray-400 mb-2">‰∏≠ÊñáÂßìÂêç</label><input type="text" id="tempMemberNameCn" class="input-field w-full" value="Ë®™ÂÆ¢" oninput="updateTempCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">Ëã±ÊñáÂßìÂêç</label><input type="text" id="tempMemberName" class="input-field w-full" value="VISITOR" oninput="updateTempCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">Ëá®ÊôÇÁ∑®Ëôü</label><input type="text" id="tempMemberId" class="input-field w-full" value="TMP-2024-0001" oninput="updateTempCard()"></div>
                    <div><label class="block text-sm text-gray-400 mb-2">ÊúâÊïàÊó•Êúü</label><input type="month" id="tempExpiryDate" class="input-field w-full" value="2025-12" oninput="updateTempCard()"></div>
                </div>
                <div class="flex flex-wrap gap-4 justify-center">
                    <button onclick="downloadCard('temporaryCard')" class="btn-primary flex items-center gap-2" style="background: linear-gradient(135deg, #f59e0b, #d97706);"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>‰∏ãËºâËá®ÊôÇÊúÉÂì°Âç°</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const roleMap = {'ÊúÉÂì°':'MEMBER','Âππ‰∫ã':'COMMITTEE','ÂâØÊúÉÈï∑':'VICE PRESIDENT','ÊúÉÈï∑':'PRESIDENT','ÂâØ‰∏ªÂ∏≠':'VICE CHAIRMAN','‰∏ªÂ∏≠':'CHAIRMAN','È°ßÂïè':'ADVISOR','Ê¶ÆË≠ΩÊúÉÂì°':'HONORARY'};
        function switchTab(tab) {
            const tabs = ['named', 'sticker', 'anonymous', 'temporary'];
            tabs.forEach(t => { document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1)).classList.remove('active'); document.getElementById(t+'View').classList.add('hidden'); });
            document.getElementById('tab'+tab.charAt(0).toUpperCase()+tab.slice(1)).classList.add('active');
            document.getElementById(tab+'View').classList.remove('hidden');
        }
        function updateNamedCard() {
            const nameCn = document.getElementById('namedMemberNameCn').value || 'ÊúÉÂì°ÂßìÂêç';
            const name = document.getElementById('namedMemberName').value || 'MEMBER NAME';
            const id = document.getElementById('namedMemberId').value || 'ATS-2024-0001';
            const role = document.getElementById('namedMemberRole').value;
            const expiry = document.getElementById('namedExpiryDate').value;
            document.getElementById('namedDisplayNameCn').textContent = nameCn;
            document.getElementById('namedDisplayName').textContent = name.toUpperCase();
            document.getElementById('namedDisplayId').textContent = id.toUpperCase();
            document.getElementById('namedDisplayRole').textContent = role;
            document.getElementById('namedDisplayRoleEn').textContent = roleMap[role] || 'MEMBER';
            if (expiry) { const [year, month] = expiry.split('-'); document.getElementById('namedDisplayExpiry').textContent = month+'/'+year.slice(-2); }
        }
        function updateStickerCard() {
            const nameCn = document.getElementById('stickerMemberNameCn').value || 'ÊúÉÂì°ÂßìÂêç';
            const name = document.getElementById('stickerMemberName').value || 'MEMBER NAME';
            const id = document.getElementById('stickerMemberId').value || 'ATS-2024-0001';
            const expiry = document.getElementById('stickerExpiryDate').value;
            document.getElementById('stickerDisplayId').textContent = id.toUpperCase();
            document.getElementById('stickerDisplayNameCn').textContent = nameCn;
            document.getElementById('stickerDisplayName').textContent = name.toUpperCase();
            if (expiry) { const [year, month] = expiry.split('-'); document.getElementById('stickerDisplayExpiry').textContent = month+'/'+year.slice(-2); }
        }
        function updateTempCard() {
            const nameCn = document.getElementById('tempMemberNameCn').value || 'Ë®™ÂÆ¢';
            const name = document.getElementById('tempMemberName').value || 'VISITOR';
            const id = document.getElementById('tempMemberId').value || 'TMP-2024-0001';
            const expiry = document.getElementById('tempExpiryDate').value;
            document.getElementById('tempDisplayNameCn').textContent = nameCn;
            document.getElementById('tempDisplayName').textContent = name.toUpperCase();
            document.getElementById('tempDisplayId').textContent = id.toUpperCase();
            if (expiry) { const [year, month] = expiry.split('-'); document.getElementById('tempDisplayExpiry').textContent = month+'/'+year.slice(-2); }
        }
        async function downloadCard(cardId) {
            const card = document.getElementById(cardId);
            try {
                const canvas = await html2canvas(card, { scale: 3, backgroundColor: null, logging: false, useCORS: true, removeContainer: true, onclone: function(clonedDoc) { const clonedCard = clonedDoc.getElementById(cardId); if (clonedCard) { clonedCard.style.transform = 'none'; clonedCard.style.overflow = 'hidden'; clonedCard.style.background = 'linear-gradient(135deg, #1a1a3a 0%, #2d2d5a 50%, #1a1a3a 100%)'; } } });
                const link = document.createElement('a'); link.download = 'ATS-ÊúÉÂì°Âç°-'+cardId+'.png'; link.href = canvas.toDataURL('image/png'); link.click();
            } catch (error) { console.error('Download error:', error); }
        }
        async function downloadNameSticker() {
            const sticker = document.getElementById('stickerPreviewName');
            try {
                const canvas = await html2canvas(sticker, { scale: 4, backgroundColor: null, logging: false, useCORS: true });
                const link = document.createElement('a');
                const name = document.getElementById('stickerMemberName').value || 'member';
                link.download = 'ATS-ÂßìÂêçË≤ºÁ¥ô-'+name+'.png'; link.href = canvas.toDataURL('image/png'); link.click();
            } catch (error) { console.error('Download error:', error); }
        }
        async function downloadExpirySticker() {
            const sticker = document.getElementById('stickerPreviewExpiry');
            try {
                const canvas = await html2canvas(sticker, { scale: 4, backgroundColor: null, logging: false, useCORS: true });
                const link = document.createElement('a');
                const expiry = document.getElementById('stickerDisplayExpiry').textContent || 'expiry';
                link.download = 'ATS-ÊúâÊïàÊó•ÊúüË≤ºÁ¥ô-'+expiry.replace('/', '-')+'.png'; link.href = canvas.toDataURL('image/png'); link.click();
            } catch (error) { console.error('Download error:', error); }
        }
        function generateQRCodes() {
            const container = document.getElementById('qrcode1');
            if (container) {
                container.innerHTML = '';
                new QRCode(container, {
                    text: 'https://tech-society-website-eta.vercel.app/index.html',
                    width: 49,
                    height: 49,
                    colorDark: '#1a1a3a',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.M
                });
            }
        }
        // Initialize card size based on initial screen width (prevents resize when keyboard pops up)
        function initCardSize() {
            const isSmallScreen = window.innerWidth <= 500;
            document.querySelectorAll('.member-card, .card-back').forEach(card => {
                if (isSmallScreen) {
                    card.classList.add('card-small');
                } else {
                    card.classList.remove('card-small');
                }
            });
        }
        updateNamedCard();
        updateStickerCard();
        updateTempCard();
        generateQRCodes();
        initCardSize();
    <\/script>
    <div style="position:fixed;bottom:8px;right:8px;font-size:10px;color:rgba(255,255,255,0.4);background:rgba(0,0,0,0.3);padding:4px 8px;border-radius:8px;">v5.7.4 - ÊúÉÂì°Âç°</div>
</body>
</html>`;

        function openMemberCardPopup() {
            const modal = document.getElementById('memberCardModal');
            const iframe = document.getElementById('memberCardIframe');
            modal.classList.remove('hidden');
            iframe.srcdoc = memberCardHTML;
            document.body.style.overflow = 'hidden';
        }

        function closeMemberCardPopup() {
            const modal = document.getElementById('memberCardModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMemberCardPopup();
            }
        });

        // Close modal on background click
        document.getElementById('memberCardModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeMemberCardPopup();
            }
        });

    </script>

    <!-- ÁâàÊú¨ËôüÈ°ØÁ§∫ -->
    <div class="fixed bottom-2 right-2 text-xs text-gray-400 dark:text-gray-600 bg-white dark:bg-gray-800 px-3 py-1 rounded-full shadow-sm z-50">
        v5.7.1 - ÂæåÂè∞
    </div>
</body>
</html>
